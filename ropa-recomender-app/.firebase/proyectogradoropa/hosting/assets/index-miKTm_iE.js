var Ek=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var P8=Ek((B8,ZD)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function _S(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var uy={exports:{}},gh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xE;function Tk(){if(xE)return gh;xE=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,a){var s=null;if(a!==void 0&&(s=""+a),i.key!==void 0&&(s=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:r,type:n,key:s,ref:i!==void 0?i:null,props:a}}return gh.Fragment=e,gh.jsx=t,gh.jsxs=t,gh}var EE;function Sk(){return EE||(EE=1,uy.exports=Tk()),uy.exports}var Z=Sk(),ly={exports:{}},Je={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TE;function Ck(){if(TE)return Je;TE=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),s=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),m=Symbol.iterator;function v(H){return H===null||typeof H!="object"?null:(H=m&&H[m]||H["@@iterator"],typeof H=="function"?H:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,E={};function x(H,ee,pe){this.props=H,this.context=ee,this.refs=E,this.updater=pe||y}x.prototype.isReactComponent={},x.prototype.setState=function(H,ee){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,ee,"setState")},x.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function T(){}T.prototype=x.prototype;function C(H,ee,pe){this.props=H,this.context=ee,this.refs=E,this.updater=pe||y}var A=C.prototype=new T;A.constructor=C,_(A,x.prototype),A.isPureReactComponent=!0;var R=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},B=Object.prototype.hasOwnProperty;function P(H,ee,pe,ce,xe,Se){return pe=Se.ref,{$$typeof:r,type:H,key:ee,ref:pe!==void 0?pe:null,props:Se}}function I(H,ee){return P(H.type,ee,void 0,void 0,void 0,H.props)}function D(H){return typeof H=="object"&&H!==null&&H.$$typeof===r}function O(H){var ee={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(pe){return ee[pe]})}var L=/\/+/g;function F(H,ee){return typeof H=="object"&&H!==null&&H.key!=null?O(""+H.key):ee.toString(36)}function V(){}function ie(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(V,V):(H.status="pending",H.then(function(ee){H.status==="pending"&&(H.status="fulfilled",H.value=ee)},function(ee){H.status==="pending"&&(H.status="rejected",H.reason=ee)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function se(H,ee,pe,ce,xe){var Se=typeof H;(Se==="undefined"||Se==="boolean")&&(H=null);var Ee=!1;if(H===null)Ee=!0;else switch(Se){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(H.$$typeof){case r:case e:Ee=!0;break;case d:return Ee=H._init,se(Ee(H._payload),ee,pe,ce,xe)}}if(Ee)return xe=xe(H),Ee=ce===""?"."+F(H,0):ce,R(xe)?(pe="",Ee!=null&&(pe=Ee.replace(L,"$&/")+"/"),se(xe,ee,pe,"",function(Ke){return Ke})):xe!=null&&(D(xe)&&(xe=I(xe,pe+(xe.key==null||H&&H.key===xe.key?"":(""+xe.key).replace(L,"$&/")+"/")+Ee)),ee.push(xe)),1;Ee=0;var Ve=ce===""?".":ce+":";if(R(H))for(var ke=0;ke<H.length;ke++)ce=H[ke],Se=Ve+F(ce,ke),Ee+=se(ce,ee,pe,Se,xe);else if(ke=v(H),typeof ke=="function")for(H=ke.call(H),ke=0;!(ce=H.next()).done;)ce=ce.value,Se=Ve+F(ce,ke++),Ee+=se(ce,ee,pe,Se,xe);else if(Se==="object"){if(typeof H.then=="function")return se(ie(H),ee,pe,ce,xe);throw ee=String(H),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function G(H,ee,pe){if(H==null)return H;var ce=[],xe=0;return se(H,ce,"","",function(Se){return ee.call(pe,Se,xe++)}),ce}function Q(H){if(H._status===-1){var ee=H._result;ee=ee(),ee.then(function(pe){(H._status===0||H._status===-1)&&(H._status=1,H._result=pe)},function(pe){(H._status===0||H._status===-1)&&(H._status=2,H._result=pe)}),H._status===-1&&(H._status=0,H._result=ee)}if(H._status===1)return H._result.default;throw H._result}var te=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)};function de(){}return Je.Children={map:G,forEach:function(H,ee,pe){G(H,function(){ee.apply(this,arguments)},pe)},count:function(H){var ee=0;return G(H,function(){ee++}),ee},toArray:function(H){return G(H,function(ee){return ee})||[]},only:function(H){if(!D(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},Je.Component=x,Je.Fragment=t,Je.Profiler=i,Je.PureComponent=C,Je.StrictMode=n,Je.Suspense=c,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Je.__COMPILER_RUNTIME={__proto__:null,c:function(H){return k.H.useMemoCache(H)}},Je.cache=function(H){return function(){return H.apply(null,arguments)}},Je.cloneElement=function(H,ee,pe){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var ce=_({},H.props),xe=H.key,Se=void 0;if(ee!=null)for(Ee in ee.ref!==void 0&&(Se=void 0),ee.key!==void 0&&(xe=""+ee.key),ee)!B.call(ee,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&ee.ref===void 0||(ce[Ee]=ee[Ee]);var Ee=arguments.length-2;if(Ee===1)ce.children=pe;else if(1<Ee){for(var Ve=Array(Ee),ke=0;ke<Ee;ke++)Ve[ke]=arguments[ke+2];ce.children=Ve}return P(H.type,xe,void 0,void 0,Se,ce)},Je.createContext=function(H){return H={$$typeof:s,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:a,_context:H},H},Je.createElement=function(H,ee,pe){var ce,xe={},Se=null;if(ee!=null)for(ce in ee.key!==void 0&&(Se=""+ee.key),ee)B.call(ee,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(xe[ce]=ee[ce]);var Ee=arguments.length-2;if(Ee===1)xe.children=pe;else if(1<Ee){for(var Ve=Array(Ee),ke=0;ke<Ee;ke++)Ve[ke]=arguments[ke+2];xe.children=Ve}if(H&&H.defaultProps)for(ce in Ee=H.defaultProps,Ee)xe[ce]===void 0&&(xe[ce]=Ee[ce]);return P(H,Se,void 0,void 0,null,xe)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(H){return{$$typeof:u,render:H}},Je.isValidElement=D,Je.lazy=function(H){return{$$typeof:d,_payload:{_status:-1,_result:H},_init:Q}},Je.memo=function(H,ee){return{$$typeof:h,type:H,compare:ee===void 0?null:ee}},Je.startTransition=function(H){var ee=k.T,pe={};k.T=pe;try{var ce=H(),xe=k.S;xe!==null&&xe(pe,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(de,te)}catch(Se){te(Se)}finally{k.T=ee}},Je.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Je.use=function(H){return k.H.use(H)},Je.useActionState=function(H,ee,pe){return k.H.useActionState(H,ee,pe)},Je.useCallback=function(H,ee){return k.H.useCallback(H,ee)},Je.useContext=function(H){return k.H.useContext(H)},Je.useDebugValue=function(){},Je.useDeferredValue=function(H,ee){return k.H.useDeferredValue(H,ee)},Je.useEffect=function(H,ee,pe){var ce=k.H;if(typeof pe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ce.useEffect(H,ee)},Je.useId=function(){return k.H.useId()},Je.useImperativeHandle=function(H,ee,pe){return k.H.useImperativeHandle(H,ee,pe)},Je.useInsertionEffect=function(H,ee){return k.H.useInsertionEffect(H,ee)},Je.useLayoutEffect=function(H,ee){return k.H.useLayoutEffect(H,ee)},Je.useMemo=function(H,ee){return k.H.useMemo(H,ee)},Je.useOptimistic=function(H,ee){return k.H.useOptimistic(H,ee)},Je.useReducer=function(H,ee,pe){return k.H.useReducer(H,ee,pe)},Je.useRef=function(H){return k.H.useRef(H)},Je.useState=function(H){return k.H.useState(H)},Je.useSyncExternalStore=function(H,ee,pe){return k.H.useSyncExternalStore(H,ee,pe)},Je.useTransition=function(){return k.H.useTransition()},Je.version="19.1.0",Je}var SE;function tb(){return SE||(SE=1,ly.exports=Ck()),ly.exports}var Y=tb();const Ak=_S(Y);var cy={exports:{}},yh={},hy={exports:{}},fy={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CE;function Rk(){return CE||(CE=1,function(r){function e(G,Q){var te=G.length;G.push(Q);e:for(;0<te;){var de=te-1>>>1,H=G[de];if(0<i(H,Q))G[de]=Q,G[te]=H,te=de;else break e}}function t(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var Q=G[0],te=G.pop();if(te!==Q){G[0]=te;e:for(var de=0,H=G.length,ee=H>>>1;de<ee;){var pe=2*(de+1)-1,ce=G[pe],xe=pe+1,Se=G[xe];if(0>i(ce,te))xe<H&&0>i(Se,ce)?(G[de]=Se,G[xe]=te,de=xe):(G[de]=ce,G[pe]=te,de=pe);else if(xe<H&&0>i(Se,te))G[de]=Se,G[xe]=te,de=xe;else break e}}return Q}function i(G,Q){var te=G.sortIndex-Q.sortIndex;return te!==0?te:G.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();r.unstable_now=function(){return s.now()-u}}var c=[],h=[],d=1,m=null,v=3,y=!1,_=!1,E=!1,x=!1,T=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function R(G){for(var Q=t(h);Q!==null;){if(Q.callback===null)n(h);else if(Q.startTime<=G)n(h),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(h)}}function k(G){if(E=!1,R(G),!_)if(t(c)!==null)_=!0,B||(B=!0,F());else{var Q=t(h);Q!==null&&se(k,Q.startTime-G)}}var B=!1,P=-1,I=5,D=-1;function O(){return x?!0:!(r.unstable_now()-D<I)}function L(){if(x=!1,B){var G=r.unstable_now();D=G;var Q=!0;try{e:{_=!1,E&&(E=!1,C(P),P=-1),y=!0;var te=v;try{t:{for(R(G),m=t(c);m!==null&&!(m.expirationTime>G&&O());){var de=m.callback;if(typeof de=="function"){m.callback=null,v=m.priorityLevel;var H=de(m.expirationTime<=G);if(G=r.unstable_now(),typeof H=="function"){m.callback=H,R(G),Q=!0;break t}m===t(c)&&n(c),R(G)}else n(c);m=t(c)}if(m!==null)Q=!0;else{var ee=t(h);ee!==null&&se(k,ee.startTime-G),Q=!1}}break e}finally{m=null,v=te,y=!1}Q=void 0}}finally{Q?F():B=!1}}}var F;if(typeof A=="function")F=function(){A(L)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,ie=V.port2;V.port1.onmessage=L,F=function(){ie.postMessage(null)}}else F=function(){T(L,0)};function se(G,Q){P=T(function(){G(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(G){G.callback=null},r.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<G?Math.floor(1e3/G):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(G){switch(v){case 1:case 2:case 3:var Q=3;break;default:Q=v}var te=v;v=Q;try{return G()}finally{v=te}},r.unstable_requestPaint=function(){x=!0},r.unstable_runWithPriority=function(G,Q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var te=v;v=G;try{return Q()}finally{v=te}},r.unstable_scheduleCallback=function(G,Q,te){var de=r.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?de+te:de):te=de,G){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=te+H,G={id:d++,callback:Q,priorityLevel:G,startTime:te,expirationTime:H,sortIndex:-1},te>de?(G.sortIndex=te,e(h,G),t(c)===null&&G===t(h)&&(E?(C(P),P=-1):E=!0,se(k,te-de))):(G.sortIndex=H,e(c,G),_||y||(_=!0,B||(B=!0,F()))),G},r.unstable_shouldYield=O,r.unstable_wrapCallback=function(G){var Q=v;return function(){var te=v;v=Q;try{return G.apply(this,arguments)}finally{v=te}}}}(fy)),fy}var AE;function Ik(){return AE||(AE=1,hy.exports=Rk()),hy.exports}var dy={exports:{}},Qn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RE;function Dk(){if(RE)return Qn;RE=1;var r=tb();function e(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(c,h,d){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:m==null?null:""+m,children:c,containerInfo:h,implementation:d}}var s=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,h){if(c==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Qn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Qn.createPortal=function(c,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return a(c,h,null,d)},Qn.flushSync=function(c){var h=s.T,d=n.p;try{if(s.T=null,n.p=2,c)return c()}finally{s.T=h,n.p=d,n.d.f()}},Qn.preconnect=function(c,h){typeof c=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(c,h))},Qn.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Qn.preinit=function(c,h){if(typeof c=="string"&&h&&typeof h.as=="string"){var d=h.as,m=u(d,h.crossOrigin),v=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?n.d.S(c,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:v,fetchPriority:y}):d==="script"&&n.d.X(c,{crossOrigin:m,integrity:v,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Qn.preinitModule=function(c,h){if(typeof c=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=u(h.as,h.crossOrigin);n.d.M(c,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(c)},Qn.preload=function(c,h){if(typeof c=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,m=u(d,h.crossOrigin);n.d.L(c,d,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Qn.preloadModule=function(c,h){if(typeof c=="string")if(h){var d=u(h.as,h.crossOrigin);n.d.m(c,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(c)},Qn.requestFormReset=function(c){n.d.r(c)},Qn.unstable_batchedUpdates=function(c,h){return c(h)},Qn.useFormState=function(c,h,d){return s.H.useFormState(c,h,d)},Qn.useFormStatus=function(){return s.H.useHostTransitionStatus()},Qn.version="19.1.0",Qn}var IE;function Nk(){if(IE)return dy.exports;IE=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),dy.exports=Dk(),dy.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DE;function kk(){if(DE)return yh;DE=1;var r=Ik(),e=tb(),t=Nk();function n(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function a(o){var l=o,f=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(f=l.return),o=l.return;while(o)}return l.tag===3?f:null}function s(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function u(o){if(a(o)!==o)throw Error(n(188))}function c(o){var l=o.alternate;if(!l){if(l=a(o),l===null)throw Error(n(188));return l!==o?null:o}for(var f=o,p=l;;){var b=f.return;if(b===null)break;var w=b.alternate;if(w===null){if(p=b.return,p!==null){f=p;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===f)return u(b),o;if(w===p)return u(b),l;w=w.sibling}throw Error(n(188))}if(f.return!==p.return)f=b,p=w;else{for(var M=!1,U=b.child;U;){if(U===f){M=!0,f=b,p=w;break}if(U===p){M=!0,p=b,f=w;break}U=U.sibling}if(!M){for(U=w.child;U;){if(U===f){M=!0,f=w,p=b;break}if(U===p){M=!0,p=w,f=b;break}U=U.sibling}if(!M)throw Error(n(189))}}if(f.alternate!==p)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?o:l}function h(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=h(o),l!==null)return l;o=o.sibling}return null}var d=Object.assign,m=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),A=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function F(o){return o===null||typeof o!="object"?null:(o=L&&o[L]||o["@@iterator"],typeof o=="function"?o:null)}var V=Symbol.for("react.client.reference");function ie(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===V?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case _:return"Fragment";case x:return"Profiler";case E:return"StrictMode";case k:return"Suspense";case B:return"SuspenseList";case D:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case y:return"Portal";case A:return(o.displayName||"Context")+".Provider";case C:return(o._context.displayName||"Context")+".Consumer";case R:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case P:return l=o.displayName||null,l!==null?l:ie(o.type)||"Memo";case I:l=o._payload,o=o._init;try{return ie(o(l))}catch{}}return null}var se=Array.isArray,G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},de=[],H=-1;function ee(o){return{current:o}}function pe(o){0>H||(o.current=de[H],de[H]=null,H--)}function ce(o,l){H++,de[H]=o.current,o.current=l}var xe=ee(null),Se=ee(null),Ee=ee(null),Ve=ee(null);function ke(o,l){switch(ce(Ee,l),ce(Se,o),ce(xe,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?Yx(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=Yx(l),o=Qx(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}pe(xe),ce(xe,o)}function Ke(){pe(xe),pe(Se),pe(Ee)}function wt(o){o.memoizedState!==null&&ce(Ve,o);var l=xe.current,f=Qx(l,o.type);l!==f&&(ce(Se,o),ce(xe,f))}function Xe(o){Se.current===o&&(pe(xe),pe(Se)),Ve.current===o&&(pe(Ve),fh._currentValue=te)}var lt=Object.prototype.hasOwnProperty,tt=r.unstable_scheduleCallback,xt=r.unstable_cancelCallback,Ct=r.unstable_shouldYield,It=r.unstable_requestPaint,Wt=r.unstable_now,dr=r.unstable_getCurrentPriorityLevel,fn=r.unstable_ImmediatePriority,Rr=r.unstable_UserBlockingPriority,Fn=r.unstable_NormalPriority,Gr=r.unstable_LowPriority,$n=r.unstable_IdlePriority,Kr=r.log,pr=r.unstable_setDisableYieldValue,Pt=null,ct=null;function Vt(o){if(typeof Kr=="function"&&pr(o),ct&&typeof ct.setStrictMode=="function")try{ct.setStrictMode(Pt,o)}catch{}}var an=Math.clz32?Math.clz32:_a,Cu=Math.log,hc=Math.LN2;function _a(o){return o>>>=0,o===0?32:31-(Cu(o)/hc|0)|0}var fi=256,di=4194304;function ur(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Au(o,l,f){var p=o.pendingLanes;if(p===0)return 0;var b=0,w=o.suspendedLanes,M=o.pingedLanes;o=o.warmLanes;var U=p&134217727;return U!==0?(p=U&~w,p!==0?b=ur(p):(M&=U,M!==0?b=ur(M):f||(f=U&~o,f!==0&&(b=ur(f))))):(U=p&~w,U!==0?b=ur(U):M!==0?b=ur(M):f||(f=p&~o,f!==0&&(b=ur(f)))),b===0?0:l!==0&&l!==b&&(l&w)===0&&(w=b&-b,f=l&-l,w>=f||w===32&&(f&4194048)!==0)?l:b}function _s(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function fc(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dc(){var o=fi;return fi<<=1,(fi&4194048)===0&&(fi=256),o}function pc(){var o=di;return di<<=1,(di&62914560)===0&&(di=4194304),o}function wa(o){for(var l=[],f=0;31>f;f++)l.push(o);return l}function xa(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function mc(o,l,f,p,b,w){var M=o.pendingLanes;o.pendingLanes=f,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=f,o.entangledLanes&=f,o.errorRecoveryDisabledLanes&=f,o.shellSuspendCounter=0;var U=o.entanglements,q=o.expirationTimes,ae=o.hiddenUpdates;for(f=M&~f;0<f;){var ve=31-an(f),ye=1<<ve;U[ve]=0,q[ve]=-1;var oe=ae[ve];if(oe!==null)for(ae[ve]=null,ve=0;ve<oe.length;ve++){var ue=oe[ve];ue!==null&&(ue.lane&=-536870913)}f&=~ye}p!==0&&Oi(o,p,0),w!==0&&b===0&&o.tag!==0&&(o.suspendedLanes|=w&~(M&~l))}function Oi(o,l,f){o.pendingLanes|=l,o.suspendedLanes&=~l;var p=31-an(l);o.entangledLanes|=l,o.entanglements[p]=o.entanglements[p]|1073741824|f&4194090}function vc(o,l){var f=o.entangledLanes|=l;for(o=o.entanglements;f;){var p=31-an(f),b=1<<p;b&l|o[p]&l&&(o[p]|=l),f&=~b}}function fo(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Ru(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function po(){var o=Q.p;return o!==0?o:(o=window.event,o===void 0?32:vE(o.type))}function Af(o,l){var f=Q.p;try{return Q.p=o,l()}finally{Q.p=f}}var Ut=Math.random().toString(36).slice(2),dn="__reactFiber$"+Ut,on="__reactProps$"+Ut,Xr="__reactContainer$"+Ut,gc="__reactEvents$"+Ut,hv="__reactListeners$"+Ut,mo="__reactHandles$"+Ut,Rf="__reactResources$"+Ut,ws="__reactMarker$"+Ut;function vo(o){delete o[dn],delete o[on],delete o[gc],delete o[hv],delete o[mo]}function Ea(o){var l=o[dn];if(l)return l;for(var f=o.parentNode;f;){if(l=f[Xr]||f[dn]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(o=tE(o);o!==null;){if(f=o[dn])return f;o=tE(o)}return l}o=f,f=o.parentNode}return null}function Mi(o){if(o=o[dn]||o[Xr]){var l=o.tag;if(l===5||l===6||l===13||l===26||l===27||l===3)return o}return null}function Pi(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(n(33))}function lr(o){var l=o[Rf];return l||(l=o[Rf]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function Jt(o){o[ws]=!0}var yc=new Set,Iu={};function pi(o,l){Ta(o,l),Ta(o+"Capture",l)}function Ta(o,l){for(Iu[o]=l,o=0;o<l.length;o++)yc.add(l[o])}var If=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Df={},xs={};function Nf(o){return lt.call(xs,o)?!0:lt.call(Df,o)?!1:If.test(o)?xs[o]=!0:(Df[o]=!0,!1)}function go(o,l,f){if(Nf(l))if(f===null)o.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+f)}}function Li(o,l,f){if(f===null)o.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+f)}}function Bn(o,l,f,p){if(p===null)o.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttributeNS(l,f,""+p)}}var Es,kf;function Sa(o){if(Es===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);Es=l&&l[1]||"",kf=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Es+o+kf}var Du=!1;function Nu(o,l){if(!o||Du)return"";Du=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var ye=function(){throw Error()};if(Object.defineProperty(ye.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ye,[])}catch(ue){var oe=ue}Reflect.construct(o,[],ye)}else{try{ye.call()}catch(ue){oe=ue}o.call(ye.prototype)}}else{try{throw Error()}catch(ue){oe=ue}(ye=o())&&typeof ye.catch=="function"&&ye.catch(function(){})}}catch(ue){if(ue&&oe&&typeof ue.stack=="string")return[ue.stack,oe.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=p.DetermineComponentFrameRoot(),M=w[0],U=w[1];if(M&&U){var q=M.split(`
`),ae=U.split(`
`);for(b=p=0;p<q.length&&!q[p].includes("DetermineComponentFrameRoot");)p++;for(;b<ae.length&&!ae[b].includes("DetermineComponentFrameRoot");)b++;if(p===q.length||b===ae.length)for(p=q.length-1,b=ae.length-1;1<=p&&0<=b&&q[p]!==ae[b];)b--;for(;1<=p&&0<=b;p--,b--)if(q[p]!==ae[b]){if(p!==1||b!==1)do if(p--,b--,0>b||q[p]!==ae[b]){var ve=`
`+q[p].replace(" at new "," at ");return o.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",o.displayName)),ve}while(1<=p&&0<=b);break}}}finally{Du=!1,Error.prepareStackTrace=f}return(f=o?o.displayName||o.name:"")?Sa(f):""}function bc(o){switch(o.tag){case 26:case 27:case 5:return Sa(o.type);case 16:return Sa("Lazy");case 13:return Sa("Suspense");case 19:return Sa("SuspenseList");case 0:case 15:return Nu(o.type,!1);case 11:return Nu(o.type.render,!1);case 1:return Nu(o.type,!0);case 31:return Sa("Activity");default:return""}}function ku(o){try{var l="";do l+=bc(o),o=o.return;while(o);return l}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function cr(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function _c(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function fv(o){var l=_c(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,l),p=""+o[l];if(!o.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return b.call(this)},set:function(M){p=""+M,w.call(this,M)}}),Object.defineProperty(o,l,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(M){p=""+M},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Ou(o){o._valueTracker||(o._valueTracker=fv(o))}function wc(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var f=l.getValue(),p="";return o&&(p=_c(o)?o.checked?"true":"false":o.value),o=p,o!==f?(l.setValue(o),!0):!1}function Ts(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var dv=/[\n"\\]/g;function sn(o){return o.replace(dv,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function Ir(o,l,f,p,b,w,M,U){o.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?o.type=M:o.removeAttribute("type"),l!=null?M==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+cr(l)):o.value!==""+cr(l)&&(o.value=""+cr(l)):M!=="submit"&&M!=="reset"||o.removeAttribute("value"),l!=null?yo(o,M,cr(l)):f!=null?yo(o,M,cr(f)):p!=null&&o.removeAttribute("value"),b==null&&w!=null&&(o.defaultChecked=!!w),b!=null&&(o.checked=b&&typeof b!="function"&&typeof b!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?o.name=""+cr(U):o.removeAttribute("name")}function Ss(o,l,f,p,b,w,M,U){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(o.type=w),l!=null||f!=null){if(!(w!=="submit"&&w!=="reset"||l!=null))return;f=f!=null?""+cr(f):"",l=l!=null?""+cr(l):f,U||l===o.value||(o.value=l),o.defaultValue=l}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,o.checked=U?o.checked:!!p,o.defaultChecked=!!p,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(o.name=M)}function yo(o,l,f){l==="number"&&Ts(o.ownerDocument)===o||o.defaultValue===""+f||(o.defaultValue=""+f)}function Ca(o,l,f,p){if(o=o.options,l){l={};for(var b=0;b<f.length;b++)l["$"+f[b]]=!0;for(f=0;f<o.length;f++)b=l.hasOwnProperty("$"+o[f].value),o[f].selected!==b&&(o[f].selected=b),b&&p&&(o[f].defaultSelected=!0)}else{for(f=""+cr(f),l=null,b=0;b<o.length;b++){if(o[b].value===f){o[b].selected=!0,p&&(o[b].defaultSelected=!0);return}l!==null||o[b].disabled||(l=o[b])}l!==null&&(l.selected=!0)}}function Dt(o,l,f){if(l!=null&&(l=""+cr(l),l!==o.value&&(o.value=l),f==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=f!=null?""+cr(f):""}function Cs(o,l,f,p){if(l==null){if(p!=null){if(f!=null)throw Error(n(92));if(se(p)){if(1<p.length)throw Error(n(93));p=p[0]}f=p}f==null&&(f=""),l=f}f=cr(l),o.defaultValue=f,p=o.textContent,p===f&&p!==""&&p!==null&&(o.value=p)}function $r(o,l){if(l){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=l;return}}o.textContent=l}var As=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Of(o,l,f){var p=l.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":p?o.setProperty(l,f):typeof f!="number"||f===0||As.has(l)?l==="float"?o.cssFloat=f:o[l]=(""+f).trim():o[l]=f+"px"}function xc(o,l,f){if(l!=null&&typeof l!="object")throw Error(n(62));if(o=o.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?o.setProperty(p,""):p==="float"?o.cssFloat="":o[p]="");for(var b in l)p=l[b],l.hasOwnProperty(b)&&f[b]!==p&&Of(o,b,p)}else for(var w in l)l.hasOwnProperty(w)&&Of(o,w,l[w])}function Ec(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),mv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mu(o){return mv.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var Aa=null;function Yr(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Ra=null,Ia=null;function Tc(o){var l=Mi(o);if(l&&(o=l.stateNode)){var f=o[on]||null;e:switch(o=l.stateNode,l.type){case"input":if(Ir(o,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),l=f.name,f.type==="radio"&&l!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+sn(""+l)+'"][type="radio"]'),l=0;l<f.length;l++){var p=f[l];if(p!==o&&p.form===o.form){var b=p[on]||null;if(!b)throw Error(n(90));Ir(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(l=0;l<f.length;l++)p=f[l],p.form===o.form&&wc(p)}break e;case"textarea":Dt(o,f.value,f.defaultValue);break e;case"select":l=f.value,l!=null&&Ca(o,!!f.multiple,l,!1)}}}var Fi=!1;function Mf(o,l,f){if(Fi)return o(l,f);Fi=!0;try{var p=o(l);return p}finally{if(Fi=!1,(Ra!==null||Ia!==null)&&(Ad(),Ra&&(l=Ra,o=Ia,Ia=Ra=null,Tc(l),o)))for(l=0;l<o.length;l++)Tc(o[l])}}function Rs(o,l){var f=o.stateNode;if(f===null)return null;var p=f[on]||null;if(p===null)return null;f=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(o=o.type,p=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!p;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(n(231,l,typeof f));return f}var mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qr=!1;if(mi)try{var Is={};Object.defineProperty(Is,"passive",{get:function(){Qr=!0}}),window.addEventListener("test",Is,Is),window.removeEventListener("test",Is,Is)}catch{Qr=!1}var Bi=null,bo=null,Da=null;function Sc(){if(Da)return Da;var o,l=bo,f=l.length,p,b="value"in Bi?Bi.value:Bi.textContent,w=b.length;for(o=0;o<f&&l[o]===b[o];o++);var M=f-o;for(p=1;p<=M&&l[f-p]===b[w-p];p++);return Da=b.slice(o,1<p?1-p:void 0)}function Vi(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function Ui(){return!0}function Cc(){return!1}function Rn(o){function l(f,p,b,w,M){this._reactName=f,this._targetInst=b,this.type=p,this.nativeEvent=w,this.target=M,this.currentTarget=null;for(var U in o)o.hasOwnProperty(U)&&(f=o[U],this[U]=f?f(w):w[U]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Ui:Cc,this.isPropagationStopped=Cc,this}return d(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Ui)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Ui)},persist:function(){},isPersistent:Ui}),l}var Et={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pu=Rn(Et),Ds=d({},Et,{view:0,detail:0}),Pf=Rn(Ds),Lu,Fu,zi,Ns=d({},Ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ms,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==zi&&(zi&&o.type==="mousemove"?(Lu=o.screenX-zi.screenX,Fu=o.screenY-zi.screenY):Fu=Lu=0,zi=o),Lu)},movementY:function(o){return"movementY"in o?o.movementY:Fu}}),Zr=Rn(Ns),Lf=d({},Ns,{dataTransfer:0}),vv=Rn(Lf),ks=d({},Ds,{relatedTarget:0}),Bu=Rn(ks),Ac=d({},Et,{animationName:0,elapsedTime:0,pseudoElement:0}),Vu=Rn(Ac),Ff=d({},Et,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),Uu=Rn(Ff),gv=d({},Et,{data:0}),Rc=Rn(gv),Os={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ic(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=Vf[o])?!!l[o]:!1}function Ms(){return Ic}var Uf=d({},Ds,{key:function(o){if(o.key){var l=Os[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=Vi(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Bf[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ms,charCode:function(o){return o.type==="keypress"?Vi(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Vi(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),zu=Rn(Uf),zf=d({},Ns,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dc=Rn(zf),Na=d({},Ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ms}),jf=Rn(Na),Hf=d({},Et,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wf=Rn(Hf),qf=d({},Ns,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),ju=Rn(qf),hr=d({},Et,{newState:0,oldState:0}),Gf=Rn(hr),Kf=[9,13,27,32],ji=mi&&"CompositionEvent"in window,g=null;mi&&"documentMode"in document&&(g=document.documentMode);var S=mi&&"TextEvent"in window&&!g,N=mi&&(!ji||g&&8<g&&11>=g),z=" ",ne=!1;function fe(o,l){switch(o){case"keyup":return Kf.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Te(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var dt=!1;function pn(o,l){switch(o){case"compositionend":return Te(l);case"keypress":return l.which!==32?null:(ne=!0,z);case"textInput":return o=l.data,o===z&&ne?null:o;default:return null}}function pt(o,l){if(dt)return o==="compositionend"||!ji&&fe(o,l)?(o=Sc(),Da=bo=Bi=null,dt=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return N&&l.locale!=="ko"?null:l.data;default:return null}}var In={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mn(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!In[o.type]:l==="textarea"}function ka(o,l,f,p){Ra?Ia?Ia.push(p):Ia=[p]:Ra=p,l=Od(l,"onChange"),0<l.length&&(f=new Pu("onChange","change",null,f,p),o.push({event:f,listeners:l}))}var Vn=null,Hi=null;function Nc(o){qx(o,0)}function Xf(o){var l=Pi(o);if(wc(l))return o}function fw(o,l){if(o==="change")return l}var dw=!1;if(mi){var yv;if(mi){var bv="oninput"in document;if(!bv){var pw=document.createElement("div");pw.setAttribute("oninput","return;"),bv=typeof pw.oninput=="function"}yv=bv}else yv=!1;dw=yv&&(!document.documentMode||9<document.documentMode)}function mw(){Vn&&(Vn.detachEvent("onpropertychange",vw),Hi=Vn=null)}function vw(o){if(o.propertyName==="value"&&Xf(Hi)){var l=[];ka(l,Hi,o,Yr(o)),Mf(Nc,l)}}function JD(o,l,f){o==="focusin"?(mw(),Vn=l,Hi=f,Vn.attachEvent("onpropertychange",vw)):o==="focusout"&&mw()}function eN(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Xf(Hi)}function tN(o,l){if(o==="click")return Xf(l)}function nN(o,l){if(o==="input"||o==="change")return Xf(l)}function rN(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var Dr=typeof Object.is=="function"?Object.is:rN;function kc(o,l){if(Dr(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var f=Object.keys(o),p=Object.keys(l);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var b=f[p];if(!lt.call(l,b)||!Dr(o[b],l[b]))return!1}return!0}function gw(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function yw(o,l){var f=gw(o);o=0;for(var p;f;){if(f.nodeType===3){if(p=o+f.textContent.length,o<=l&&p>=l)return{node:f,offset:l-o};o=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=gw(f)}}function bw(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?bw(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function _w(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=Ts(o.document);l instanceof o.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)o=l.contentWindow;else break;l=Ts(o.document)}return l}function _v(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var iN=mi&&"documentMode"in document&&11>=document.documentMode,Hu=null,wv=null,Oc=null,xv=!1;function ww(o,l,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;xv||Hu==null||Hu!==Ts(p)||(p=Hu,"selectionStart"in p&&_v(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Oc&&kc(Oc,p)||(Oc=p,p=Od(wv,"onSelect"),0<p.length&&(l=new Pu("onSelect","select",null,l,f),o.push({event:l,listeners:p}),l.target=Hu)))}function Ps(o,l){var f={};return f[o.toLowerCase()]=l.toLowerCase(),f["Webkit"+o]="webkit"+l,f["Moz"+o]="moz"+l,f}var Wu={animationend:Ps("Animation","AnimationEnd"),animationiteration:Ps("Animation","AnimationIteration"),animationstart:Ps("Animation","AnimationStart"),transitionrun:Ps("Transition","TransitionRun"),transitionstart:Ps("Transition","TransitionStart"),transitioncancel:Ps("Transition","TransitionCancel"),transitionend:Ps("Transition","TransitionEnd")},Ev={},xw={};mi&&(xw=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function Ls(o){if(Ev[o])return Ev[o];if(!Wu[o])return o;var l=Wu[o],f;for(f in l)if(l.hasOwnProperty(f)&&f in xw)return Ev[o]=l[f];return o}var Ew=Ls("animationend"),Tw=Ls("animationiteration"),Sw=Ls("animationstart"),aN=Ls("transitionrun"),oN=Ls("transitionstart"),sN=Ls("transitioncancel"),Cw=Ls("transitionend"),Aw=new Map,Tv="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Tv.push("scrollEnd");function vi(o,l){Aw.set(o,l),pi(l,[o])}var Rw=new WeakMap;function Jr(o,l){if(typeof o=="object"&&o!==null){var f=Rw.get(o);return f!==void 0?f:(l={value:o,source:l,stack:ku(l)},Rw.set(o,l),l)}return{value:o,source:l,stack:ku(l)}}var ei=[],qu=0,Sv=0;function $f(){for(var o=qu,l=Sv=qu=0;l<o;){var f=ei[l];ei[l++]=null;var p=ei[l];ei[l++]=null;var b=ei[l];ei[l++]=null;var w=ei[l];if(ei[l++]=null,p!==null&&b!==null){var M=p.pending;M===null?b.next=b:(b.next=M.next,M.next=b),p.pending=b}w!==0&&Iw(f,b,w)}}function Yf(o,l,f,p){ei[qu++]=o,ei[qu++]=l,ei[qu++]=f,ei[qu++]=p,Sv|=p,o.lanes|=p,o=o.alternate,o!==null&&(o.lanes|=p)}function Cv(o,l,f,p){return Yf(o,l,f,p),Qf(o)}function Gu(o,l){return Yf(o,null,null,l),Qf(o)}function Iw(o,l,f){o.lanes|=f;var p=o.alternate;p!==null&&(p.lanes|=f);for(var b=!1,w=o.return;w!==null;)w.childLanes|=f,p=w.alternate,p!==null&&(p.childLanes|=f),w.tag===22&&(o=w.stateNode,o===null||o._visibility&1||(b=!0)),o=w,w=w.return;return o.tag===3?(w=o.stateNode,b&&l!==null&&(b=31-an(f),o=w.hiddenUpdates,p=o[b],p===null?o[b]=[l]:p.push(l),l.lane=f|536870912),w):null}function Qf(o){if(50<ih)throw ih=0,kg=null,Error(n(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var Ku={};function uN(o,l,f,p){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nr(o,l,f,p){return new uN(o,l,f,p)}function Av(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Oa(o,l){var f=o.alternate;return f===null?(f=Nr(o.tag,l,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=l,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&65011712,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,l=o.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f.refCleanup=o.refCleanup,f}function Dw(o,l){o.flags&=65011714;var f=o.alternate;return f===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=f.childLanes,o.lanes=f.lanes,o.child=f.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=f.memoizedProps,o.memoizedState=f.memoizedState,o.updateQueue=f.updateQueue,o.type=f.type,l=f.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function Zf(o,l,f,p,b,w){var M=0;if(p=o,typeof o=="function")Av(o)&&(M=1);else if(typeof o=="string")M=ck(o,f,xe.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case D:return o=Nr(31,f,l,b),o.elementType=D,o.lanes=w,o;case _:return Fs(f.children,b,w,l);case E:M=8,b|=24;break;case x:return o=Nr(12,f,l,b|2),o.elementType=x,o.lanes=w,o;case k:return o=Nr(13,f,l,b),o.elementType=k,o.lanes=w,o;case B:return o=Nr(19,f,l,b),o.elementType=B,o.lanes=w,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case T:case A:M=10;break e;case C:M=9;break e;case R:M=11;break e;case P:M=14;break e;case I:M=16,p=null;break e}M=29,f=Error(n(130,o===null?"null":typeof o,"")),p=null}return l=Nr(M,f,l,b),l.elementType=o,l.type=p,l.lanes=w,l}function Fs(o,l,f,p){return o=Nr(7,o,p,l),o.lanes=f,o}function Rv(o,l,f){return o=Nr(6,o,null,l),o.lanes=f,o}function Iv(o,l,f){return l=Nr(4,o.children!==null?o.children:[],o.key,l),l.lanes=f,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var Xu=[],$u=0,Jf=null,ed=0,ti=[],ni=0,Bs=null,Ma=1,Pa="";function Vs(o,l){Xu[$u++]=ed,Xu[$u++]=Jf,Jf=o,ed=l}function Nw(o,l,f){ti[ni++]=Ma,ti[ni++]=Pa,ti[ni++]=Bs,Bs=o;var p=Ma;o=Pa;var b=32-an(p)-1;p&=~(1<<b),f+=1;var w=32-an(l)+b;if(30<w){var M=b-b%5;w=(p&(1<<M)-1).toString(32),p>>=M,b-=M,Ma=1<<32-an(l)+b|f<<b|p,Pa=w+o}else Ma=1<<w|f<<b|p,Pa=o}function Dv(o){o.return!==null&&(Vs(o,1),Nw(o,1,0))}function Nv(o){for(;o===Jf;)Jf=Xu[--$u],Xu[$u]=null,ed=Xu[--$u],Xu[$u]=null;for(;o===Bs;)Bs=ti[--ni],ti[ni]=null,Pa=ti[--ni],ti[ni]=null,Ma=ti[--ni],ti[ni]=null}var fr=null,Yt=null,bt=!1,Us=null,Wi=!1,kv=Error(n(519));function zs(o){var l=Error(n(418,""));throw Lc(Jr(l,o)),kv}function kw(o){var l=o.stateNode,f=o.type,p=o.memoizedProps;switch(l[dn]=o,l[on]=p,f){case"dialog":st("cancel",l),st("close",l);break;case"iframe":case"object":case"embed":st("load",l);break;case"video":case"audio":for(f=0;f<oh.length;f++)st(oh[f],l);break;case"source":st("error",l);break;case"img":case"image":case"link":st("error",l),st("load",l);break;case"details":st("toggle",l);break;case"input":st("invalid",l),Ss(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Ou(l);break;case"select":st("invalid",l);break;case"textarea":st("invalid",l),Cs(l,p.value,p.defaultValue,p.children),Ou(l)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||l.textContent===""+f||p.suppressHydrationWarning===!0||$x(l.textContent,f)?(p.popover!=null&&(st("beforetoggle",l),st("toggle",l)),p.onScroll!=null&&st("scroll",l),p.onScrollEnd!=null&&st("scrollend",l),p.onClick!=null&&(l.onclick=Md),l=!0):l=!1,l||zs(o)}function Ow(o){for(fr=o.return;fr;)switch(fr.tag){case 5:case 13:Wi=!1;return;case 27:case 3:Wi=!0;return;default:fr=fr.return}}function Mc(o){if(o!==fr)return!1;if(!bt)return Ow(o),bt=!0,!1;var l=o.tag,f;if((f=l!==3&&l!==27)&&((f=l===5)&&(f=o.type,f=!(f!=="form"&&f!=="button")||Xg(o.type,o.memoizedProps)),f=!f),f&&Yt&&zs(o),Ow(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,l=0;o;){if(o.nodeType===8)if(f=o.data,f==="/$"){if(l===0){Yt=yi(o.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++;o=o.nextSibling}Yt=null}}else l===27?(l=Yt,Po(o.type)?(o=Zg,Zg=null,Yt=o):Yt=l):Yt=fr?yi(o.stateNode.nextSibling):null;return!0}function Pc(){Yt=fr=null,bt=!1}function Mw(){var o=Us;return o!==null&&(gr===null?gr=o:gr.push.apply(gr,o),Us=null),o}function Lc(o){Us===null?Us=[o]:Us.push(o)}var Ov=ee(null),js=null,La=null;function _o(o,l,f){ce(Ov,l._currentValue),l._currentValue=f}function Fa(o){o._currentValue=Ov.current,pe(Ov)}function Mv(o,l,f){for(;o!==null;){var p=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),o===f)break;o=o.return}}function Pv(o,l,f,p){var b=o.child;for(b!==null&&(b.return=o);b!==null;){var w=b.dependencies;if(w!==null){var M=b.child;w=w.firstContext;e:for(;w!==null;){var U=w;w=b;for(var q=0;q<l.length;q++)if(U.context===l[q]){w.lanes|=f,U=w.alternate,U!==null&&(U.lanes|=f),Mv(w.return,f,o),p||(M=null);break e}w=U.next}}else if(b.tag===18){if(M=b.return,M===null)throw Error(n(341));M.lanes|=f,w=M.alternate,w!==null&&(w.lanes|=f),Mv(M,f,o),M=null}else M=b.child;if(M!==null)M.return=b;else for(M=b;M!==null;){if(M===o){M=null;break}if(b=M.sibling,b!==null){b.return=M.return,M=b;break}M=M.return}b=M}}function Fc(o,l,f,p){o=null;for(var b=l,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var M=b.alternate;if(M===null)throw Error(n(387));if(M=M.memoizedProps,M!==null){var U=b.type;Dr(b.pendingProps.value,M.value)||(o!==null?o.push(U):o=[U])}}else if(b===Ve.current){if(M=b.alternate,M===null)throw Error(n(387));M.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(o!==null?o.push(fh):o=[fh])}b=b.return}o!==null&&Pv(l,o,f,p),l.flags|=262144}function td(o){for(o=o.firstContext;o!==null;){if(!Dr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Hs(o){js=o,La=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Yn(o){return Pw(js,o)}function nd(o,l){return js===null&&Hs(o),Pw(o,l)}function Pw(o,l){var f=l._currentValue;if(l={context:l,memoizedValue:f,next:null},La===null){if(o===null)throw Error(n(308));La=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else La=La.next=l;return f}var lN=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(f,p){o.push(p)}};this.abort=function(){l.aborted=!0,o.forEach(function(f){return f()})}},cN=r.unstable_scheduleCallback,hN=r.unstable_NormalPriority,vn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Lv(){return{controller:new lN,data:new Map,refCount:0}}function Bc(o){o.refCount--,o.refCount===0&&cN(hN,function(){o.controller.abort()})}var Vc=null,Fv=0,Yu=0,Qu=null;function fN(o,l){if(Vc===null){var f=Vc=[];Fv=0,Yu=Vg(),Qu={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Fv++,l.then(Lw,Lw),l}function Lw(){if(--Fv===0&&Vc!==null){Qu!==null&&(Qu.status="fulfilled");var o=Vc;Vc=null,Yu=0,Qu=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function dN(o,l){var f=[],p={status:"pending",value:null,reason:null,then:function(b){f.push(b)}};return o.then(function(){p.status="fulfilled",p.value=l;for(var b=0;b<f.length;b++)(0,f[b])(l)},function(b){for(p.status="rejected",p.reason=b,b=0;b<f.length;b++)(0,f[b])(void 0)}),p}var Fw=G.S;G.S=function(o,l){typeof l=="object"&&l!==null&&typeof l.then=="function"&&fN(o,l),Fw!==null&&Fw(o,l)};var Ws=ee(null);function Bv(){var o=Ws.current;return o!==null?o:Lt.pooledCache}function rd(o,l){l===null?ce(Ws,Ws.current):ce(Ws,l.pool)}function Bw(){var o=Bv();return o===null?null:{parent:vn._currentValue,pool:o}}var Uc=Error(n(460)),Vw=Error(n(474)),id=Error(n(542)),Vv={then:function(){}};function Uw(o){return o=o.status,o==="fulfilled"||o==="rejected"}function ad(){}function zw(o,l,f){switch(f=o[f],f===void 0?o.push(l):f!==l&&(l.then(ad,ad),l=f),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,Hw(o),o;default:if(typeof l.status=="string")l.then(ad,ad);else{if(o=Lt,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=l,o.status="pending",o.then(function(p){if(l.status==="pending"){var b=l;b.status="fulfilled",b.value=p}},function(p){if(l.status==="pending"){var b=l;b.status="rejected",b.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,Hw(o),o}throw zc=l,Uc}}var zc=null;function jw(){if(zc===null)throw Error(n(459));var o=zc;return zc=null,o}function Hw(o){if(o===Uc||o===id)throw Error(n(483))}var wo=!1;function Uv(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function zv(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function xo(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Eo(o,l,f){var p=o.updateQueue;if(p===null)return null;if(p=p.shared,(At&2)!==0){var b=p.pending;return b===null?l.next=l:(l.next=b.next,b.next=l),p.pending=l,l=Qf(o),Iw(o,null,f),l}return Yf(o,p,l,f),Qf(o)}function jc(o,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194048)!==0)){var p=l.lanes;p&=o.pendingLanes,f|=p,l.lanes=f,vc(o,f)}}function jv(o,l){var f=o.updateQueue,p=o.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var b=null,w=null;if(f=f.firstBaseUpdate,f!==null){do{var M={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};w===null?b=w=M:w=w.next=M,f=f.next}while(f!==null);w===null?b=w=l:w=w.next=l}else b=w=l;f={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:p.shared,callbacks:p.callbacks},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=l:o.next=l,f.lastBaseUpdate=l}var Hv=!1;function Hc(){if(Hv){var o=Qu;if(o!==null)throw o}}function Wc(o,l,f,p){Hv=!1;var b=o.updateQueue;wo=!1;var w=b.firstBaseUpdate,M=b.lastBaseUpdate,U=b.shared.pending;if(U!==null){b.shared.pending=null;var q=U,ae=q.next;q.next=null,M===null?w=ae:M.next=ae,M=q;var ve=o.alternate;ve!==null&&(ve=ve.updateQueue,U=ve.lastBaseUpdate,U!==M&&(U===null?ve.firstBaseUpdate=ae:U.next=ae,ve.lastBaseUpdate=q))}if(w!==null){var ye=b.baseState;M=0,ve=ae=q=null,U=w;do{var oe=U.lane&-536870913,ue=oe!==U.lane;if(ue?(mt&oe)===oe:(p&oe)===oe){oe!==0&&oe===Yu&&(Hv=!0),ve!==null&&(ve=ve.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var We=o,ze=U;oe=l;var Ot=f;switch(ze.tag){case 1:if(We=ze.payload,typeof We=="function"){ye=We.call(Ot,ye,oe);break e}ye=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=ze.payload,oe=typeof We=="function"?We.call(Ot,ye,oe):We,oe==null)break e;ye=d({},ye,oe);break e;case 2:wo=!0}}oe=U.callback,oe!==null&&(o.flags|=64,ue&&(o.flags|=8192),ue=b.callbacks,ue===null?b.callbacks=[oe]:ue.push(oe))}else ue={lane:oe,tag:U.tag,payload:U.payload,callback:U.callback,next:null},ve===null?(ae=ve=ue,q=ye):ve=ve.next=ue,M|=oe;if(U=U.next,U===null){if(U=b.shared.pending,U===null)break;ue=U,U=ue.next,ue.next=null,b.lastBaseUpdate=ue,b.shared.pending=null}}while(!0);ve===null&&(q=ye),b.baseState=q,b.firstBaseUpdate=ae,b.lastBaseUpdate=ve,w===null&&(b.shared.lanes=0),No|=M,o.lanes=M,o.memoizedState=ye}}function Ww(o,l){if(typeof o!="function")throw Error(n(191,o));o.call(l)}function qw(o,l){var f=o.callbacks;if(f!==null)for(o.callbacks=null,o=0;o<f.length;o++)Ww(f[o],l)}var Zu=ee(null),od=ee(0);function Gw(o,l){o=Wa,ce(od,o),ce(Zu,l),Wa=o|l.baseLanes}function Wv(){ce(od,Wa),ce(Zu,Zu.current)}function qv(){Wa=od.current,pe(Zu),pe(od)}var To=0,nt=null,Nt=null,un=null,sd=!1,Ju=!1,qs=!1,ud=0,qc=0,el=null,pN=0;function en(){throw Error(n(321))}function Gv(o,l){if(l===null)return!1;for(var f=0;f<l.length&&f<o.length;f++)if(!Dr(o[f],l[f]))return!1;return!0}function Kv(o,l,f,p,b,w){return To=w,nt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,G.H=o===null||o.memoizedState===null?I1:D1,qs=!1,w=f(p,b),qs=!1,Ju&&(w=Xw(l,f,p,b)),Kw(o),w}function Kw(o){G.H=pd;var l=Nt!==null&&Nt.next!==null;if(To=0,un=Nt=nt=null,sd=!1,qc=0,el=null,l)throw Error(n(300));o===null||Dn||(o=o.dependencies,o!==null&&td(o)&&(Dn=!0))}function Xw(o,l,f,p){nt=o;var b=0;do{if(Ju&&(el=null),qc=0,Ju=!1,25<=b)throw Error(n(301));if(b+=1,un=Nt=null,o.updateQueue!=null){var w=o.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}G.H=wN,w=l(f,p)}while(Ju);return w}function mN(){var o=G.H,l=o.useState()[0];return l=typeof l.then=="function"?Gc(l):l,o=o.useState()[0],(Nt!==null?Nt.memoizedState:null)!==o&&(nt.flags|=1024),l}function Xv(){var o=ud!==0;return ud=0,o}function $v(o,l,f){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~f}function Yv(o){if(sd){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}sd=!1}To=0,un=Nt=nt=null,Ju=!1,qc=ud=0,el=null}function mr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return un===null?nt.memoizedState=un=o:un=un.next=o,un}function ln(){if(Nt===null){var o=nt.alternate;o=o!==null?o.memoizedState:null}else o=Nt.next;var l=un===null?nt.memoizedState:un.next;if(l!==null)un=l,Nt=o;else{if(o===null)throw nt.alternate===null?Error(n(467)):Error(n(310));Nt=o,o={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},un===null?nt.memoizedState=un=o:un=un.next=o}return un}function Qv(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gc(o){var l=qc;return qc+=1,el===null&&(el=[]),o=zw(el,o,l),l=nt,(un===null?l.memoizedState:un.next)===null&&(l=l.alternate,G.H=l===null||l.memoizedState===null?I1:D1),o}function ld(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Gc(o);if(o.$$typeof===A)return Yn(o)}throw Error(n(438,String(o)))}function Zv(o){var l=null,f=nt.updateQueue;if(f!==null&&(l=f.memoCache),l==null){var p=nt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(b){return b.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),f===null&&(f=Qv(),nt.updateQueue=f),f.memoCache=l,f=l.data[l.index],f===void 0)for(f=l.data[l.index]=Array(o),p=0;p<o;p++)f[p]=O;return l.index++,f}function Ba(o,l){return typeof l=="function"?l(o):l}function cd(o){var l=ln();return Jv(l,Nt,o)}function Jv(o,l,f){var p=o.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=f;var b=o.baseQueue,w=p.pending;if(w!==null){if(b!==null){var M=b.next;b.next=w.next,w.next=M}l.baseQueue=b=w,p.pending=null}if(w=o.baseState,b===null)o.memoizedState=w;else{l=b.next;var U=M=null,q=null,ae=l,ve=!1;do{var ye=ae.lane&-536870913;if(ye!==ae.lane?(mt&ye)===ye:(To&ye)===ye){var oe=ae.revertLane;if(oe===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),ye===Yu&&(ve=!0);else if((To&oe)===oe){ae=ae.next,oe===Yu&&(ve=!0);continue}else ye={lane:0,revertLane:ae.revertLane,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},q===null?(U=q=ye,M=w):q=q.next=ye,nt.lanes|=oe,No|=oe;ye=ae.action,qs&&f(w,ye),w=ae.hasEagerState?ae.eagerState:f(w,ye)}else oe={lane:ye,revertLane:ae.revertLane,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},q===null?(U=q=oe,M=w):q=q.next=oe,nt.lanes|=ye,No|=ye;ae=ae.next}while(ae!==null&&ae!==l);if(q===null?M=w:q.next=U,!Dr(w,o.memoizedState)&&(Dn=!0,ve&&(f=Qu,f!==null)))throw f;o.memoizedState=w,o.baseState=M,o.baseQueue=q,p.lastRenderedState=w}return b===null&&(p.lanes=0),[o.memoizedState,p.dispatch]}function eg(o){var l=ln(),f=l.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=o;var p=f.dispatch,b=f.pending,w=l.memoizedState;if(b!==null){f.pending=null;var M=b=b.next;do w=o(w,M.action),M=M.next;while(M!==b);Dr(w,l.memoizedState)||(Dn=!0),l.memoizedState=w,l.baseQueue===null&&(l.baseState=w),f.lastRenderedState=w}return[w,p]}function $w(o,l,f){var p=nt,b=ln(),w=bt;if(w){if(f===void 0)throw Error(n(407));f=f()}else f=l();var M=!Dr((Nt||b).memoizedState,f);M&&(b.memoizedState=f,Dn=!0),b=b.queue;var U=Zw.bind(null,p,b,o);if(Kc(2048,8,U,[o]),b.getSnapshot!==l||M||un!==null&&un.memoizedState.tag&1){if(p.flags|=2048,tl(9,hd(),Qw.bind(null,p,b,f,l),null),Lt===null)throw Error(n(349));w||(To&124)!==0||Yw(p,l,f)}return f}function Yw(o,l,f){o.flags|=16384,o={getSnapshot:l,value:f},l=nt.updateQueue,l===null?(l=Qv(),nt.updateQueue=l,l.stores=[o]):(f=l.stores,f===null?l.stores=[o]:f.push(o))}function Qw(o,l,f,p){l.value=f,l.getSnapshot=p,Jw(l)&&e1(o)}function Zw(o,l,f){return f(function(){Jw(l)&&e1(o)})}function Jw(o){var l=o.getSnapshot;o=o.value;try{var f=l();return!Dr(o,f)}catch{return!0}}function e1(o){var l=Gu(o,2);l!==null&&Lr(l,o,2)}function tg(o){var l=mr();if(typeof o=="function"){var f=o;if(o=f(),qs){Vt(!0);try{f()}finally{Vt(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:o},l}function t1(o,l,f,p){return o.baseState=f,Jv(o,Nt,typeof p=="function"?p:Ba)}function vN(o,l,f,p,b){if(dd(o))throw Error(n(485));if(o=l.action,o!==null){var w={payload:b,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){w.listeners.push(M)}};G.T!==null?f(!0):w.isTransition=!1,p(w),f=l.pending,f===null?(w.next=l.pending=w,n1(l,w)):(w.next=f.next,l.pending=f.next=w)}}function n1(o,l){var f=l.action,p=l.payload,b=o.state;if(l.isTransition){var w=G.T,M={};G.T=M;try{var U=f(b,p),q=G.S;q!==null&&q(M,U),r1(o,l,U)}catch(ae){ng(o,l,ae)}finally{G.T=w}}else try{w=f(b,p),r1(o,l,w)}catch(ae){ng(o,l,ae)}}function r1(o,l,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){i1(o,l,p)},function(p){return ng(o,l,p)}):i1(o,l,f)}function i1(o,l,f){l.status="fulfilled",l.value=f,a1(l),o.state=f,l=o.pending,l!==null&&(f=l.next,f===l?o.pending=null:(f=f.next,l.next=f,n1(o,f)))}function ng(o,l,f){var p=o.pending;if(o.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=f,a1(l),l=l.next;while(l!==p)}o.action=null}function a1(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function o1(o,l){return l}function s1(o,l){if(bt){var f=Lt.formState;if(f!==null){e:{var p=nt;if(bt){if(Yt){t:{for(var b=Yt,w=Wi;b.nodeType!==8;){if(!w){b=null;break t}if(b=yi(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Yt=yi(b.nextSibling),p=b.data==="F!";break e}}zs(p)}p=!1}p&&(l=f[0])}}return f=mr(),f.memoizedState=f.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o1,lastRenderedState:l},f.queue=p,f=C1.bind(null,nt,p),p.dispatch=f,p=tg(!1),w=sg.bind(null,nt,!1,p.queue),p=mr(),b={state:l,dispatch:null,action:o,pending:null},p.queue=b,f=vN.bind(null,nt,b,w,f),b.dispatch=f,p.memoizedState=o,[l,f,!1]}function u1(o){var l=ln();return l1(l,Nt,o)}function l1(o,l,f){if(l=Jv(o,l,o1)[0],o=cd(Ba)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=Gc(l)}catch(M){throw M===Uc?id:M}else p=l;l=ln();var b=l.queue,w=b.dispatch;return f!==l.memoizedState&&(nt.flags|=2048,tl(9,hd(),gN.bind(null,b,f),null)),[p,w,o]}function gN(o,l){o.action=l}function c1(o){var l=ln(),f=Nt;if(f!==null)return l1(l,f,o);ln(),l=l.memoizedState,f=ln();var p=f.queue.dispatch;return f.memoizedState=o,[l,p,!1]}function tl(o,l,f,p){return o={tag:o,create:f,deps:p,inst:l,next:null},l=nt.updateQueue,l===null&&(l=Qv(),nt.updateQueue=l),f=l.lastEffect,f===null?l.lastEffect=o.next=o:(p=f.next,f.next=o,o.next=p,l.lastEffect=o),o}function hd(){return{destroy:void 0,resource:void 0}}function h1(){return ln().memoizedState}function fd(o,l,f,p){var b=mr();p=p===void 0?null:p,nt.flags|=o,b.memoizedState=tl(1|l,hd(),f,p)}function Kc(o,l,f,p){var b=ln();p=p===void 0?null:p;var w=b.memoizedState.inst;Nt!==null&&p!==null&&Gv(p,Nt.memoizedState.deps)?b.memoizedState=tl(l,w,f,p):(nt.flags|=o,b.memoizedState=tl(1|l,w,f,p))}function f1(o,l){fd(8390656,8,o,l)}function d1(o,l){Kc(2048,8,o,l)}function p1(o,l){return Kc(4,2,o,l)}function m1(o,l){return Kc(4,4,o,l)}function v1(o,l){if(typeof l=="function"){o=o();var f=l(o);return function(){typeof f=="function"?f():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function g1(o,l,f){f=f!=null?f.concat([o]):null,Kc(4,4,v1.bind(null,l,o),f)}function rg(){}function y1(o,l){var f=ln();l=l===void 0?null:l;var p=f.memoizedState;return l!==null&&Gv(l,p[1])?p[0]:(f.memoizedState=[o,l],o)}function b1(o,l){var f=ln();l=l===void 0?null:l;var p=f.memoizedState;if(l!==null&&Gv(l,p[1]))return p[0];if(p=o(),qs){Vt(!0);try{o()}finally{Vt(!1)}}return f.memoizedState=[p,l],p}function ig(o,l,f){return f===void 0||(To&1073741824)!==0?o.memoizedState=l:(o.memoizedState=f,o=xx(),nt.lanes|=o,No|=o,f)}function _1(o,l,f,p){return Dr(f,l)?f:Zu.current!==null?(o=ig(o,f,p),Dr(o,l)||(Dn=!0),o):(To&42)===0?(Dn=!0,o.memoizedState=f):(o=xx(),nt.lanes|=o,No|=o,l)}function w1(o,l,f,p,b){var w=Q.p;Q.p=w!==0&&8>w?w:8;var M=G.T,U={};G.T=U,sg(o,!1,l,f);try{var q=b(),ae=G.S;if(ae!==null&&ae(U,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var ve=dN(q,p);Xc(o,l,ve,Pr(o))}else Xc(o,l,p,Pr(o))}catch(ye){Xc(o,l,{then:function(){},status:"rejected",reason:ye},Pr())}finally{Q.p=w,G.T=M}}function yN(){}function ag(o,l,f,p){if(o.tag!==5)throw Error(n(476));var b=x1(o).queue;w1(o,b,l,te,f===null?yN:function(){return E1(o),f(p)})}function x1(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:te},next:null};var f={};return l.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:f},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function E1(o){var l=x1(o).next.queue;Xc(o,l,{},Pr())}function og(){return Yn(fh)}function T1(){return ln().memoizedState}function S1(){return ln().memoizedState}function bN(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var f=Pr();o=xo(f);var p=Eo(l,o,f);p!==null&&(Lr(p,l,f),jc(p,l,f)),l={cache:Lv()},o.payload=l;return}l=l.return}}function _N(o,l,f){var p=Pr();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},dd(o)?A1(l,f):(f=Cv(o,l,f,p),f!==null&&(Lr(f,o,p),R1(f,l,p)))}function C1(o,l,f){var p=Pr();Xc(o,l,f,p)}function Xc(o,l,f,p){var b={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(dd(o))A1(l,b);else{var w=o.alternate;if(o.lanes===0&&(w===null||w.lanes===0)&&(w=l.lastRenderedReducer,w!==null))try{var M=l.lastRenderedState,U=w(M,f);if(b.hasEagerState=!0,b.eagerState=U,Dr(U,M))return Yf(o,l,b,0),Lt===null&&$f(),!1}catch{}finally{}if(f=Cv(o,l,b,p),f!==null)return Lr(f,o,p),R1(f,l,p),!0}return!1}function sg(o,l,f,p){if(p={lane:2,revertLane:Vg(),action:p,hasEagerState:!1,eagerState:null,next:null},dd(o)){if(l)throw Error(n(479))}else l=Cv(o,f,p,2),l!==null&&Lr(l,o,2)}function dd(o){var l=o.alternate;return o===nt||l!==null&&l===nt}function A1(o,l){Ju=sd=!0;var f=o.pending;f===null?l.next=l:(l.next=f.next,f.next=l),o.pending=l}function R1(o,l,f){if((f&4194048)!==0){var p=l.lanes;p&=o.pendingLanes,f|=p,l.lanes=f,vc(o,f)}}var pd={readContext:Yn,use:ld,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useLayoutEffect:en,useInsertionEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useSyncExternalStore:en,useId:en,useHostTransitionStatus:en,useFormState:en,useActionState:en,useOptimistic:en,useMemoCache:en,useCacheRefresh:en},I1={readContext:Yn,use:ld,useCallback:function(o,l){return mr().memoizedState=[o,l===void 0?null:l],o},useContext:Yn,useEffect:f1,useImperativeHandle:function(o,l,f){f=f!=null?f.concat([o]):null,fd(4194308,4,v1.bind(null,l,o),f)},useLayoutEffect:function(o,l){return fd(4194308,4,o,l)},useInsertionEffect:function(o,l){fd(4,2,o,l)},useMemo:function(o,l){var f=mr();l=l===void 0?null:l;var p=o();if(qs){Vt(!0);try{o()}finally{Vt(!1)}}return f.memoizedState=[p,l],p},useReducer:function(o,l,f){var p=mr();if(f!==void 0){var b=f(l);if(qs){Vt(!0);try{f(l)}finally{Vt(!1)}}}else b=l;return p.memoizedState=p.baseState=b,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:b},p.queue=o,o=o.dispatch=_N.bind(null,nt,o),[p.memoizedState,o]},useRef:function(o){var l=mr();return o={current:o},l.memoizedState=o},useState:function(o){o=tg(o);var l=o.queue,f=C1.bind(null,nt,l);return l.dispatch=f,[o.memoizedState,f]},useDebugValue:rg,useDeferredValue:function(o,l){var f=mr();return ig(f,o,l)},useTransition:function(){var o=tg(!1);return o=w1.bind(null,nt,o.queue,!0,!1),mr().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,f){var p=nt,b=mr();if(bt){if(f===void 0)throw Error(n(407));f=f()}else{if(f=l(),Lt===null)throw Error(n(349));(mt&124)!==0||Yw(p,l,f)}b.memoizedState=f;var w={value:f,getSnapshot:l};return b.queue=w,f1(Zw.bind(null,p,w,o),[o]),p.flags|=2048,tl(9,hd(),Qw.bind(null,p,w,f,l),null),f},useId:function(){var o=mr(),l=Lt.identifierPrefix;if(bt){var f=Pa,p=Ma;f=(p&~(1<<32-an(p)-1)).toString(32)+f,l="«"+l+"R"+f,f=ud++,0<f&&(l+="H"+f.toString(32)),l+="»"}else f=pN++,l="«"+l+"r"+f.toString(32)+"»";return o.memoizedState=l},useHostTransitionStatus:og,useFormState:s1,useActionState:s1,useOptimistic:function(o){var l=mr();l.memoizedState=l.baseState=o;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=f,l=sg.bind(null,nt,!0,f),f.dispatch=l,[o,l]},useMemoCache:Zv,useCacheRefresh:function(){return mr().memoizedState=bN.bind(null,nt)}},D1={readContext:Yn,use:ld,useCallback:y1,useContext:Yn,useEffect:d1,useImperativeHandle:g1,useInsertionEffect:p1,useLayoutEffect:m1,useMemo:b1,useReducer:cd,useRef:h1,useState:function(){return cd(Ba)},useDebugValue:rg,useDeferredValue:function(o,l){var f=ln();return _1(f,Nt.memoizedState,o,l)},useTransition:function(){var o=cd(Ba)[0],l=ln().memoizedState;return[typeof o=="boolean"?o:Gc(o),l]},useSyncExternalStore:$w,useId:T1,useHostTransitionStatus:og,useFormState:u1,useActionState:u1,useOptimistic:function(o,l){var f=ln();return t1(f,Nt,o,l)},useMemoCache:Zv,useCacheRefresh:S1},wN={readContext:Yn,use:ld,useCallback:y1,useContext:Yn,useEffect:d1,useImperativeHandle:g1,useInsertionEffect:p1,useLayoutEffect:m1,useMemo:b1,useReducer:eg,useRef:h1,useState:function(){return eg(Ba)},useDebugValue:rg,useDeferredValue:function(o,l){var f=ln();return Nt===null?ig(f,o,l):_1(f,Nt.memoizedState,o,l)},useTransition:function(){var o=eg(Ba)[0],l=ln().memoizedState;return[typeof o=="boolean"?o:Gc(o),l]},useSyncExternalStore:$w,useId:T1,useHostTransitionStatus:og,useFormState:c1,useActionState:c1,useOptimistic:function(o,l){var f=ln();return Nt!==null?t1(f,Nt,o,l):(f.baseState=o,[o,f.queue.dispatch])},useMemoCache:Zv,useCacheRefresh:S1},nl=null,$c=0;function md(o){var l=$c;return $c+=1,nl===null&&(nl=[]),zw(nl,o,l)}function Yc(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function vd(o,l){throw l.$$typeof===m?Error(n(525)):(o=Object.prototype.toString.call(l),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function N1(o){var l=o._init;return l(o._payload)}function k1(o){function l(J,X){if(o){var re=J.deletions;re===null?(J.deletions=[X],J.flags|=16):re.push(X)}}function f(J,X){if(!o)return null;for(;X!==null;)l(J,X),X=X.sibling;return null}function p(J){for(var X=new Map;J!==null;)J.key!==null?X.set(J.key,J):X.set(J.index,J),J=J.sibling;return X}function b(J,X){return J=Oa(J,X),J.index=0,J.sibling=null,J}function w(J,X,re){return J.index=re,o?(re=J.alternate,re!==null?(re=re.index,re<X?(J.flags|=67108866,X):re):(J.flags|=67108866,X)):(J.flags|=1048576,X)}function M(J){return o&&J.alternate===null&&(J.flags|=67108866),J}function U(J,X,re,ge){return X===null||X.tag!==6?(X=Rv(re,J.mode,ge),X.return=J,X):(X=b(X,re),X.return=J,X)}function q(J,X,re,ge){var Ie=re.type;return Ie===_?ve(J,X,re.props.children,ge,re.key):X!==null&&(X.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===I&&N1(Ie)===X.type)?(X=b(X,re.props),Yc(X,re),X.return=J,X):(X=Zf(re.type,re.key,re.props,null,J.mode,ge),Yc(X,re),X.return=J,X)}function ae(J,X,re,ge){return X===null||X.tag!==4||X.stateNode.containerInfo!==re.containerInfo||X.stateNode.implementation!==re.implementation?(X=Iv(re,J.mode,ge),X.return=J,X):(X=b(X,re.children||[]),X.return=J,X)}function ve(J,X,re,ge,Ie){return X===null||X.tag!==7?(X=Fs(re,J.mode,ge,Ie),X.return=J,X):(X=b(X,re),X.return=J,X)}function ye(J,X,re){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return X=Rv(""+X,J.mode,re),X.return=J,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case v:return re=Zf(X.type,X.key,X.props,null,J.mode,re),Yc(re,X),re.return=J,re;case y:return X=Iv(X,J.mode,re),X.return=J,X;case I:var ge=X._init;return X=ge(X._payload),ye(J,X,re)}if(se(X)||F(X))return X=Fs(X,J.mode,re,null),X.return=J,X;if(typeof X.then=="function")return ye(J,md(X),re);if(X.$$typeof===A)return ye(J,nd(J,X),re);vd(J,X)}return null}function oe(J,X,re,ge){var Ie=X!==null?X.key:null;if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return Ie!==null?null:U(J,X,""+re,ge);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case v:return re.key===Ie?q(J,X,re,ge):null;case y:return re.key===Ie?ae(J,X,re,ge):null;case I:return Ie=re._init,re=Ie(re._payload),oe(J,X,re,ge)}if(se(re)||F(re))return Ie!==null?null:ve(J,X,re,ge,null);if(typeof re.then=="function")return oe(J,X,md(re),ge);if(re.$$typeof===A)return oe(J,X,nd(J,re),ge);vd(J,re)}return null}function ue(J,X,re,ge,Ie){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return J=J.get(re)||null,U(X,J,""+ge,Ie);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case v:return J=J.get(ge.key===null?re:ge.key)||null,q(X,J,ge,Ie);case y:return J=J.get(ge.key===null?re:ge.key)||null,ae(X,J,ge,Ie);case I:var it=ge._init;return ge=it(ge._payload),ue(J,X,re,ge,Ie)}if(se(ge)||F(ge))return J=J.get(re)||null,ve(X,J,ge,Ie,null);if(typeof ge.then=="function")return ue(J,X,re,md(ge),Ie);if(ge.$$typeof===A)return ue(J,X,re,nd(X,ge),Ie);vd(X,ge)}return null}function We(J,X,re,ge){for(var Ie=null,it=null,Fe=X,je=X=0,kn=null;Fe!==null&&je<re.length;je++){Fe.index>je?(kn=Fe,Fe=null):kn=Fe.sibling;var yt=oe(J,Fe,re[je],ge);if(yt===null){Fe===null&&(Fe=kn);break}o&&Fe&&yt.alternate===null&&l(J,Fe),X=w(yt,X,je),it===null?Ie=yt:it.sibling=yt,it=yt,Fe=kn}if(je===re.length)return f(J,Fe),bt&&Vs(J,je),Ie;if(Fe===null){for(;je<re.length;je++)Fe=ye(J,re[je],ge),Fe!==null&&(X=w(Fe,X,je),it===null?Ie=Fe:it.sibling=Fe,it=Fe);return bt&&Vs(J,je),Ie}for(Fe=p(Fe);je<re.length;je++)kn=ue(Fe,J,je,re[je],ge),kn!==null&&(o&&kn.alternate!==null&&Fe.delete(kn.key===null?je:kn.key),X=w(kn,X,je),it===null?Ie=kn:it.sibling=kn,it=kn);return o&&Fe.forEach(function(Uo){return l(J,Uo)}),bt&&Vs(J,je),Ie}function ze(J,X,re,ge){if(re==null)throw Error(n(151));for(var Ie=null,it=null,Fe=X,je=X=0,kn=null,yt=re.next();Fe!==null&&!yt.done;je++,yt=re.next()){Fe.index>je?(kn=Fe,Fe=null):kn=Fe.sibling;var Uo=oe(J,Fe,yt.value,ge);if(Uo===null){Fe===null&&(Fe=kn);break}o&&Fe&&Uo.alternate===null&&l(J,Fe),X=w(Uo,X,je),it===null?Ie=Uo:it.sibling=Uo,it=Uo,Fe=kn}if(yt.done)return f(J,Fe),bt&&Vs(J,je),Ie;if(Fe===null){for(;!yt.done;je++,yt=re.next())yt=ye(J,yt.value,ge),yt!==null&&(X=w(yt,X,je),it===null?Ie=yt:it.sibling=yt,it=yt);return bt&&Vs(J,je),Ie}for(Fe=p(Fe);!yt.done;je++,yt=re.next())yt=ue(Fe,J,je,yt.value,ge),yt!==null&&(o&&yt.alternate!==null&&Fe.delete(yt.key===null?je:yt.key),X=w(yt,X,je),it===null?Ie=yt:it.sibling=yt,it=yt);return o&&Fe.forEach(function(xk){return l(J,xk)}),bt&&Vs(J,je),Ie}function Ot(J,X,re,ge){if(typeof re=="object"&&re!==null&&re.type===_&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case v:e:{for(var Ie=re.key;X!==null;){if(X.key===Ie){if(Ie=re.type,Ie===_){if(X.tag===7){f(J,X.sibling),ge=b(X,re.props.children),ge.return=J,J=ge;break e}}else if(X.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===I&&N1(Ie)===X.type){f(J,X.sibling),ge=b(X,re.props),Yc(ge,re),ge.return=J,J=ge;break e}f(J,X);break}else l(J,X);X=X.sibling}re.type===_?(ge=Fs(re.props.children,J.mode,ge,re.key),ge.return=J,J=ge):(ge=Zf(re.type,re.key,re.props,null,J.mode,ge),Yc(ge,re),ge.return=J,J=ge)}return M(J);case y:e:{for(Ie=re.key;X!==null;){if(X.key===Ie)if(X.tag===4&&X.stateNode.containerInfo===re.containerInfo&&X.stateNode.implementation===re.implementation){f(J,X.sibling),ge=b(X,re.children||[]),ge.return=J,J=ge;break e}else{f(J,X);break}else l(J,X);X=X.sibling}ge=Iv(re,J.mode,ge),ge.return=J,J=ge}return M(J);case I:return Ie=re._init,re=Ie(re._payload),Ot(J,X,re,ge)}if(se(re))return We(J,X,re,ge);if(F(re)){if(Ie=F(re),typeof Ie!="function")throw Error(n(150));return re=Ie.call(re),ze(J,X,re,ge)}if(typeof re.then=="function")return Ot(J,X,md(re),ge);if(re.$$typeof===A)return Ot(J,X,nd(J,re),ge);vd(J,re)}return typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint"?(re=""+re,X!==null&&X.tag===6?(f(J,X.sibling),ge=b(X,re),ge.return=J,J=ge):(f(J,X),ge=Rv(re,J.mode,ge),ge.return=J,J=ge),M(J)):f(J,X)}return function(J,X,re,ge){try{$c=0;var Ie=Ot(J,X,re,ge);return nl=null,Ie}catch(Fe){if(Fe===Uc||Fe===id)throw Fe;var it=Nr(29,Fe,null,J.mode);return it.lanes=ge,it.return=J,it}finally{}}}var rl=k1(!0),O1=k1(!1),ri=ee(null),qi=null;function So(o){var l=o.alternate;ce(gn,gn.current&1),ce(ri,o),qi===null&&(l===null||Zu.current!==null||l.memoizedState!==null)&&(qi=o)}function M1(o){if(o.tag===22){if(ce(gn,gn.current),ce(ri,o),qi===null){var l=o.alternate;l!==null&&l.memoizedState!==null&&(qi=o)}}else Co()}function Co(){ce(gn,gn.current),ce(ri,ri.current)}function Va(o){pe(ri),qi===o&&(qi=null),pe(gn)}var gn=ee(0);function gd(o){for(var l=o;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||Qg(f)))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}function ug(o,l,f,p){l=o.memoizedState,f=f(p,l),f=f==null?l:d({},l,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var lg={enqueueSetState:function(o,l,f){o=o._reactInternals;var p=Pr(),b=xo(p);b.payload=l,f!=null&&(b.callback=f),l=Eo(o,b,p),l!==null&&(Lr(l,o,p),jc(l,o,p))},enqueueReplaceState:function(o,l,f){o=o._reactInternals;var p=Pr(),b=xo(p);b.tag=1,b.payload=l,f!=null&&(b.callback=f),l=Eo(o,b,p),l!==null&&(Lr(l,o,p),jc(l,o,p))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var f=Pr(),p=xo(f);p.tag=2,l!=null&&(p.callback=l),l=Eo(o,p,f),l!==null&&(Lr(l,o,f),jc(l,o,f))}};function P1(o,l,f,p,b,w,M){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(p,w,M):l.prototype&&l.prototype.isPureReactComponent?!kc(f,p)||!kc(b,w):!0}function L1(o,l,f,p){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,p),l.state!==o&&lg.enqueueReplaceState(l,l.state,null)}function Gs(o,l){var f=l;if("ref"in l){f={};for(var p in l)p!=="ref"&&(f[p]=l[p])}if(o=o.defaultProps){f===l&&(f=d({},f));for(var b in o)f[b]===void 0&&(f[b]=o[b])}return f}var yd=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function F1(o){yd(o)}function B1(o){console.error(o)}function V1(o){yd(o)}function bd(o,l){try{var f=o.onUncaughtError;f(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function U1(o,l,f){try{var p=o.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function cg(o,l,f){return f=xo(f),f.tag=3,f.payload={element:null},f.callback=function(){bd(o,l)},f}function z1(o){return o=xo(o),o.tag=3,o}function j1(o,l,f,p){var b=f.type.getDerivedStateFromError;if(typeof b=="function"){var w=p.value;o.payload=function(){return b(w)},o.callback=function(){U1(l,f,p)}}var M=f.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(o.callback=function(){U1(l,f,p),typeof b!="function"&&(ko===null?ko=new Set([this]):ko.add(this));var U=p.stack;this.componentDidCatch(p.value,{componentStack:U!==null?U:""})})}function xN(o,l,f,p,b){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=f.alternate,l!==null&&Fc(l,f,b,!0),f=ri.current,f!==null){switch(f.tag){case 13:return qi===null?Mg():f.alternate===null&&Qt===0&&(Qt=3),f.flags&=-257,f.flags|=65536,f.lanes=b,p===Vv?f.flags|=16384:(l=f.updateQueue,l===null?f.updateQueue=new Set([p]):l.add(p),Lg(o,p,b)),!1;case 22:return f.flags|=65536,p===Vv?f.flags|=16384:(l=f.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=l):(f=l.retryQueue,f===null?l.retryQueue=new Set([p]):f.add(p)),Lg(o,p,b)),!1}throw Error(n(435,f.tag))}return Lg(o,p,b),Mg(),!1}if(bt)return l=ri.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=b,p!==kv&&(o=Error(n(422),{cause:p}),Lc(Jr(o,f)))):(p!==kv&&(l=Error(n(423),{cause:p}),Lc(Jr(l,f))),o=o.current.alternate,o.flags|=65536,b&=-b,o.lanes|=b,p=Jr(p,f),b=cg(o.stateNode,p,b),jv(o,b),Qt!==4&&(Qt=2)),!1;var w=Error(n(520),{cause:p});if(w=Jr(w,f),rh===null?rh=[w]:rh.push(w),Qt!==4&&(Qt=2),l===null)return!0;p=Jr(p,f),f=l;do{switch(f.tag){case 3:return f.flags|=65536,o=b&-b,f.lanes|=o,o=cg(f.stateNode,p,o),jv(f,o),!1;case 1:if(l=f.type,w=f.stateNode,(f.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(ko===null||!ko.has(w))))return f.flags|=65536,b&=-b,f.lanes|=b,b=z1(b),j1(b,o,f,p),jv(f,b),!1}f=f.return}while(f!==null);return!1}var H1=Error(n(461)),Dn=!1;function Un(o,l,f,p){l.child=o===null?O1(l,null,f,p):rl(l,o.child,f,p)}function W1(o,l,f,p,b){f=f.render;var w=l.ref;if("ref"in p){var M={};for(var U in p)U!=="ref"&&(M[U]=p[U])}else M=p;return Hs(l),p=Kv(o,l,f,M,w,b),U=Xv(),o!==null&&!Dn?($v(o,l,b),Ua(o,l,b)):(bt&&U&&Dv(l),l.flags|=1,Un(o,l,p,b),l.child)}function q1(o,l,f,p,b){if(o===null){var w=f.type;return typeof w=="function"&&!Av(w)&&w.defaultProps===void 0&&f.compare===null?(l.tag=15,l.type=w,G1(o,l,w,p,b)):(o=Zf(f.type,null,p,l,l.mode,b),o.ref=l.ref,o.return=l,l.child=o)}if(w=o.child,!yg(o,b)){var M=w.memoizedProps;if(f=f.compare,f=f!==null?f:kc,f(M,p)&&o.ref===l.ref)return Ua(o,l,b)}return l.flags|=1,o=Oa(w,p),o.ref=l.ref,o.return=l,l.child=o}function G1(o,l,f,p,b){if(o!==null){var w=o.memoizedProps;if(kc(w,p)&&o.ref===l.ref)if(Dn=!1,l.pendingProps=p=w,yg(o,b))(o.flags&131072)!==0&&(Dn=!0);else return l.lanes=o.lanes,Ua(o,l,b)}return hg(o,l,f,p,b)}function K1(o,l,f){var p=l.pendingProps,b=p.children,w=o!==null?o.memoizedState:null;if(p.mode==="hidden"){if((l.flags&128)!==0){if(p=w!==null?w.baseLanes|f:f,o!==null){for(b=l.child=o.child,w=0;b!==null;)w=w|b.lanes|b.childLanes,b=b.sibling;l.childLanes=w&~p}else l.childLanes=0,l.child=null;return X1(o,l,p,f)}if((f&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&rd(l,w!==null?w.cachePool:null),w!==null?Gw(l,w):Wv(),M1(l);else return l.lanes=l.childLanes=536870912,X1(o,l,w!==null?w.baseLanes|f:f,f)}else w!==null?(rd(l,w.cachePool),Gw(l,w),Co(),l.memoizedState=null):(o!==null&&rd(l,null),Wv(),Co());return Un(o,l,b,f),l.child}function X1(o,l,f,p){var b=Bv();return b=b===null?null:{parent:vn._currentValue,pool:b},l.memoizedState={baseLanes:f,cachePool:b},o!==null&&rd(l,null),Wv(),M1(l),o!==null&&Fc(o,l,p,!0),null}function _d(o,l){var f=l.ref;if(f===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(o===null||o.ref!==f)&&(l.flags|=4194816)}}function hg(o,l,f,p,b){return Hs(l),f=Kv(o,l,f,p,void 0,b),p=Xv(),o!==null&&!Dn?($v(o,l,b),Ua(o,l,b)):(bt&&p&&Dv(l),l.flags|=1,Un(o,l,f,b),l.child)}function $1(o,l,f,p,b,w){return Hs(l),l.updateQueue=null,f=Xw(l,p,f,b),Kw(o),p=Xv(),o!==null&&!Dn?($v(o,l,w),Ua(o,l,w)):(bt&&p&&Dv(l),l.flags|=1,Un(o,l,f,w),l.child)}function Y1(o,l,f,p,b){if(Hs(l),l.stateNode===null){var w=Ku,M=f.contextType;typeof M=="object"&&M!==null&&(w=Yn(M)),w=new f(p,w),l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=lg,l.stateNode=w,w._reactInternals=l,w=l.stateNode,w.props=p,w.state=l.memoizedState,w.refs={},Uv(l),M=f.contextType,w.context=typeof M=="object"&&M!==null?Yn(M):Ku,w.state=l.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&(ug(l,f,M,p),w.state=l.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(M=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),M!==w.state&&lg.enqueueReplaceState(w,w.state,null),Wc(l,p,w,b),Hc(),w.state=l.memoizedState),typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(o===null){w=l.stateNode;var U=l.memoizedProps,q=Gs(f,U);w.props=q;var ae=w.context,ve=f.contextType;M=Ku,typeof ve=="object"&&ve!==null&&(M=Yn(ve));var ye=f.getDerivedStateFromProps;ve=typeof ye=="function"||typeof w.getSnapshotBeforeUpdate=="function",U=l.pendingProps!==U,ve||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(U||ae!==M)&&L1(l,w,p,M),wo=!1;var oe=l.memoizedState;w.state=oe,Wc(l,p,w,b),Hc(),ae=l.memoizedState,U||oe!==ae||wo?(typeof ye=="function"&&(ug(l,f,ye,p),ae=l.memoizedState),(q=wo||P1(l,f,q,p,oe,ae,M))?(ve||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(l.flags|=4194308)):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=ae),w.props=p,w.state=ae,w.context=M,p=q):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{w=l.stateNode,zv(o,l),M=l.memoizedProps,ve=Gs(f,M),w.props=ve,ye=l.pendingProps,oe=w.context,ae=f.contextType,q=Ku,typeof ae=="object"&&ae!==null&&(q=Yn(ae)),U=f.getDerivedStateFromProps,(ae=typeof U=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(M!==ye||oe!==q)&&L1(l,w,p,q),wo=!1,oe=l.memoizedState,w.state=oe,Wc(l,p,w,b),Hc();var ue=l.memoizedState;M!==ye||oe!==ue||wo||o!==null&&o.dependencies!==null&&td(o.dependencies)?(typeof U=="function"&&(ug(l,f,U,p),ue=l.memoizedState),(ve=wo||P1(l,f,ve,p,oe,ue,q)||o!==null&&o.dependencies!==null&&td(o.dependencies))?(ae||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(p,ue,q),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(p,ue,q)),typeof w.componentDidUpdate=="function"&&(l.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof w.componentDidUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=ue),w.props=p,w.state=ue,w.context=q,p=ve):(typeof w.componentDidUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||M===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),p=!1)}return w=p,_d(o,l),p=(l.flags&128)!==0,w||p?(w=l.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:w.render(),l.flags|=1,o!==null&&p?(l.child=rl(l,o.child,null,b),l.child=rl(l,null,f,b)):Un(o,l,f,b),l.memoizedState=w.state,o=l.child):o=Ua(o,l,b),o}function Q1(o,l,f,p){return Pc(),l.flags|=256,Un(o,l,f,p),l.child}var fg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function dg(o){return{baseLanes:o,cachePool:Bw()}}function pg(o,l,f){return o=o!==null?o.childLanes&~f:0,l&&(o|=ii),o}function Z1(o,l,f){var p=l.pendingProps,b=!1,w=(l.flags&128)!==0,M;if((M=w)||(M=o!==null&&o.memoizedState===null?!1:(gn.current&2)!==0),M&&(b=!0,l.flags&=-129),M=(l.flags&32)!==0,l.flags&=-33,o===null){if(bt){if(b?So(l):Co(),bt){var U=Yt,q;if(q=U){e:{for(q=U,U=Wi;q.nodeType!==8;){if(!U){U=null;break e}if(q=yi(q.nextSibling),q===null){U=null;break e}}U=q}U!==null?(l.memoizedState={dehydrated:U,treeContext:Bs!==null?{id:Ma,overflow:Pa}:null,retryLane:536870912,hydrationErrors:null},q=Nr(18,null,null,0),q.stateNode=U,q.return=l,l.child=q,fr=l,Yt=null,q=!0):q=!1}q||zs(l)}if(U=l.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return Qg(U)?l.lanes=32:l.lanes=536870912,null;Va(l)}return U=p.children,p=p.fallback,b?(Co(),b=l.mode,U=wd({mode:"hidden",children:U},b),p=Fs(p,b,f,null),U.return=l,p.return=l,U.sibling=p,l.child=U,b=l.child,b.memoizedState=dg(f),b.childLanes=pg(o,M,f),l.memoizedState=fg,p):(So(l),mg(l,U))}if(q=o.memoizedState,q!==null&&(U=q.dehydrated,U!==null)){if(w)l.flags&256?(So(l),l.flags&=-257,l=vg(o,l,f)):l.memoizedState!==null?(Co(),l.child=o.child,l.flags|=128,l=null):(Co(),b=p.fallback,U=l.mode,p=wd({mode:"visible",children:p.children},U),b=Fs(b,U,f,null),b.flags|=2,p.return=l,b.return=l,p.sibling=b,l.child=p,rl(l,o.child,null,f),p=l.child,p.memoizedState=dg(f),p.childLanes=pg(o,M,f),l.memoizedState=fg,l=b);else if(So(l),Qg(U)){if(M=U.nextSibling&&U.nextSibling.dataset,M)var ae=M.dgst;M=ae,p=Error(n(419)),p.stack="",p.digest=M,Lc({value:p,source:null,stack:null}),l=vg(o,l,f)}else if(Dn||Fc(o,l,f,!1),M=(f&o.childLanes)!==0,Dn||M){if(M=Lt,M!==null&&(p=f&-f,p=(p&42)!==0?1:fo(p),p=(p&(M.suspendedLanes|f))!==0?0:p,p!==0&&p!==q.retryLane))throw q.retryLane=p,Gu(o,p),Lr(M,o,p),H1;U.data==="$?"||Mg(),l=vg(o,l,f)}else U.data==="$?"?(l.flags|=192,l.child=o.child,l=null):(o=q.treeContext,Yt=yi(U.nextSibling),fr=l,bt=!0,Us=null,Wi=!1,o!==null&&(ti[ni++]=Ma,ti[ni++]=Pa,ti[ni++]=Bs,Ma=o.id,Pa=o.overflow,Bs=l),l=mg(l,p.children),l.flags|=4096);return l}return b?(Co(),b=p.fallback,U=l.mode,q=o.child,ae=q.sibling,p=Oa(q,{mode:"hidden",children:p.children}),p.subtreeFlags=q.subtreeFlags&65011712,ae!==null?b=Oa(ae,b):(b=Fs(b,U,f,null),b.flags|=2),b.return=l,p.return=l,p.sibling=b,l.child=p,p=b,b=l.child,U=o.child.memoizedState,U===null?U=dg(f):(q=U.cachePool,q!==null?(ae=vn._currentValue,q=q.parent!==ae?{parent:ae,pool:ae}:q):q=Bw(),U={baseLanes:U.baseLanes|f,cachePool:q}),b.memoizedState=U,b.childLanes=pg(o,M,f),l.memoizedState=fg,p):(So(l),f=o.child,o=f.sibling,f=Oa(f,{mode:"visible",children:p.children}),f.return=l,f.sibling=null,o!==null&&(M=l.deletions,M===null?(l.deletions=[o],l.flags|=16):M.push(o)),l.child=f,l.memoizedState=null,f)}function mg(o,l){return l=wd({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function wd(o,l){return o=Nr(22,o,null,l),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function vg(o,l,f){return rl(l,o.child,null,f),o=mg(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function J1(o,l,f){o.lanes|=l;var p=o.alternate;p!==null&&(p.lanes|=l),Mv(o.return,l,f)}function gg(o,l,f,p,b){var w=o.memoizedState;w===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:b}:(w.isBackwards=l,w.rendering=null,w.renderingStartTime=0,w.last=p,w.tail=f,w.tailMode=b)}function ex(o,l,f){var p=l.pendingProps,b=p.revealOrder,w=p.tail;if(Un(o,l,p.children,f),p=gn.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&J1(o,f,l);else if(o.tag===19)J1(o,f,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break e;for(;o.sibling===null;){if(o.return===null||o.return===l)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}p&=1}switch(ce(gn,p),b){case"forwards":for(f=l.child,b=null;f!==null;)o=f.alternate,o!==null&&gd(o)===null&&(b=f),f=f.sibling;f=b,f===null?(b=l.child,l.child=null):(b=f.sibling,f.sibling=null),gg(l,!1,b,f,w);break;case"backwards":for(f=null,b=l.child,l.child=null;b!==null;){if(o=b.alternate,o!==null&&gd(o)===null){l.child=b;break}o=b.sibling,b.sibling=f,f=b,b=o}gg(l,!0,f,null,w);break;case"together":gg(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Ua(o,l,f){if(o!==null&&(l.dependencies=o.dependencies),No|=l.lanes,(f&l.childLanes)===0)if(o!==null){if(Fc(o,l,f,!1),(f&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(n(153));if(l.child!==null){for(o=l.child,f=Oa(o,o.pendingProps),l.child=f,f.return=l;o.sibling!==null;)o=o.sibling,f=f.sibling=Oa(o,o.pendingProps),f.return=l;f.sibling=null}return l.child}function yg(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&td(o)))}function EN(o,l,f){switch(l.tag){case 3:ke(l,l.stateNode.containerInfo),_o(l,vn,o.memoizedState.cache),Pc();break;case 27:case 5:wt(l);break;case 4:ke(l,l.stateNode.containerInfo);break;case 10:_o(l,l.type,l.memoizedProps.value);break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(So(l),l.flags|=128,null):(f&l.child.childLanes)!==0?Z1(o,l,f):(So(l),o=Ua(o,l,f),o!==null?o.sibling:null);So(l);break;case 19:var b=(o.flags&128)!==0;if(p=(f&l.childLanes)!==0,p||(Fc(o,l,f,!1),p=(f&l.childLanes)!==0),b){if(p)return ex(o,l,f);l.flags|=128}if(b=l.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ce(gn,gn.current),p)break;return null;case 22:case 23:return l.lanes=0,K1(o,l,f);case 24:_o(l,vn,o.memoizedState.cache)}return Ua(o,l,f)}function tx(o,l,f){if(o!==null)if(o.memoizedProps!==l.pendingProps)Dn=!0;else{if(!yg(o,f)&&(l.flags&128)===0)return Dn=!1,EN(o,l,f);Dn=(o.flags&131072)!==0}else Dn=!1,bt&&(l.flags&1048576)!==0&&Nw(l,ed,l.index);switch(l.lanes=0,l.tag){case 16:e:{o=l.pendingProps;var p=l.elementType,b=p._init;if(p=b(p._payload),l.type=p,typeof p=="function")Av(p)?(o=Gs(p,o),l.tag=1,l=Y1(null,l,p,o,f)):(l.tag=0,l=hg(null,l,p,o,f));else{if(p!=null){if(b=p.$$typeof,b===R){l.tag=11,l=W1(null,l,p,o,f);break e}else if(b===P){l.tag=14,l=q1(null,l,p,o,f);break e}}throw l=ie(p)||p,Error(n(306,l,""))}}return l;case 0:return hg(o,l,l.type,l.pendingProps,f);case 1:return p=l.type,b=Gs(p,l.pendingProps),Y1(o,l,p,b,f);case 3:e:{if(ke(l,l.stateNode.containerInfo),o===null)throw Error(n(387));p=l.pendingProps;var w=l.memoizedState;b=w.element,zv(o,l),Wc(l,p,null,f);var M=l.memoizedState;if(p=M.cache,_o(l,vn,p),p!==w.cache&&Pv(l,[vn],f,!0),Hc(),p=M.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:M.cache},l.updateQueue.baseState=w,l.memoizedState=w,l.flags&256){l=Q1(o,l,p,f);break e}else if(p!==b){b=Jr(Error(n(424)),l),Lc(b),l=Q1(o,l,p,f);break e}else{switch(o=l.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Yt=yi(o.firstChild),fr=l,bt=!0,Us=null,Wi=!0,f=O1(l,null,p,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(Pc(),p===b){l=Ua(o,l,f);break e}Un(o,l,p,f)}l=l.child}return l;case 26:return _d(o,l),o===null?(f=aE(l.type,null,l.pendingProps,null))?l.memoizedState=f:bt||(f=l.type,o=l.pendingProps,p=Pd(Ee.current).createElement(f),p[dn]=l,p[on]=o,jn(p,f,o),Jt(p),l.stateNode=p):l.memoizedState=aE(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return wt(l),o===null&&bt&&(p=l.stateNode=nE(l.type,l.pendingProps,Ee.current),fr=l,Wi=!0,b=Yt,Po(l.type)?(Zg=b,Yt=yi(p.firstChild)):Yt=b),Un(o,l,l.pendingProps.children,f),_d(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&bt&&((b=p=Yt)&&(p=QN(p,l.type,l.pendingProps,Wi),p!==null?(l.stateNode=p,fr=l,Yt=yi(p.firstChild),Wi=!1,b=!0):b=!1),b||zs(l)),wt(l),b=l.type,w=l.pendingProps,M=o!==null?o.memoizedProps:null,p=w.children,Xg(b,w)?p=null:M!==null&&Xg(b,M)&&(l.flags|=32),l.memoizedState!==null&&(b=Kv(o,l,mN,null,null,f),fh._currentValue=b),_d(o,l),Un(o,l,p,f),l.child;case 6:return o===null&&bt&&((o=f=Yt)&&(f=ZN(f,l.pendingProps,Wi),f!==null?(l.stateNode=f,fr=l,Yt=null,o=!0):o=!1),o||zs(l)),null;case 13:return Z1(o,l,f);case 4:return ke(l,l.stateNode.containerInfo),p=l.pendingProps,o===null?l.child=rl(l,null,p,f):Un(o,l,p,f),l.child;case 11:return W1(o,l,l.type,l.pendingProps,f);case 7:return Un(o,l,l.pendingProps,f),l.child;case 8:return Un(o,l,l.pendingProps.children,f),l.child;case 12:return Un(o,l,l.pendingProps.children,f),l.child;case 10:return p=l.pendingProps,_o(l,l.type,p.value),Un(o,l,p.children,f),l.child;case 9:return b=l.type._context,p=l.pendingProps.children,Hs(l),b=Yn(b),p=p(b),l.flags|=1,Un(o,l,p,f),l.child;case 14:return q1(o,l,l.type,l.pendingProps,f);case 15:return G1(o,l,l.type,l.pendingProps,f);case 19:return ex(o,l,f);case 31:return p=l.pendingProps,f=l.mode,p={mode:p.mode,children:p.children},o===null?(f=wd(p,f),f.ref=l.ref,l.child=f,f.return=l,l=f):(f=Oa(o.child,p),f.ref=l.ref,l.child=f,f.return=l,l=f),l;case 22:return K1(o,l,f);case 24:return Hs(l),p=Yn(vn),o===null?(b=Bv(),b===null&&(b=Lt,w=Lv(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=f),b=w),l.memoizedState={parent:p,cache:b},Uv(l),_o(l,vn,b)):((o.lanes&f)!==0&&(zv(o,l),Wc(l,null,null,f),Hc()),b=o.memoizedState,w=l.memoizedState,b.parent!==p?(b={parent:p,cache:p},l.memoizedState=b,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=b),_o(l,vn,p)):(p=w.cache,_o(l,vn,p),p!==b.cache&&Pv(l,[vn],f,!0))),Un(o,l,l.pendingProps.children,f),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function za(o){o.flags|=4}function nx(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!cE(l)){if(l=ri.current,l!==null&&((mt&4194048)===mt?qi!==null:(mt&62914560)!==mt&&(mt&536870912)===0||l!==qi))throw zc=Vv,Vw;o.flags|=8192}}function xd(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?pc():536870912,o.lanes|=l,sl|=l)}function Qc(o,l){if(!bt)switch(o.tailMode){case"hidden":l=o.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:p.sibling=null}}function qt(o){var l=o.alternate!==null&&o.alternate.child===o.child,f=0,p=0;if(l)for(var b=o.child;b!==null;)f|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=o,b=b.sibling;else for(b=o.child;b!==null;)f|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=o,b=b.sibling;return o.subtreeFlags|=p,o.childLanes=f,l}function TN(o,l,f){var p=l.pendingProps;switch(Nv(l),l.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(l),null;case 1:return qt(l),null;case 3:return f=l.stateNode,p=null,o!==null&&(p=o.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),Fa(vn),Ke(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(Mc(l)?za(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Mw())),qt(l),null;case 26:return f=l.memoizedState,o===null?(za(l),f!==null?(qt(l),nx(l,f)):(qt(l),l.flags&=-16777217)):f?f!==o.memoizedState?(za(l),qt(l),nx(l,f)):(qt(l),l.flags&=-16777217):(o.memoizedProps!==p&&za(l),qt(l),l.flags&=-16777217),null;case 27:Xe(l),f=Ee.current;var b=l.type;if(o!==null&&l.stateNode!=null)o.memoizedProps!==p&&za(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return qt(l),null}o=xe.current,Mc(l)?kw(l):(o=nE(b,p,f),l.stateNode=o,za(l))}return qt(l),null;case 5:if(Xe(l),f=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==p&&za(l);else{if(!p){if(l.stateNode===null)throw Error(n(166));return qt(l),null}if(o=xe.current,Mc(l))kw(l);else{switch(b=Pd(Ee.current),o){case 1:o=b.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:o=b.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":o=b.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":o=b.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":o=b.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof p.is=="string"?b.createElement("select",{is:p.is}):b.createElement("select"),p.multiple?o.multiple=!0:p.size&&(o.size=p.size);break;default:o=typeof p.is=="string"?b.createElement(f,{is:p.is}):b.createElement(f)}}o[dn]=l,o[on]=p;e:for(b=l.child;b!==null;){if(b.tag===5||b.tag===6)o.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===l)break e;for(;b.sibling===null;){if(b.return===null||b.return===l)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}l.stateNode=o;e:switch(jn(o,f,p),f){case"button":case"input":case"select":case"textarea":o=!!p.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&za(l)}}return qt(l),l.flags&=-16777217,null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==p&&za(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(o=Ee.current,Mc(l)){if(o=l.stateNode,f=l.memoizedProps,p=null,b=fr,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}o[dn]=l,o=!!(o.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||$x(o.nodeValue,f)),o||zs(l)}else o=Pd(o).createTextNode(p),o[dn]=l,l.stateNode=o}return qt(l),null;case 13:if(p=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(b=Mc(l),p!==null&&p.dehydrated!==null){if(o===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[dn]=l}else Pc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;qt(l),b=!1}else b=Mw(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=b),b=!0;if(!b)return l.flags&256?(Va(l),l):(Va(l),null)}if(Va(l),(l.flags&128)!==0)return l.lanes=f,l;if(f=p!==null,o=o!==null&&o.memoizedState!==null,f){p=l.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool);var w=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(w=p.memoizedState.cachePool.pool),w!==b&&(p.flags|=2048)}return f!==o&&f&&(l.child.flags|=8192),xd(l,l.updateQueue),qt(l),null;case 4:return Ke(),o===null&&Hg(l.stateNode.containerInfo),qt(l),null;case 10:return Fa(l.type),qt(l),null;case 19:if(pe(gn),b=l.memoizedState,b===null)return qt(l),null;if(p=(l.flags&128)!==0,w=b.rendering,w===null)if(p)Qc(b,!1);else{if(Qt!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(w=gd(o),w!==null){for(l.flags|=128,Qc(b,!1),o=w.updateQueue,l.updateQueue=o,xd(l,o),l.subtreeFlags=0,o=f,f=l.child;f!==null;)Dw(f,o),f=f.sibling;return ce(gn,gn.current&1|2),l.child}o=o.sibling}b.tail!==null&&Wt()>Sd&&(l.flags|=128,p=!0,Qc(b,!1),l.lanes=4194304)}else{if(!p)if(o=gd(w),o!==null){if(l.flags|=128,p=!0,o=o.updateQueue,l.updateQueue=o,xd(l,o),Qc(b,!0),b.tail===null&&b.tailMode==="hidden"&&!w.alternate&&!bt)return qt(l),null}else 2*Wt()-b.renderingStartTime>Sd&&f!==536870912&&(l.flags|=128,p=!0,Qc(b,!1),l.lanes=4194304);b.isBackwards?(w.sibling=l.child,l.child=w):(o=b.last,o!==null?o.sibling=w:l.child=w,b.last=w)}return b.tail!==null?(l=b.tail,b.rendering=l,b.tail=l.sibling,b.renderingStartTime=Wt(),l.sibling=null,o=gn.current,ce(gn,p?o&1|2:o&1),l):(qt(l),null);case 22:case 23:return Va(l),qv(),p=l.memoizedState!==null,o!==null?o.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(f&536870912)!==0&&(l.flags&128)===0&&(qt(l),l.subtreeFlags&6&&(l.flags|=8192)):qt(l),f=l.updateQueue,f!==null&&xd(l,f.retryQueue),f=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==f&&(l.flags|=2048),o!==null&&pe(Ws),null;case 24:return f=null,o!==null&&(f=o.memoizedState.cache),l.memoizedState.cache!==f&&(l.flags|=2048),Fa(vn),qt(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function SN(o,l){switch(Nv(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return Fa(vn),Ke(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return Xe(l),null;case 13:if(Va(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Pc()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return pe(gn),null;case 4:return Ke(),null;case 10:return Fa(l.type),null;case 22:case 23:return Va(l),qv(),o!==null&&pe(Ws),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return Fa(vn),null;case 25:return null;default:return null}}function rx(o,l){switch(Nv(l),l.tag){case 3:Fa(vn),Ke();break;case 26:case 27:case 5:Xe(l);break;case 4:Ke();break;case 13:Va(l);break;case 19:pe(gn);break;case 10:Fa(l.type);break;case 22:case 23:Va(l),qv(),o!==null&&pe(Ws);break;case 24:Fa(vn)}}function Zc(o,l){try{var f=l.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var b=p.next;f=b;do{if((f.tag&o)===o){p=void 0;var w=f.create,M=f.inst;p=w(),M.destroy=p}f=f.next}while(f!==b)}}catch(U){Mt(l,l.return,U)}}function Ao(o,l,f){try{var p=l.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var w=b.next;p=w;do{if((p.tag&o)===o){var M=p.inst,U=M.destroy;if(U!==void 0){M.destroy=void 0,b=l;var q=f,ae=U;try{ae()}catch(ve){Mt(b,q,ve)}}}p=p.next}while(p!==w)}}catch(ve){Mt(l,l.return,ve)}}function ix(o){var l=o.updateQueue;if(l!==null){var f=o.stateNode;try{qw(l,f)}catch(p){Mt(o,o.return,p)}}}function ax(o,l,f){f.props=Gs(o.type,o.memoizedProps),f.state=o.memoizedState;try{f.componentWillUnmount()}catch(p){Mt(o,l,p)}}function Jc(o,l){try{var f=o.ref;if(f!==null){switch(o.tag){case 26:case 27:case 5:var p=o.stateNode;break;case 30:p=o.stateNode;break;default:p=o.stateNode}typeof f=="function"?o.refCleanup=f(p):f.current=p}}catch(b){Mt(o,l,b)}}function Gi(o,l){var f=o.ref,p=o.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(b){Mt(o,l,b)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(b){Mt(o,l,b)}else f.current=null}function ox(o){var l=o.type,f=o.memoizedProps,p=o.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(b){Mt(o,o.return,b)}}function bg(o,l,f){try{var p=o.stateNode;GN(p,o.type,f,l),p[on]=l}catch(b){Mt(o,o.return,b)}}function sx(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Po(o.type)||o.tag===4}function _g(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||sx(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Po(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function wg(o,l,f){var p=o.tag;if(p===5||p===6)o=o.stateNode,l?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(o,l):(l=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,l.appendChild(o),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Md));else if(p!==4&&(p===27&&Po(o.type)&&(f=o.stateNode,l=null),o=o.child,o!==null))for(wg(o,l,f),o=o.sibling;o!==null;)wg(o,l,f),o=o.sibling}function Ed(o,l,f){var p=o.tag;if(p===5||p===6)o=o.stateNode,l?f.insertBefore(o,l):f.appendChild(o);else if(p!==4&&(p===27&&Po(o.type)&&(f=o.stateNode),o=o.child,o!==null))for(Ed(o,l,f),o=o.sibling;o!==null;)Ed(o,l,f),o=o.sibling}function ux(o){var l=o.stateNode,f=o.memoizedProps;try{for(var p=o.type,b=l.attributes;b.length;)l.removeAttributeNode(b[0]);jn(l,p,f),l[dn]=o,l[on]=f}catch(w){Mt(o,o.return,w)}}var ja=!1,tn=!1,xg=!1,lx=typeof WeakSet=="function"?WeakSet:Set,Nn=null;function CN(o,l){if(o=o.containerInfo,Gg=zd,o=_w(o),_v(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var b=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{f.nodeType,w.nodeType}catch{f=null;break e}var M=0,U=-1,q=-1,ae=0,ve=0,ye=o,oe=null;t:for(;;){for(var ue;ye!==f||b!==0&&ye.nodeType!==3||(U=M+b),ye!==w||p!==0&&ye.nodeType!==3||(q=M+p),ye.nodeType===3&&(M+=ye.nodeValue.length),(ue=ye.firstChild)!==null;)oe=ye,ye=ue;for(;;){if(ye===o)break t;if(oe===f&&++ae===b&&(U=M),oe===w&&++ve===p&&(q=M),(ue=ye.nextSibling)!==null)break;ye=oe,oe=ye.parentNode}ye=ue}f=U===-1||q===-1?null:{start:U,end:q}}else f=null}f=f||{start:0,end:0}}else f=null;for(Kg={focusedElem:o,selectionRange:f},zd=!1,Nn=l;Nn!==null;)if(l=Nn,o=l.child,(l.subtreeFlags&1024)!==0&&o!==null)o.return=l,Nn=o;else for(;Nn!==null;){switch(l=Nn,w=l.alternate,o=l.flags,l.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&w!==null){o=void 0,f=l,b=w.memoizedProps,w=w.memoizedState,p=f.stateNode;try{var We=Gs(f.type,b,f.elementType===f.type);o=p.getSnapshotBeforeUpdate(We,w),p.__reactInternalSnapshotBeforeUpdate=o}catch(ze){Mt(f,f.return,ze)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,f=o.nodeType,f===9)Yg(o);else if(f===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Yg(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=l.sibling,o!==null){o.return=l.return,Nn=o;break}Nn=l.return}}function cx(o,l,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Ro(o,f),p&4&&Zc(5,f);break;case 1:if(Ro(o,f),p&4)if(o=f.stateNode,l===null)try{o.componentDidMount()}catch(M){Mt(f,f.return,M)}else{var b=Gs(f.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(b,l,o.__reactInternalSnapshotBeforeUpdate)}catch(M){Mt(f,f.return,M)}}p&64&&ix(f),p&512&&Jc(f,f.return);break;case 3:if(Ro(o,f),p&64&&(o=f.updateQueue,o!==null)){if(l=null,f.child!==null)switch(f.child.tag){case 27:case 5:l=f.child.stateNode;break;case 1:l=f.child.stateNode}try{qw(o,l)}catch(M){Mt(f,f.return,M)}}break;case 27:l===null&&p&4&&ux(f);case 26:case 5:Ro(o,f),l===null&&p&4&&ox(f),p&512&&Jc(f,f.return);break;case 12:Ro(o,f);break;case 13:Ro(o,f),p&4&&dx(o,f),p&64&&(o=f.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(f=PN.bind(null,f),JN(o,f))));break;case 22:if(p=f.memoizedState!==null||ja,!p){l=l!==null&&l.memoizedState!==null||tn,b=ja;var w=tn;ja=p,(tn=l)&&!w?Io(o,f,(f.subtreeFlags&8772)!==0):Ro(o,f),ja=b,tn=w}break;case 30:break;default:Ro(o,f)}}function hx(o){var l=o.alternate;l!==null&&(o.alternate=null,hx(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&vo(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var zt=null,vr=!1;function Ha(o,l,f){for(f=f.child;f!==null;)fx(o,l,f),f=f.sibling}function fx(o,l,f){if(ct&&typeof ct.onCommitFiberUnmount=="function")try{ct.onCommitFiberUnmount(Pt,f)}catch{}switch(f.tag){case 26:tn||Gi(f,l),Ha(o,l,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:tn||Gi(f,l);var p=zt,b=vr;Po(f.type)&&(zt=f.stateNode,vr=!1),Ha(o,l,f),uh(f.stateNode),zt=p,vr=b;break;case 5:tn||Gi(f,l);case 6:if(p=zt,b=vr,zt=null,Ha(o,l,f),zt=p,vr=b,zt!==null)if(vr)try{(zt.nodeType===9?zt.body:zt.nodeName==="HTML"?zt.ownerDocument.body:zt).removeChild(f.stateNode)}catch(w){Mt(f,l,w)}else try{zt.removeChild(f.stateNode)}catch(w){Mt(f,l,w)}break;case 18:zt!==null&&(vr?(o=zt,eE(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,f.stateNode),vh(o)):eE(zt,f.stateNode));break;case 4:p=zt,b=vr,zt=f.stateNode.containerInfo,vr=!0,Ha(o,l,f),zt=p,vr=b;break;case 0:case 11:case 14:case 15:tn||Ao(2,f,l),tn||Ao(4,f,l),Ha(o,l,f);break;case 1:tn||(Gi(f,l),p=f.stateNode,typeof p.componentWillUnmount=="function"&&ax(f,l,p)),Ha(o,l,f);break;case 21:Ha(o,l,f);break;case 22:tn=(p=tn)||f.memoizedState!==null,Ha(o,l,f),tn=p;break;default:Ha(o,l,f)}}function dx(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{vh(o)}catch(f){Mt(l,l.return,f)}}function AN(o){switch(o.tag){case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new lx),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new lx),l;default:throw Error(n(435,o.tag))}}function Eg(o,l){var f=AN(o);l.forEach(function(p){var b=LN.bind(null,o,p);f.has(p)||(f.add(p),p.then(b,b))})}function kr(o,l){var f=l.deletions;if(f!==null)for(var p=0;p<f.length;p++){var b=f[p],w=o,M=l,U=M;e:for(;U!==null;){switch(U.tag){case 27:if(Po(U.type)){zt=U.stateNode,vr=!1;break e}break;case 5:zt=U.stateNode,vr=!1;break e;case 3:case 4:zt=U.stateNode.containerInfo,vr=!0;break e}U=U.return}if(zt===null)throw Error(n(160));fx(w,M,b),zt=null,vr=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(l.subtreeFlags&13878)for(l=l.child;l!==null;)px(l,o),l=l.sibling}var gi=null;function px(o,l){var f=o.alternate,p=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:kr(l,o),Or(o),p&4&&(Ao(3,o,o.return),Zc(3,o),Ao(5,o,o.return));break;case 1:kr(l,o),Or(o),p&512&&(tn||f===null||Gi(f,f.return)),p&64&&ja&&(o=o.updateQueue,o!==null&&(p=o.callbacks,p!==null&&(f=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var b=gi;if(kr(l,o),Or(o),p&512&&(tn||f===null||Gi(f,f.return)),p&4){var w=f!==null?f.memoizedState:null;if(p=o.memoizedState,f===null)if(p===null)if(o.stateNode===null){e:{p=o.type,f=o.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":w=b.getElementsByTagName("title")[0],(!w||w[ws]||w[dn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(p),b.head.insertBefore(w,b.querySelector("head > title"))),jn(w,p,f),w[dn]=o,Jt(w),p=w;break e;case"link":var M=uE("link","href",b).get(p+(f.href||""));if(M){for(var U=0;U<M.length;U++)if(w=M[U],w.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&w.getAttribute("rel")===(f.rel==null?null:f.rel)&&w.getAttribute("title")===(f.title==null?null:f.title)&&w.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){M.splice(U,1);break t}}w=b.createElement(p),jn(w,p,f),b.head.appendChild(w);break;case"meta":if(M=uE("meta","content",b).get(p+(f.content||""))){for(U=0;U<M.length;U++)if(w=M[U],w.getAttribute("content")===(f.content==null?null:""+f.content)&&w.getAttribute("name")===(f.name==null?null:f.name)&&w.getAttribute("property")===(f.property==null?null:f.property)&&w.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&w.getAttribute("charset")===(f.charSet==null?null:f.charSet)){M.splice(U,1);break t}}w=b.createElement(p),jn(w,p,f),b.head.appendChild(w);break;default:throw Error(n(468,p))}w[dn]=o,Jt(w),p=w}o.stateNode=p}else lE(b,o.type,o.stateNode);else o.stateNode=sE(b,p,o.memoizedProps);else w!==p?(w===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):w.count--,p===null?lE(b,o.type,o.stateNode):sE(b,p,o.memoizedProps)):p===null&&o.stateNode!==null&&bg(o,o.memoizedProps,f.memoizedProps)}break;case 27:kr(l,o),Or(o),p&512&&(tn||f===null||Gi(f,f.return)),f!==null&&p&4&&bg(o,o.memoizedProps,f.memoizedProps);break;case 5:if(kr(l,o),Or(o),p&512&&(tn||f===null||Gi(f,f.return)),o.flags&32){b=o.stateNode;try{$r(b,"")}catch(ue){Mt(o,o.return,ue)}}p&4&&o.stateNode!=null&&(b=o.memoizedProps,bg(o,b,f!==null?f.memoizedProps:b)),p&1024&&(xg=!0);break;case 6:if(kr(l,o),Or(o),p&4){if(o.stateNode===null)throw Error(n(162));p=o.memoizedProps,f=o.stateNode;try{f.nodeValue=p}catch(ue){Mt(o,o.return,ue)}}break;case 3:if(Bd=null,b=gi,gi=Ld(l.containerInfo),kr(l,o),gi=b,Or(o),p&4&&f!==null&&f.memoizedState.isDehydrated)try{vh(l.containerInfo)}catch(ue){Mt(o,o.return,ue)}xg&&(xg=!1,mx(o));break;case 4:p=gi,gi=Ld(o.stateNode.containerInfo),kr(l,o),Or(o),gi=p;break;case 12:kr(l,o),Or(o);break;case 13:kr(l,o),Or(o),o.child.flags&8192&&o.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Ig=Wt()),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,Eg(o,p)));break;case 22:b=o.memoizedState!==null;var q=f!==null&&f.memoizedState!==null,ae=ja,ve=tn;if(ja=ae||b,tn=ve||q,kr(l,o),tn=ve,ja=ae,Or(o),p&8192)e:for(l=o.stateNode,l._visibility=b?l._visibility&-2:l._visibility|1,b&&(f===null||q||ja||tn||Ks(o)),f=null,l=o;;){if(l.tag===5||l.tag===26){if(f===null){q=f=l;try{if(w=q.stateNode,b)M=w.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{U=q.stateNode;var ye=q.memoizedProps.style,oe=ye!=null&&ye.hasOwnProperty("display")?ye.display:null;U.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(ue){Mt(q,q.return,ue)}}}else if(l.tag===6){if(f===null){q=l;try{q.stateNode.nodeValue=b?"":q.memoizedProps}catch(ue){Mt(q,q.return,ue)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break e;for(;l.sibling===null;){if(l.return===null||l.return===o)break e;f===l&&(f=null),l=l.return}f===l&&(f=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=o.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,Eg(o,f))));break;case 19:kr(l,o),Or(o),p&4&&(p=o.updateQueue,p!==null&&(o.updateQueue=null,Eg(o,p)));break;case 30:break;case 21:break;default:kr(l,o),Or(o)}}function Or(o){var l=o.flags;if(l&2){try{for(var f,p=o.return;p!==null;){if(sx(p)){f=p;break}p=p.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var b=f.stateNode,w=_g(o);Ed(o,w,b);break;case 5:var M=f.stateNode;f.flags&32&&($r(M,""),f.flags&=-33);var U=_g(o);Ed(o,U,M);break;case 3:case 4:var q=f.stateNode.containerInfo,ae=_g(o);wg(o,ae,q);break;default:throw Error(n(161))}}catch(ve){Mt(o,o.return,ve)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function mx(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;mx(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function Ro(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)cx(o,l.alternate,l),l=l.sibling}function Ks(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:Ao(4,l,l.return),Ks(l);break;case 1:Gi(l,l.return);var f=l.stateNode;typeof f.componentWillUnmount=="function"&&ax(l,l.return,f),Ks(l);break;case 27:uh(l.stateNode);case 26:case 5:Gi(l,l.return),Ks(l);break;case 22:l.memoizedState===null&&Ks(l);break;case 30:Ks(l);break;default:Ks(l)}o=o.sibling}}function Io(o,l,f){for(f=f&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,b=o,w=l,M=w.flags;switch(w.tag){case 0:case 11:case 15:Io(b,w,f),Zc(4,w);break;case 1:if(Io(b,w,f),p=w,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ae){Mt(p,p.return,ae)}if(p=w,b=p.updateQueue,b!==null){var U=p.stateNode;try{var q=b.shared.hiddenCallbacks;if(q!==null)for(b.shared.hiddenCallbacks=null,b=0;b<q.length;b++)Ww(q[b],U)}catch(ae){Mt(p,p.return,ae)}}f&&M&64&&ix(w),Jc(w,w.return);break;case 27:ux(w);case 26:case 5:Io(b,w,f),f&&p===null&&M&4&&ox(w),Jc(w,w.return);break;case 12:Io(b,w,f);break;case 13:Io(b,w,f),f&&M&4&&dx(b,w);break;case 22:w.memoizedState===null&&Io(b,w,f),Jc(w,w.return);break;case 30:break;default:Io(b,w,f)}l=l.sibling}}function Tg(o,l){var f=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==f&&(o!=null&&o.refCount++,f!=null&&Bc(f))}function Sg(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Bc(o))}function Ki(o,l,f,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)vx(o,l,f,p),l=l.sibling}function vx(o,l,f,p){var b=l.flags;switch(l.tag){case 0:case 11:case 15:Ki(o,l,f,p),b&2048&&Zc(9,l);break;case 1:Ki(o,l,f,p);break;case 3:Ki(o,l,f,p),b&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Bc(o)));break;case 12:if(b&2048){Ki(o,l,f,p),o=l.stateNode;try{var w=l.memoizedProps,M=w.id,U=w.onPostCommit;typeof U=="function"&&U(M,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(q){Mt(l,l.return,q)}}else Ki(o,l,f,p);break;case 13:Ki(o,l,f,p);break;case 23:break;case 22:w=l.stateNode,M=l.alternate,l.memoizedState!==null?w._visibility&2?Ki(o,l,f,p):eh(o,l):w._visibility&2?Ki(o,l,f,p):(w._visibility|=2,il(o,l,f,p,(l.subtreeFlags&10256)!==0)),b&2048&&Tg(M,l);break;case 24:Ki(o,l,f,p),b&2048&&Sg(l.alternate,l);break;default:Ki(o,l,f,p)}}function il(o,l,f,p,b){for(b=b&&(l.subtreeFlags&10256)!==0,l=l.child;l!==null;){var w=o,M=l,U=f,q=p,ae=M.flags;switch(M.tag){case 0:case 11:case 15:il(w,M,U,q,b),Zc(8,M);break;case 23:break;case 22:var ve=M.stateNode;M.memoizedState!==null?ve._visibility&2?il(w,M,U,q,b):eh(w,M):(ve._visibility|=2,il(w,M,U,q,b)),b&&ae&2048&&Tg(M.alternate,M);break;case 24:il(w,M,U,q,b),b&&ae&2048&&Sg(M.alternate,M);break;default:il(w,M,U,q,b)}l=l.sibling}}function eh(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var f=o,p=l,b=p.flags;switch(p.tag){case 22:eh(f,p),b&2048&&Tg(p.alternate,p);break;case 24:eh(f,p),b&2048&&Sg(p.alternate,p);break;default:eh(f,p)}l=l.sibling}}var th=8192;function al(o){if(o.subtreeFlags&th)for(o=o.child;o!==null;)gx(o),o=o.sibling}function gx(o){switch(o.tag){case 26:al(o),o.flags&th&&o.memoizedState!==null&&fk(gi,o.memoizedState,o.memoizedProps);break;case 5:al(o);break;case 3:case 4:var l=gi;gi=Ld(o.stateNode.containerInfo),al(o),gi=l;break;case 22:o.memoizedState===null&&(l=o.alternate,l!==null&&l.memoizedState!==null?(l=th,th=16777216,al(o),th=l):al(o));break;default:al(o)}}function yx(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function nh(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var p=l[f];Nn=p,_x(p,o)}yx(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)bx(o),o=o.sibling}function bx(o){switch(o.tag){case 0:case 11:case 15:nh(o),o.flags&2048&&Ao(9,o,o.return);break;case 3:nh(o);break;case 12:nh(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,Td(o)):nh(o);break;default:nh(o)}}function Td(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var f=0;f<l.length;f++){var p=l[f];Nn=p,_x(p,o)}yx(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:Ao(8,l,l.return),Td(l);break;case 22:f=l.stateNode,f._visibility&2&&(f._visibility&=-3,Td(l));break;default:Td(l)}o=o.sibling}}function _x(o,l){for(;Nn!==null;){var f=Nn;switch(f.tag){case 0:case 11:case 15:Ao(8,f,l);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Bc(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,Nn=p;else e:for(f=o;Nn!==null;){p=Nn;var b=p.sibling,w=p.return;if(hx(p),p===f){Nn=null;break e}if(b!==null){b.return=w,Nn=b;break e}Nn=w}}}var RN={getCacheForType:function(o){var l=Yn(vn),f=l.data.get(o);return f===void 0&&(f=o(),l.data.set(o,f)),f}},IN=typeof WeakMap=="function"?WeakMap:Map,At=0,Lt=null,ot=null,mt=0,Rt=0,Mr=null,Do=!1,ol=!1,Cg=!1,Wa=0,Qt=0,No=0,Xs=0,Ag=0,ii=0,sl=0,rh=null,gr=null,Rg=!1,Ig=0,Sd=1/0,Cd=null,ko=null,zn=0,Oo=null,ul=null,ll=0,Dg=0,Ng=null,wx=null,ih=0,kg=null;function Pr(){if((At&2)!==0&&mt!==0)return mt&-mt;if(G.T!==null){var o=Yu;return o!==0?o:Vg()}return po()}function xx(){ii===0&&(ii=(mt&536870912)===0||bt?dc():536870912);var o=ri.current;return o!==null&&(o.flags|=32),ii}function Lr(o,l,f){(o===Lt&&(Rt===2||Rt===9)||o.cancelPendingCommit!==null)&&(cl(o,0),Mo(o,mt,ii,!1)),xa(o,f),((At&2)===0||o!==Lt)&&(o===Lt&&((At&2)===0&&(Xs|=f),Qt===4&&Mo(o,mt,ii,!1)),Xi(o))}function Ex(o,l,f){if((At&6)!==0)throw Error(n(327));var p=!f&&(l&124)===0&&(l&o.expiredLanes)===0||_s(o,l),b=p?kN(o,l):Pg(o,l,!0),w=p;do{if(b===0){ol&&!p&&Mo(o,l,0,!1);break}else{if(f=o.current.alternate,w&&!DN(f)){b=Pg(o,l,!1),w=!1;continue}if(b===2){if(w=l,o.errorRecoveryDisabledLanes&w)var M=0;else M=o.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){l=M;e:{var U=o;b=rh;var q=U.current.memoizedState.isDehydrated;if(q&&(cl(U,M).flags|=256),M=Pg(U,M,!1),M!==2){if(Cg&&!q){U.errorRecoveryDisabledLanes|=w,Xs|=w,b=4;break e}w=gr,gr=b,w!==null&&(gr===null?gr=w:gr.push.apply(gr,w))}b=M}if(w=!1,b!==2)continue}}if(b===1){cl(o,0),Mo(o,l,0,!0);break}e:{switch(p=o,w=b,w){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Mo(p,l,ii,!Do);break e;case 2:gr=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(b=Ig+300-Wt(),10<b)){if(Mo(p,l,ii,!Do),Au(p,0,!0)!==0)break e;p.timeoutHandle=Zx(Tx.bind(null,p,f,gr,Cd,Rg,l,ii,Xs,sl,Do,w,2,-0,0),b);break e}Tx(p,f,gr,Cd,Rg,l,ii,Xs,sl,Do,w,0,-0,0)}}break}while(!0);Xi(o)}function Tx(o,l,f,p,b,w,M,U,q,ae,ve,ye,oe,ue){if(o.timeoutHandle=-1,ye=l.subtreeFlags,(ye&8192||(ye&16785408)===16785408)&&(hh={stylesheets:null,count:0,unsuspend:hk},gx(l),ye=dk(),ye!==null)){o.cancelPendingCommit=ye(Nx.bind(null,o,l,w,f,p,b,M,U,q,ve,1,oe,ue)),Mo(o,w,M,!ae);return}Nx(o,l,w,f,p,b,M,U,q)}function DN(o){for(var l=o;;){var f=l.tag;if((f===0||f===11||f===15)&&l.flags&16384&&(f=l.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var b=f[p],w=b.getSnapshot;b=b.value;try{if(!Dr(w(),b))return!1}catch{return!1}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Mo(o,l,f,p){l&=~Ag,l&=~Xs,o.suspendedLanes|=l,o.pingedLanes&=~l,p&&(o.warmLanes|=l),p=o.expirationTimes;for(var b=l;0<b;){var w=31-an(b),M=1<<w;p[w]=-1,b&=~M}f!==0&&Oi(o,f,l)}function Ad(){return(At&6)===0?(ah(0),!1):!0}function Og(){if(ot!==null){if(Rt===0)var o=ot.return;else o=ot,La=js=null,Yv(o),nl=null,$c=0,o=ot;for(;o!==null;)rx(o.alternate,o),o=o.return;ot=null}}function cl(o,l){var f=o.timeoutHandle;f!==-1&&(o.timeoutHandle=-1,XN(f)),f=o.cancelPendingCommit,f!==null&&(o.cancelPendingCommit=null,f()),Og(),Lt=o,ot=f=Oa(o.current,null),mt=l,Rt=0,Mr=null,Do=!1,ol=_s(o,l),Cg=!1,sl=ii=Ag=Xs=No=Qt=0,gr=rh=null,Rg=!1,(l&8)!==0&&(l|=l&32);var p=o.entangledLanes;if(p!==0)for(o=o.entanglements,p&=l;0<p;){var b=31-an(p),w=1<<b;l|=o[b],p&=~w}return Wa=l,$f(),f}function Sx(o,l){nt=null,G.H=pd,l===Uc||l===id?(l=jw(),Rt=3):l===Vw?(l=jw(),Rt=4):Rt=l===H1?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Mr=l,ot===null&&(Qt=1,bd(o,Jr(l,o.current)))}function Cx(){var o=G.H;return G.H=pd,o===null?pd:o}function Ax(){var o=G.A;return G.A=RN,o}function Mg(){Qt=4,Do||(mt&4194048)!==mt&&ri.current!==null||(ol=!0),(No&134217727)===0&&(Xs&134217727)===0||Lt===null||Mo(Lt,mt,ii,!1)}function Pg(o,l,f){var p=At;At|=2;var b=Cx(),w=Ax();(Lt!==o||mt!==l)&&(Cd=null,cl(o,l)),l=!1;var M=Qt;e:do try{if(Rt!==0&&ot!==null){var U=ot,q=Mr;switch(Rt){case 8:Og(),M=6;break e;case 3:case 2:case 9:case 6:ri.current===null&&(l=!0);var ae=Rt;if(Rt=0,Mr=null,hl(o,U,q,ae),f&&ol){M=0;break e}break;default:ae=Rt,Rt=0,Mr=null,hl(o,U,q,ae)}}NN(),M=Qt;break}catch(ve){Sx(o,ve)}while(!0);return l&&o.shellSuspendCounter++,La=js=null,At=p,G.H=b,G.A=w,ot===null&&(Lt=null,mt=0,$f()),M}function NN(){for(;ot!==null;)Rx(ot)}function kN(o,l){var f=At;At|=2;var p=Cx(),b=Ax();Lt!==o||mt!==l?(Cd=null,Sd=Wt()+500,cl(o,l)):ol=_s(o,l);e:do try{if(Rt!==0&&ot!==null){l=ot;var w=Mr;t:switch(Rt){case 1:Rt=0,Mr=null,hl(o,l,w,1);break;case 2:case 9:if(Uw(w)){Rt=0,Mr=null,Ix(l);break}l=function(){Rt!==2&&Rt!==9||Lt!==o||(Rt=7),Xi(o)},w.then(l,l);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:Uw(w)?(Rt=0,Mr=null,Ix(l)):(Rt=0,Mr=null,hl(o,l,w,7));break;case 5:var M=null;switch(ot.tag){case 26:M=ot.memoizedState;case 5:case 27:var U=ot;if(!M||cE(M)){Rt=0,Mr=null;var q=U.sibling;if(q!==null)ot=q;else{var ae=U.return;ae!==null?(ot=ae,Rd(ae)):ot=null}break t}}Rt=0,Mr=null,hl(o,l,w,5);break;case 6:Rt=0,Mr=null,hl(o,l,w,6);break;case 8:Og(),Qt=6;break e;default:throw Error(n(462))}}ON();break}catch(ve){Sx(o,ve)}while(!0);return La=js=null,G.H=p,G.A=b,At=f,ot!==null?0:(Lt=null,mt=0,$f(),Qt)}function ON(){for(;ot!==null&&!Ct();)Rx(ot)}function Rx(o){var l=tx(o.alternate,o,Wa);o.memoizedProps=o.pendingProps,l===null?Rd(o):ot=l}function Ix(o){var l=o,f=l.alternate;switch(l.tag){case 15:case 0:l=$1(f,l,l.pendingProps,l.type,void 0,mt);break;case 11:l=$1(f,l,l.pendingProps,l.type.render,l.ref,mt);break;case 5:Yv(l);default:rx(f,l),l=ot=Dw(l,Wa),l=tx(f,l,Wa)}o.memoizedProps=o.pendingProps,l===null?Rd(o):ot=l}function hl(o,l,f,p){La=js=null,Yv(l),nl=null,$c=0;var b=l.return;try{if(xN(o,b,l,f,mt)){Qt=1,bd(o,Jr(f,o.current)),ot=null;return}}catch(w){if(b!==null)throw ot=b,w;Qt=1,bd(o,Jr(f,o.current)),ot=null;return}l.flags&32768?(bt||p===1?o=!0:ol||(mt&536870912)!==0?o=!1:(Do=o=!0,(p===2||p===9||p===3||p===6)&&(p=ri.current,p!==null&&p.tag===13&&(p.flags|=16384))),Dx(l,o)):Rd(l)}function Rd(o){var l=o;do{if((l.flags&32768)!==0){Dx(l,Do);return}o=l.return;var f=TN(l.alternate,l,Wa);if(f!==null){ot=f;return}if(l=l.sibling,l!==null){ot=l;return}ot=l=o}while(l!==null);Qt===0&&(Qt=5)}function Dx(o,l){do{var f=SN(o.alternate,o);if(f!==null){f.flags&=32767,ot=f;return}if(f=o.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!l&&(o=o.sibling,o!==null)){ot=o;return}ot=o=f}while(o!==null);Qt=6,ot=null}function Nx(o,l,f,p,b,w,M,U,q){o.cancelPendingCommit=null;do Id();while(zn!==0);if((At&6)!==0)throw Error(n(327));if(l!==null){if(l===o.current)throw Error(n(177));if(w=l.lanes|l.childLanes,w|=Sv,mc(o,f,w,M,U,q),o===Lt&&(ot=Lt=null,mt=0),ul=l,Oo=o,ll=f,Dg=w,Ng=b,wx=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,FN(Fn,function(){return Lx(),null})):(o.callbackNode=null,o.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=G.T,G.T=null,b=Q.p,Q.p=2,M=At,At|=4;try{CN(o,l,f)}finally{At=M,Q.p=b,G.T=p}}zn=1,kx(),Ox(),Mx()}}function kx(){if(zn===1){zn=0;var o=Oo,l=ul,f=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||f){f=G.T,G.T=null;var p=Q.p;Q.p=2;var b=At;At|=4;try{px(l,o);var w=Kg,M=_w(o.containerInfo),U=w.focusedElem,q=w.selectionRange;if(M!==U&&U&&U.ownerDocument&&bw(U.ownerDocument.documentElement,U)){if(q!==null&&_v(U)){var ae=q.start,ve=q.end;if(ve===void 0&&(ve=ae),"selectionStart"in U)U.selectionStart=ae,U.selectionEnd=Math.min(ve,U.value.length);else{var ye=U.ownerDocument||document,oe=ye&&ye.defaultView||window;if(oe.getSelection){var ue=oe.getSelection(),We=U.textContent.length,ze=Math.min(q.start,We),Ot=q.end===void 0?ze:Math.min(q.end,We);!ue.extend&&ze>Ot&&(M=Ot,Ot=ze,ze=M);var J=yw(U,ze),X=yw(U,Ot);if(J&&X&&(ue.rangeCount!==1||ue.anchorNode!==J.node||ue.anchorOffset!==J.offset||ue.focusNode!==X.node||ue.focusOffset!==X.offset)){var re=ye.createRange();re.setStart(J.node,J.offset),ue.removeAllRanges(),ze>Ot?(ue.addRange(re),ue.extend(X.node,X.offset)):(re.setEnd(X.node,X.offset),ue.addRange(re))}}}}for(ye=[],ue=U;ue=ue.parentNode;)ue.nodeType===1&&ye.push({element:ue,left:ue.scrollLeft,top:ue.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<ye.length;U++){var ge=ye[U];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}zd=!!Gg,Kg=Gg=null}finally{At=b,Q.p=p,G.T=f}}o.current=l,zn=2}}function Ox(){if(zn===2){zn=0;var o=Oo,l=ul,f=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||f){f=G.T,G.T=null;var p=Q.p;Q.p=2;var b=At;At|=4;try{cx(o,l.alternate,l)}finally{At=b,Q.p=p,G.T=f}}zn=3}}function Mx(){if(zn===4||zn===3){zn=0,It();var o=Oo,l=ul,f=ll,p=wx;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?zn=5:(zn=0,ul=Oo=null,Px(o,o.pendingLanes));var b=o.pendingLanes;if(b===0&&(ko=null),Ru(f),l=l.stateNode,ct&&typeof ct.onCommitFiberRoot=="function")try{ct.onCommitFiberRoot(Pt,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=G.T,b=Q.p,Q.p=2,G.T=null;try{for(var w=o.onRecoverableError,M=0;M<p.length;M++){var U=p[M];w(U.value,{componentStack:U.stack})}}finally{G.T=l,Q.p=b}}(ll&3)!==0&&Id(),Xi(o),b=o.pendingLanes,(f&4194090)!==0&&(b&42)!==0?o===kg?ih++:(ih=0,kg=o):ih=0,ah(0)}}function Px(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,Bc(l)))}function Id(o){return kx(),Ox(),Mx(),Lx()}function Lx(){if(zn!==5)return!1;var o=Oo,l=Dg;Dg=0;var f=Ru(ll),p=G.T,b=Q.p;try{Q.p=32>f?32:f,G.T=null,f=Ng,Ng=null;var w=Oo,M=ll;if(zn=0,ul=Oo=null,ll=0,(At&6)!==0)throw Error(n(331));var U=At;if(At|=4,bx(w.current),vx(w,w.current,M,f),At=U,ah(0,!1),ct&&typeof ct.onPostCommitFiberRoot=="function")try{ct.onPostCommitFiberRoot(Pt,w)}catch{}return!0}finally{Q.p=b,G.T=p,Px(o,l)}}function Fx(o,l,f){l=Jr(f,l),l=cg(o.stateNode,l,2),o=Eo(o,l,2),o!==null&&(xa(o,2),Xi(o))}function Mt(o,l,f){if(o.tag===3)Fx(o,o,f);else for(;l!==null;){if(l.tag===3){Fx(l,o,f);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ko===null||!ko.has(p))){o=Jr(f,o),f=z1(2),p=Eo(l,f,2),p!==null&&(j1(f,p,l,o),xa(p,2),Xi(p));break}}l=l.return}}function Lg(o,l,f){var p=o.pingCache;if(p===null){p=o.pingCache=new IN;var b=new Set;p.set(l,b)}else b=p.get(l),b===void 0&&(b=new Set,p.set(l,b));b.has(f)||(Cg=!0,b.add(f),o=MN.bind(null,o,l,f),l.then(o,o))}function MN(o,l,f){var p=o.pingCache;p!==null&&p.delete(l),o.pingedLanes|=o.suspendedLanes&f,o.warmLanes&=~f,Lt===o&&(mt&f)===f&&(Qt===4||Qt===3&&(mt&62914560)===mt&&300>Wt()-Ig?(At&2)===0&&cl(o,0):Ag|=f,sl===mt&&(sl=0)),Xi(o)}function Bx(o,l){l===0&&(l=pc()),o=Gu(o,l),o!==null&&(xa(o,l),Xi(o))}function PN(o){var l=o.memoizedState,f=0;l!==null&&(f=l.retryLane),Bx(o,f)}function LN(o,l){var f=0;switch(o.tag){case 13:var p=o.stateNode,b=o.memoizedState;b!==null&&(f=b.retryLane);break;case 19:p=o.stateNode;break;case 22:p=o.stateNode._retryCache;break;default:throw Error(n(314))}p!==null&&p.delete(l),Bx(o,f)}function FN(o,l){return tt(o,l)}var Dd=null,fl=null,Fg=!1,Nd=!1,Bg=!1,$s=0;function Xi(o){o!==fl&&o.next===null&&(fl===null?Dd=fl=o:fl=fl.next=o),Nd=!0,Fg||(Fg=!0,VN())}function ah(o,l){if(!Bg&&Nd){Bg=!0;do for(var f=!1,p=Dd;p!==null;){if(o!==0){var b=p.pendingLanes;if(b===0)var w=0;else{var M=p.suspendedLanes,U=p.pingedLanes;w=(1<<31-an(42|o)+1)-1,w&=b&~(M&~U),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(f=!0,jx(p,w))}else w=mt,w=Au(p,p===Lt?w:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(w&3)===0||_s(p,w)||(f=!0,jx(p,w));p=p.next}while(f);Bg=!1}}function BN(){Vx()}function Vx(){Nd=Fg=!1;var o=0;$s!==0&&(KN()&&(o=$s),$s=0);for(var l=Wt(),f=null,p=Dd;p!==null;){var b=p.next,w=Ux(p,l);w===0?(p.next=null,f===null?Dd=b:f.next=b,b===null&&(fl=f)):(f=p,(o!==0||(w&3)!==0)&&(Nd=!0)),p=b}ah(o)}function Ux(o,l){for(var f=o.suspendedLanes,p=o.pingedLanes,b=o.expirationTimes,w=o.pendingLanes&-62914561;0<w;){var M=31-an(w),U=1<<M,q=b[M];q===-1?((U&f)===0||(U&p)!==0)&&(b[M]=fc(U,l)):q<=l&&(o.expiredLanes|=U),w&=~U}if(l=Lt,f=mt,f=Au(o,o===l?f:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p=o.callbackNode,f===0||o===l&&(Rt===2||Rt===9)||o.cancelPendingCommit!==null)return p!==null&&p!==null&&xt(p),o.callbackNode=null,o.callbackPriority=0;if((f&3)===0||_s(o,f)){if(l=f&-f,l===o.callbackPriority)return l;switch(p!==null&&xt(p),Ru(f)){case 2:case 8:f=Rr;break;case 32:f=Fn;break;case 268435456:f=$n;break;default:f=Fn}return p=zx.bind(null,o),f=tt(f,p),o.callbackPriority=l,o.callbackNode=f,l}return p!==null&&p!==null&&xt(p),o.callbackPriority=2,o.callbackNode=null,2}function zx(o,l){if(zn!==0&&zn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var f=o.callbackNode;if(Id()&&o.callbackNode!==f)return null;var p=mt;return p=Au(o,o===Lt?p:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),p===0?null:(Ex(o,p,l),Ux(o,Wt()),o.callbackNode!=null&&o.callbackNode===f?zx.bind(null,o):null)}function jx(o,l){if(Id())return null;Ex(o,l,!0)}function VN(){$N(function(){(At&6)!==0?tt(fn,BN):Vx()})}function Vg(){return $s===0&&($s=dc()),$s}function Hx(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Mu(""+o)}function Wx(o,l){var f=l.ownerDocument.createElement("input");return f.name=l.name,f.value=l.value,o.id&&f.setAttribute("form",o.id),l.parentNode.insertBefore(f,l),o=new FormData(o),f.parentNode.removeChild(f),o}function UN(o,l,f,p,b){if(l==="submit"&&f&&f.stateNode===b){var w=Hx((b[on]||null).action),M=p.submitter;M&&(l=(l=M[on]||null)?Hx(l.formAction):M.getAttribute("formAction"),l!==null&&(w=l,M=null));var U=new Pu("action","action",null,p,b);o.push({event:U,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if($s!==0){var q=M?Wx(b,M):new FormData(b);ag(f,{pending:!0,data:q,method:b.method,action:w},null,q)}}else typeof w=="function"&&(U.preventDefault(),q=M?Wx(b,M):new FormData(b),ag(f,{pending:!0,data:q,method:b.method,action:w},w,q))},currentTarget:b}]})}}for(var Ug=0;Ug<Tv.length;Ug++){var zg=Tv[Ug],zN=zg.toLowerCase(),jN=zg[0].toUpperCase()+zg.slice(1);vi(zN,"on"+jN)}vi(Ew,"onAnimationEnd"),vi(Tw,"onAnimationIteration"),vi(Sw,"onAnimationStart"),vi("dblclick","onDoubleClick"),vi("focusin","onFocus"),vi("focusout","onBlur"),vi(aN,"onTransitionRun"),vi(oN,"onTransitionStart"),vi(sN,"onTransitionCancel"),vi(Cw,"onTransitionEnd"),Ta("onMouseEnter",["mouseout","mouseover"]),Ta("onMouseLeave",["mouseout","mouseover"]),Ta("onPointerEnter",["pointerout","pointerover"]),Ta("onPointerLeave",["pointerout","pointerover"]),pi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pi("onBeforeInput",["compositionend","keypress","textInput","paste"]),pi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HN=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(oh));function qx(o,l){l=(l&4)!==0;for(var f=0;f<o.length;f++){var p=o[f],b=p.event;p=p.listeners;e:{var w=void 0;if(l)for(var M=p.length-1;0<=M;M--){var U=p[M],q=U.instance,ae=U.currentTarget;if(U=U.listener,q!==w&&b.isPropagationStopped())break e;w=U,b.currentTarget=ae;try{w(b)}catch(ve){yd(ve)}b.currentTarget=null,w=q}else for(M=0;M<p.length;M++){if(U=p[M],q=U.instance,ae=U.currentTarget,U=U.listener,q!==w&&b.isPropagationStopped())break e;w=U,b.currentTarget=ae;try{w(b)}catch(ve){yd(ve)}b.currentTarget=null,w=q}}}}function st(o,l){var f=l[gc];f===void 0&&(f=l[gc]=new Set);var p=o+"__bubble";f.has(p)||(Gx(l,o,2,!1),f.add(p))}function jg(o,l,f){var p=0;l&&(p|=4),Gx(f,o,p,l)}var kd="_reactListening"+Math.random().toString(36).slice(2);function Hg(o){if(!o[kd]){o[kd]=!0,yc.forEach(function(f){f!=="selectionchange"&&(HN.has(f)||jg(f,!1,o),jg(f,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[kd]||(l[kd]=!0,jg("selectionchange",!1,l))}}function Gx(o,l,f,p){switch(vE(l)){case 2:var b=vk;break;case 8:b=gk;break;default:b=ry}f=b.bind(null,l,f,o),b=void 0,!Qr||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(b=!0),p?b!==void 0?o.addEventListener(l,f,{capture:!0,passive:b}):o.addEventListener(l,f,!0):b!==void 0?o.addEventListener(l,f,{passive:b}):o.addEventListener(l,f,!1)}function Wg(o,l,f,p,b){var w=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var M=p.tag;if(M===3||M===4){var U=p.stateNode.containerInfo;if(U===b)break;if(M===4)for(M=p.return;M!==null;){var q=M.tag;if((q===3||q===4)&&M.stateNode.containerInfo===b)return;M=M.return}for(;U!==null;){if(M=Ea(U),M===null)return;if(q=M.tag,q===5||q===6||q===26||q===27){p=w=M;continue e}U=U.parentNode}}p=p.return}Mf(function(){var ae=w,ve=Yr(f),ye=[];e:{var oe=Aw.get(o);if(oe!==void 0){var ue=Pu,We=o;switch(o){case"keypress":if(Vi(f)===0)break e;case"keydown":case"keyup":ue=zu;break;case"focusin":We="focus",ue=Bu;break;case"focusout":We="blur",ue=Bu;break;case"beforeblur":case"afterblur":ue=Bu;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=Zr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=vv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=jf;break;case Ew:case Tw:case Sw:ue=Vu;break;case Cw:ue=Wf;break;case"scroll":case"scrollend":ue=Pf;break;case"wheel":ue=ju;break;case"copy":case"cut":case"paste":ue=Uu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=Dc;break;case"toggle":case"beforetoggle":ue=Gf}var ze=(l&4)!==0,Ot=!ze&&(o==="scroll"||o==="scrollend"),J=ze?oe!==null?oe+"Capture":null:oe;ze=[];for(var X=ae,re;X!==null;){var ge=X;if(re=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||re===null||J===null||(ge=Rs(X,J),ge!=null&&ze.push(sh(X,ge,re))),Ot)break;X=X.return}0<ze.length&&(oe=new ue(oe,We,null,f,ve),ye.push({event:oe,listeners:ze}))}}if((l&7)===0){e:{if(oe=o==="mouseover"||o==="pointerover",ue=o==="mouseout"||o==="pointerout",oe&&f!==Aa&&(We=f.relatedTarget||f.fromElement)&&(Ea(We)||We[Xr]))break e;if((ue||oe)&&(oe=ve.window===ve?ve:(oe=ve.ownerDocument)?oe.defaultView||oe.parentWindow:window,ue?(We=f.relatedTarget||f.toElement,ue=ae,We=We?Ea(We):null,We!==null&&(Ot=a(We),ze=We.tag,We!==Ot||ze!==5&&ze!==27&&ze!==6)&&(We=null)):(ue=null,We=ae),ue!==We)){if(ze=Zr,ge="onMouseLeave",J="onMouseEnter",X="mouse",(o==="pointerout"||o==="pointerover")&&(ze=Dc,ge="onPointerLeave",J="onPointerEnter",X="pointer"),Ot=ue==null?oe:Pi(ue),re=We==null?oe:Pi(We),oe=new ze(ge,X+"leave",ue,f,ve),oe.target=Ot,oe.relatedTarget=re,ge=null,Ea(ve)===ae&&(ze=new ze(J,X+"enter",We,f,ve),ze.target=re,ze.relatedTarget=Ot,ge=ze),Ot=ge,ue&&We)t:{for(ze=ue,J=We,X=0,re=ze;re;re=dl(re))X++;for(re=0,ge=J;ge;ge=dl(ge))re++;for(;0<X-re;)ze=dl(ze),X--;for(;0<re-X;)J=dl(J),re--;for(;X--;){if(ze===J||J!==null&&ze===J.alternate)break t;ze=dl(ze),J=dl(J)}ze=null}else ze=null;ue!==null&&Kx(ye,oe,ue,ze,!1),We!==null&&Ot!==null&&Kx(ye,Ot,We,ze,!0)}}e:{if(oe=ae?Pi(ae):window,ue=oe.nodeName&&oe.nodeName.toLowerCase(),ue==="select"||ue==="input"&&oe.type==="file")var Ie=fw;else if(mn(oe))if(dw)Ie=nN;else{Ie=eN;var it=JD}else ue=oe.nodeName,!ue||ue.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?ae&&Ec(ae.elementType)&&(Ie=fw):Ie=tN;if(Ie&&(Ie=Ie(o,ae))){ka(ye,Ie,f,ve);break e}it&&it(o,oe,ae),o==="focusout"&&ae&&oe.type==="number"&&ae.memoizedProps.value!=null&&yo(oe,"number",oe.value)}switch(it=ae?Pi(ae):window,o){case"focusin":(mn(it)||it.contentEditable==="true")&&(Hu=it,wv=ae,Oc=null);break;case"focusout":Oc=wv=Hu=null;break;case"mousedown":xv=!0;break;case"contextmenu":case"mouseup":case"dragend":xv=!1,ww(ye,f,ve);break;case"selectionchange":if(iN)break;case"keydown":case"keyup":ww(ye,f,ve)}var Fe;if(ji)e:{switch(o){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else dt?fe(o,f)&&(je="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(je="onCompositionStart");je&&(N&&f.locale!=="ko"&&(dt||je!=="onCompositionStart"?je==="onCompositionEnd"&&dt&&(Fe=Sc()):(Bi=ve,bo="value"in Bi?Bi.value:Bi.textContent,dt=!0)),it=Od(ae,je),0<it.length&&(je=new Rc(je,o,null,f,ve),ye.push({event:je,listeners:it}),Fe?je.data=Fe:(Fe=Te(f),Fe!==null&&(je.data=Fe)))),(Fe=S?pn(o,f):pt(o,f))&&(je=Od(ae,"onBeforeInput"),0<je.length&&(it=new Rc("onBeforeInput","beforeinput",null,f,ve),ye.push({event:it,listeners:je}),it.data=Fe)),UN(ye,o,ae,f,ve)}qx(ye,l)})}function sh(o,l,f){return{instance:o,listener:l,currentTarget:f}}function Od(o,l){for(var f=l+"Capture",p=[];o!==null;){var b=o,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=Rs(o,f),b!=null&&p.unshift(sh(o,b,w)),b=Rs(o,l),b!=null&&p.push(sh(o,b,w))),o.tag===3)return p;o=o.return}return[]}function dl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function Kx(o,l,f,p,b){for(var w=l._reactName,M=[];f!==null&&f!==p;){var U=f,q=U.alternate,ae=U.stateNode;if(U=U.tag,q!==null&&q===p)break;U!==5&&U!==26&&U!==27||ae===null||(q=ae,b?(ae=Rs(f,w),ae!=null&&M.unshift(sh(f,ae,q))):b||(ae=Rs(f,w),ae!=null&&M.push(sh(f,ae,q)))),f=f.return}M.length!==0&&o.push({event:l,listeners:M})}var WN=/\r\n?/g,qN=/\u0000|\uFFFD/g;function Xx(o){return(typeof o=="string"?o:""+o).replace(WN,`
`).replace(qN,"")}function $x(o,l){return l=Xx(l),Xx(o)===l}function Md(){}function kt(o,l,f,p,b,w){switch(f){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||$r(o,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&$r(o,""+p);break;case"className":Li(o,"class",p);break;case"tabIndex":Li(o,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Li(o,f,p);break;case"style":xc(o,p,w);break;case"data":if(l!=="object"){Li(o,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||f!=="href")){o.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(f);break}p=Mu(""+p),o.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){o.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(f==="formAction"?(l!=="input"&&kt(o,l,"name",b.name,b,null),kt(o,l,"formEncType",b.formEncType,b,null),kt(o,l,"formMethod",b.formMethod,b,null),kt(o,l,"formTarget",b.formTarget,b,null)):(kt(o,l,"encType",b.encType,b,null),kt(o,l,"method",b.method,b,null),kt(o,l,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){o.removeAttribute(f);break}p=Mu(""+p),o.setAttribute(f,p);break;case"onClick":p!=null&&(o.onclick=Md);break;case"onScroll":p!=null&&st("scroll",o);break;case"onScrollEnd":p!=null&&st("scrollend",o);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(f=p.__html,f!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"multiple":o.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":o.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){o.removeAttribute("xlink:href");break}f=Mu(""+p),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,""+p):o.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,""):o.removeAttribute(f);break;case"capture":case"download":p===!0?o.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?o.setAttribute(f,p):o.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?o.setAttribute(f,p):o.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?o.removeAttribute(f):o.setAttribute(f,p);break;case"popover":st("beforetoggle",o),st("toggle",o),go(o,"popover",p);break;case"xlinkActuate":Bn(o,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Bn(o,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Bn(o,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Bn(o,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Bn(o,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Bn(o,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Bn(o,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Bn(o,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Bn(o,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":go(o,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=pv.get(f)||f,go(o,f,p))}}function qg(o,l,f,p,b,w){switch(f){case"style":xc(o,p,w);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(n(61));if(f=p.__html,f!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"children":typeof p=="string"?$r(o,p):(typeof p=="number"||typeof p=="bigint")&&$r(o,""+p);break;case"onScroll":p!=null&&st("scroll",o);break;case"onScrollEnd":p!=null&&st("scrollend",o);break;case"onClick":p!=null&&(o.onclick=Md);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Iu.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(b=f.endsWith("Capture"),l=f.slice(2,b?f.length-7:void 0),w=o[on]||null,w=w!=null?w[f]:null,typeof w=="function"&&o.removeEventListener(l,w,b),typeof p=="function")){typeof w!="function"&&w!==null&&(f in o?o[f]=null:o.hasAttribute(f)&&o.removeAttribute(f)),o.addEventListener(l,p,b);break e}f in o?o[f]=p:p===!0?o.setAttribute(f,""):go(o,f,p)}}}function jn(o,l,f){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",o),st("load",o);var p=!1,b=!1,w;for(w in f)if(f.hasOwnProperty(w)){var M=f[w];if(M!=null)switch(w){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:kt(o,l,w,M,f,null)}}b&&kt(o,l,"srcSet",f.srcSet,f,null),p&&kt(o,l,"src",f.src,f,null);return;case"input":st("invalid",o);var U=w=M=b=null,q=null,ae=null;for(p in f)if(f.hasOwnProperty(p)){var ve=f[p];if(ve!=null)switch(p){case"name":b=ve;break;case"type":M=ve;break;case"checked":q=ve;break;case"defaultChecked":ae=ve;break;case"value":w=ve;break;case"defaultValue":U=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(n(137,l));break;default:kt(o,l,p,ve,f,null)}}Ss(o,w,U,q,ae,M,b,!1),Ou(o);return;case"select":st("invalid",o),p=M=w=null;for(b in f)if(f.hasOwnProperty(b)&&(U=f[b],U!=null))switch(b){case"value":w=U;break;case"defaultValue":M=U;break;case"multiple":p=U;default:kt(o,l,b,U,f,null)}l=w,f=M,o.multiple=!!p,l!=null?Ca(o,!!p,l,!1):f!=null&&Ca(o,!!p,f,!0);return;case"textarea":st("invalid",o),w=b=p=null;for(M in f)if(f.hasOwnProperty(M)&&(U=f[M],U!=null))switch(M){case"value":p=U;break;case"defaultValue":b=U;break;case"children":w=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(n(91));break;default:kt(o,l,M,U,f,null)}Cs(o,p,b,w),Ou(o);return;case"option":for(q in f)if(f.hasOwnProperty(q)&&(p=f[q],p!=null))switch(q){case"selected":o.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:kt(o,l,q,p,f,null)}return;case"dialog":st("beforetoggle",o),st("toggle",o),st("cancel",o),st("close",o);break;case"iframe":case"object":st("load",o);break;case"video":case"audio":for(p=0;p<oh.length;p++)st(oh[p],o);break;case"image":st("error",o),st("load",o);break;case"details":st("toggle",o);break;case"embed":case"source":case"link":st("error",o),st("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ae in f)if(f.hasOwnProperty(ae)&&(p=f[ae],p!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:kt(o,l,ae,p,f,null)}return;default:if(Ec(l)){for(ve in f)f.hasOwnProperty(ve)&&(p=f[ve],p!==void 0&&qg(o,l,ve,p,f,void 0));return}}for(U in f)f.hasOwnProperty(U)&&(p=f[U],p!=null&&kt(o,l,U,p,f,null))}function GN(o,l,f,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,M=null,U=null,q=null,ae=null,ve=null;for(ue in f){var ye=f[ue];if(f.hasOwnProperty(ue)&&ye!=null)switch(ue){case"checked":break;case"value":break;case"defaultValue":q=ye;default:p.hasOwnProperty(ue)||kt(o,l,ue,null,p,ye)}}for(var oe in p){var ue=p[oe];if(ye=f[oe],p.hasOwnProperty(oe)&&(ue!=null||ye!=null))switch(oe){case"type":w=ue;break;case"name":b=ue;break;case"checked":ae=ue;break;case"defaultChecked":ve=ue;break;case"value":M=ue;break;case"defaultValue":U=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(n(137,l));break;default:ue!==ye&&kt(o,l,oe,ue,p,ye)}}Ir(o,M,U,q,ae,ve,w,b);return;case"select":ue=M=U=oe=null;for(w in f)if(q=f[w],f.hasOwnProperty(w)&&q!=null)switch(w){case"value":break;case"multiple":ue=q;default:p.hasOwnProperty(w)||kt(o,l,w,null,p,q)}for(b in p)if(w=p[b],q=f[b],p.hasOwnProperty(b)&&(w!=null||q!=null))switch(b){case"value":oe=w;break;case"defaultValue":U=w;break;case"multiple":M=w;default:w!==q&&kt(o,l,b,w,p,q)}l=U,f=M,p=ue,oe!=null?Ca(o,!!f,oe,!1):!!p!=!!f&&(l!=null?Ca(o,!!f,l,!0):Ca(o,!!f,f?[]:"",!1));return;case"textarea":ue=oe=null;for(U in f)if(b=f[U],f.hasOwnProperty(U)&&b!=null&&!p.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:kt(o,l,U,null,p,b)}for(M in p)if(b=p[M],w=f[M],p.hasOwnProperty(M)&&(b!=null||w!=null))switch(M){case"value":oe=b;break;case"defaultValue":ue=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==w&&kt(o,l,M,b,p,w)}Dt(o,oe,ue);return;case"option":for(var We in f)if(oe=f[We],f.hasOwnProperty(We)&&oe!=null&&!p.hasOwnProperty(We))switch(We){case"selected":o.selected=!1;break;default:kt(o,l,We,null,p,oe)}for(q in p)if(oe=p[q],ue=f[q],p.hasOwnProperty(q)&&oe!==ue&&(oe!=null||ue!=null))switch(q){case"selected":o.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:kt(o,l,q,oe,p,ue)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ze in f)oe=f[ze],f.hasOwnProperty(ze)&&oe!=null&&!p.hasOwnProperty(ze)&&kt(o,l,ze,null,p,oe);for(ae in p)if(oe=p[ae],ue=f[ae],p.hasOwnProperty(ae)&&oe!==ue&&(oe!=null||ue!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(n(137,l));break;default:kt(o,l,ae,oe,p,ue)}return;default:if(Ec(l)){for(var Ot in f)oe=f[Ot],f.hasOwnProperty(Ot)&&oe!==void 0&&!p.hasOwnProperty(Ot)&&qg(o,l,Ot,void 0,p,oe);for(ve in p)oe=p[ve],ue=f[ve],!p.hasOwnProperty(ve)||oe===ue||oe===void 0&&ue===void 0||qg(o,l,ve,oe,p,ue);return}}for(var J in f)oe=f[J],f.hasOwnProperty(J)&&oe!=null&&!p.hasOwnProperty(J)&&kt(o,l,J,null,p,oe);for(ye in p)oe=p[ye],ue=f[ye],!p.hasOwnProperty(ye)||oe===ue||oe==null&&ue==null||kt(o,l,ye,oe,p,ue)}var Gg=null,Kg=null;function Pd(o){return o.nodeType===9?o:o.ownerDocument}function Yx(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qx(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function Xg(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var $g=null;function KN(){var o=window.event;return o&&o.type==="popstate"?o===$g?!1:($g=o,!0):($g=null,!1)}var Zx=typeof setTimeout=="function"?setTimeout:void 0,XN=typeof clearTimeout=="function"?clearTimeout:void 0,Jx=typeof Promise=="function"?Promise:void 0,$N=typeof queueMicrotask=="function"?queueMicrotask:typeof Jx<"u"?function(o){return Jx.resolve(null).then(o).catch(YN)}:Zx;function YN(o){setTimeout(function(){throw o})}function Po(o){return o==="head"}function eE(o,l){var f=l,p=0,b=0;do{var w=f.nextSibling;if(o.removeChild(f),w&&w.nodeType===8)if(f=w.data,f==="/$"){if(0<p&&8>p){f=p;var M=o.ownerDocument;if(f&1&&uh(M.documentElement),f&2&&uh(M.body),f&4)for(f=M.head,uh(f),M=f.firstChild;M;){var U=M.nextSibling,q=M.nodeName;M[ws]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&M.rel.toLowerCase()==="stylesheet"||f.removeChild(M),M=U}}if(b===0){o.removeChild(w),vh(l);return}b--}else f==="$"||f==="$?"||f==="$!"?b++:p=f.charCodeAt(0)-48;else p=0;f=w}while(f);vh(l)}function Yg(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var f=l;switch(l=l.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Yg(f),vo(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}o.removeChild(f)}}function QN(o,l,f,p){for(;o.nodeType===1;){var b=f;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(p){if(!o[ws])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(w=o.getAttribute("rel"),w==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(w!==b.rel||o.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||o.getAttribute("title")!==(b.title==null?null:b.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(w=o.getAttribute("src"),(w!==(b.src==null?null:b.src)||o.getAttribute("type")!==(b.type==null?null:b.type)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&o.getAttribute("name")===w)return o}else return o;if(o=yi(o.nextSibling),o===null)break}return null}function ZN(o,l,f){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!f||(o=yi(o.nextSibling),o===null))return null;return o}function Qg(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function JN(o,l){var f=o.ownerDocument;if(o.data!=="$?"||f.readyState==="complete")l();else{var p=function(){l(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),o._reactRetry=p}}function yi(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="F!"||l==="F")break;if(l==="/$")return null}}return o}var Zg=null;function tE(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return o;l--}else f==="/$"&&l++}o=o.previousSibling}return null}function nE(o,l,f){switch(l=Pd(f),o){case"html":if(o=l.documentElement,!o)throw Error(n(452));return o;case"head":if(o=l.head,!o)throw Error(n(453));return o;case"body":if(o=l.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function uh(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);vo(o)}var ai=new Map,rE=new Set;function Ld(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var qa=Q.d;Q.d={f:ek,r:tk,D:nk,C:rk,L:ik,m:ak,X:sk,S:ok,M:uk};function ek(){var o=qa.f(),l=Ad();return o||l}function tk(o){var l=Mi(o);l!==null&&l.tag===5&&l.type==="form"?E1(l):qa.r(o)}var pl=typeof document>"u"?null:document;function iE(o,l,f){var p=pl;if(p&&typeof l=="string"&&l){var b=sn(l);b='link[rel="'+o+'"][href="'+b+'"]',typeof f=="string"&&(b+='[crossorigin="'+f+'"]'),rE.has(b)||(rE.add(b),o={rel:o,crossOrigin:f,href:l},p.querySelector(b)===null&&(l=p.createElement("link"),jn(l,"link",o),Jt(l),p.head.appendChild(l)))}}function nk(o){qa.D(o),iE("dns-prefetch",o,null)}function rk(o,l){qa.C(o,l),iE("preconnect",o,l)}function ik(o,l,f){qa.L(o,l,f);var p=pl;if(p&&o&&l){var b='link[rel="preload"][as="'+sn(l)+'"]';l==="image"&&f&&f.imageSrcSet?(b+='[imagesrcset="'+sn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(b+='[imagesizes="'+sn(f.imageSizes)+'"]')):b+='[href="'+sn(o)+'"]';var w=b;switch(l){case"style":w=ml(o);break;case"script":w=vl(o)}ai.has(w)||(o=d({rel:"preload",href:l==="image"&&f&&f.imageSrcSet?void 0:o,as:l},f),ai.set(w,o),p.querySelector(b)!==null||l==="style"&&p.querySelector(lh(w))||l==="script"&&p.querySelector(ch(w))||(l=p.createElement("link"),jn(l,"link",o),Jt(l),p.head.appendChild(l)))}}function ak(o,l){qa.m(o,l);var f=pl;if(f&&o){var p=l&&typeof l.as=="string"?l.as:"script",b='link[rel="modulepreload"][as="'+sn(p)+'"][href="'+sn(o)+'"]',w=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=vl(o)}if(!ai.has(w)&&(o=d({rel:"modulepreload",href:o},l),ai.set(w,o),f.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(ch(w)))return}p=f.createElement("link"),jn(p,"link",o),Jt(p),f.head.appendChild(p)}}}function ok(o,l,f){qa.S(o,l,f);var p=pl;if(p&&o){var b=lr(p).hoistableStyles,w=ml(o);l=l||"default";var M=b.get(w);if(!M){var U={loading:0,preload:null};if(M=p.querySelector(lh(w)))U.loading=5;else{o=d({rel:"stylesheet",href:o,"data-precedence":l},f),(f=ai.get(w))&&Jg(o,f);var q=M=p.createElement("link");Jt(q),jn(q,"link",o),q._p=new Promise(function(ae,ve){q.onload=ae,q.onerror=ve}),q.addEventListener("load",function(){U.loading|=1}),q.addEventListener("error",function(){U.loading|=2}),U.loading|=4,Fd(M,l,p)}M={type:"stylesheet",instance:M,count:1,state:U},b.set(w,M)}}}function sk(o,l){qa.X(o,l);var f=pl;if(f&&o){var p=lr(f).hoistableScripts,b=vl(o),w=p.get(b);w||(w=f.querySelector(ch(b)),w||(o=d({src:o,async:!0},l),(l=ai.get(b))&&ey(o,l),w=f.createElement("script"),Jt(w),jn(w,"link",o),f.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(b,w))}}function uk(o,l){qa.M(o,l);var f=pl;if(f&&o){var p=lr(f).hoistableScripts,b=vl(o),w=p.get(b);w||(w=f.querySelector(ch(b)),w||(o=d({src:o,async:!0,type:"module"},l),(l=ai.get(b))&&ey(o,l),w=f.createElement("script"),Jt(w),jn(w,"link",o),f.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(b,w))}}function aE(o,l,f,p){var b=(b=Ee.current)?Ld(b):null;if(!b)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(l=ml(f.href),f=lr(b).hoistableStyles,p=f.get(l),p||(p={type:"style",instance:null,count:0,state:null},f.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){o=ml(f.href);var w=lr(b).hoistableStyles,M=w.get(o);if(M||(b=b.ownerDocument||b,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(o,M),(w=b.querySelector(lh(o)))&&!w._p&&(M.instance=w,M.state.loading=5),ai.has(o)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ai.set(o,f),w||lk(b,o,f,M.state))),l&&p===null)throw Error(n(528,""));return M}if(l&&p!==null)throw Error(n(529,""));return null;case"script":return l=f.async,f=f.src,typeof f=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=vl(f),f=lr(b).hoistableScripts,p=f.get(l),p||(p={type:"script",instance:null,count:0,state:null},f.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function ml(o){return'href="'+sn(o)+'"'}function lh(o){return'link[rel="stylesheet"]['+o+"]"}function oE(o){return d({},o,{"data-precedence":o.precedence,precedence:null})}function lk(o,l,f,p){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=o.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),jn(l,"link",f),Jt(l),o.head.appendChild(l))}function vl(o){return'[src="'+sn(o)+'"]'}function ch(o){return"script[async]"+o}function sE(o,l,f){if(l.count++,l.instance===null)switch(l.type){case"style":var p=o.querySelector('style[data-href~="'+sn(f.href)+'"]');if(p)return l.instance=p,Jt(p),p;var b=d({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(o.ownerDocument||o).createElement("style"),Jt(p),jn(p,"style",b),Fd(p,f.precedence,o),l.instance=p;case"stylesheet":b=ml(f.href);var w=o.querySelector(lh(b));if(w)return l.state.loading|=4,l.instance=w,Jt(w),w;p=oE(f),(b=ai.get(b))&&Jg(p,b),w=(o.ownerDocument||o).createElement("link"),Jt(w);var M=w;return M._p=new Promise(function(U,q){M.onload=U,M.onerror=q}),jn(w,"link",p),l.state.loading|=4,Fd(w,f.precedence,o),l.instance=w;case"script":return w=vl(f.src),(b=o.querySelector(ch(w)))?(l.instance=b,Jt(b),b):(p=f,(b=ai.get(w))&&(p=d({},f),ey(p,b)),o=o.ownerDocument||o,b=o.createElement("script"),Jt(b),jn(b,"link",p),o.head.appendChild(b),l.instance=b);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,Fd(p,f.precedence,o));return l.instance}function Fd(o,l,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,w=b,M=0;M<p.length;M++){var U=p[M];if(U.dataset.precedence===l)w=U;else if(w!==b)break}w?w.parentNode.insertBefore(o,w.nextSibling):(l=f.nodeType===9?f.head:f,l.insertBefore(o,l.firstChild))}function Jg(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function ey(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var Bd=null;function uE(o,l,f){if(Bd===null){var p=new Map,b=Bd=new Map;b.set(f,p)}else b=Bd,p=b.get(f),p||(p=new Map,b.set(f,p));if(p.has(o))return p;for(p.set(o,null),f=f.getElementsByTagName(o),b=0;b<f.length;b++){var w=f[b];if(!(w[ws]||w[dn]||o==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var M=w.getAttribute(l)||"";M=o+M;var U=p.get(M);U?U.push(w):p.set(M,[w])}}return p}function lE(o,l,f){o=o.ownerDocument||o,o.head.insertBefore(f,l==="title"?o.querySelector("head > title"):null)}function ck(o,l,f){if(f===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return o=l.disabled,typeof l.precedence=="string"&&o==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function cE(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var hh=null;function hk(){}function fk(o,l,f){if(hh===null)throw Error(n(475));var p=hh;if(l.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var b=ml(f.href),w=o.querySelector(lh(b));if(w){o=w._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(p.count++,p=Vd.bind(p),o.then(p,p)),l.state.loading|=4,l.instance=w,Jt(w);return}w=o.ownerDocument||o,f=oE(f),(b=ai.get(b))&&Jg(f,b),w=w.createElement("link"),Jt(w);var M=w;M._p=new Promise(function(U,q){M.onload=U,M.onerror=q}),jn(w,"link",f),l.instance=w}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(l,o),(o=l.state.preload)&&(l.state.loading&3)===0&&(p.count++,l=Vd.bind(p),o.addEventListener("load",l),o.addEventListener("error",l))}}function dk(){if(hh===null)throw Error(n(475));var o=hh;return o.stylesheets&&o.count===0&&ty(o,o.stylesheets),0<o.count?function(l){var f=setTimeout(function(){if(o.stylesheets&&ty(o,o.stylesheets),o.unsuspend){var p=o.unsuspend;o.unsuspend=null,p()}},6e4);return o.unsuspend=l,function(){o.unsuspend=null,clearTimeout(f)}}:null}function Vd(){if(this.count--,this.count===0){if(this.stylesheets)ty(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var Ud=null;function ty(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,Ud=new Map,l.forEach(pk,o),Ud=null,Vd.call(o))}function pk(o,l){if(!(l.state.loading&4)){var f=Ud.get(o);if(f)var p=f.get(null);else{f=new Map,Ud.set(o,f);for(var b=o.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var M=b[w];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(f.set(M.dataset.precedence,M),p=M)}p&&f.set(null,p)}b=l.instance,M=b.getAttribute("data-precedence"),w=f.get(M)||p,w===p&&f.set(null,b),f.set(M,b),this.count++,p=Vd.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),w?w.parentNode.insertBefore(b,w.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(b,o.firstChild)),l.state.loading|=4}}var fh={$$typeof:A,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function mk(o,l,f,p,b,w,M,U){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=wa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wa(0),this.hiddenUpdates=wa(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function hE(o,l,f,p,b,w,M,U,q,ae,ve,ye){return o=new mk(o,l,f,M,U,q,ae,ye),l=1,w===!0&&(l|=24),w=Nr(3,null,null,l),o.current=w,w.stateNode=o,l=Lv(),l.refCount++,o.pooledCache=l,l.refCount++,w.memoizedState={element:p,isDehydrated:f,cache:l},Uv(w),o}function fE(o){return o?(o=Ku,o):Ku}function dE(o,l,f,p,b,w){b=fE(b),p.context===null?p.context=b:p.pendingContext=b,p=xo(l),p.payload={element:f},w=w===void 0?null:w,w!==null&&(p.callback=w),f=Eo(o,p,l),f!==null&&(Lr(f,o,l),jc(f,o,l))}function pE(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<l?f:l}}function ny(o,l){pE(o,l),(o=o.alternate)&&pE(o,l)}function mE(o){if(o.tag===13){var l=Gu(o,67108864);l!==null&&Lr(l,o,67108864),ny(o,67108864)}}var zd=!0;function vk(o,l,f,p){var b=G.T;G.T=null;var w=Q.p;try{Q.p=2,ry(o,l,f,p)}finally{Q.p=w,G.T=b}}function gk(o,l,f,p){var b=G.T;G.T=null;var w=Q.p;try{Q.p=8,ry(o,l,f,p)}finally{Q.p=w,G.T=b}}function ry(o,l,f,p){if(zd){var b=iy(p);if(b===null)Wg(o,l,p,jd,f),gE(o,p);else if(bk(b,o,l,f,p))p.stopPropagation();else if(gE(o,p),l&4&&-1<yk.indexOf(o)){for(;b!==null;){var w=Mi(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var M=ur(w.pendingLanes);if(M!==0){var U=w;for(U.pendingLanes|=2,U.entangledLanes|=2;M;){var q=1<<31-an(M);U.entanglements[1]|=q,M&=~q}Xi(w),(At&6)===0&&(Sd=Wt()+500,ah(0))}}break;case 13:U=Gu(w,2),U!==null&&Lr(U,w,2),Ad(),ny(w,2)}if(w=iy(p),w===null&&Wg(o,l,p,jd,f),w===b)break;b=w}b!==null&&p.stopPropagation()}else Wg(o,l,p,null,f)}}function iy(o){return o=Yr(o),ay(o)}var jd=null;function ay(o){if(jd=null,o=Ea(o),o!==null){var l=a(o);if(l===null)o=null;else{var f=l.tag;if(f===13){if(o=s(l),o!==null)return o;o=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return jd=o,null}function vE(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(dr()){case fn:return 2;case Rr:return 8;case Fn:case Gr:return 32;case $n:return 268435456;default:return 32}default:return 32}}var oy=!1,Lo=null,Fo=null,Bo=null,dh=new Map,ph=new Map,Vo=[],yk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gE(o,l){switch(o){case"focusin":case"focusout":Lo=null;break;case"dragenter":case"dragleave":Fo=null;break;case"mouseover":case"mouseout":Bo=null;break;case"pointerover":case"pointerout":dh.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":ph.delete(l.pointerId)}}function mh(o,l,f,p,b,w){return o===null||o.nativeEvent!==w?(o={blockedOn:l,domEventName:f,eventSystemFlags:p,nativeEvent:w,targetContainers:[b]},l!==null&&(l=Mi(l),l!==null&&mE(l)),o):(o.eventSystemFlags|=p,l=o.targetContainers,b!==null&&l.indexOf(b)===-1&&l.push(b),o)}function bk(o,l,f,p,b){switch(l){case"focusin":return Lo=mh(Lo,o,l,f,p,b),!0;case"dragenter":return Fo=mh(Fo,o,l,f,p,b),!0;case"mouseover":return Bo=mh(Bo,o,l,f,p,b),!0;case"pointerover":var w=b.pointerId;return dh.set(w,mh(dh.get(w)||null,o,l,f,p,b)),!0;case"gotpointercapture":return w=b.pointerId,ph.set(w,mh(ph.get(w)||null,o,l,f,p,b)),!0}return!1}function yE(o){var l=Ea(o.target);if(l!==null){var f=a(l);if(f!==null){if(l=f.tag,l===13){if(l=s(f),l!==null){o.blockedOn=l,Af(o.priority,function(){if(f.tag===13){var p=Pr();p=fo(p);var b=Gu(f,p);b!==null&&Lr(b,f,p),ny(f,p)}});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Hd(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var f=iy(o.nativeEvent);if(f===null){f=o.nativeEvent;var p=new f.constructor(f.type,f);Aa=p,f.target.dispatchEvent(p),Aa=null}else return l=Mi(f),l!==null&&mE(l),o.blockedOn=f,!1;l.shift()}return!0}function bE(o,l,f){Hd(o)&&f.delete(l)}function _k(){oy=!1,Lo!==null&&Hd(Lo)&&(Lo=null),Fo!==null&&Hd(Fo)&&(Fo=null),Bo!==null&&Hd(Bo)&&(Bo=null),dh.forEach(bE),ph.forEach(bE)}function Wd(o,l){o.blockedOn===l&&(o.blockedOn=null,oy||(oy=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,_k)))}var qd=null;function _E(o){qd!==o&&(qd=o,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){qd===o&&(qd=null);for(var l=0;l<o.length;l+=3){var f=o[l],p=o[l+1],b=o[l+2];if(typeof p!="function"){if(ay(p||f)===null)continue;break}var w=Mi(f);w!==null&&(o.splice(l,3),l-=3,ag(w,{pending:!0,data:b,method:f.method,action:p},p,b))}}))}function vh(o){function l(q){return Wd(q,o)}Lo!==null&&Wd(Lo,o),Fo!==null&&Wd(Fo,o),Bo!==null&&Wd(Bo,o),dh.forEach(l),ph.forEach(l);for(var f=0;f<Vo.length;f++){var p=Vo[f];p.blockedOn===o&&(p.blockedOn=null)}for(;0<Vo.length&&(f=Vo[0],f.blockedOn===null);)yE(f),f.blockedOn===null&&Vo.shift();if(f=(o.ownerDocument||o).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var b=f[p],w=f[p+1],M=b[on]||null;if(typeof w=="function")M||_E(f);else if(M){var U=null;if(w&&w.hasAttribute("formAction")){if(b=w,M=w[on]||null)U=M.formAction;else if(ay(b)!==null)continue}else U=M.action;typeof U=="function"?f[p+1]=U:(f.splice(p,3),p-=3),_E(f)}}}function sy(o){this._internalRoot=o}Gd.prototype.render=sy.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(n(409));var f=l.current,p=Pr();dE(f,p,o,l,null,null)},Gd.prototype.unmount=sy.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;dE(o.current,2,null,o,null,null),Ad(),l[Xr]=null}};function Gd(o){this._internalRoot=o}Gd.prototype.unstable_scheduleHydration=function(o){if(o){var l=po();o={blockedOn:null,target:o,priority:l};for(var f=0;f<Vo.length&&l!==0&&l<Vo[f].priority;f++);Vo.splice(f,0,o),f===0&&yE(o)}};var wE=e.version;if(wE!=="19.1.0")throw Error(n(527,wE,"19.1.0"));Q.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=c(l),o=o!==null?h(o):null,o=o===null?null:o.stateNode,o};var wk={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kd.isDisabled&&Kd.supportsFiber)try{Pt=Kd.inject(wk),ct=Kd}catch{}}return yh.createRoot=function(o,l){if(!i(o))throw Error(n(299));var f=!1,p="",b=F1,w=B1,M=V1,U=null;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(U=l.unstable_transitionCallbacks)),l=hE(o,1,!1,null,null,f,p,b,w,M,U,null),o[Xr]=l.current,Hg(o),new sy(l)},yh.hydrateRoot=function(o,l,f){if(!i(o))throw Error(n(299));var p=!1,b="",w=F1,M=B1,U=V1,q=null,ae=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(b=f.identifierPrefix),f.onUncaughtError!==void 0&&(w=f.onUncaughtError),f.onCaughtError!==void 0&&(M=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(q=f.unstable_transitionCallbacks),f.formState!==void 0&&(ae=f.formState)),l=hE(o,1,!0,l,f??null,p,b,w,M,U,q,ae),l.context=fE(null),f=l.current,p=Pr(),p=fo(p),b=xo(p),b.callback=null,Eo(f,b,p),f=p,l.current.lanes=f,xa(l,f),Xi(l),o[Xr]=l.current,Hg(o),new Gd(l)},yh.version="19.1.0",yh}var NE;function Ok(){if(NE)return cy.exports;NE=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),cy.exports=kk(),cy.exports}var Mk=Ok();const Pk=_S(Mk);var bh={},kE;function Lk(){if(kE)return bh;kE=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.parse=s,bh.serialize=h;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,a=(()=>{const v=function(){};return v.prototype=Object.create(null),v})();function s(v,y){const _=new a,E=v.length;if(E<2)return _;const x=(y==null?void 0:y.decode)||d;let T=0;do{const C=v.indexOf("=",T);if(C===-1)break;const A=v.indexOf(";",T),R=A===-1?E:A;if(C>R){T=v.lastIndexOf(";",C-1)+1;continue}const k=u(v,T,C),B=c(v,C,k),P=v.slice(k,B);if(_[P]===void 0){let I=u(v,C+1,R),D=c(v,R,I);const O=x(v.slice(I,D));_[P]=O}T=R+1}while(T<E);return _}function u(v,y,_){do{const E=v.charCodeAt(y);if(E!==32&&E!==9)return y}while(++y<_);return _}function c(v,y,_){for(;y>_;){const E=v.charCodeAt(--y);if(E!==32&&E!==9)return y+1}return _}function h(v,y,_){const E=(_==null?void 0:_.encode)||encodeURIComponent;if(!r.test(v))throw new TypeError(`argument name is invalid: ${v}`);const x=E(y);if(!e.test(x))throw new TypeError(`argument val is invalid: ${y}`);let T=v+"="+x;if(!_)return T;if(_.maxAge!==void 0){if(!Number.isInteger(_.maxAge))throw new TypeError(`option maxAge is invalid: ${_.maxAge}`);T+="; Max-Age="+_.maxAge}if(_.domain){if(!t.test(_.domain))throw new TypeError(`option domain is invalid: ${_.domain}`);T+="; Domain="+_.domain}if(_.path){if(!n.test(_.path))throw new TypeError(`option path is invalid: ${_.path}`);T+="; Path="+_.path}if(_.expires){if(!m(_.expires)||!Number.isFinite(_.expires.valueOf()))throw new TypeError(`option expires is invalid: ${_.expires}`);T+="; Expires="+_.expires.toUTCString()}if(_.httpOnly&&(T+="; HttpOnly"),_.secure&&(T+="; Secure"),_.partitioned&&(T+="; Partitioned"),_.priority)switch(typeof _.priority=="string"?_.priority.toLowerCase():void 0){case"low":T+="; Priority=Low";break;case"medium":T+="; Priority=Medium";break;case"high":T+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${_.priority}`)}if(_.sameSite)switch(typeof _.sameSite=="string"?_.sameSite.toLowerCase():_.sameSite){case!0:case"strict":T+="; SameSite=Strict";break;case"lax":T+="; SameSite=Lax";break;case"none":T+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${_.sameSite}`)}return T}function d(v){if(v.indexOf("%")===-1)return v;try{return decodeURIComponent(v)}catch{return v}}function m(v){return i.call(v)==="[object Date]"}return bh}Lk();/**
 * react-router v7.5.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var OE="popstate";function Fk(r={}){function e(n,i){let{pathname:a,search:s,hash:u}=n.location;return r0("",{pathname:a,search:s,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:Uh(i)}return Vk(e,t,null,r)}function Ht(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Ci(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Bk(){return Math.random().toString(36).substring(2,10)}function ME(r,e){return{usr:r.state,key:r.key,idx:e}}function r0(r,e,t=null,n){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?Jl(e):e,state:t,key:e&&e.key||n||Bk()}}function Uh({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function Jl(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substring(n),r=r.substring(0,n)),r&&(e.pathname=r)}return e}function Vk(r,e,t,n={}){let{window:i=document.defaultView,v5Compat:a=!1}=n,s=i.history,u="POP",c=null,h=d();h==null&&(h=0,s.replaceState({...s.state,idx:h},""));function d(){return(s.state||{idx:null}).idx}function m(){u="POP";let x=d(),T=x==null?null:x-h;h=x,c&&c({action:u,location:E.location,delta:T})}function v(x,T){u="PUSH";let C=r0(E.location,x,T);h=d()+1;let A=ME(C,h),R=E.createHref(C);try{s.pushState(A,"",R)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;i.location.assign(R)}a&&c&&c({action:u,location:E.location,delta:1})}function y(x,T){u="REPLACE";let C=r0(E.location,x,T);h=d();let A=ME(C,h),R=E.createHref(C);s.replaceState(A,"",R),a&&c&&c({action:u,location:E.location,delta:0})}function _(x){let T=i.location.origin!=="null"?i.location.origin:i.location.href,C=typeof x=="string"?x:Uh(x);return C=C.replace(/ $/,"%20"),Ht(T,`No window.location.(origin|href) available to create URL for href: ${C}`),new URL(C,T)}let E={get action(){return u},get location(){return r(i,s)},listen(x){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(OE,m),c=x,()=>{i.removeEventListener(OE,m),c=null}},createHref(x){return e(i,x)},createURL:_,encodeLocation(x){let T=_(x);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:v,replace:y,go(x){return s.go(x)}};return E}function wS(r,e,t="/"){return Uk(r,e,t,!1)}function Uk(r,e,t,n){let i=typeof e=="string"?Jl(e):e,a=eo(i.pathname||"/",t);if(a==null)return null;let s=xS(r);zk(s);let u=null;for(let c=0;u==null&&c<s.length;++c){let h=Zk(a);u=Yk(s[c],h,n)}return u}function xS(r,e=[],t=[],n=""){let i=(a,s,u)=>{let c={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};c.relativePath.startsWith("/")&&(Ht(c.relativePath.startsWith(n),`Absolute route path "${c.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(n.length));let h=Qa([n,c.relativePath]),d=t.concat(c);a.children&&a.children.length>0&&(Ht(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),xS(a.children,e,d,h)),!(a.path==null&&!a.index)&&e.push({path:h,score:Xk(h,a.index),routesMeta:d})};return r.forEach((a,s)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))i(a,s);else for(let c of ES(a.path))i(a,s,c)}),e}function ES(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let s=ES(n.join("/")),u=[];return u.push(...s.map(c=>c===""?a:[a,c].join("/"))),i&&u.push(...s),u.map(c=>r.startsWith("/")&&c===""?"/":c)}function zk(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:$k(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var jk=/^:[\w-]+$/,Hk=3,Wk=2,qk=1,Gk=10,Kk=-2,PE=r=>r==="*";function Xk(r,e){let t=r.split("/"),n=t.length;return t.some(PE)&&(n+=Kk),e&&(n+=Wk),t.filter(i=>!PE(i)).reduce((i,a)=>i+(jk.test(a)?Hk:a===""?qk:Gk),n)}function $k(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function Yk(r,e,t=!1){let{routesMeta:n}=r,i={},a="/",s=[];for(let u=0;u<n.length;++u){let c=n[u],h=u===n.length-1,d=a==="/"?e:e.slice(a.length)||"/",m=Dp({path:c.relativePath,caseSensitive:c.caseSensitive,end:h},d),v=c.route;if(!m&&h&&t&&!n[n.length-1].route.index&&(m=Dp({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!m)return null;Object.assign(i,m.params),s.push({params:i,pathname:Qa([a,m.pathname]),pathnameBase:nO(Qa([a,m.pathnameBase])),route:v}),m.pathnameBase!=="/"&&(a=Qa([a,m.pathnameBase]))}return s}function Dp(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=Qk(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:n.reduce((h,{paramName:d,isOptional:m},v)=>{if(d==="*"){let _=u[v]||"";s=a.slice(0,a.length-_.length).replace(/(.)\/+$/,"$1")}const y=u[v];return m&&!y?h[d]=void 0:h[d]=(y||"").replace(/%2F/g,"/"),h},{}),pathname:a,pathnameBase:s,pattern:r}}function Qk(r,e=!1,t=!0){Ci(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,u,c)=>(n.push({paramName:u,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function Zk(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ci(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function eo(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function Jk(r,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?Jl(r):r;return{pathname:t?t.startsWith("/")?t:eO(t,e):e,search:rO(n),hash:iO(i)}}function eO(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function py(r,e,t,n){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function tO(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function nb(r){let e=tO(r);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function rb(r,e,t,n=!1){let i;typeof r=="string"?i=Jl(r):(i={...r},Ht(!i.pathname||!i.pathname.includes("?"),py("?","pathname","search",i)),Ht(!i.pathname||!i.pathname.includes("#"),py("#","pathname","hash",i)),Ht(!i.search||!i.search.includes("#"),py("#","search","hash",i)));let a=r===""||i.pathname==="",s=a?"/":i.pathname,u;if(s==null)u=t;else{let m=e.length-1;if(!n&&s.startsWith("..")){let v=s.split("/");for(;v[0]==="..";)v.shift(),m-=1;i.pathname=v.join("/")}u=m>=0?e[m]:"/"}let c=Jk(i,u),h=s&&s!=="/"&&s.endsWith("/"),d=(a||s===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(h||d)&&(c.pathname+="/"),c}var Qa=r=>r.join("/").replace(/\/\/+/g,"/"),nO=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),rO=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,iO=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function aO(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var TS=["POST","PUT","PATCH","DELETE"];new Set(TS);var oO=["GET",...TS];new Set(oO);var ec=Y.createContext(null);ec.displayName="DataRouter";var xm=Y.createContext(null);xm.displayName="DataRouterState";var SS=Y.createContext({isTransitioning:!1});SS.displayName="ViewTransition";var sO=Y.createContext(new Map);sO.displayName="Fetchers";var uO=Y.createContext(null);uO.displayName="Await";var Ri=Y.createContext(null);Ri.displayName="Navigation";var af=Y.createContext(null);af.displayName="Location";var Ii=Y.createContext({outlet:null,matches:[],isDataRoute:!1});Ii.displayName="Route";var ib=Y.createContext(null);ib.displayName="RouteError";function lO(r,{relative:e}={}){Ht(tc(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=Y.useContext(Ri),{hash:i,pathname:a,search:s}=of(r,{relative:e}),u=a;return t!=="/"&&(u=a==="/"?t:Qa([t,a])),n.createHref({pathname:u,search:s,hash:i})}function tc(){return Y.useContext(af)!=null}function ao(){return Ht(tc(),"useLocation() may be used only in the context of a <Router> component."),Y.useContext(af).location}var CS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function AS(r){Y.useContext(Ri).static||Y.useLayoutEffect(r)}function ma(){let{isDataRoute:r}=Y.useContext(Ii);return r?EO():cO()}function cO(){Ht(tc(),"useNavigate() may be used only in the context of a <Router> component.");let r=Y.useContext(ec),{basename:e,navigator:t}=Y.useContext(Ri),{matches:n}=Y.useContext(Ii),{pathname:i}=ao(),a=JSON.stringify(nb(n)),s=Y.useRef(!1);return AS(()=>{s.current=!0}),Y.useCallback((c,h={})=>{if(Ci(s.current,CS),!s.current)return;if(typeof c=="number"){t.go(c);return}let d=rb(c,JSON.parse(a),i,h.relative==="path");r==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Qa([e,d.pathname])),(h.replace?t.replace:t.push)(d,h.state,h)},[e,t,a,i,r])}Y.createContext(null);function hO(){let{matches:r}=Y.useContext(Ii),e=r[r.length-1];return e?e.params:{}}function of(r,{relative:e}={}){let{matches:t}=Y.useContext(Ii),{pathname:n}=ao(),i=JSON.stringify(nb(t));return Y.useMemo(()=>rb(r,JSON.parse(i),n,e==="path"),[r,i,n,e])}function fO(r,e){return RS(r,e)}function RS(r,e,t,n){var C;Ht(tc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:a}=Y.useContext(Ri),{matches:s}=Y.useContext(Ii),u=s[s.length-1],c=u?u.params:{},h=u?u.pathname:"/",d=u?u.pathnameBase:"/",m=u&&u.route;{let A=m&&m.path||"";IS(h,!m||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let v=ao(),y;if(e){let A=typeof e=="string"?Jl(e):e;Ht(d==="/"||((C=A.pathname)==null?void 0:C.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${A.pathname}" was given in the \`location\` prop.`),y=A}else y=v;let _=y.pathname||"/",E=_;if(d!=="/"){let A=d.replace(/^\//,"").split("/");E="/"+_.replace(/^\//,"").split("/").slice(A.length).join("/")}let x=!a&&t&&t.matches&&t.matches.length>0?t.matches:wS(r,{pathname:E});Ci(m||x!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),Ci(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let T=gO(x&&x.map(A=>Object.assign({},A,{params:Object.assign({},c,A.params),pathname:Qa([d,i.encodeLocation?i.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?d:Qa([d,i.encodeLocation?i.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),s,t,n);return e&&T?Y.createElement(af.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},T):T}function dO(){let r=xO(),e=aO(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},a={padding:"2px 4px",backgroundColor:n},s=null;return console.error("Error handled by React Router default ErrorBoundary:",r),s=Y.createElement(Y.Fragment,null,Y.createElement("p",null,"💿 Hey developer 👋"),Y.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Y.createElement("code",{style:a},"ErrorBoundary")," or"," ",Y.createElement("code",{style:a},"errorElement")," prop on your route.")),Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},e),t?Y.createElement("pre",{style:i},t):null,s)}var pO=Y.createElement(dO,null),mO=class extends Y.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?Y.createElement(Ii.Provider,{value:this.props.routeContext},Y.createElement(ib.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vO({routeContext:r,match:e,children:t}){let n=Y.useContext(ec);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),Y.createElement(Ii.Provider,{value:r},t)}function gO(r,e=[],t=null,n=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let i=r,a=t==null?void 0:t.errors;if(a!=null){let c=i.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);Ht(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let s=!1,u=-1;if(t)for(let c=0;c<i.length;c++){let h=i[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:d,errors:m}=t,v=h.route.loader&&!d.hasOwnProperty(h.route.id)&&(!m||m[h.route.id]===void 0);if(h.route.lazy||v){s=!0,u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}return i.reduceRight((c,h,d)=>{let m,v=!1,y=null,_=null;t&&(m=a&&h.route.id?a[h.route.id]:void 0,y=h.route.errorElement||pO,s&&(u<0&&d===0?(IS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,_=null):u===d&&(v=!0,_=h.route.hydrateFallbackElement||null)));let E=e.concat(i.slice(0,d+1)),x=()=>{let T;return m?T=y:v?T=_:h.route.Component?T=Y.createElement(h.route.Component,null):h.route.element?T=h.route.element:T=c,Y.createElement(vO,{match:h,routeContext:{outlet:c,matches:E,isDataRoute:t!=null},children:T})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?Y.createElement(mO,{location:t.location,revalidation:t.revalidation,component:y,error:m,children:x(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):x()},null)}function ab(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yO(r){let e=Y.useContext(ec);return Ht(e,ab(r)),e}function bO(r){let e=Y.useContext(xm);return Ht(e,ab(r)),e}function _O(r){let e=Y.useContext(Ii);return Ht(e,ab(r)),e}function ob(r){let e=_O(r),t=e.matches[e.matches.length-1];return Ht(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function wO(){return ob("useRouteId")}function xO(){var n;let r=Y.useContext(ib),e=bO("useRouteError"),t=ob("useRouteError");return r!==void 0?r:(n=e.errors)==null?void 0:n[t]}function EO(){let{router:r}=yO("useNavigate"),e=ob("useNavigate"),t=Y.useRef(!1);return AS(()=>{t.current=!0}),Y.useCallback(async(i,a={})=>{Ci(t.current,CS),t.current&&(typeof i=="number"?r.navigate(i):await r.navigate(i,{fromRouteId:e,...a}))},[r,e])}var LE={};function IS(r,e,t){!e&&!LE[r]&&(LE[r]=!0,Ci(!1,t))}Y.memo(TO);function TO({routes:r,future:e,state:t}){return RS(r,void 0,t,e)}function SO({to:r,replace:e,state:t,relative:n}){Ht(tc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=Y.useContext(Ri);Ci(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:a}=Y.useContext(Ii),{pathname:s}=ao(),u=ma(),c=rb(r,nb(a),s,n==="path"),h=JSON.stringify(c);return Y.useEffect(()=>{u(JSON.parse(h),{replace:e,state:t,relative:n})},[u,h,n,e,t]),null}function Qs(r){Ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function CO({basename:r="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:a=!1}){Ht(!tc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=r.replace(/^\/*/,"/"),u=Y.useMemo(()=>({basename:s,navigator:i,static:a,future:{}}),[s,i,a]);typeof t=="string"&&(t=Jl(t));let{pathname:c="/",search:h="",hash:d="",state:m=null,key:v="default"}=t,y=Y.useMemo(()=>{let _=eo(c,s);return _==null?null:{location:{pathname:_,search:h,hash:d,state:m,key:v},navigationType:n}},[s,c,h,d,m,v,n]);return Ci(y!=null,`<Router basename="${s}"> is not able to match the URL "${c}${h}${d}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:Y.createElement(Ri.Provider,{value:u},Y.createElement(af.Provider,{children:e,value:y}))}function AO({children:r,location:e}){return fO(i0(r),e)}function i0(r,e=[]){let t=[];return Y.Children.forEach(r,(n,i)=>{if(!Y.isValidElement(n))return;let a=[...e,i];if(n.type===Y.Fragment){t.push.apply(t,i0(n.props.children,a));return}Ht(n.type===Qs,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ht(!n.props.index||!n.props.children,"An index route cannot have child routes.");let s={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=i0(n.props.children,a)),t.push(s)}),t}var gp="get",yp="application/x-www-form-urlencoded";function Em(r){return r!=null&&typeof r.tagName=="string"}function RO(r){return Em(r)&&r.tagName.toLowerCase()==="button"}function IO(r){return Em(r)&&r.tagName.toLowerCase()==="form"}function DO(r){return Em(r)&&r.tagName.toLowerCase()==="input"}function NO(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function kO(r,e){return r.button===0&&(!e||e==="_self")&&!NO(r)}var Xd=null;function OO(){if(Xd===null)try{new FormData(document.createElement("form"),0),Xd=!1}catch{Xd=!0}return Xd}var MO=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function my(r){return r!=null&&!MO.has(r)?(Ci(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${yp}"`),null):r}function PO(r,e){let t,n,i,a,s;if(IO(r)){let u=r.getAttribute("action");n=u?eo(u,e):null,t=r.getAttribute("method")||gp,i=my(r.getAttribute("enctype"))||yp,a=new FormData(r)}else if(RO(r)||DO(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=r.getAttribute("formaction")||u.getAttribute("action");if(n=c?eo(c,e):null,t=r.getAttribute("formmethod")||u.getAttribute("method")||gp,i=my(r.getAttribute("formenctype"))||my(u.getAttribute("enctype"))||yp,a=new FormData(u,r),!OO()){let{name:h,type:d,value:m}=r;if(d==="image"){let v=h?`${h}.`:"";a.append(`${v}x`,"0"),a.append(`${v}y`,"0")}else h&&a.append(h,m)}}else{if(Em(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=gp,n=null,i=yp,s=r}return a&&i==="text/plain"&&(s=a,a=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:a,body:s}}function sb(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}async function LO(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function FO(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function BO(r,e,t){let n=await Promise.all(r.map(async i=>{let a=e.routes[i.route.id];if(a){let s=await LO(a,t);return s.links?s.links():[]}return[]}));return jO(n.flat(1).filter(FO).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function FE(r,e,t,n,i,a){let s=(c,h)=>t[h]?c.route.id!==t[h].route.id:!0,u=(c,h)=>{var d;return t[h].pathname!==c.pathname||((d=t[h].route.path)==null?void 0:d.endsWith("*"))&&t[h].params["*"]!==c.params["*"]};return a==="assets"?e.filter((c,h)=>s(c,h)||u(c,h)):a==="data"?e.filter((c,h)=>{var m;let d=n.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(s(c,h)||u(c,h))return!0;if(c.route.shouldRevalidate){let v=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(r,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function VO(r,e,{includeHydrateFallback:t}={}){return UO(r.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let a=[i.module];return i.clientActionModule&&(a=a.concat(i.clientActionModule)),i.clientLoaderModule&&(a=a.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(a=a.concat(i.hydrateFallbackModule)),i.imports&&(a=a.concat(i.imports)),a}).flat(1))}function UO(r){return[...new Set(r)]}function zO(r){let e={},t=Object.keys(r).sort();for(let n of t)e[n]=r[n];return e}function jO(r,e){let t=new Set;return new Set(e),r.reduce((n,i)=>{let a=JSON.stringify(zO(i));return t.has(a)||(t.add(a),n.push({key:a,link:i})),n},[])}var HO=new Set([100,101,204,205]);function WO(r,e){let t=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return t.pathname==="/"?t.pathname="_root.data":e&&eo(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function DS(){let r=Y.useContext(ec);return sb(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function qO(){let r=Y.useContext(xm);return sb(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var ub=Y.createContext(void 0);ub.displayName="FrameworkContext";function NS(){let r=Y.useContext(ub);return sb(r,"You must render this element inside a <HydratedRouter> element"),r}function GO(r,e){let t=Y.useContext(ub),[n,i]=Y.useState(!1),[a,s]=Y.useState(!1),{onFocus:u,onBlur:c,onMouseEnter:h,onMouseLeave:d,onTouchStart:m}=e,v=Y.useRef(null);Y.useEffect(()=>{if(r==="render"&&s(!0),r==="viewport"){let E=T=>{T.forEach(C=>{s(C.isIntersecting)})},x=new IntersectionObserver(E,{threshold:.5});return v.current&&x.observe(v.current),()=>{x.disconnect()}}},[r]),Y.useEffect(()=>{if(n){let E=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(E)}}},[n]);let y=()=>{i(!0)},_=()=>{i(!1),s(!1)};return t?r!=="intent"?[a,v,{}]:[a,v,{onFocus:_h(u,y),onBlur:_h(c,_),onMouseEnter:_h(h,y),onMouseLeave:_h(d,_),onTouchStart:_h(m,y)}]:[!1,v,{}]}function _h(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function KO({page:r,...e}){let{router:t}=DS(),n=Y.useMemo(()=>wS(t.routes,r,t.basename),[t.routes,r,t.basename]);return n?Y.createElement($O,{page:r,matches:n,...e}):null}function XO(r){let{manifest:e,routeModules:t}=NS(),[n,i]=Y.useState([]);return Y.useEffect(()=>{let a=!1;return BO(r,e,t).then(s=>{a||i(s)}),()=>{a=!0}},[r,e,t]),n}function $O({page:r,matches:e,...t}){let n=ao(),{manifest:i,routeModules:a}=NS(),{basename:s}=DS(),{loaderData:u,matches:c}=qO(),h=Y.useMemo(()=>FE(r,e,c,i,n,"data"),[r,e,c,i,n]),d=Y.useMemo(()=>FE(r,e,c,i,n,"assets"),[r,e,c,i,n]),m=Y.useMemo(()=>{if(r===n.pathname+n.search+n.hash)return[];let _=new Set,E=!1;if(e.forEach(T=>{var A;let C=i.routes[T.route.id];!C||!C.hasLoader||(!h.some(R=>R.route.id===T.route.id)&&T.route.id in u&&((A=a[T.route.id])!=null&&A.shouldRevalidate)||C.hasClientLoader?E=!0:_.add(T.route.id))}),_.size===0)return[];let x=WO(r,s);return E&&_.size>0&&x.searchParams.set("_routes",e.filter(T=>_.has(T.route.id)).map(T=>T.route.id).join(",")),[x.pathname+x.search]},[s,u,n,i,h,e,r,a]),v=Y.useMemo(()=>VO(d,i),[d,i]),y=XO(d);return Y.createElement(Y.Fragment,null,m.map(_=>Y.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...t})),v.map(_=>Y.createElement("link",{key:_,rel:"modulepreload",href:_,...t})),y.map(({key:_,link:E})=>Y.createElement("link",{key:_,...E})))}function YO(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var kS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{kS&&(window.__reactRouterVersion="7.5.1")}catch{}function QO({basename:r,children:e,window:t}){let n=Y.useRef();n.current==null&&(n.current=Fk({window:t,v5Compat:!0}));let i=n.current,[a,s]=Y.useState({action:i.action,location:i.location}),u=Y.useCallback(c=>{Y.startTransition(()=>s(c))},[s]);return Y.useLayoutEffect(()=>i.listen(u),[i,u]),Y.createElement(CO,{basename:r,children:e,location:a.location,navigationType:a.action,navigator:i})}var OS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tm=Y.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:a,replace:s,state:u,target:c,to:h,preventScrollReset:d,viewTransition:m,...v},y){let{basename:_}=Y.useContext(Ri),E=typeof h=="string"&&OS.test(h),x,T=!1;if(typeof h=="string"&&E&&(x=h,kS))try{let D=new URL(window.location.href),O=h.startsWith("//")?new URL(D.protocol+h):new URL(h),L=eo(O.pathname,_);O.origin===D.origin&&L!=null?h=L+O.search+O.hash:T=!0}catch{Ci(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=lO(h,{relative:i}),[A,R,k]=GO(n,v),B=tM(h,{replace:s,state:u,target:c,preventScrollReset:d,relative:i,viewTransition:m});function P(D){e&&e(D),D.defaultPrevented||B(D)}let I=Y.createElement("a",{...v,...k,href:x||C,onClick:T||a?e:P,ref:YO(y,R),target:c,"data-discover":!E&&t==="render"?"true":void 0});return A&&!E?Y.createElement(Y.Fragment,null,I,Y.createElement(KO,{page:C})):I});Tm.displayName="Link";var ZO=Y.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:a,to:s,viewTransition:u,children:c,...h},d){let m=of(s,{relative:h.relative}),v=ao(),y=Y.useContext(xm),{navigator:_,basename:E}=Y.useContext(Ri),x=y!=null&&oM(m)&&u===!0,T=_.encodeLocation?_.encodeLocation(m).pathname:m.pathname,C=v.pathname,A=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;t||(C=C.toLowerCase(),A=A?A.toLowerCase():null,T=T.toLowerCase()),A&&E&&(A=eo(A,E)||A);const R=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let k=C===T||!i&&C.startsWith(T)&&C.charAt(R)==="/",B=A!=null&&(A===T||!i&&A.startsWith(T)&&A.charAt(T.length)==="/"),P={isActive:k,isPending:B,isTransitioning:x},I=k?e:void 0,D;typeof n=="function"?D=n(P):D=[n,k?"active":null,B?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let O=typeof a=="function"?a(P):a;return Y.createElement(Tm,{...h,"aria-current":I,className:D,ref:d,style:O,to:s,viewTransition:u},typeof c=="function"?c(P):c)});ZO.displayName="NavLink";var JO=Y.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:a,method:s=gp,action:u,onSubmit:c,relative:h,preventScrollReset:d,viewTransition:m,...v},y)=>{let _=iM(),E=aM(u,{relative:h}),x=s.toLowerCase()==="get"?"get":"post",T=typeof u=="string"&&OS.test(u),C=A=>{if(c&&c(A),A.defaultPrevented)return;A.preventDefault();let R=A.nativeEvent.submitter,k=(R==null?void 0:R.getAttribute("formmethod"))||s;_(R||A.currentTarget,{fetcherKey:e,method:k,navigate:t,replace:i,state:a,relative:h,preventScrollReset:d,viewTransition:m})};return Y.createElement("form",{ref:y,method:x,action:E,onSubmit:n?c:C,...v,"data-discover":!T&&r==="render"?"true":void 0})});JO.displayName="Form";function eM(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function MS(r){let e=Y.useContext(ec);return Ht(e,eM(r)),e}function tM(r,{target:e,replace:t,state:n,preventScrollReset:i,relative:a,viewTransition:s}={}){let u=ma(),c=ao(),h=of(r,{relative:a});return Y.useCallback(d=>{if(kO(d,e)){d.preventDefault();let m=t!==void 0?t:Uh(c)===Uh(h);u(r,{replace:m,state:n,preventScrollReset:i,relative:a,viewTransition:s})}},[c,u,h,t,n,e,r,i,a,s])}var nM=0,rM=()=>`__${String(++nM)}__`;function iM(){let{router:r}=MS("useSubmit"),{basename:e}=Y.useContext(Ri),t=wO();return Y.useCallback(async(n,i={})=>{let{action:a,method:s,encType:u,formData:c,body:h}=PO(n,e);if(i.navigate===!1){let d=i.fetcherKey||rM();await r.fetch(d,t,i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:h,formMethod:i.method||s,formEncType:i.encType||u,flushSync:i.flushSync})}else await r.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:h,formMethod:i.method||s,formEncType:i.encType||u,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[r,e,t])}function aM(r,{relative:e}={}){let{basename:t}=Y.useContext(Ri),n=Y.useContext(Ii);Ht(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),a={...of(r||".",{relative:e})},s=ao();if(r==null){a.search=s.search;let u=new URLSearchParams(a.search),c=u.getAll("index");if(c.some(d=>d==="")){u.delete("index"),c.filter(m=>m).forEach(m=>u.append("index",m));let d=u.toString();a.search=d?`?${d}`:""}}return(!r||r===".")&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Qa([t,a.pathname])),Uh(a)}function oM(r,e={}){let t=Y.useContext(SS);Ht(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=MS("useViewTransitionState"),i=of(r,{relative:e.relative});if(!t.isTransitioning)return!1;let a=eo(t.currentLocation.pathname,n)||t.currentLocation.pathname,s=eo(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Dp(i.pathname,s)!=null||Dp(i.pathname,a)!=null}new TextEncoder;[...HO];const sM=()=>{};var BE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PS=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},uM=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=r[t++];e[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=r[t++],s=r[t++],u=r[t++],c=((i&7)<<18|(a&63)<<12|(s&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const a=r[t++],s=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|s&63)}}return e.join("")},LS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const a=r[i],s=i+1<r.length,u=s?r[i+1]:0,c=i+2<r.length,h=c?r[i+2]:0,d=a>>2,m=(a&3)<<4|u>>4;let v=(u&15)<<2|h>>6,y=h&63;c||(y=64,s||(v=64)),n.push(t[d],t[m],t[v],t[y])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(PS(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):uM(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const a=t[r.charAt(i++)],u=i<r.length?t[r.charAt(i)]:0;++i;const h=i<r.length?t[r.charAt(i)]:64;++i;const m=i<r.length?t[r.charAt(i)]:64;if(++i,a==null||u==null||h==null||m==null)throw new lM;const v=a<<2|u>>4;if(n.push(v),h!==64){const y=u<<4&240|h>>2;if(n.push(y),m!==64){const _=h<<6&192|m;n.push(_)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class lM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cM=function(r){const e=PS(r);return LS.encodeByteArray(e,!0)},Np=function(r){return cM(r).replace(/\./g,"")},FS=function(r){try{return LS.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hM(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fM=()=>hM().__FIREBASE_DEFAULTS__,dM=()=>{if(typeof process>"u"||typeof BE>"u")return;const r=BE.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},pM=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&FS(r[1]);return e&&JSON.parse(e)},Sm=()=>{try{return sM()||fM()||dM()||pM()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},BS=r=>{var e,t;return(t=(e=Sm())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},mM=r=>{const e=BS(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},VS=()=>{var r;return(r=Sm())===null||r===void 0?void 0:r.config},US=r=>{var e;return(e=Sm())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gM(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,a=r.sub||r.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},r);return[Np(JSON.stringify(t)),Np(JSON.stringify(s)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function or(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function yM(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(or())}function bM(){var r;const e=(r=Sm())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _M(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zS(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function wM(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xM(){const r=or();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function EM(){return!bM()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jS(){try{return typeof indexedDB=="object"}catch{return!1}}function HS(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(t){e(t)}})}function TM(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SM="FirebaseError";class Di extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=SM,Object.setPrototypeOf(this,Di.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,gu.prototype.create)}}class gu{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],s=a?CM(a,n):"Error",u=`${this.serviceName}: ${s} (${i}).`;return new Di(i,u,n)}}function CM(r,e){return r.replace(AM,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const AM=/\{\$([^}]+)}/g;function RM(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function rs(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const a=r[i],s=e[i];if(VE(a)&&VE(s)){if(!rs(a,s))return!1}else if(a!==s)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function VE(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Sh(r){const e={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,a]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function Ch(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function IM(r,e){const t=new DM(r,e);return t.subscribe.bind(t)}class DM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");NM(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=vy),i.error===void 0&&(i.error=vy),i.complete===void 0&&(i.complete=vy);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function NM(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function vy(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kM=1e3,OM=2,MM=4*60*60*1e3,PM=.5;function UE(r,e=kM,t=OM){const n=e*Math.pow(t,r),i=Math.round(PM*n*(Math.random()-.5)*2);return Math.min(MM,n+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(r){return r&&r._delegate?r._delegate:r}class Ai{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LM{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new vM;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(BM(e))try{this.getOrInitializeService({instanceIdentifier:Zs})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(e=Zs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zs){return this.instances.has(e)}getOptions(e=Zs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[a,s]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(a);n===u&&s.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(e),this.onInitCallbacks.set(i,a);const s=this.instances.get(i);return s&&e(s,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:FM(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Zs){return this.component?this.component.multipleInstances?e:Zs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FM(r){return r===Zs?void 0:r}function BM(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VM{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new LM(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ht;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(ht||(ht={}));const UM={debug:ht.DEBUG,verbose:ht.VERBOSE,info:ht.INFO,warn:ht.WARN,error:ht.ERROR,silent:ht.SILENT},zM=ht.INFO,jM={[ht.DEBUG]:"log",[ht.VERBOSE]:"log",[ht.INFO]:"info",[ht.WARN]:"warn",[ht.ERROR]:"error"},HM=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=jM[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Cm{constructor(e){this.name=e,this._logLevel=zM,this._logHandler=HM,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ht))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?UM[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ht.DEBUG,...e),this._logHandler(this,ht.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ht.VERBOSE,...e),this._logHandler(this,ht.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ht.INFO,...e),this._logHandler(this,ht.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ht.WARN,...e),this._logHandler(this,ht.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ht.ERROR,...e),this._logHandler(this,ht.ERROR,...e)}}const WM=(r,e)=>e.some(t=>r instanceof t);let zE,jE;function qM(){return zE||(zE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function GM(){return jE||(jE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WS=new WeakMap,a0=new WeakMap,qS=new WeakMap,gy=new WeakMap,lb=new WeakMap;function KM(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",a),r.removeEventListener("error",s)},a=()=>{t(Yo(r.result)),i()},s=()=>{n(r.error),i()};r.addEventListener("success",a),r.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&WS.set(t,r)}).catch(()=>{}),lb.set(e,r),e}function XM(r){if(a0.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",a),r.removeEventListener("error",s),r.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",a),r.addEventListener("error",s),r.addEventListener("abort",s)});a0.set(r,e)}let o0={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return a0.get(r);if(e==="objectStoreNames")return r.objectStoreNames||qS.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Yo(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function $M(r){o0=r(o0)}function YM(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(yy(this),e,...t);return qS.set(n,e.sort?e.sort():[e]),Yo(n)}:GM().includes(r)?function(...e){return r.apply(yy(this),e),Yo(WS.get(this))}:function(...e){return Yo(r.apply(yy(this),e))}}function QM(r){return typeof r=="function"?YM(r):(r instanceof IDBTransaction&&XM(r),WM(r,qM())?new Proxy(r,o0):r)}function Yo(r){if(r instanceof IDBRequest)return KM(r);if(gy.has(r))return gy.get(r);const e=QM(r);return e!==r&&(gy.set(r,e),lb.set(e,r)),e}const yy=r=>lb.get(r);function GS(r,e,{blocked:t,upgrade:n,blocking:i,terminated:a}={}){const s=indexedDB.open(r,e),u=Yo(s);return n&&s.addEventListener("upgradeneeded",c=>{n(Yo(s.result),c.oldVersion,c.newVersion,Yo(s.transaction),c)}),t&&s.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),u.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const ZM=["get","getKey","getAll","getAllKeys","count"],JM=["put","add","delete","clear"],by=new Map;function HE(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(by.get(e))return by.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=JM.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ZM.includes(t)))return;const a=async function(s,...u){const c=this.transaction(s,i?"readwrite":"readonly");let h=c.store;return n&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),i&&c.done]))[0]};return by.set(e,a),a}$M(r=>({...r,get:(e,t,n)=>HE(e,t)||r.get(e,t,n),has:(e,t)=>!!HE(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(tP(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function tP(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const s0="@firebase/app",WE="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const to=new Cm("@firebase/app"),nP="@firebase/app-compat",rP="@firebase/analytics-compat",iP="@firebase/analytics",aP="@firebase/app-check-compat",oP="@firebase/app-check",sP="@firebase/auth",uP="@firebase/auth-compat",lP="@firebase/database",cP="@firebase/data-connect",hP="@firebase/database-compat",fP="@firebase/functions",dP="@firebase/functions-compat",pP="@firebase/installations",mP="@firebase/installations-compat",vP="@firebase/messaging",gP="@firebase/messaging-compat",yP="@firebase/performance",bP="@firebase/performance-compat",_P="@firebase/remote-config",wP="@firebase/remote-config-compat",xP="@firebase/storage",EP="@firebase/storage-compat",TP="@firebase/firestore",SP="@firebase/vertexai",CP="@firebase/firestore-compat",AP="firebase",RP="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u0="[DEFAULT]",IP={[s0]:"fire-core",[nP]:"fire-core-compat",[iP]:"fire-analytics",[rP]:"fire-analytics-compat",[oP]:"fire-app-check",[aP]:"fire-app-check-compat",[sP]:"fire-auth",[uP]:"fire-auth-compat",[lP]:"fire-rtdb",[cP]:"fire-data-connect",[hP]:"fire-rtdb-compat",[fP]:"fire-fn",[dP]:"fire-fn-compat",[pP]:"fire-iid",[mP]:"fire-iid-compat",[vP]:"fire-fcm",[gP]:"fire-fcm-compat",[yP]:"fire-perf",[bP]:"fire-perf-compat",[_P]:"fire-rc",[wP]:"fire-rc-compat",[xP]:"fire-gcs",[EP]:"fire-gcs-compat",[TP]:"fire-fst",[CP]:"fire-fst-compat",[SP]:"fire-vertex","fire-js":"fire-js",[AP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp=new Map,DP=new Map,l0=new Map;function qE(r,e){try{r.container.addComponent(e)}catch(t){to.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function ca(r){const e=r.name;if(l0.has(e))return to.debug(`There were multiple attempts to register component ${e}.`),!1;l0.set(e,r);for(const t of kp.values())qE(t,r);for(const t of DP.values())qE(t,r);return!0}function yu(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Vr(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qo=new gu("app","Firebase",NP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ai("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=RP;function KS(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:u0,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw Qo.create("bad-app-name",{appName:String(i)});if(t||(t=VS()),!t)throw Qo.create("no-options");const a=kp.get(i);if(a){if(rs(t,a.options)&&rs(n,a.config))return a;throw Qo.create("duplicate-app",{appName:i})}const s=new VM(i);for(const c of l0.values())s.addComponent(c);const u=new kP(t,n,s);return kp.set(i,u),u}function cb(r=u0){const e=kp.get(r);if(!e&&r===u0&&VS())return KS();if(!e)throw Qo.create("no-app",{appName:r});return e}function li(r,e,t){var n;let i=(n=IP[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);const a=i.match(/\s|\//),s=e.match(/\s|\//);if(a||s){const u=[`Unable to register library "${i}" with version "${e}":`];a&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&s&&u.push("and"),s&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),to.warn(u.join(" "));return}ca(new Ai(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OP="firebase-heartbeat-database",MP=1,zh="firebase-heartbeat-store";let _y=null;function XS(){return _y||(_y=GS(OP,MP,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(zh)}catch(t){console.warn(t)}}}}).catch(r=>{throw Qo.create("idb-open",{originalErrorMessage:r.message})})),_y}async function PP(r){try{const t=(await XS()).transaction(zh),n=await t.objectStore(zh).get($S(r));return await t.done,n}catch(e){if(e instanceof Di)to.warn(e.message);else{const t=Qo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});to.warn(t.message)}}}async function GE(r,e){try{const n=(await XS()).transaction(zh,"readwrite");await n.objectStore(zh).put(e,$S(r)),await n.done}catch(t){if(t instanceof Di)to.warn(t.message);else{const n=Qo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});to.warn(n.message)}}}function $S(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP=1024,FP=30;class BP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new UP(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=KE();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(s=>s.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>FP){const s=zP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){to.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=KE(),{heartbeatsToSend:n,unsentEntries:i}=VP(this._heartbeatsCache.heartbeats),a=Np(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return to.warn(t),""}}}function KE(){return new Date().toISOString().substring(0,10)}function VP(r,e=LP){const t=[];let n=r.slice();for(const i of r){const a=t.find(s=>s.agent===i.agent);if(a){if(a.dates.push(i.date),XE(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),XE(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class UP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return jS()?HS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await PP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return GE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return GE(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function XE(r){return Np(JSON.stringify({version:2,heartbeats:r})).length}function zP(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(r){ca(new Ai("platform-logger",e=>new eP(e),"PRIVATE")),ca(new Ai("heartbeat",e=>new BP(e),"PRIVATE")),li(s0,WE,r),li(s0,WE,"esm2017"),li("fire-js","")}jP("");var HP="firebase",WP="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */li(HP,WP,"app");const YS="@firebase/installations",hb="0.6.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS=1e4,ZS=`w:${hb}`,JS="FIS_v2",qP="https://firebaseinstallations.googleapis.com/v1",GP=60*60*1e3,KP="installations",XP="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},uu=new gu(KP,XP,$P);function eC(r){return r instanceof Di&&r.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC({projectId:r}){return`${qP}/projects/${r}/installations`}function nC(r){return{token:r.token,requestStatus:2,expiresIn:QP(r.expiresIn),creationTime:Date.now()}}async function rC(r,e){const n=(await e.json()).error;return uu.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function iC({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function YP(r,{refreshToken:e}){const t=iC(r);return t.append("Authorization",ZP(e)),t}async function aC(r){const e=await r();return e.status>=500&&e.status<600?r():e}function QP(r){return Number(r.replace("s","000"))}function ZP(r){return`${JS} ${r}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JP({appConfig:r,heartbeatServiceProvider:e},{fid:t}){const n=tC(r),i=iC(r),a=e.getImmediate({optional:!0});if(a){const h=await a.getHeartbeatsHeader();h&&i.append("x-firebase-client",h)}const s={fid:t,authVersion:JS,appId:r.appId,sdkVersion:ZS},u={method:"POST",headers:i,body:JSON.stringify(s)},c=await aC(()=>fetch(n,u));if(c.ok){const h=await c.json();return{fid:h.fid||t,registrationStatus:2,refreshToken:h.refreshToken,authToken:nC(h.authToken)}}else throw await rC("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e4(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4=/^[cdef][\w-]{21}$/,c0="";function n4(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;const t=r4(r);return t4.test(t)?t:c0}catch{return c0}}function r4(r){return e4(r).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(r){return`${r.appName}!${r.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC=new Map;function uC(r,e){const t=Am(r);lC(t,e),i4(t,e)}function lC(r,e){const t=sC.get(r);if(t)for(const n of t)n(e)}function i4(r,e){const t=a4();t&&t.postMessage({key:r,fid:e}),o4()}let nu=null;function a4(){return!nu&&"BroadcastChannel"in self&&(nu=new BroadcastChannel("[Firebase] FID Change"),nu.onmessage=r=>{lC(r.data.key,r.data.fid)}),nu}function o4(){sC.size===0&&nu&&(nu.close(),nu=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s4="firebase-installations-database",u4=1,lu="firebase-installations-store";let wy=null;function fb(){return wy||(wy=GS(s4,u4,{upgrade:(r,e)=>{switch(e){case 0:r.createObjectStore(lu)}}})),wy}async function Op(r,e){const t=Am(r),i=(await fb()).transaction(lu,"readwrite"),a=i.objectStore(lu),s=await a.get(t);return await a.put(e,t),await i.done,(!s||s.fid!==e.fid)&&uC(r,e.fid),e}async function cC(r){const e=Am(r),n=(await fb()).transaction(lu,"readwrite");await n.objectStore(lu).delete(e),await n.done}async function Rm(r,e){const t=Am(r),i=(await fb()).transaction(lu,"readwrite"),a=i.objectStore(lu),s=await a.get(t),u=e(s);return u===void 0?await a.delete(t):await a.put(u,t),await i.done,u&&(!s||s.fid!==u.fid)&&uC(r,u.fid),u}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function db(r){let e;const t=await Rm(r.appConfig,n=>{const i=l4(n),a=c4(r,i);return e=a.registrationPromise,a.installationEntry});return t.fid===c0?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function l4(r){const e=r||{fid:n4(),registrationStatus:0};return hC(e)}function c4(r,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(uu.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=h4(r,t);return{installationEntry:t,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:f4(r)}:{installationEntry:e}}async function h4(r,e){try{const t=await JP(r,e);return Op(r.appConfig,t)}catch(t){throw eC(t)&&t.customData.serverCode===409?await cC(r.appConfig):await Op(r.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function f4(r){let e=await $E(r.appConfig);for(;e.registrationStatus===1;)await oC(100),e=await $E(r.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:n}=await db(r);return n||t}return e}function $E(r){return Rm(r,e=>{if(!e)throw uu.create("installation-not-found");return hC(e)})}function hC(r){return d4(r)?{fid:r.fid,registrationStatus:0}:r}function d4(r){return r.registrationStatus===1&&r.registrationTime+QS<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p4({appConfig:r,heartbeatServiceProvider:e},t){const n=m4(r,t),i=YP(r,t),a=e.getImmediate({optional:!0});if(a){const h=await a.getHeartbeatsHeader();h&&i.append("x-firebase-client",h)}const s={installation:{sdkVersion:ZS,appId:r.appId}},u={method:"POST",headers:i,body:JSON.stringify(s)},c=await aC(()=>fetch(n,u));if(c.ok){const h=await c.json();return nC(h)}else throw await rC("Generate Auth Token",c)}function m4(r,{fid:e}){return`${tC(r)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pb(r,e=!1){let t;const n=await Rm(r.appConfig,a=>{if(!fC(a))throw uu.create("not-registered");const s=a.authToken;if(!e&&y4(s))return a;if(s.requestStatus===1)return t=v4(r,e),a;{if(!navigator.onLine)throw uu.create("app-offline");const u=_4(a);return t=g4(r,u),u}});return t?await t:n.authToken}async function v4(r,e){let t=await YE(r.appConfig);for(;t.authToken.requestStatus===1;)await oC(100),t=await YE(r.appConfig);const n=t.authToken;return n.requestStatus===0?pb(r,e):n}function YE(r){return Rm(r,e=>{if(!fC(e))throw uu.create("not-registered");const t=e.authToken;return w4(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function g4(r,e){try{const t=await p4(r,e),n=Object.assign(Object.assign({},e),{authToken:t});return await Op(r.appConfig,n),t}catch(t){if(eC(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await cC(r.appConfig);else{const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Op(r.appConfig,n)}throw t}}function fC(r){return r!==void 0&&r.registrationStatus===2}function y4(r){return r.requestStatus===2&&!b4(r)}function b4(r){const e=Date.now();return e<r.creationTime||r.creationTime+r.expiresIn<e+GP}function _4(r){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:e})}function w4(r){return r.requestStatus===1&&r.requestTime+QS<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x4(r){const e=r,{installationEntry:t,registrationPromise:n}=await db(e);return n?n.catch(console.error):pb(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E4(r,e=!1){const t=r;return await T4(t),(await pb(t,e)).token}async function T4(r){const{registrationPromise:e}=await db(r);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4(r){if(!r||!r.options)throw xy("App Configuration");if(!r.name)throw xy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!r.options[t])throw xy(t);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function xy(r){return uu.create("missing-app-config-values",{valueName:r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC="installations",C4="installations-internal",A4=r=>{const e=r.getProvider("app").getImmediate(),t=S4(e),n=yu(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},R4=r=>{const e=r.getProvider("app").getImmediate(),t=yu(e,dC).getImmediate();return{getId:()=>x4(t),getToken:i=>E4(t,i)}};function I4(){ca(new Ai(dC,A4,"PUBLIC")),ca(new Ai(C4,R4,"PRIVATE"))}I4();li(YS,hb);li(YS,hb,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp="analytics",D4="firebase_id",N4="origin",k4=60*1e3,O4="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",mb="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new Cm("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Wr=new gu("analytics","Analytics",M4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(r){if(!r.startsWith(mb)){const e=Wr.create("invalid-gtag-resource",{gtagURL:r});return Er.warn(e.message),""}return r}function pC(r){return Promise.all(r.map(e=>e.catch(t=>t)))}function L4(r,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(r,e)),t}function F4(r,e){const t=L4("firebase-js-sdk-policy",{createScriptURL:P4}),n=document.createElement("script"),i=`${mb}?l=${r}&id=${e}`;n.src=t?t==null?void 0:t.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function B4(r){let e=[];return Array.isArray(window[r])?e=window[r]:window[r]=e,e}async function V4(r,e,t,n,i,a){const s=n[i];try{if(s)await e[s];else{const c=(await pC(t)).find(h=>h.measurementId===i);c&&await e[c.appId]}}catch(u){Er.error(u)}r("config",i,a)}async function U4(r,e,t,n,i){try{let a=[];if(i&&i.send_to){let s=i.send_to;Array.isArray(s)||(s=[s]);const u=await pC(t);for(const c of s){const h=u.find(m=>m.measurementId===c),d=h&&e[h.appId];if(d)a.push(d);else{a=[];break}}}a.length===0&&(a=Object.values(e)),await Promise.all(a),r("event",n,i||{})}catch(a){Er.error(a)}}function z4(r,e,t,n){async function i(a,...s){try{if(a==="event"){const[u,c]=s;await U4(r,e,t,u,c)}else if(a==="config"){const[u,c]=s;await V4(r,e,t,n,u,c)}else if(a==="consent"){const[u,c]=s;r("consent",u,c)}else if(a==="get"){const[u,c,h]=s;r("get",u,c,h)}else if(a==="set"){const[u]=s;r("set",u)}else r(a,...s)}catch(u){Er.error(u)}}return i}function j4(r,e,t,n,i){let a=function(...s){window[n].push(arguments)};return window[i]&&typeof window[i]=="function"&&(a=window[i]),window[i]=z4(a,r,e,t),{gtagCore:a,wrappedGtag:window[i]}}function H4(r){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(mb)&&t.src.includes(r))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4=30,q4=1e3;class G4{constructor(e={},t=q4){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const mC=new G4;function K4(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function X4(r){var e;const{appId:t,apiKey:n}=r,i={method:"GET",headers:K4(n)},a=O4.replace("{app-id}",t),s=await fetch(a,i);if(s.status!==200&&s.status!==304){let u="";try{const c=await s.json();!((e=c.error)===null||e===void 0)&&e.message&&(u=c.error.message)}catch{}throw Wr.create("config-fetch-failed",{httpStatus:s.status,responseMessage:u})}return s.json()}async function $4(r,e=mC,t){const{appId:n,apiKey:i,measurementId:a}=r.options;if(!n)throw Wr.create("no-app-id");if(!i){if(a)return{measurementId:a,appId:n};throw Wr.create("no-api-key")}const s=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new Z4;return setTimeout(async()=>{u.abort()},k4),vC({appId:n,apiKey:i,measurementId:a},s,u,e)}async function vC(r,{throttleEndTimeMillis:e,backoffCount:t},n,i=mC){var a;const{appId:s,measurementId:u}=r;try{await Y4(n,e)}catch(c){if(u)return Er.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:s,measurementId:u};throw c}try{const c=await X4(r);return i.deleteThrottleMetadata(s),c}catch(c){const h=c;if(!Q4(h)){if(i.deleteThrottleMetadata(s),u)return Er.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${h==null?void 0:h.message}]`),{appId:s,measurementId:u};throw c}const d=Number((a=h==null?void 0:h.customData)===null||a===void 0?void 0:a.httpStatus)===503?UE(t,i.intervalMillis,W4):UE(t,i.intervalMillis),m={throttleEndTimeMillis:Date.now()+d,backoffCount:t+1};return i.setThrottleMetadata(s,m),Er.debug(`Calling attemptFetch again in ${d} millis`),vC(r,m,n,i)}}function Y4(r,e){return new Promise((t,n)=>{const i=Math.max(e-Date.now(),0),a=setTimeout(t,i);r.addEventListener(()=>{clearTimeout(a),n(Wr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Q4(r){if(!(r instanceof Di)||!r.customData)return!1;const e=Number(r.customData.httpStatus);return e===429||e===500||e===503||e===504}class Z4{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function J4(r,e,t,n,i){if(i&&i.global){r("event",t,n);return}else{const a=await e,s=Object.assign(Object.assign({},n),{send_to:a});r("event",t,s)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e3(){if(jS())try{await HS()}catch(r){return Er.warn(Wr.create("indexeddb-unavailable",{errorInfo:r==null?void 0:r.toString()}).message),!1}else return Er.warn(Wr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function t3(r,e,t,n,i,a,s){var u;const c=$4(r);c.then(y=>{t[y.measurementId]=y.appId,r.options.measurementId&&y.measurementId!==r.options.measurementId&&Er.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(y=>Er.error(y)),e.push(c);const h=e3().then(y=>{if(y)return n.getId()}),[d,m]=await Promise.all([c,h]);H4(a)||F4(a,d.measurementId),i("js",new Date);const v=(u=s==null?void 0:s.config)!==null&&u!==void 0?u:{};return v[N4]="firebase",v.update=!0,m!=null&&(v[D4]=m),i("config",d.measurementId,v),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e){this.app=e}_delete(){return delete Nh[this.app.options.appId],Promise.resolve()}}let Nh={},QE=[];const ZE={};let Ey="dataLayer",r3="gtag",JE,gC,e2=!1;function i3(){const r=[];if(zS()&&r.push("This is a browser extension environment."),TM()||r.push("Cookies are not available."),r.length>0){const e=r.map((n,i)=>`(${i+1}) ${n}`).join(" "),t=Wr.create("invalid-analytics-context",{errorInfo:e});Er.warn(t.message)}}function a3(r,e,t){i3();const n=r.options.appId;if(!n)throw Wr.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)Er.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Wr.create("no-api-key");if(Nh[n]!=null)throw Wr.create("already-exists",{id:n});if(!e2){B4(Ey);const{wrappedGtag:a,gtagCore:s}=j4(Nh,QE,ZE,Ey,r3);gC=a,JE=s,e2=!0}return Nh[n]=t3(r,QE,ZE,e,JE,Ey,t),new n3(r)}function o3(r=cb()){r=Tn(r);const e=yu(r,Mp);return e.isInitialized()?e.getImmediate():s3(r)}function s3(r,e={}){const t=yu(r,Mp);if(t.isInitialized()){const i=t.getImmediate();if(rs(e,t.getOptions()))return i;throw Wr.create("already-initialized")}return t.initialize({options:e})}function u3(r,e,t,n){r=Tn(r),J4(gC,Nh[r.app.options.appId],e,t,n).catch(i=>Er.error(i))}const t2="@firebase/analytics",n2="0.10.12";function l3(){ca(new Ai(Mp,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return a3(n,i,t)},"PUBLIC")),ca(new Ai("analytics-internal",r,"PRIVATE")),li(t2,n2),li(t2,n2,"esm2017");function r(e){try{const t=e.getProvider(Mp).getImmediate();return{logEvent:(n,i,a)=>u3(t,n,i,a)}}catch(t){throw Wr.create("interop-component-reg-failed",{reason:t})}}}l3();function vb(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function yC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const c3=yC,bC=new gu("auth","Firebase",yC());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pp=new Cm("@firebase/auth");function h3(r,...e){Pp.logLevel<=ht.WARN&&Pp.warn(`Auth (${nc}): ${r}`,...e)}function bp(r,...e){Pp.logLevel<=ht.ERROR&&Pp.error(`Auth (${nc}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(r,...e){throw yb(r,...e)}function xi(r,...e){return yb(r,...e)}function gb(r,e,t){const n=Object.assign(Object.assign({},c3()),{[e]:t});return new gu("auth","Firebase",n).create(e,{appName:r.name})}function Za(r){return gb(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function f3(r,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&ci(r,"argument-error"),gb(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function yb(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return bC.create(r,...e)}function He(r,e,...t){if(!r)throw yb(e,...t)}function $a(r){const e="INTERNAL ASSERTION FAILED: "+r;throw bp(e),new Error(e)}function no(r,e){r||$a(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h0(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function d3(){return r2()==="http:"||r2()==="https:"}function r2(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(d3()||zS()||"connection"in navigator)?navigator.onLine:!0}function m3(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,t){this.shortDelay=e,this.longDelay=t,no(t>e,"Short delay should be less than long delay!"),this.isMobile=yM()||wM()}get(){return p3()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(r,e){no(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$a("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$a("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$a("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v3={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g3=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],y3=new uf(3e4,6e4);function fs(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function ds(r,e,t,n,i={}){return wC(r,i,async()=>{let a={},s={};n&&(e==="GET"?s=n:a={body:JSON.stringify(n)});const u=sf(Object.assign({key:r.config.apiKey},s)).slice(1),c=await r._getAdditionalHeaders();c["Content-Type"]="application/json",r.languageCode&&(c["X-Firebase-Locale"]=r.languageCode);const h=Object.assign({method:e,headers:c},a);return _M()||(h.referrerPolicy="no-referrer"),_C.fetch()(await xC(r,r.config.apiHost,t,u),h)})}async function wC(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},v3),e);try{const i=new _3(r),a=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const s=await a.json();if("needConfirmation"in s)throw $d(r,"account-exists-with-different-credential",s);if(a.ok&&!("errorMessage"in s))return s;{const u=a.ok?s.errorMessage:s.error.message,[c,h]=u.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw $d(r,"credential-already-in-use",s);if(c==="EMAIL_EXISTS")throw $d(r,"email-already-in-use",s);if(c==="USER_DISABLED")throw $d(r,"user-disabled",s);const d=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw gb(r,d,h);ci(r,d)}}catch(i){if(i instanceof Di)throw i;ci(r,"network-request-failed",{message:String(i)})}}async function lf(r,e,t,n,i={}){const a=await ds(r,e,t,n,i);return"mfaPendingCredential"in a&&ci(r,"multi-factor-auth-required",{_serverResponse:a}),a}async function xC(r,e,t,n){const i=`${e}${t}?${n}`,a=r,s=a.config.emulator?bb(r.config,i):`${r.config.apiScheme}://${i}`;return g3.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(s).toString():s}function b3(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _3{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(xi(this.auth,"network-request-failed")),y3.get())})}}function $d(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=xi(r,e,n);return i.customData._tokenResponse=t,i}function i2(r){return r!==void 0&&r.enterprise!==void 0}class w3{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return b3(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function x3(r,e){return ds(r,"GET","/v2/recaptchaConfig",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E3(r,e){return ds(r,"POST","/v1/accounts:delete",e)}async function Lp(r,e){return ds(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kh(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function T3(r,e=!1){const t=Tn(r),n=await t.getIdToken(e),i=_b(n);He(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,s=a==null?void 0:a.sign_in_provider;return{claims:i,token:n,authTime:kh(Ty(i.auth_time)),issuedAtTime:kh(Ty(i.iat)),expirationTime:kh(Ty(i.exp)),signInProvider:s||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Ty(r){return Number(r)*1e3}function _b(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return bp("JWT malformed, contained fewer than 3 sections"),null;try{const i=FS(t);return i?JSON.parse(i):(bp("Failed to decode base64 JWT payload"),null)}catch(i){return bp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function a2(r){const e=_b(r);return He(e,"internal-error"),He(typeof e.exp<"u","internal-error"),He(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jh(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Di&&S3(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function S3({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=kh(this.lastLoginAt),this.creationTime=kh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fp(r){var e;const t=r.auth,n=await r.getIdToken(),i=await jh(r,Lp(t,{idToken:n}));He(i==null?void 0:i.users.length,t,"internal-error");const a=i.users[0];r._notifyReloadListener(a);const s=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?EC(a.providerUserInfo):[],u=R3(r.providerData,s),c=r.isAnonymous,h=!(r.email&&a.passwordHash)&&!(u!=null&&u.length),d=c?h:!1,m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new f0(a.createdAt,a.lastLoginAt),isAnonymous:d};Object.assign(r,m)}async function A3(r){const e=Tn(r);await Fp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function R3(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function EC(r){return r.map(e=>{var{providerId:t}=e,n=vb(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I3(r,e){const t=await wC(r,{},async()=>{const n=sf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=r.config,s=await xC(r,i,"/v1/token",`key=${a}`),u=await r._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",_C.fetch()(s,{method:"POST",headers:u,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function D3(r,e){return ds(r,"POST","/v2/accounts:revokeToken",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){He(e.idToken,"internal-error"),He(typeof e.idToken<"u","internal-error"),He(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):a2(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){He(e.length!==0,"internal-error");const t=a2(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(He(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:a}=await I3(e,t);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:a}=t,s=new Il;return n&&(He(typeof n=="string","internal-error",{appName:e}),s.refreshToken=n),i&&(He(typeof i=="string","internal-error",{appName:e}),s.accessToken=i),a&&(He(typeof a=="number","internal-error",{appName:e}),s.expirationTime=a),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Il,this.toJSON())}_performRefresh(){return $a("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zo(r,e){He(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class _i{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,a=vb(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new C3(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new f0(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await jh(this,this.stsTokenManager.getToken(this.auth,e));return He(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return T3(this,e)}reload(){return A3(this)}_assign(e){this!==e&&(He(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _i(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){He(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Fp(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vr(this.auth.app))return Promise.reject(Za(this.auth));const e=await this.getIdToken();return await jh(this,E3(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,a,s,u,c,h,d;const m=(n=t.displayName)!==null&&n!==void 0?n:void 0,v=(i=t.email)!==null&&i!==void 0?i:void 0,y=(a=t.phoneNumber)!==null&&a!==void 0?a:void 0,_=(s=t.photoURL)!==null&&s!==void 0?s:void 0,E=(u=t.tenantId)!==null&&u!==void 0?u:void 0,x=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,T=(h=t.createdAt)!==null&&h!==void 0?h:void 0,C=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:A,emailVerified:R,isAnonymous:k,providerData:B,stsTokenManager:P}=t;He(A&&P,e,"internal-error");const I=Il.fromJSON(this.name,P);He(typeof A=="string",e,"internal-error"),zo(m,e.name),zo(v,e.name),He(typeof R=="boolean",e,"internal-error"),He(typeof k=="boolean",e,"internal-error"),zo(y,e.name),zo(_,e.name),zo(E,e.name),zo(x,e.name),zo(T,e.name),zo(C,e.name);const D=new _i({uid:A,auth:e,email:v,emailVerified:R,displayName:m,isAnonymous:k,photoURL:_,phoneNumber:y,tenantId:E,stsTokenManager:I,createdAt:T,lastLoginAt:C});return B&&Array.isArray(B)&&(D.providerData=B.map(O=>Object.assign({},O))),x&&(D._redirectEventId=x),D}static async _fromIdTokenResponse(e,t,n=!1){const i=new Il;i.updateFromServerResponse(t);const a=new _i({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Fp(a),a}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];He(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?EC(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),u=new Il;u.updateFromIdToken(n);const c=new _i({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:s}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new f0(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(c,h),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=new Map;function Ya(r){no(r instanceof Function,"Expected a class definition");let e=o2.get(r);return e?(no(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,o2.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}TC.type="NONE";const s2=TC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(r,e,t){return`firebase:${r}:${e}:${t}`}class Dl{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=_p(this.userKey,i.apiKey,a),this.fullPersistenceKey=_p("persistence",i.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Lp(this.auth,{idToken:e}).catch(()=>{});return t?_i._fromGetAccountInfoResponse(this.auth,t,e):null}return _i._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Dl(Ya(s2),e,n);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let a=i[0]||Ya(s2);const s=_p(n,e.config.apiKey,e.name);let u=null;for(const h of t)try{const d=await h._get(s);if(d){let m;if(typeof d=="string"){const v=await Lp(e,{idToken:d}).catch(()=>{});if(!v)break;m=await _i._fromGetAccountInfoResponse(e,v,d)}else m=_i._fromJSON(e,d);h!==a&&(u=m),a=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new Dl(a,e,n):(a=c[0],u&&await a._set(s,u.toJSON()),await Promise.all(t.map(async h=>{if(h!==a)try{await h._remove(s)}catch{}})),new Dl(a,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(RC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(SC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(DC(e))return"Blackberry";if(NC(e))return"Webos";if(CC(e))return"Safari";if((e.includes("chrome/")||AC(e))&&!e.includes("edge/"))return"Chrome";if(IC(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function SC(r=or()){return/firefox\//i.test(r)}function CC(r=or()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function AC(r=or()){return/crios\//i.test(r)}function RC(r=or()){return/iemobile/i.test(r)}function IC(r=or()){return/android/i.test(r)}function DC(r=or()){return/blackberry/i.test(r)}function NC(r=or()){return/webos/i.test(r)}function wb(r=or()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function N3(r=or()){var e;return wb(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function k3(){return xM()&&document.documentMode===10}function kC(r=or()){return wb(r)||IC(r)||NC(r)||DC(r)||/windows phone/i.test(r)||RC(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(r,e=[]){let t;switch(r){case"Browser":t=u2(or());break;case"Worker":t=`${u2(or())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${nc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O3{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=a=>new Promise((s,u)=>{try{const c=e(a);s(c)}catch(c){u(c)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M3(r,e={}){return ds(r,"GET","/v2/passwordPolicy",fs(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3=6;class L3{constructor(e){var t,n,i,a;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=s.minPasswordLength)!==null&&t!==void 0?t:P3,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,a,s,u;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(n=c.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(a=c.containsUppercaseLetter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(s=c.containsNumericCharacter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(u=c.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),c}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new l2(this),this.idTokenSubscription=new l2(this),this.beforeStateQueue=new O3(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ya(t)),this._initializationPromise=this.queue(async()=>{var n,i,a;if(!this._deleted&&(this.persistenceManager=await Dl.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Lp(this,{idToken:e}),n=await _i._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Vr(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(u,u))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!s||s===u)&&(c!=null&&c.user)&&(i=c.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return He(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Fp(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=m3()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Vr(this.app))return Promise.reject(Za(this));const t=e?Tn(e):null;return t&&He(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&He(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Vr(this.app)?Promise.reject(Za(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Vr(this.app)?Promise.reject(Za(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ya(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await M3(this),t=new L3(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new gu("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await D3(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ya(e)||this._popupRedirectResolver;He(t,this,"argument-error"),this.redirectPersistenceManager=await Dl.create(this,[Ya(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let s=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(He(u,this,"internal-error"),u.then(()=>{s||a(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,n,i);return()=>{s=!0,c()}}else{const c=e.addObserver(t);return()=>{s=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return He(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=OC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(Vr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&h3(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function ps(r){return Tn(r)}class l2{constructor(e){this.auth=e,this.observer=null,this.addObserver=IM(t=>this.observer=t)}get next(){return He(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Im={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function B3(r){Im=r}function MC(r){return Im.loadJS(r)}function V3(){return Im.recaptchaEnterpriseScript}function U3(){return Im.gapiScript}function z3(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class j3{constructor(){this.enterprise=new H3}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class H3{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const W3="recaptcha-enterprise",PC="NO_RECAPTCHA";class q3{constructor(e){this.type=W3,this.auth=ps(e)}async verify(e="verify",t=!1){async function n(a){if(!t){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(s,u)=>{x3(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const h=new w3(c);return a.tenantId==null?a._agentRecaptchaConfig=h:a._tenantRecaptchaConfigs[a.tenantId]=h,s(h.siteKey)}}).catch(c=>{u(c)})})}function i(a,s,u){const c=window.grecaptcha;i2(c)?c.enterprise.ready(()=>{c.enterprise.execute(a,{action:e}).then(h=>{s(h)}).catch(()=>{s(PC)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new j3().execute("siteKey",{action:"verify"}):new Promise((a,s)=>{n(this.auth).then(u=>{if(!t&&i2(window.grecaptcha))i(u,a,s);else{if(typeof window>"u"){s(new Error("RecaptchaVerifier is only supported in browser"));return}let c=V3();c.length!==0&&(c+=u),MC(c).then(()=>{i(u,a,s)}).catch(h=>{s(h)})}}).catch(u=>{s(u)})})}}async function c2(r,e,t,n=!1,i=!1){const a=new q3(r);let s;if(i)s=PC;else try{s=await a.verify(t)}catch{s=await a.verify(t,!0)}const u=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const c=u.phoneEnrollmentInfo.phoneNumber,h=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:h,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const c=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return n?Object.assign(u,{captchaResp:s}):Object.assign(u,{captchaResponse:s}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function d0(r,e,t,n,i){var a;if(!((a=r._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await c2(r,e,t,t==="getOobCode");return n(r,s)}else return n(r,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await c2(r,e,t,t==="getOobCode");return n(r,u)}else return Promise.reject(s)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G3(r,e){const t=yu(r,"auth");if(t.isInitialized()){const i=t.getImmediate(),a=t.getOptions();if(rs(a,e??{}))return i;ci(i,"already-initialized")}return t.initialize({options:e})}function K3(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Ya);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function X3(r,e,t){const n=ps(r);He(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,a=LC(e),{host:s,port:u}=$3(e),c=u===null?"":`:${u}`,h={url:`${a}//${s}${c}/`},d=Object.freeze({host:s,port:u,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){He(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),He(rs(h,n.config.emulator)&&rs(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,Y3()}function LC(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function $3(r){const e=LC(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:h2(n.substr(a.length+1))}}else{const[a,s]=n.split(":");return{host:a,port:h2(s)}}}function h2(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function Y3(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $a("not implemented")}_getIdTokenResponse(e){return $a("not implemented")}_linkToIdToken(e,t){return $a("not implemented")}_getReauthenticationResolver(e){return $a("not implemented")}}async function Q3(r,e){return ds(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z3(r,e){return lf(r,"POST","/v1/accounts:signInWithPassword",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J3(r,e){return lf(r,"POST","/v1/accounts:signInWithEmailLink",fs(r,e))}async function eL(r,e){return lf(r,"POST","/v1/accounts:signInWithEmailLink",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh extends xb{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Hh(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Hh(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return d0(e,t,"signInWithPassword",Z3);case"emailLink":return J3(e,{email:this._email,oobCode:this._password});default:ci(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return d0(e,n,"signUpPassword",Q3);case"emailLink":return eL(e,{idToken:t,email:this._email,oobCode:this._password});default:ci(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nl(r,e){return lf(r,"POST","/v1/accounts:signInWithIdp",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL="http://localhost";class cu extends xb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new cu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ci("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,a=vb(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new cu(n,i);return s.idToken=a.idToken||void 0,s.accessToken=a.accessToken||void 0,s.secret=a.secret,s.nonce=a.nonce,s.pendingToken=a.pendingToken||null,s}_getIdTokenResponse(e){const t=this.buildRequest();return Nl(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Nl(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Nl(e,t)}buildRequest(){const e={requestUri:tL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=sf(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nL(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function rL(r){const e=Sh(Ch(r)).link,t=e?Sh(Ch(e)).deep_link_id:null,n=Sh(Ch(r)).deep_link_id;return(n?Sh(Ch(n)).link:null)||n||t||e||r}class Eb{constructor(e){var t,n,i,a,s,u;const c=Sh(Ch(e)),h=(t=c.apiKey)!==null&&t!==void 0?t:null,d=(n=c.oobCode)!==null&&n!==void 0?n:null,m=nL((i=c.mode)!==null&&i!==void 0?i:null);He(h&&d&&m,"argument-error"),this.apiKey=h,this.operation=m,this.code=d,this.continueUrl=(a=c.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(s=c.languageCode)!==null&&s!==void 0?s:null,this.tenantId=(u=c.tenantId)!==null&&u!==void 0?u:null}static parseLink(e){const t=rL(e);try{return new Eb(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(){this.providerId=rc.PROVIDER_ID}static credential(e,t){return Hh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Eb.parseLink(t);return He(n,"argument-error"),Hh._fromEmailAndCode(e,n.code,n.tenantId)}}rc.PROVIDER_ID="password";rc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";rc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf extends Tb{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo extends cf{constructor(){super("facebook.com")}static credential(e){return cu._fromParams({providerId:Wo.PROVIDER_ID,signInMethod:Wo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wo.credentialFromTaggedObject(e)}static credentialFromError(e){return Wo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wo.credential(e.oauthAccessToken)}catch{return null}}}Wo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Wo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji extends cf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return cu._fromParams({providerId:Ji.PROVIDER_ID,signInMethod:Ji.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ji.credentialFromTaggedObject(e)}static credentialFromError(e){return Ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ji.credential(t,n)}catch{return null}}}Ji.GOOGLE_SIGN_IN_METHOD="google.com";Ji.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo extends cf{constructor(){super("github.com")}static credential(e){return cu._fromParams({providerId:qo.PROVIDER_ID,signInMethod:qo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qo.credentialFromTaggedObject(e)}static credentialFromError(e){return qo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qo.credential(e.oauthAccessToken)}catch{return null}}}qo.GITHUB_SIGN_IN_METHOD="github.com";qo.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go extends cf{constructor(){super("twitter.com")}static credential(e,t){return cu._fromParams({providerId:Go.PROVIDER_ID,signInMethod:Go.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Go.credentialFromTaggedObject(e)}static credentialFromError(e){return Go.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Go.credential(t,n)}catch{return null}}}Go.TWITTER_SIGN_IN_METHOD="twitter.com";Go.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iL(r,e){return lf(r,"POST","/v1/accounts:signUp",fs(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const a=await _i._fromIdTokenResponse(e,n,i),s=f2(n);return new hu({user:a,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=f2(n);return new hu({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function f2(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp extends Di{constructor(e,t,n,i){var a;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Bp.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Bp(e,t,n,i)}}function FC(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?Bp._fromErrorAndOperation(r,a,e,n):a})}async function aL(r,e,t=!1){const n=await jh(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return hu._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oL(r,e,t=!1){const{auth:n}=r;if(Vr(n.app))return Promise.reject(Za(n));const i="reauthenticate";try{const a=await jh(r,FC(n,i,e,r),t);He(a.idToken,n,"internal-error");const s=_b(a.idToken);He(s,n,"internal-error");const{sub:u}=s;return He(r.uid===u,n,"user-mismatch"),hu._forOperation(r,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&ci(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(r,e,t=!1){if(Vr(r.app))return Promise.reject(Za(r));const n="signIn",i=await FC(r,n,e),a=await hu._fromIdTokenResponse(r,n,i);return t||await r._updateCurrentUser(a.user),a}async function sL(r,e){return BC(ps(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(r){const e=ps(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function uL(r,e,t){if(Vr(r.app))return Promise.reject(Za(r));const n=ps(r),s=await d0(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",iL).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&VC(r),c}),u=await hu._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(u.user),u}function lL(r,e,t){return Vr(r.app)?Promise.reject(Za(r)):sL(Tn(r),rc.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&VC(r),n})}function cL(r,e,t,n){return Tn(r).onIdTokenChanged(e,t,n)}function hL(r,e,t){return Tn(r).beforeAuthStateChanged(e,t)}function fL(r,e,t,n){return Tn(r).onAuthStateChanged(e,t,n)}function dL(r){return Tn(r).signOut()}const Vp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Vp,"1"),this.storage.removeItem(Vp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pL=1e3,mL=10;class zC extends UC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=kC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((s,u,c)=>{this.notifyListeners(s,c)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const s=this.storage.getItem(n);!t&&this.localCache[n]===s||this.notifyListeners(n,s)},a=this.storage.getItem(n);k3()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,mL):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},pL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zC.type="LOCAL";const vL=zC;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC extends UC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}jC.type="SESSION";const HC=jC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gL(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new Dm(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:a}=t.data,s=this.handlersMap[i];if(!(s!=null&&s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const u=Array.from(s).map(async h=>h(t.origin,a)),c=await gL(u);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Dm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sb(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,s;return new Promise((u,c)=>{const h=Sb("",20);i.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},n);s={messageChannel:i,onMessage(m){const v=m;if(v.data.eventId===h)switch(v.data.status){case"ack":clearTimeout(d),a=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),u(v.data.response);break;default:clearTimeout(d),clearTimeout(a),c(new Error("invalid_response"));break}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ra(){return window}function bL(r){ra().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WC(){return typeof ra().WorkerGlobalScope<"u"&&typeof ra().importScripts=="function"}async function _L(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function wL(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function xL(){return WC()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC="firebaseLocalStorageDb",EL=1,Up="firebaseLocalStorage",GC="fbase_key";class hf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Nm(r,e){return r.transaction([Up],e?"readwrite":"readonly").objectStore(Up)}function TL(){const r=indexedDB.deleteDatabase(qC);return new hf(r).toPromise()}function p0(){const r=indexedDB.open(qC,EL);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Up,{keyPath:GC})}catch(i){t(i)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Up)?e(n):(n.close(),await TL(),e(await p0()))})})}async function d2(r,e,t){const n=Nm(r,!0).put({[GC]:e,value:t});return new hf(n).toPromise()}async function SL(r,e){const t=Nm(r,!1).get(e),n=await new hf(t).toPromise();return n===void 0?null:n.value}function p2(r,e){const t=Nm(r,!0).delete(e);return new hf(t).toPromise()}const CL=800,AL=3;class KC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await p0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>AL)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return WC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Dm._getInstance(xL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await _L(),!this.activeServiceWorker)return;this.sender=new yL(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||wL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await p0();return await d2(e,Vp,"1"),await p2(e,Vp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>d2(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>SL(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>p2(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=Nm(i,!1).getAll();return new hf(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),CL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}KC.type="LOCAL";const RL=KC;new uf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(r,e){return e?Ya(e):(He(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb extends xb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Nl(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Nl(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Nl(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function IL(r){return BC(r.auth,new Cb(r),r.bypassAuthState)}function DL(r){const{auth:e,user:t}=r;return He(t,e,"internal-error"),oL(t,new Cb(r),r.bypassAuthState)}async function NL(r){const{auth:e,user:t}=r;return He(t,e,"internal-error"),aL(t,new Cb(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(e,t,n,i,a=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:a,error:s,type:u}=e;if(s){this.reject(s);return}const c={auth:this.auth,requestUri:t,sessionId:n,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return IL;case"linkViaPopup":case"linkViaRedirect":return NL;case"reauthViaPopup":case"reauthViaRedirect":return DL;default:ci(this.auth,"internal-error")}}resolve(e){no(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){no(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kL=new uf(2e3,1e4);async function OL(r,e,t){if(Vr(r.app))return Promise.reject(xi(r,"operation-not-supported-in-this-environment"));const n=ps(r);f3(r,e,Tb);const i=XC(n,t);return new ru(n,"signInViaPopup",e,i).executeNotNull()}class ru extends $C{constructor(e,t,n,i,a){super(e,t,i,a),this.provider=n,this.authWindow=null,this.pollId=null,ru.currentPopupAction&&ru.currentPopupAction.cancel(),ru.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return He(e,this.auth,"internal-error"),e}async onExecution(){no(this.filter.length===1,"Popup operations only handle one event");const e=Sb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ru.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,kL.get())};e()}}ru.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ML="pendingRedirect",wp=new Map;class PL extends $C{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=wp.get(this.auth._key());if(!e){try{const n=await LL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}wp.set(this.auth._key(),e)}return this.bypassAuthState||wp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function LL(r,e){const t=VL(e),n=BL(r);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}function FL(r,e){wp.set(r._key(),e)}function BL(r){return Ya(r._redirectPersistence)}function VL(r){return _p(ML,r.config.apiKey,r.name)}async function UL(r,e,t=!1){if(Vr(r.app))return Promise.reject(Za(r));const n=ps(r),i=XC(n,e),s=await new PL(n,i,t).execute();return s&&!t&&(delete s.user._redirectEventId,await n._persistUserIfCurrent(s.user),await n._setRedirectUser(null,e)),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=10*60*1e3;class jL{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!HL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!YC(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(xi(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zL&&this.cachedEventUids.clear(),this.cachedEventUids.has(m2(e))}saveEventToCache(e){this.cachedEventUids.add(m2(e)),this.lastProcessedEventTime=Date.now()}}function m2(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function YC({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function HL(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return YC(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WL(r,e={}){return ds(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,GL=/^https?/;async function KL(r){if(r.config.emulator)return;const{authorizedDomains:e}=await WL(r);for(const t of e)try{if(XL(t))return}catch{}ci(r,"unauthorized-domain")}function XL(r){const e=h0(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const s=new URL(r);return s.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&s.hostname===n}if(!GL.test(t))return!1;if(qL.test(r))return n===r;const i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $L=new uf(3e4,6e4);function v2(){const r=ra().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function YL(r){return new Promise((e,t)=>{var n,i,a;function s(){v2(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{v2(),t(xi(r,"network-request-failed"))},timeout:$L.get()})}if(!((i=(n=ra().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((a=ra().gapi)===null||a===void 0)&&a.load)s();else{const u=z3("iframefcb");return ra()[u]=()=>{gapi.load?s():t(xi(r,"network-request-failed"))},MC(`${U3()}?onload=${u}`).catch(c=>t(c))}}).catch(e=>{throw xp=null,e})}let xp=null;function QL(r){return xp=xp||YL(r),xp}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZL=new uf(5e3,15e3),JL="__/auth/iframe",eF="emulator/auth/iframe",tF={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nF=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function rF(r){const e=r.config;He(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?bb(e,eF):`https://${r.config.authDomain}/${JL}`,n={apiKey:e.apiKey,appName:r.name,v:nc},i=nF.get(r.config.apiHost);i&&(n.eid=i);const a=r._getFrameworks();return a.length&&(n.fw=a.join(",")),`${t}?${sf(n).slice(1)}`}async function iF(r){const e=await QL(r),t=ra().gapi;return He(t,r,"internal-error"),e.open({where:document.body,url:rF(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tF,dontclear:!0},n=>new Promise(async(i,a)=>{await n.restyle({setHideOnLeave:!1});const s=xi(r,"network-request-failed"),u=ra().setTimeout(()=>{a(s)},ZL.get());function c(){ra().clearTimeout(u),i(n)}n.ping(c).then(c,()=>{a(s)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},oF=500,sF=600,uF="_blank",lF="http://localhost";class g2{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cF(r,e,t,n=oF,i=sF){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-n)/2,0).toString();let u="";const c=Object.assign(Object.assign({},aF),{width:n.toString(),height:i.toString(),top:a,left:s}),h=or().toLowerCase();t&&(u=AC(h)?uF:t),SC(h)&&(e=e||lF,c.scrollbars="yes");const d=Object.entries(c).reduce((v,[y,_])=>`${v}${y}=${_},`,"");if(N3(h)&&u!=="_self")return hF(e||"",u),new g2(null);const m=window.open(e||"",u,d);He(m,r,"popup-blocked");try{m.focus()}catch{}return new g2(m)}function hF(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF="__/auth/handler",dF="emulator/auth/handler",pF=encodeURIComponent("fac");async function y2(r,e,t,n,i,a){He(r.config.authDomain,r,"auth-domain-config-required"),He(r.config.apiKey,r,"invalid-api-key");const s={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:nc,eventId:i};if(e instanceof Tb){e.setDefaultLanguage(r.languageCode),s.providerId=e.providerId||"",RM(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,m]of Object.entries({}))s[d]=m}if(e instanceof cf){const d=e.getScopes().filter(m=>m!=="");d.length>0&&(s.scopes=d.join(","))}r.tenantId&&(s.tid=r.tenantId);const u=s;for(const d of Object.keys(u))u[d]===void 0&&delete u[d];const c=await r._getAppCheckToken(),h=c?`#${pF}=${encodeURIComponent(c)}`:"";return`${mF(r)}?${sf(u).slice(1)}${h}`}function mF({config:r}){return r.emulator?bb(r,dF):`https://${r.authDomain}/${fF}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sy="webStorageSupport";class vF{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=HC,this._completeRedirectFn=UL,this._overrideRedirectResult=FL}async _openPopup(e,t,n,i){var a;no((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await y2(e,t,n,h0(),i);return cF(e,s,Sb())}async _openRedirect(e,t,n,i){await this._originValidation(e);const a=await y2(e,t,n,h0(),i);return bL(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:a}=this.eventManagers[t];return i?Promise.resolve(i):(no(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await iF(e),n=new jL(e);return t.register("authEvent",i=>(He(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sy,{type:Sy},i=>{var a;const s=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[Sy];s!==void 0&&t(!!s),ci(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=KL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return kC()||CC()||wb()}}const gF=vF;var b2="@firebase/auth",_2="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){He(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bF(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _F(r){ca(new Ai("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:s,authDomain:u}=n.options;He(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:s,authDomain:u,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:OC(r)},h=new F3(n,i,a,c);return K3(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),ca(new Ai("auth-internal",e=>{const t=ps(e.getProvider("auth").getImmediate());return(n=>new yF(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),li(b2,_2,bF(r)),li(b2,_2,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=5*60,xF=US("authIdTokenMaxAge")||wF;let w2=null;const EF=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>xF)return;const i=t==null?void 0:t.token;w2!==i&&(w2=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function TF(r=cb()){const e=yu(r,"auth");if(e.isInitialized())return e.getImmediate();const t=G3(r,{popupRedirectResolver:gF,persistence:[RL,vL,HC]}),n=US("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(n,location.origin);if(location.origin===a.origin){const s=EF(a.toString());hL(t,s,()=>s(t.currentUser)),cL(t,u=>s(u))}}const i=BS("auth");return i&&X3(t,`http://${i}`),t}function SF(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}B3({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{const a=xi("internal-error");a.customData=i,t(a)},n.type="text/javascript",n.charset="UTF-8",SF().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_F("Browser");var x2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Zo,QC;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,I){function D(){}D.prototype=I.prototype,P.D=I.prototype,P.prototype=new D,P.prototype.constructor=P,P.C=function(O,L,F){for(var V=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)V[ie-2]=arguments[ie];return I.prototype[L].apply(O,V)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(P,I,D){D||(D=0);var O=Array(16);if(typeof I=="string")for(var L=0;16>L;++L)O[L]=I.charCodeAt(D++)|I.charCodeAt(D++)<<8|I.charCodeAt(D++)<<16|I.charCodeAt(D++)<<24;else for(L=0;16>L;++L)O[L]=I[D++]|I[D++]<<8|I[D++]<<16|I[D++]<<24;I=P.g[0],D=P.g[1],L=P.g[2];var F=P.g[3],V=I+(F^D&(L^F))+O[0]+3614090360&4294967295;I=D+(V<<7&4294967295|V>>>25),V=F+(L^I&(D^L))+O[1]+3905402710&4294967295,F=I+(V<<12&4294967295|V>>>20),V=L+(D^F&(I^D))+O[2]+606105819&4294967295,L=F+(V<<17&4294967295|V>>>15),V=D+(I^L&(F^I))+O[3]+3250441966&4294967295,D=L+(V<<22&4294967295|V>>>10),V=I+(F^D&(L^F))+O[4]+4118548399&4294967295,I=D+(V<<7&4294967295|V>>>25),V=F+(L^I&(D^L))+O[5]+1200080426&4294967295,F=I+(V<<12&4294967295|V>>>20),V=L+(D^F&(I^D))+O[6]+2821735955&4294967295,L=F+(V<<17&4294967295|V>>>15),V=D+(I^L&(F^I))+O[7]+4249261313&4294967295,D=L+(V<<22&4294967295|V>>>10),V=I+(F^D&(L^F))+O[8]+1770035416&4294967295,I=D+(V<<7&4294967295|V>>>25),V=F+(L^I&(D^L))+O[9]+2336552879&4294967295,F=I+(V<<12&4294967295|V>>>20),V=L+(D^F&(I^D))+O[10]+4294925233&4294967295,L=F+(V<<17&4294967295|V>>>15),V=D+(I^L&(F^I))+O[11]+2304563134&4294967295,D=L+(V<<22&4294967295|V>>>10),V=I+(F^D&(L^F))+O[12]+1804603682&4294967295,I=D+(V<<7&4294967295|V>>>25),V=F+(L^I&(D^L))+O[13]+4254626195&4294967295,F=I+(V<<12&4294967295|V>>>20),V=L+(D^F&(I^D))+O[14]+2792965006&4294967295,L=F+(V<<17&4294967295|V>>>15),V=D+(I^L&(F^I))+O[15]+1236535329&4294967295,D=L+(V<<22&4294967295|V>>>10),V=I+(L^F&(D^L))+O[1]+4129170786&4294967295,I=D+(V<<5&4294967295|V>>>27),V=F+(D^L&(I^D))+O[6]+3225465664&4294967295,F=I+(V<<9&4294967295|V>>>23),V=L+(I^D&(F^I))+O[11]+643717713&4294967295,L=F+(V<<14&4294967295|V>>>18),V=D+(F^I&(L^F))+O[0]+3921069994&4294967295,D=L+(V<<20&4294967295|V>>>12),V=I+(L^F&(D^L))+O[5]+3593408605&4294967295,I=D+(V<<5&4294967295|V>>>27),V=F+(D^L&(I^D))+O[10]+38016083&4294967295,F=I+(V<<9&4294967295|V>>>23),V=L+(I^D&(F^I))+O[15]+3634488961&4294967295,L=F+(V<<14&4294967295|V>>>18),V=D+(F^I&(L^F))+O[4]+3889429448&4294967295,D=L+(V<<20&4294967295|V>>>12),V=I+(L^F&(D^L))+O[9]+568446438&4294967295,I=D+(V<<5&4294967295|V>>>27),V=F+(D^L&(I^D))+O[14]+3275163606&4294967295,F=I+(V<<9&4294967295|V>>>23),V=L+(I^D&(F^I))+O[3]+4107603335&4294967295,L=F+(V<<14&4294967295|V>>>18),V=D+(F^I&(L^F))+O[8]+1163531501&4294967295,D=L+(V<<20&4294967295|V>>>12),V=I+(L^F&(D^L))+O[13]+2850285829&4294967295,I=D+(V<<5&4294967295|V>>>27),V=F+(D^L&(I^D))+O[2]+4243563512&4294967295,F=I+(V<<9&4294967295|V>>>23),V=L+(I^D&(F^I))+O[7]+1735328473&4294967295,L=F+(V<<14&4294967295|V>>>18),V=D+(F^I&(L^F))+O[12]+2368359562&4294967295,D=L+(V<<20&4294967295|V>>>12),V=I+(D^L^F)+O[5]+4294588738&4294967295,I=D+(V<<4&4294967295|V>>>28),V=F+(I^D^L)+O[8]+2272392833&4294967295,F=I+(V<<11&4294967295|V>>>21),V=L+(F^I^D)+O[11]+1839030562&4294967295,L=F+(V<<16&4294967295|V>>>16),V=D+(L^F^I)+O[14]+4259657740&4294967295,D=L+(V<<23&4294967295|V>>>9),V=I+(D^L^F)+O[1]+2763975236&4294967295,I=D+(V<<4&4294967295|V>>>28),V=F+(I^D^L)+O[4]+1272893353&4294967295,F=I+(V<<11&4294967295|V>>>21),V=L+(F^I^D)+O[7]+4139469664&4294967295,L=F+(V<<16&4294967295|V>>>16),V=D+(L^F^I)+O[10]+3200236656&4294967295,D=L+(V<<23&4294967295|V>>>9),V=I+(D^L^F)+O[13]+681279174&4294967295,I=D+(V<<4&4294967295|V>>>28),V=F+(I^D^L)+O[0]+3936430074&4294967295,F=I+(V<<11&4294967295|V>>>21),V=L+(F^I^D)+O[3]+3572445317&4294967295,L=F+(V<<16&4294967295|V>>>16),V=D+(L^F^I)+O[6]+76029189&4294967295,D=L+(V<<23&4294967295|V>>>9),V=I+(D^L^F)+O[9]+3654602809&4294967295,I=D+(V<<4&4294967295|V>>>28),V=F+(I^D^L)+O[12]+3873151461&4294967295,F=I+(V<<11&4294967295|V>>>21),V=L+(F^I^D)+O[15]+530742520&4294967295,L=F+(V<<16&4294967295|V>>>16),V=D+(L^F^I)+O[2]+3299628645&4294967295,D=L+(V<<23&4294967295|V>>>9),V=I+(L^(D|~F))+O[0]+4096336452&4294967295,I=D+(V<<6&4294967295|V>>>26),V=F+(D^(I|~L))+O[7]+1126891415&4294967295,F=I+(V<<10&4294967295|V>>>22),V=L+(I^(F|~D))+O[14]+2878612391&4294967295,L=F+(V<<15&4294967295|V>>>17),V=D+(F^(L|~I))+O[5]+4237533241&4294967295,D=L+(V<<21&4294967295|V>>>11),V=I+(L^(D|~F))+O[12]+1700485571&4294967295,I=D+(V<<6&4294967295|V>>>26),V=F+(D^(I|~L))+O[3]+2399980690&4294967295,F=I+(V<<10&4294967295|V>>>22),V=L+(I^(F|~D))+O[10]+4293915773&4294967295,L=F+(V<<15&4294967295|V>>>17),V=D+(F^(L|~I))+O[1]+2240044497&4294967295,D=L+(V<<21&4294967295|V>>>11),V=I+(L^(D|~F))+O[8]+1873313359&4294967295,I=D+(V<<6&4294967295|V>>>26),V=F+(D^(I|~L))+O[15]+4264355552&4294967295,F=I+(V<<10&4294967295|V>>>22),V=L+(I^(F|~D))+O[6]+2734768916&4294967295,L=F+(V<<15&4294967295|V>>>17),V=D+(F^(L|~I))+O[13]+1309151649&4294967295,D=L+(V<<21&4294967295|V>>>11),V=I+(L^(D|~F))+O[4]+4149444226&4294967295,I=D+(V<<6&4294967295|V>>>26),V=F+(D^(I|~L))+O[11]+3174756917&4294967295,F=I+(V<<10&4294967295|V>>>22),V=L+(I^(F|~D))+O[2]+718787259&4294967295,L=F+(V<<15&4294967295|V>>>17),V=D+(F^(L|~I))+O[9]+3951481745&4294967295,P.g[0]=P.g[0]+I&4294967295,P.g[1]=P.g[1]+(L+(V<<21&4294967295|V>>>11))&4294967295,P.g[2]=P.g[2]+L&4294967295,P.g[3]=P.g[3]+F&4294967295}n.prototype.u=function(P,I){I===void 0&&(I=P.length);for(var D=I-this.blockSize,O=this.B,L=this.h,F=0;F<I;){if(L==0)for(;F<=D;)i(this,P,F),F+=this.blockSize;if(typeof P=="string"){for(;F<I;)if(O[L++]=P.charCodeAt(F++),L==this.blockSize){i(this,O),L=0;break}}else for(;F<I;)if(O[L++]=P[F++],L==this.blockSize){i(this,O),L=0;break}}this.h=L,this.o+=I},n.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var I=1;I<P.length-8;++I)P[I]=0;var D=8*this.o;for(I=P.length-8;I<P.length;++I)P[I]=D&255,D/=256;for(this.u(P),P=Array(16),I=D=0;4>I;++I)for(var O=0;32>O;O+=8)P[D++]=this.g[I]>>>O&255;return P};function a(P,I){var D=u;return Object.prototype.hasOwnProperty.call(D,P)?D[P]:D[P]=I(P)}function s(P,I){this.h=I;for(var D=[],O=!0,L=P.length-1;0<=L;L--){var F=P[L]|0;O&&F==I||(D[L]=F,O=!1)}this.g=D}var u={};function c(P){return-128<=P&&128>P?a(P,function(I){return new s([I|0],0>I?-1:0)}):new s([P|0],0>P?-1:0)}function h(P){if(isNaN(P)||!isFinite(P))return m;if(0>P)return x(h(-P));for(var I=[],D=1,O=0;P>=D;O++)I[O]=P/D|0,D*=4294967296;return new s(I,0)}function d(P,I){if(P.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(P.charAt(0)=="-")return x(d(P.substring(1),I));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=h(Math.pow(I,8)),O=m,L=0;L<P.length;L+=8){var F=Math.min(8,P.length-L),V=parseInt(P.substring(L,L+F),I);8>F?(F=h(Math.pow(I,F)),O=O.j(F).add(h(V))):(O=O.j(D),O=O.add(h(V)))}return O}var m=c(0),v=c(1),y=c(16777216);r=s.prototype,r.m=function(){if(E(this))return-x(this).m();for(var P=0,I=1,D=0;D<this.g.length;D++){var O=this.i(D);P+=(0<=O?O:4294967296+O)*I,I*=4294967296}return P},r.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(_(this))return"0";if(E(this))return"-"+x(this).toString(P);for(var I=h(Math.pow(P,6)),D=this,O="";;){var L=R(D,I).g;D=T(D,L.j(I));var F=((0<D.g.length?D.g[0]:D.h)>>>0).toString(P);if(D=L,_(D))return F+O;for(;6>F.length;)F="0"+F;O=F+O}},r.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function _(P){if(P.h!=0)return!1;for(var I=0;I<P.g.length;I++)if(P.g[I]!=0)return!1;return!0}function E(P){return P.h==-1}r.l=function(P){return P=T(this,P),E(P)?-1:_(P)?0:1};function x(P){for(var I=P.g.length,D=[],O=0;O<I;O++)D[O]=~P.g[O];return new s(D,~P.h).add(v)}r.abs=function(){return E(this)?x(this):this},r.add=function(P){for(var I=Math.max(this.g.length,P.g.length),D=[],O=0,L=0;L<=I;L++){var F=O+(this.i(L)&65535)+(P.i(L)&65535),V=(F>>>16)+(this.i(L)>>>16)+(P.i(L)>>>16);O=V>>>16,F&=65535,V&=65535,D[L]=V<<16|F}return new s(D,D[D.length-1]&-2147483648?-1:0)};function T(P,I){return P.add(x(I))}r.j=function(P){if(_(this)||_(P))return m;if(E(this))return E(P)?x(this).j(x(P)):x(x(this).j(P));if(E(P))return x(this.j(x(P)));if(0>this.l(y)&&0>P.l(y))return h(this.m()*P.m());for(var I=this.g.length+P.g.length,D=[],O=0;O<2*I;O++)D[O]=0;for(O=0;O<this.g.length;O++)for(var L=0;L<P.g.length;L++){var F=this.i(O)>>>16,V=this.i(O)&65535,ie=P.i(L)>>>16,se=P.i(L)&65535;D[2*O+2*L]+=V*se,C(D,2*O+2*L),D[2*O+2*L+1]+=F*se,C(D,2*O+2*L+1),D[2*O+2*L+1]+=V*ie,C(D,2*O+2*L+1),D[2*O+2*L+2]+=F*ie,C(D,2*O+2*L+2)}for(O=0;O<I;O++)D[O]=D[2*O+1]<<16|D[2*O];for(O=I;O<2*I;O++)D[O]=0;return new s(D,0)};function C(P,I){for(;(P[I]&65535)!=P[I];)P[I+1]+=P[I]>>>16,P[I]&=65535,I++}function A(P,I){this.g=P,this.h=I}function R(P,I){if(_(I))throw Error("division by zero");if(_(P))return new A(m,m);if(E(P))return I=R(x(P),I),new A(x(I.g),x(I.h));if(E(I))return I=R(P,x(I)),new A(x(I.g),I.h);if(30<P.g.length){if(E(P)||E(I))throw Error("slowDivide_ only works with positive integers.");for(var D=v,O=I;0>=O.l(P);)D=k(D),O=k(O);var L=B(D,1),F=B(O,1);for(O=B(O,2),D=B(D,2);!_(O);){var V=F.add(O);0>=V.l(P)&&(L=L.add(D),F=V),O=B(O,1),D=B(D,1)}return I=T(P,L.j(I)),new A(L,I)}for(L=m;0<=P.l(I);){for(D=Math.max(1,Math.floor(P.m()/I.m())),O=Math.ceil(Math.log(D)/Math.LN2),O=48>=O?1:Math.pow(2,O-48),F=h(D),V=F.j(I);E(V)||0<V.l(P);)D-=O,F=h(D),V=F.j(I);_(F)&&(F=v),L=L.add(F),P=T(P,V)}return new A(L,P)}r.A=function(P){return R(this,P).h},r.and=function(P){for(var I=Math.max(this.g.length,P.g.length),D=[],O=0;O<I;O++)D[O]=this.i(O)&P.i(O);return new s(D,this.h&P.h)},r.or=function(P){for(var I=Math.max(this.g.length,P.g.length),D=[],O=0;O<I;O++)D[O]=this.i(O)|P.i(O);return new s(D,this.h|P.h)},r.xor=function(P){for(var I=Math.max(this.g.length,P.g.length),D=[],O=0;O<I;O++)D[O]=this.i(O)^P.i(O);return new s(D,this.h^P.h)};function k(P){for(var I=P.g.length+1,D=[],O=0;O<I;O++)D[O]=P.i(O)<<1|P.i(O-1)>>>31;return new s(D,P.h)}function B(P,I){var D=I>>5;I%=32;for(var O=P.g.length-D,L=[],F=0;F<O;F++)L[F]=0<I?P.i(F+D)>>>I|P.i(F+D+1)<<32-I:P.i(F+D);return new s(L,P.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,QC=n,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=h,s.fromString=d,Zo=s}).apply(typeof x2<"u"?x2:typeof self<"u"?self:typeof window<"u"?window:{});var Yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ZC,Ah,JC,Ep,m0,eA,tA,nA;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(g,S,N){return g==Array.prototype||g==Object.prototype||(g[S]=N.value),g};function t(g){g=[typeof globalThis=="object"&&globalThis,g,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yd=="object"&&Yd];for(var S=0;S<g.length;++S){var N=g[S];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var n=t(this);function i(g,S){if(S)e:{var N=n;g=g.split(".");for(var z=0;z<g.length-1;z++){var ne=g[z];if(!(ne in N))break e;N=N[ne]}g=g[g.length-1],z=N[g],S=S(z),S!=z&&S!=null&&e(N,g,{configurable:!0,writable:!0,value:S})}}function a(g,S){g instanceof String&&(g+="");var N=0,z=!1,ne={next:function(){if(!z&&N<g.length){var fe=N++;return{value:S(fe,g[fe]),done:!1}}return z=!0,{done:!0,value:void 0}}};return ne[Symbol.iterator]=function(){return ne},ne}i("Array.prototype.values",function(g){return g||function(){return a(this,function(S,N){return N})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},u=this||self;function c(g){var S=typeof g;return S=S!="object"?S:g?Array.isArray(g)?"array":S:"null",S=="array"||S=="object"&&typeof g.length=="number"}function h(g){var S=typeof g;return S=="object"&&g!=null||S=="function"}function d(g,S,N){return g.call.apply(g.bind,arguments)}function m(g,S,N){if(!g)throw Error();if(2<arguments.length){var z=Array.prototype.slice.call(arguments,2);return function(){var ne=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ne,z),g.apply(S,ne)}}return function(){return g.apply(S,arguments)}}function v(g,S,N){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:m,v.apply(null,arguments)}function y(g,S){var N=Array.prototype.slice.call(arguments,1);return function(){var z=N.slice();return z.push.apply(z,arguments),g.apply(this,z)}}function _(g,S){function N(){}N.prototype=S.prototype,g.aa=S.prototype,g.prototype=new N,g.prototype.constructor=g,g.Qb=function(z,ne,fe){for(var Te=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)Te[dt-2]=arguments[dt];return S.prototype[ne].apply(z,Te)}}function E(g){const S=g.length;if(0<S){const N=Array(S);for(let z=0;z<S;z++)N[z]=g[z];return N}return[]}function x(g,S){for(let N=1;N<arguments.length;N++){const z=arguments[N];if(c(z)){const ne=g.length||0,fe=z.length||0;g.length=ne+fe;for(let Te=0;Te<fe;Te++)g[ne+Te]=z[Te]}else g.push(z)}}class T{constructor(S,N){this.i=S,this.j=N,this.h=0,this.g=null}get(){let S;return 0<this.h?(this.h--,S=this.g,this.g=S.next,S.next=null):S=this.i(),S}}function C(g){return/^[\s\xa0]*$/.test(g)}function A(){var g=u.navigator;return g&&(g=g.userAgent)?g:""}function R(g){return R[" "](g),g}R[" "]=function(){};var k=A().indexOf("Gecko")!=-1&&!(A().toLowerCase().indexOf("webkit")!=-1&&A().indexOf("Edge")==-1)&&!(A().indexOf("Trident")!=-1||A().indexOf("MSIE")!=-1)&&A().indexOf("Edge")==-1;function B(g,S,N){for(const z in g)S.call(N,g[z],z,g)}function P(g,S){for(const N in g)S.call(void 0,g[N],N,g)}function I(g){const S={};for(const N in g)S[N]=g[N];return S}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(g,S){let N,z;for(let ne=1;ne<arguments.length;ne++){z=arguments[ne];for(N in z)g[N]=z[N];for(let fe=0;fe<D.length;fe++)N=D[fe],Object.prototype.hasOwnProperty.call(z,N)&&(g[N]=z[N])}}function L(g){var S=1;g=g.split(":");const N=[];for(;0<S&&g.length;)N.push(g.shift()),S--;return g.length&&N.push(g.join(":")),N}function F(g){u.setTimeout(()=>{throw g},0)}function V(){var g=de;let S=null;return g.g&&(S=g.g,g.g=g.g.next,g.g||(g.h=null),S.next=null),S}class ie{constructor(){this.h=this.g=null}add(S,N){const z=se.get();z.set(S,N),this.h?this.h.next=z:this.g=z,this.h=z}}var se=new T(()=>new G,g=>g.reset());class G{constructor(){this.next=this.g=this.h=null}set(S,N){this.h=S,this.g=N,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,te=!1,de=new ie,H=()=>{const g=u.Promise.resolve(void 0);Q=()=>{g.then(ee)}};var ee=()=>{for(var g;g=V();){try{g.h.call(g.g)}catch(N){F(N)}var S=se;S.j(g),100>S.h&&(S.h++,g.next=S.g,S.g=g)}te=!1};function pe(){this.s=this.s,this.C=this.C}pe.prototype.s=!1,pe.prototype.ma=function(){this.s||(this.s=!0,this.N())},pe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ce(g,S){this.type=g,this.g=this.target=S,this.defaultPrevented=!1}ce.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var g=!1,S=Object.defineProperty({},"passive",{get:function(){g=!0}});try{const N=()=>{};u.addEventListener("test",N,S),u.removeEventListener("test",N,S)}catch{}return g}();function Se(g,S){if(ce.call(this,g?g.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,g){var N=this.type=g.type,z=g.changedTouches&&g.changedTouches.length?g.changedTouches[0]:null;if(this.target=g.target||g.srcElement,this.g=S,S=g.relatedTarget){if(k){e:{try{R(S.nodeName);var ne=!0;break e}catch{}ne=!1}ne||(S=null)}}else N=="mouseover"?S=g.fromElement:N=="mouseout"&&(S=g.toElement);this.relatedTarget=S,z?(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0):(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0),this.button=g.button,this.key=g.key||"",this.ctrlKey=g.ctrlKey,this.altKey=g.altKey,this.shiftKey=g.shiftKey,this.metaKey=g.metaKey,this.pointerId=g.pointerId||0,this.pointerType=typeof g.pointerType=="string"?g.pointerType:Ee[g.pointerType]||"",this.state=g.state,this.i=g,g.defaultPrevented&&Se.aa.h.call(this)}}_(Se,ce);var Ee={2:"touch",3:"pen",4:"mouse"};Se.prototype.h=function(){Se.aa.h.call(this);var g=this.i;g.preventDefault?g.preventDefault():g.returnValue=!1};var Ve="closure_listenable_"+(1e6*Math.random()|0),ke=0;function Ke(g,S,N,z,ne){this.listener=g,this.proxy=null,this.src=S,this.type=N,this.capture=!!z,this.ha=ne,this.key=++ke,this.da=this.fa=!1}function wt(g){g.da=!0,g.listener=null,g.proxy=null,g.src=null,g.ha=null}function Xe(g){this.src=g,this.g={},this.h=0}Xe.prototype.add=function(g,S,N,z,ne){var fe=g.toString();g=this.g[fe],g||(g=this.g[fe]=[],this.h++);var Te=tt(g,S,z,ne);return-1<Te?(S=g[Te],N||(S.fa=!1)):(S=new Ke(S,this.src,fe,!!z,ne),S.fa=N,g.push(S)),S};function lt(g,S){var N=S.type;if(N in g.g){var z=g.g[N],ne=Array.prototype.indexOf.call(z,S,void 0),fe;(fe=0<=ne)&&Array.prototype.splice.call(z,ne,1),fe&&(wt(S),g.g[N].length==0&&(delete g.g[N],g.h--))}}function tt(g,S,N,z){for(var ne=0;ne<g.length;++ne){var fe=g[ne];if(!fe.da&&fe.listener==S&&fe.capture==!!N&&fe.ha==z)return ne}return-1}var xt="closure_lm_"+(1e6*Math.random()|0),Ct={};function It(g,S,N,z,ne){if(Array.isArray(S)){for(var fe=0;fe<S.length;fe++)It(g,S[fe],N,z,ne);return null}return N=pr(N),g&&g[Ve]?g.K(S,N,h(z)?!!z.capture:!1,ne):Wt(g,S,N,!1,z,ne)}function Wt(g,S,N,z,ne,fe){if(!S)throw Error("Invalid event type");var Te=h(ne)?!!ne.capture:!!ne,dt=$n(g);if(dt||(g[xt]=dt=new Xe(g)),N=dt.add(S,N,z,Te,fe),N.proxy)return N;if(z=dr(),N.proxy=z,z.src=g,z.listener=N,g.addEventListener)xe||(ne=Te),ne===void 0&&(ne=!1),g.addEventListener(S.toString(),z,ne);else if(g.attachEvent)g.attachEvent(Fn(S.toString()),z);else if(g.addListener&&g.removeListener)g.addListener(z);else throw Error("addEventListener and attachEvent are unavailable.");return N}function dr(){function g(N){return S.call(g.src,g.listener,N)}const S=Gr;return g}function fn(g,S,N,z,ne){if(Array.isArray(S))for(var fe=0;fe<S.length;fe++)fn(g,S[fe],N,z,ne);else z=h(z)?!!z.capture:!!z,N=pr(N),g&&g[Ve]?(g=g.i,S=String(S).toString(),S in g.g&&(fe=g.g[S],N=tt(fe,N,z,ne),-1<N&&(wt(fe[N]),Array.prototype.splice.call(fe,N,1),fe.length==0&&(delete g.g[S],g.h--)))):g&&(g=$n(g))&&(S=g.g[S.toString()],g=-1,S&&(g=tt(S,N,z,ne)),(N=-1<g?S[g]:null)&&Rr(N))}function Rr(g){if(typeof g!="number"&&g&&!g.da){var S=g.src;if(S&&S[Ve])lt(S.i,g);else{var N=g.type,z=g.proxy;S.removeEventListener?S.removeEventListener(N,z,g.capture):S.detachEvent?S.detachEvent(Fn(N),z):S.addListener&&S.removeListener&&S.removeListener(z),(N=$n(S))?(lt(N,g),N.h==0&&(N.src=null,S[xt]=null)):wt(g)}}}function Fn(g){return g in Ct?Ct[g]:Ct[g]="on"+g}function Gr(g,S){if(g.da)g=!0;else{S=new Se(S,this);var N=g.listener,z=g.ha||g.src;g.fa&&Rr(g),g=N.call(z,S)}return g}function $n(g){return g=g[xt],g instanceof Xe?g:null}var Kr="__closure_events_fn_"+(1e9*Math.random()>>>0);function pr(g){return typeof g=="function"?g:(g[Kr]||(g[Kr]=function(S){return g.handleEvent(S)}),g[Kr])}function Pt(){pe.call(this),this.i=new Xe(this),this.M=this,this.F=null}_(Pt,pe),Pt.prototype[Ve]=!0,Pt.prototype.removeEventListener=function(g,S,N,z){fn(this,g,S,N,z)};function ct(g,S){var N,z=g.F;if(z)for(N=[];z;z=z.F)N.push(z);if(g=g.M,z=S.type||S,typeof S=="string")S=new ce(S,g);else if(S instanceof ce)S.target=S.target||g;else{var ne=S;S=new ce(z,g),O(S,ne)}if(ne=!0,N)for(var fe=N.length-1;0<=fe;fe--){var Te=S.g=N[fe];ne=Vt(Te,z,!0,S)&&ne}if(Te=S.g=g,ne=Vt(Te,z,!0,S)&&ne,ne=Vt(Te,z,!1,S)&&ne,N)for(fe=0;fe<N.length;fe++)Te=S.g=N[fe],ne=Vt(Te,z,!1,S)&&ne}Pt.prototype.N=function(){if(Pt.aa.N.call(this),this.i){var g=this.i,S;for(S in g.g){for(var N=g.g[S],z=0;z<N.length;z++)wt(N[z]);delete g.g[S],g.h--}}this.F=null},Pt.prototype.K=function(g,S,N,z){return this.i.add(String(g),S,!1,N,z)},Pt.prototype.L=function(g,S,N,z){return this.i.add(String(g),S,!0,N,z)};function Vt(g,S,N,z){if(S=g.i.g[String(S)],!S)return!0;S=S.concat();for(var ne=!0,fe=0;fe<S.length;++fe){var Te=S[fe];if(Te&&!Te.da&&Te.capture==N){var dt=Te.listener,pn=Te.ha||Te.src;Te.fa&&lt(g.i,Te),ne=dt.call(pn,z)!==!1&&ne}}return ne&&!z.defaultPrevented}function an(g,S,N){if(typeof g=="function")N&&(g=v(g,N));else if(g&&typeof g.handleEvent=="function")g=v(g.handleEvent,g);else throw Error("Invalid listener argument");return 2147483647<Number(S)?-1:u.setTimeout(g,S||0)}function Cu(g){g.g=an(()=>{g.g=null,g.i&&(g.i=!1,Cu(g))},g.l);const S=g.h;g.h=null,g.m.apply(null,S)}class hc extends pe{constructor(S,N){super(),this.m=S,this.l=N,this.h=null,this.i=!1,this.g=null}j(S){this.h=arguments,this.g?this.i=!0:Cu(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _a(g){pe.call(this),this.h=g,this.g={}}_(_a,pe);var fi=[];function di(g){B(g.g,function(S,N){this.g.hasOwnProperty(N)&&Rr(S)},g),g.g={}}_a.prototype.N=function(){_a.aa.N.call(this),di(this)},_a.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ur=u.JSON.stringify,Au=u.JSON.parse,_s=class{stringify(g){return u.JSON.stringify(g,void 0)}parse(g){return u.JSON.parse(g,void 0)}};function fc(){}fc.prototype.h=null;function dc(g){return g.h||(g.h=g.i())}function pc(){}var wa={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xa(){ce.call(this,"d")}_(xa,ce);function mc(){ce.call(this,"c")}_(mc,ce);var Oi={},vc=null;function fo(){return vc=vc||new Pt}Oi.La="serverreachability";function Ru(g){ce.call(this,Oi.La,g)}_(Ru,ce);function po(g){const S=fo();ct(S,new Ru(S))}Oi.STAT_EVENT="statevent";function Af(g,S){ce.call(this,Oi.STAT_EVENT,g),this.stat=S}_(Af,ce);function Ut(g){const S=fo();ct(S,new Af(S,g))}Oi.Ma="timingevent";function dn(g,S){ce.call(this,Oi.Ma,g),this.size=S}_(dn,ce);function on(g,S){if(typeof g!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){g()},S)}function Xr(){this.g=!0}Xr.prototype.xa=function(){this.g=!1};function gc(g,S,N,z,ne,fe){g.info(function(){if(g.g)if(fe)for(var Te="",dt=fe.split("&"),pn=0;pn<dt.length;pn++){var pt=dt[pn].split("=");if(1<pt.length){var In=pt[0];pt=pt[1];var mn=In.split("_");Te=2<=mn.length&&mn[1]=="type"?Te+(In+"="+pt+"&"):Te+(In+"=redacted&")}}else Te=null;else Te=fe;return"XMLHTTP REQ ("+z+") [attempt "+ne+"]: "+S+`
`+N+`
`+Te})}function hv(g,S,N,z,ne,fe,Te){g.info(function(){return"XMLHTTP RESP ("+z+") [ attempt "+ne+"]: "+S+`
`+N+`
`+fe+" "+Te})}function mo(g,S,N,z){g.info(function(){return"XMLHTTP TEXT ("+S+"): "+ws(g,N)+(z?" "+z:"")})}function Rf(g,S){g.info(function(){return"TIMEOUT: "+S})}Xr.prototype.info=function(){};function ws(g,S){if(!g.g)return S;if(!S)return null;try{var N=JSON.parse(S);if(N){for(g=0;g<N.length;g++)if(Array.isArray(N[g])){var z=N[g];if(!(2>z.length)){var ne=z[1];if(Array.isArray(ne)&&!(1>ne.length)){var fe=ne[0];if(fe!="noop"&&fe!="stop"&&fe!="close")for(var Te=1;Te<ne.length;Te++)ne[Te]=""}}}}return ur(N)}catch{return S}}var vo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ea={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Mi;function Pi(){}_(Pi,fc),Pi.prototype.g=function(){return new XMLHttpRequest},Pi.prototype.i=function(){return{}},Mi=new Pi;function lr(g,S,N,z){this.j=g,this.i=S,this.l=N,this.R=z||1,this.U=new _a(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Jt}function Jt(){this.i=null,this.g="",this.h=!1}var yc={},Iu={};function pi(g,S,N){g.L=1,g.v=Cs(Ir(S)),g.m=N,g.P=!0,Ta(g,null)}function Ta(g,S){g.F=Date.now(),xs(g),g.A=Ir(g.v);var N=g.A,z=g.R;Array.isArray(z)||(z=[String(z)]),Tc(N.i,"t",z),g.C=0,N=g.j.J,g.h=new Jt,g.g=Wf(g.j,N?S:null,!g.m),0<g.O&&(g.M=new hc(v(g.Y,g,g.g),g.O)),S=g.U,N=g.g,z=g.ca;var ne="readystatechange";Array.isArray(ne)||(ne&&(fi[0]=ne.toString()),ne=fi);for(var fe=0;fe<ne.length;fe++){var Te=It(N,ne[fe],z||S.handleEvent,!1,S.h||S);if(!Te)break;S.g[Te.key]=Te}S=g.H?I(g.H):{},g.m?(g.u||(g.u="POST"),S["Content-Type"]="application/x-www-form-urlencoded",g.g.ea(g.A,g.u,g.m,S)):(g.u="GET",g.g.ea(g.A,g.u,null,S)),po(),gc(g.i,g.u,g.A,g.l,g.R,g.m)}lr.prototype.ca=function(g){g=g.target;const S=this.M;S&&Zr(g)==3?S.j():this.Y(g)},lr.prototype.Y=function(g){try{if(g==this.g)e:{const mn=Zr(this.g);var S=this.g.Ba();const ka=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||Lf(this.g)))){this.J||mn!=4||S==7||(S==8||0>=ka?po(3):po(2)),go(this);var N=this.g.Z();this.X=N;t:if(If(this)){var z=Lf(this.g);g="";var ne=z.length,fe=Zr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Bn(this),Li(this);var Te="";break t}this.h.i=new u.TextDecoder}for(S=0;S<ne;S++)this.h.h=!0,g+=this.h.i.decode(z[S],{stream:!(fe&&S==ne-1)});z.length=0,this.h.g+=g,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=N==200,hv(this.i,this.u,this.A,this.l,this.R,mn,N),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,pn=this.g;if((dt=pn.g?pn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(dt)){var pt=dt;break t}}pt=null}if(N=pt)mo(this.i,this.l,N,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Es(this,N);else{this.o=!1,this.s=3,Ut(12),Bn(this),Li(this);break e}}if(this.P){N=!0;let Vn;for(;!this.J&&this.C<Te.length;)if(Vn=Df(this,Te),Vn==Iu){mn==4&&(this.s=4,Ut(14),N=!1),mo(this.i,this.l,null,"[Incomplete Response]");break}else if(Vn==yc){this.s=4,Ut(15),mo(this.i,this.l,Te,"[Invalid Chunk]"),N=!1;break}else mo(this.i,this.l,Vn,null),Es(this,Vn);if(If(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||Te.length!=0||this.h.h||(this.s=1,Ut(16),N=!1),this.o=this.o&&N,!N)mo(this.i,this.l,Te,"[Invalid Chunked Response]"),Bn(this),Li(this);else if(0<Te.length&&!this.W){this.W=!0;var In=this.j;In.g==this&&In.ba&&!In.M&&(In.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),Ms(In),In.M=!0,Ut(11))}}else mo(this.i,this.l,Te,null),Es(this,Te);mn==4&&Bn(this),this.o&&!this.J&&(mn==4?zf(this.j,this):(this.o=!1,xs(this)))}else vv(this.g),N==400&&0<Te.indexOf("Unknown SID")?(this.s=3,Ut(12)):(this.s=0,Ut(13)),Bn(this),Li(this)}}}catch{}finally{}};function If(g){return g.g?g.u=="GET"&&g.L!=2&&g.j.Ca:!1}function Df(g,S){var N=g.C,z=S.indexOf(`
`,N);return z==-1?Iu:(N=Number(S.substring(N,z)),isNaN(N)?yc:(z+=1,z+N>S.length?Iu:(S=S.slice(z,z+N),g.C=z+N,S)))}lr.prototype.cancel=function(){this.J=!0,Bn(this)};function xs(g){g.S=Date.now()+g.I,Nf(g,g.I)}function Nf(g,S){if(g.B!=null)throw Error("WatchDog timer not null");g.B=on(v(g.ba,g),S)}function go(g){g.B&&(u.clearTimeout(g.B),g.B=null)}lr.prototype.ba=function(){this.B=null;const g=Date.now();0<=g-this.S?(Rf(this.i,this.A),this.L!=2&&(po(),Ut(17)),Bn(this),this.s=2,Li(this)):Nf(this,this.S-g)};function Li(g){g.j.G==0||g.J||zf(g.j,g)}function Bn(g){go(g);var S=g.M;S&&typeof S.ma=="function"&&S.ma(),g.M=null,di(g.U),g.g&&(S=g.g,g.g=null,S.abort(),S.ma())}function Es(g,S){try{var N=g.j;if(N.G!=0&&(N.g==g||bc(N.h,g))){if(!g.K&&bc(N.h,g)&&N.G==3){try{var z=N.Da.g.parse(S)}catch{z=null}if(Array.isArray(z)&&z.length==3){var ne=z;if(ne[0]==0){e:if(!N.u){if(N.g)if(N.g.F+3e3<g.F)zu(N),Vu(N);else break e;Ic(N),Ut(18)}}else N.za=ne[1],0<N.za-N.T&&37500>ne[2]&&N.F&&N.v==0&&!N.C&&(N.C=on(v(N.Za,N),6e3));if(1>=Nu(N.h)&&N.ca){try{N.ca()}catch{}N.ca=void 0}}else Na(N,11)}else if((g.K||N.g==g)&&zu(N),!C(S))for(ne=N.Da.g.parse(S),S=0;S<ne.length;S++){let pt=ne[S];if(N.T=pt[0],pt=pt[1],N.G==2)if(pt[0]=="c"){N.K=pt[1],N.ia=pt[2];const In=pt[3];In!=null&&(N.la=In,N.j.info("VER="+N.la));const mn=pt[4];mn!=null&&(N.Aa=mn,N.j.info("SVER="+N.Aa));const ka=pt[5];ka!=null&&typeof ka=="number"&&0<ka&&(z=1.5*ka,N.L=z,N.j.info("backChannelRequestTimeoutMs_="+z)),z=N;const Vn=g.g;if(Vn){const Hi=Vn.g?Vn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hi){var fe=z.h;fe.g||Hi.indexOf("spdy")==-1&&Hi.indexOf("quic")==-1&&Hi.indexOf("h2")==-1||(fe.j=fe.l,fe.g=new Set,fe.h&&(ku(fe,fe.h),fe.h=null))}if(z.D){const Nc=Vn.g?Vn.g.getResponseHeader("X-HTTP-Session-Id"):null;Nc&&(z.ya=Nc,Dt(z.I,z.D,Nc))}}N.G=3,N.l&&N.l.ua(),N.ba&&(N.R=Date.now()-g.F,N.j.info("Handshake RTT: "+N.R+"ms")),z=N;var Te=g;if(z.qa=Hf(z,z.J?z.ia:null,z.W),Te.K){cr(z.h,Te);var dt=Te,pn=z.L;pn&&(dt.I=pn),dt.B&&(go(dt),xs(dt)),z.g=Te}else Vf(z);0<N.i.length&&Uu(N)}else pt[0]!="stop"&&pt[0]!="close"||Na(N,7);else N.G==3&&(pt[0]=="stop"||pt[0]=="close"?pt[0]=="stop"?Na(N,7):Ac(N):pt[0]!="noop"&&N.l&&N.l.ta(pt),N.v=0)}}po(4)}catch{}}var kf=class{constructor(g,S){this.g=g,this.map=S}};function Sa(g){this.l=g||10,u.PerformanceNavigationTiming?(g=u.performance.getEntriesByType("navigation"),g=0<g.length&&(g[0].nextHopProtocol=="hq"||g[0].nextHopProtocol=="h2")):g=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=g?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Du(g){return g.h?!0:g.g?g.g.size>=g.j:!1}function Nu(g){return g.h?1:g.g?g.g.size:0}function bc(g,S){return g.h?g.h==S:g.g?g.g.has(S):!1}function ku(g,S){g.g?g.g.add(S):g.h=S}function cr(g,S){g.h&&g.h==S?g.h=null:g.g&&g.g.has(S)&&g.g.delete(S)}Sa.prototype.cancel=function(){if(this.i=_c(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const g of this.g.values())g.cancel();this.g.clear()}};function _c(g){if(g.h!=null)return g.i.concat(g.h.D);if(g.g!=null&&g.g.size!==0){let S=g.i;for(const N of g.g.values())S=S.concat(N.D);return S}return E(g.i)}function fv(g){if(g.V&&typeof g.V=="function")return g.V();if(typeof Map<"u"&&g instanceof Map||typeof Set<"u"&&g instanceof Set)return Array.from(g.values());if(typeof g=="string")return g.split("");if(c(g)){for(var S=[],N=g.length,z=0;z<N;z++)S.push(g[z]);return S}S=[],N=0;for(z in g)S[N++]=g[z];return S}function Ou(g){if(g.na&&typeof g.na=="function")return g.na();if(!g.V||typeof g.V!="function"){if(typeof Map<"u"&&g instanceof Map)return Array.from(g.keys());if(!(typeof Set<"u"&&g instanceof Set)){if(c(g)||typeof g=="string"){var S=[];g=g.length;for(var N=0;N<g;N++)S.push(N);return S}S=[],N=0;for(const z in g)S[N++]=z;return S}}}function wc(g,S){if(g.forEach&&typeof g.forEach=="function")g.forEach(S,void 0);else if(c(g)||typeof g=="string")Array.prototype.forEach.call(g,S,void 0);else for(var N=Ou(g),z=fv(g),ne=z.length,fe=0;fe<ne;fe++)S.call(void 0,z[fe],N&&N[fe],g)}var Ts=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dv(g,S){if(g){g=g.split("&");for(var N=0;N<g.length;N++){var z=g[N].indexOf("="),ne=null;if(0<=z){var fe=g[N].substring(0,z);ne=g[N].substring(z+1)}else fe=g[N];S(fe,ne?decodeURIComponent(ne.replace(/\+/g," ")):"")}}}function sn(g){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,g instanceof sn){this.h=g.h,Ss(this,g.j),this.o=g.o,this.g=g.g,yo(this,g.s),this.l=g.l;var S=g.i,N=new Aa;N.i=S.i,S.g&&(N.g=new Map(S.g),N.h=S.h),Ca(this,N),this.m=g.m}else g&&(S=String(g).match(Ts))?(this.h=!1,Ss(this,S[1]||"",!0),this.o=$r(S[2]||""),this.g=$r(S[3]||"",!0),yo(this,S[4]),this.l=$r(S[5]||"",!0),Ca(this,S[6]||"",!0),this.m=$r(S[7]||"")):(this.h=!1,this.i=new Aa(null,this.h))}sn.prototype.toString=function(){var g=[],S=this.j;S&&g.push(As(S,xc,!0),":");var N=this.g;return(N||S=="file")&&(g.push("//"),(S=this.o)&&g.push(As(S,xc,!0),"@"),g.push(encodeURIComponent(String(N)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N=this.s,N!=null&&g.push(":",String(N))),(N=this.l)&&(this.g&&N.charAt(0)!="/"&&g.push("/"),g.push(As(N,N.charAt(0)=="/"?pv:Ec,!0))),(N=this.i.toString())&&g.push("?",N),(N=this.m)&&g.push("#",As(N,Mu)),g.join("")};function Ir(g){return new sn(g)}function Ss(g,S,N){g.j=N?$r(S,!0):S,g.j&&(g.j=g.j.replace(/:$/,""))}function yo(g,S){if(S){if(S=Number(S),isNaN(S)||0>S)throw Error("Bad port number "+S);g.s=S}else g.s=null}function Ca(g,S,N){S instanceof Aa?(g.i=S,Mf(g.i,g.h)):(N||(S=As(S,mv)),g.i=new Aa(S,g.h))}function Dt(g,S,N){g.i.set(S,N)}function Cs(g){return Dt(g,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),g}function $r(g,S){return g?S?decodeURI(g.replace(/%25/g,"%2525")):decodeURIComponent(g):""}function As(g,S,N){return typeof g=="string"?(g=encodeURI(g).replace(S,Of),N&&(g=g.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g):null}function Of(g){return g=g.charCodeAt(0),"%"+(g>>4&15).toString(16)+(g&15).toString(16)}var xc=/[#\/\?@]/g,Ec=/[#\?:]/g,pv=/[#\?]/g,mv=/[#\?@]/g,Mu=/#/g;function Aa(g,S){this.h=this.g=null,this.i=g||null,this.j=!!S}function Yr(g){g.g||(g.g=new Map,g.h=0,g.i&&dv(g.i,function(S,N){g.add(decodeURIComponent(S.replace(/\+/g," ")),N)}))}r=Aa.prototype,r.add=function(g,S){Yr(this),this.i=null,g=Fi(this,g);var N=this.g.get(g);return N||this.g.set(g,N=[]),N.push(S),this.h+=1,this};function Ra(g,S){Yr(g),S=Fi(g,S),g.g.has(S)&&(g.i=null,g.h-=g.g.get(S).length,g.g.delete(S))}function Ia(g,S){return Yr(g),S=Fi(g,S),g.g.has(S)}r.forEach=function(g,S){Yr(this),this.g.forEach(function(N,z){N.forEach(function(ne){g.call(S,ne,z,this)},this)},this)},r.na=function(){Yr(this);const g=Array.from(this.g.values()),S=Array.from(this.g.keys()),N=[];for(let z=0;z<S.length;z++){const ne=g[z];for(let fe=0;fe<ne.length;fe++)N.push(S[z])}return N},r.V=function(g){Yr(this);let S=[];if(typeof g=="string")Ia(this,g)&&(S=S.concat(this.g.get(Fi(this,g))));else{g=Array.from(this.g.values());for(let N=0;N<g.length;N++)S=S.concat(g[N])}return S},r.set=function(g,S){return Yr(this),this.i=null,g=Fi(this,g),Ia(this,g)&&(this.h-=this.g.get(g).length),this.g.set(g,[S]),this.h+=1,this},r.get=function(g,S){return g?(g=this.V(g),0<g.length?String(g[0]):S):S};function Tc(g,S,N){Ra(g,S),0<N.length&&(g.i=null,g.g.set(Fi(g,S),E(N)),g.h+=N.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const g=[],S=Array.from(this.g.keys());for(var N=0;N<S.length;N++){var z=S[N];const fe=encodeURIComponent(String(z)),Te=this.V(z);for(z=0;z<Te.length;z++){var ne=fe;Te[z]!==""&&(ne+="="+encodeURIComponent(String(Te[z]))),g.push(ne)}}return this.i=g.join("&")};function Fi(g,S){return S=String(S),g.j&&(S=S.toLowerCase()),S}function Mf(g,S){S&&!g.j&&(Yr(g),g.i=null,g.g.forEach(function(N,z){var ne=z.toLowerCase();z!=ne&&(Ra(this,z),Tc(this,ne,N))},g)),g.j=S}function Rs(g,S){const N=new Xr;if(u.Image){const z=new Image;z.onload=y(Qr,N,"TestLoadImage: loaded",!0,S,z),z.onerror=y(Qr,N,"TestLoadImage: error",!1,S,z),z.onabort=y(Qr,N,"TestLoadImage: abort",!1,S,z),z.ontimeout=y(Qr,N,"TestLoadImage: timeout",!1,S,z),u.setTimeout(function(){z.ontimeout&&z.ontimeout()},1e4),z.src=g}else S(!1)}function mi(g,S){const N=new Xr,z=new AbortController,ne=setTimeout(()=>{z.abort(),Qr(N,"TestPingServer: timeout",!1,S)},1e4);fetch(g,{signal:z.signal}).then(fe=>{clearTimeout(ne),fe.ok?Qr(N,"TestPingServer: ok",!0,S):Qr(N,"TestPingServer: server error",!1,S)}).catch(()=>{clearTimeout(ne),Qr(N,"TestPingServer: error",!1,S)})}function Qr(g,S,N,z,ne){try{ne&&(ne.onload=null,ne.onerror=null,ne.onabort=null,ne.ontimeout=null),z(N)}catch{}}function Is(){this.g=new _s}function Bi(g,S,N){const z=N||"";try{wc(g,function(ne,fe){let Te=ne;h(ne)&&(Te=ur(ne)),S.push(z+fe+"="+encodeURIComponent(Te))})}catch(ne){throw S.push(z+"type="+encodeURIComponent("_badmap")),ne}}function bo(g){this.l=g.Ub||null,this.j=g.eb||!1}_(bo,fc),bo.prototype.g=function(){return new Da(this.l,this.j)},bo.prototype.i=function(g){return function(){return g}}({});function Da(g,S){Pt.call(this),this.D=g,this.o=S,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(Da,Pt),r=Da.prototype,r.open=function(g,S){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=g,this.A=S,this.readyState=1,Ui(this)},r.send=function(g){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const S={headers:this.u,method:this.B,credentials:this.m,cache:void 0};g&&(S.body=g),(this.D||u).fetch(new Request(this.A,S)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Vi(this)),this.readyState=0},r.Sa=function(g){if(this.g&&(this.l=g,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=g.headers,this.readyState=2,Ui(this)),this.g&&(this.readyState=3,Ui(this),this.g)))if(this.responseType==="arraybuffer")g.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in g){if(this.j=g.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Sc(this)}else g.text().then(this.Ra.bind(this),this.ga.bind(this))};function Sc(g){g.j.read().then(g.Pa.bind(g)).catch(g.ga.bind(g))}r.Pa=function(g){if(this.g){if(this.o&&g.value)this.response.push(g.value);else if(!this.o){var S=g.value?g.value:new Uint8Array(0);(S=this.v.decode(S,{stream:!g.done}))&&(this.response=this.responseText+=S)}g.done?Vi(this):Ui(this),this.readyState==3&&Sc(this)}},r.Ra=function(g){this.g&&(this.response=this.responseText=g,Vi(this))},r.Qa=function(g){this.g&&(this.response=g,Vi(this))},r.ga=function(){this.g&&Vi(this)};function Vi(g){g.readyState=4,g.l=null,g.j=null,g.v=null,Ui(g)}r.setRequestHeader=function(g,S){this.u.append(g,S)},r.getResponseHeader=function(g){return this.h&&this.h.get(g.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const g=[],S=this.h.entries();for(var N=S.next();!N.done;)N=N.value,g.push(N[0]+": "+N[1]),N=S.next();return g.join(`\r
`)};function Ui(g){g.onreadystatechange&&g.onreadystatechange.call(g)}Object.defineProperty(Da.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(g){this.m=g?"include":"same-origin"}});function Cc(g){let S="";return B(g,function(N,z){S+=z,S+=":",S+=N,S+=`\r
`}),S}function Rn(g,S,N){e:{for(z in N){var z=!1;break e}z=!0}z||(N=Cc(N),typeof g=="string"?N!=null&&encodeURIComponent(String(N)):Dt(g,S,N))}function Et(g){Pt.call(this),this.headers=new Map,this.o=g||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(Et,Pt);var Pu=/^https?$/i,Ds=["POST","PUT"];r=Et.prototype,r.Ha=function(g){this.J=g},r.ea=function(g,S,N,z){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+g);S=S?S.toUpperCase():"GET",this.D=g,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Mi.g(),this.v=this.o?dc(this.o):dc(Mi),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(S,String(g),!0),this.B=!1}catch(fe){Pf(this,fe);return}if(g=N||"",N=new Map(this.headers),z)if(Object.getPrototypeOf(z)===Object.prototype)for(var ne in z)N.set(ne,z[ne]);else if(typeof z.keys=="function"&&typeof z.get=="function")for(const fe of z.keys())N.set(fe,z.get(fe));else throw Error("Unknown input type for opt_headers: "+String(z));z=Array.from(N.keys()).find(fe=>fe.toLowerCase()=="content-type"),ne=u.FormData&&g instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Ds,S,void 0))||z||ne||N.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[fe,Te]of N)this.g.setRequestHeader(fe,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ns(this),this.u=!0,this.g.send(g),this.u=!1}catch(fe){Pf(this,fe)}};function Pf(g,S){g.h=!1,g.g&&(g.j=!0,g.g.abort(),g.j=!1),g.l=S,g.m=5,Lu(g),zi(g)}function Lu(g){g.A||(g.A=!0,ct(g,"complete"),ct(g,"error"))}r.abort=function(g){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=g||7,ct(this,"complete"),ct(this,"abort"),zi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zi(this,!0)),Et.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Fu(this):this.bb())},r.bb=function(){Fu(this)};function Fu(g){if(g.h&&typeof s<"u"&&(!g.v[1]||Zr(g)!=4||g.Z()!=2)){if(g.u&&Zr(g)==4)an(g.Ea,0,g);else if(ct(g,"readystatechange"),Zr(g)==4){g.h=!1;try{const Te=g.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var S=!0;break e;default:S=!1}var N;if(!(N=S)){var z;if(z=Te===0){var ne=String(g.D).match(Ts)[1]||null;!ne&&u.self&&u.self.location&&(ne=u.self.location.protocol.slice(0,-1)),z=!Pu.test(ne?ne.toLowerCase():"")}N=z}if(N)ct(g,"complete"),ct(g,"success");else{g.m=6;try{var fe=2<Zr(g)?g.g.statusText:""}catch{fe=""}g.l=fe+" ["+g.Z()+"]",Lu(g)}}finally{zi(g)}}}}function zi(g,S){if(g.g){Ns(g);const N=g.g,z=g.v[0]?()=>{}:null;g.g=null,g.v=null,S||ct(g,"ready");try{N.onreadystatechange=z}catch{}}}function Ns(g){g.I&&(u.clearTimeout(g.I),g.I=null)}r.isActive=function(){return!!this.g};function Zr(g){return g.g?g.g.readyState:0}r.Z=function(){try{return 2<Zr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(g){if(this.g){var S=this.g.responseText;return g&&S.indexOf(g)==0&&(S=S.substring(g.length)),Au(S)}};function Lf(g){try{if(!g.g)return null;if("response"in g.g)return g.g.response;switch(g.H){case"":case"text":return g.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in g.g)return g.g.mozResponseArrayBuffer}return null}catch{return null}}function vv(g){const S={};g=(g.g&&2<=Zr(g)&&g.g.getAllResponseHeaders()||"").split(`\r
`);for(let z=0;z<g.length;z++){if(C(g[z]))continue;var N=L(g[z]);const ne=N[0];if(N=N[1],typeof N!="string")continue;N=N.trim();const fe=S[ne]||[];S[ne]=fe,fe.push(N)}P(S,function(z){return z.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ks(g,S,N){return N&&N.internalChannelParams&&N.internalChannelParams[g]||S}function Bu(g){this.Aa=0,this.i=[],this.j=new Xr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ks("failFast",!1,g),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ks("baseRetryDelayMs",5e3,g),this.cb=ks("retryDelaySeedMs",1e4,g),this.Wa=ks("forwardChannelMaxRetries",2,g),this.wa=ks("forwardChannelRequestTimeoutMs",2e4,g),this.pa=g&&g.xmlHttpFactory||void 0,this.Xa=g&&g.Tb||void 0,this.Ca=g&&g.useFetchStreams||!1,this.L=void 0,this.J=g&&g.supportsCrossDomainXhr||!1,this.K="",this.h=new Sa(g&&g.concurrentRequestLimit),this.Da=new Is,this.P=g&&g.fastHandshake||!1,this.O=g&&g.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=g&&g.Rb||!1,g&&g.xa&&this.j.xa(),g&&g.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&g&&g.detectBufferingProxy||!1,this.ja=void 0,g&&g.longPollingTimeout&&0<g.longPollingTimeout&&(this.ja=g.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Bu.prototype,r.la=8,r.G=1,r.connect=function(g,S,N,z){Ut(0),this.W=g,this.H=S||{},N&&z!==void 0&&(this.H.OSID=N,this.H.OAID=z),this.F=this.X,this.I=Hf(this,null,this.W),Uu(this)};function Ac(g){if(Ff(g),g.G==3){var S=g.U++,N=Ir(g.I);if(Dt(N,"SID",g.K),Dt(N,"RID",S),Dt(N,"TYPE","terminate"),Os(g,N),S=new lr(g,g.j,S),S.L=2,S.v=Cs(Ir(N)),N=!1,u.navigator&&u.navigator.sendBeacon)try{N=u.navigator.sendBeacon(S.v.toString(),"")}catch{}!N&&u.Image&&(new Image().src=S.v,N=!0),N||(S.g=Wf(S.j,null),S.g.ea(S.v)),S.F=Date.now(),xs(S)}jf(g)}function Vu(g){g.g&&(Ms(g),g.g.cancel(),g.g=null)}function Ff(g){Vu(g),g.u&&(u.clearTimeout(g.u),g.u=null),zu(g),g.h.cancel(),g.s&&(typeof g.s=="number"&&u.clearTimeout(g.s),g.s=null)}function Uu(g){if(!Du(g.h)&&!g.s){g.s=!0;var S=g.Ga;Q||H(),te||(Q(),te=!0),de.add(S,g),g.B=0}}function gv(g,S){return Nu(g.h)>=g.h.j-(g.s?1:0)?!1:g.s?(g.i=S.D.concat(g.i),!0):g.G==1||g.G==2||g.B>=(g.Va?0:g.Wa)?!1:(g.s=on(v(g.Ga,g,S),Dc(g,g.B)),g.B++,!0)}r.Ga=function(g){if(this.s)if(this.s=null,this.G==1){if(!g){this.U=Math.floor(1e5*Math.random()),g=this.U++;const ne=new lr(this,this.j,g);let fe=this.o;if(this.S&&(fe?(fe=I(fe),O(fe,this.S)):fe=this.S),this.m!==null||this.O||(ne.H=fe,fe=null),this.P)e:{for(var S=0,N=0;N<this.i.length;N++){t:{var z=this.i[N];if("__data__"in z.map&&(z=z.map.__data__,typeof z=="string")){z=z.length;break t}z=void 0}if(z===void 0)break;if(S+=z,4096<S){S=N;break e}if(S===4096||N===this.i.length-1){S=N+1;break e}}S=1e3}else S=1e3;S=Bf(this,ne,S),N=Ir(this.I),Dt(N,"RID",g),Dt(N,"CVER",22),this.D&&Dt(N,"X-HTTP-Session-Id",this.D),Os(this,N),fe&&(this.O?S="headers="+encodeURIComponent(String(Cc(fe)))+"&"+S:this.m&&Rn(N,this.m,fe)),ku(this.h,ne),this.Ua&&Dt(N,"TYPE","init"),this.P?(Dt(N,"$req",S),Dt(N,"SID","null"),ne.T=!0,pi(ne,N,null)):pi(ne,N,S),this.G=2}}else this.G==3&&(g?Rc(this,g):this.i.length==0||Du(this.h)||Rc(this))};function Rc(g,S){var N;S?N=S.l:N=g.U++;const z=Ir(g.I);Dt(z,"SID",g.K),Dt(z,"RID",N),Dt(z,"AID",g.T),Os(g,z),g.m&&g.o&&Rn(z,g.m,g.o),N=new lr(g,g.j,N,g.B+1),g.m===null&&(N.H=g.o),S&&(g.i=S.D.concat(g.i)),S=Bf(g,N,1e3),N.I=Math.round(.5*g.wa)+Math.round(.5*g.wa*Math.random()),ku(g.h,N),pi(N,z,S)}function Os(g,S){g.H&&B(g.H,function(N,z){Dt(S,z,N)}),g.l&&wc({},function(N,z){Dt(S,z,N)})}function Bf(g,S,N){N=Math.min(g.i.length,N);var z=g.l?v(g.l.Na,g.l,g):null;e:{var ne=g.i;let fe=-1;for(;;){const Te=["count="+N];fe==-1?0<N?(fe=ne[0].g,Te.push("ofs="+fe)):fe=0:Te.push("ofs="+fe);let dt=!0;for(let pn=0;pn<N;pn++){let pt=ne[pn].g;const In=ne[pn].map;if(pt-=fe,0>pt)fe=Math.max(0,ne[pn].g-100),dt=!1;else try{Bi(In,Te,"req"+pt+"_")}catch{z&&z(In)}}if(dt){z=Te.join("&");break e}}}return g=g.i.splice(0,N),S.D=g,z}function Vf(g){if(!g.g&&!g.u){g.Y=1;var S=g.Fa;Q||H(),te||(Q(),te=!0),de.add(S,g),g.v=0}}function Ic(g){return g.g||g.u||3<=g.v?!1:(g.Y++,g.u=on(v(g.Fa,g),Dc(g,g.v)),g.v++,!0)}r.Fa=function(){if(this.u=null,Uf(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var g=2*this.R;this.j.info("BP detection timer enabled: "+g),this.A=on(v(this.ab,this),g)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ut(10),Vu(this),Uf(this))};function Ms(g){g.A!=null&&(u.clearTimeout(g.A),g.A=null)}function Uf(g){g.g=new lr(g,g.j,"rpc",g.Y),g.m===null&&(g.g.H=g.o),g.g.O=0;var S=Ir(g.qa);Dt(S,"RID","rpc"),Dt(S,"SID",g.K),Dt(S,"AID",g.T),Dt(S,"CI",g.F?"0":"1"),!g.F&&g.ja&&Dt(S,"TO",g.ja),Dt(S,"TYPE","xmlhttp"),Os(g,S),g.m&&g.o&&Rn(S,g.m,g.o),g.L&&(g.g.I=g.L);var N=g.g;g=g.ia,N.L=1,N.v=Cs(Ir(S)),N.m=null,N.P=!0,Ta(N,g)}r.Za=function(){this.C!=null&&(this.C=null,Vu(this),Ic(this),Ut(19))};function zu(g){g.C!=null&&(u.clearTimeout(g.C),g.C=null)}function zf(g,S){var N=null;if(g.g==S){zu(g),Ms(g),g.g=null;var z=2}else if(bc(g.h,S))N=S.D,cr(g.h,S),z=1;else return;if(g.G!=0){if(S.o)if(z==1){N=S.m?S.m.length:0,S=Date.now()-S.F;var ne=g.B;z=fo(),ct(z,new dn(z,N)),Uu(g)}else Vf(g);else if(ne=S.s,ne==3||ne==0&&0<S.X||!(z==1&&gv(g,S)||z==2&&Ic(g)))switch(N&&0<N.length&&(S=g.h,S.i=S.i.concat(N)),ne){case 1:Na(g,5);break;case 4:Na(g,10);break;case 3:Na(g,6);break;default:Na(g,2)}}}function Dc(g,S){let N=g.Ta+Math.floor(Math.random()*g.cb);return g.isActive()||(N*=2),N*S}function Na(g,S){if(g.j.info("Error code "+S),S==2){var N=v(g.fb,g),z=g.Xa;const ne=!z;z=new sn(z||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ss(z,"https"),Cs(z),ne?Rs(z.toString(),N):mi(z.toString(),N)}else Ut(2);g.G=0,g.l&&g.l.sa(S),jf(g),Ff(g)}r.fb=function(g){g?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function jf(g){if(g.G=0,g.ka=[],g.l){const S=_c(g.h);(S.length!=0||g.i.length!=0)&&(x(g.ka,S),x(g.ka,g.i),g.h.i.length=0,E(g.i),g.i.length=0),g.l.ra()}}function Hf(g,S,N){var z=N instanceof sn?Ir(N):new sn(N);if(z.g!="")S&&(z.g=S+"."+z.g),yo(z,z.s);else{var ne=u.location;z=ne.protocol,S=S?S+"."+ne.hostname:ne.hostname,ne=+ne.port;var fe=new sn(null);z&&Ss(fe,z),S&&(fe.g=S),ne&&yo(fe,ne),N&&(fe.l=N),z=fe}return N=g.D,S=g.ya,N&&S&&Dt(z,N,S),Dt(z,"VER",g.la),Os(g,z),z}function Wf(g,S,N){if(S&&!g.J)throw Error("Can't create secondary domain capable XhrIo object.");return S=g.Ca&&!g.pa?new Et(new bo({eb:N})):new Et(g.pa),S.Ha(g.J),S}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function qf(){}r=qf.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function ju(){}ju.prototype.g=function(g,S){return new hr(g,S)};function hr(g,S){Pt.call(this),this.g=new Bu(S),this.l=g,this.h=S&&S.messageUrlParams||null,g=S&&S.messageHeaders||null,S&&S.clientProtocolHeaderRequired&&(g?g["X-Client-Protocol"]="webchannel":g={"X-Client-Protocol":"webchannel"}),this.g.o=g,g=S&&S.initMessageHeaders||null,S&&S.messageContentType&&(g?g["X-WebChannel-Content-Type"]=S.messageContentType:g={"X-WebChannel-Content-Type":S.messageContentType}),S&&S.va&&(g?g["X-WebChannel-Client-Profile"]=S.va:g={"X-WebChannel-Client-Profile":S.va}),this.g.S=g,(g=S&&S.Sb)&&!C(g)&&(this.g.m=g),this.v=S&&S.supportsCrossDomainXhr||!1,this.u=S&&S.sendRawJson||!1,(S=S&&S.httpSessionIdParam)&&!C(S)&&(this.g.D=S,g=this.h,g!==null&&S in g&&(g=this.h,S in g&&delete g[S])),this.j=new ji(this)}_(hr,Pt),hr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hr.prototype.close=function(){Ac(this.g)},hr.prototype.o=function(g){var S=this.g;if(typeof g=="string"){var N={};N.__data__=g,g=N}else this.u&&(N={},N.__data__=ur(g),g=N);S.i.push(new kf(S.Ya++,g)),S.G==3&&Uu(S)},hr.prototype.N=function(){this.g.l=null,delete this.j,Ac(this.g),delete this.g,hr.aa.N.call(this)};function Gf(g){xa.call(this),g.__headers__&&(this.headers=g.__headers__,this.statusCode=g.__status__,delete g.__headers__,delete g.__status__);var S=g.__sm__;if(S){e:{for(const N in S){g=N;break e}g=void 0}(this.i=g)&&(g=this.i,S=S!==null&&g in S?S[g]:void 0),this.data=S}else this.data=g}_(Gf,xa);function Kf(){mc.call(this),this.status=1}_(Kf,mc);function ji(g){this.g=g}_(ji,qf),ji.prototype.ua=function(){ct(this.g,"a")},ji.prototype.ta=function(g){ct(this.g,new Gf(g))},ji.prototype.sa=function(g){ct(this.g,new Kf)},ji.prototype.ra=function(){ct(this.g,"b")},ju.prototype.createWebChannel=ju.prototype.g,hr.prototype.send=hr.prototype.o,hr.prototype.open=hr.prototype.m,hr.prototype.close=hr.prototype.close,nA=function(){return new ju},tA=function(){return fo()},eA=Oi,m0={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},vo.NO_ERROR=0,vo.TIMEOUT=8,vo.HTTP_ERROR=6,Ep=vo,Ea.COMPLETE="complete",JC=Ea,pc.EventType=wa,wa.OPEN="a",wa.CLOSE="b",wa.ERROR="c",wa.MESSAGE="d",Pt.prototype.listen=Pt.prototype.K,Ah=pc,Et.prototype.listenOnce=Et.prototype.L,Et.prototype.getLastError=Et.prototype.Ka,Et.prototype.getLastErrorCode=Et.prototype.Ba,Et.prototype.getStatus=Et.prototype.Z,Et.prototype.getResponseJson=Et.prototype.Oa,Et.prototype.getResponseText=Et.prototype.oa,Et.prototype.send=Et.prototype.ea,Et.prototype.setWithCredentials=Et.prototype.Ha,ZC=Et}).apply(typeof Yd<"u"?Yd:typeof self<"u"?self:typeof window<"u"?window:{});const E2="@firebase/firestore",T2="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Jn.UNAUTHENTICATED=new Jn(null),Jn.GOOGLE_CREDENTIALS=new Jn("google-credentials-uid"),Jn.FIRST_PARTY=new Jn("first-party-uid"),Jn.MOCK_USER=new Jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ic="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=new Cm("@firebase/firestore");function wl(){return fu.logLevel}function Ae(r,...e){if(fu.logLevel<=ht.DEBUG){const t=e.map(Ab);fu.debug(`Firestore (${ic}): ${r}`,...t)}}function ro(r,...e){if(fu.logLevel<=ht.ERROR){const t=e.map(Ab);fu.error(`Firestore (${ic}): ${r}`,...t)}}function zl(r,...e){if(fu.logLevel<=ht.WARN){const t=e.map(Ab);fu.warn(`Firestore (${ic}): ${r}`,...t)}}function Ab(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qe(r="Unexpected state"){const e=`FIRESTORE (${ic}) INTERNAL ASSERTION FAILED: `+r;throw ro(e),new Error(e)}function Tt(r,e){r||qe()}function Ze(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends Di{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class CF{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Jn.UNAUTHENTICATED))}shutdown(){}}class AF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class RF{constructor(e){this.t=e,this.currentUser=Jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Tt(this.o===void 0);let n=this.i;const i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve();let a=new Ja;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ja,e.enqueueRetryable(()=>i(this.currentUser))};const s=()=>{const c=a;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},u=c=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ja)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Tt(typeof n.accessToken=="string"),new rA(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Tt(e===null||typeof e=="string"),new Jn(e)}}class IF{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Jn.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class DF{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new IF(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class S2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class NF{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Vr(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){Tt(this.o===void 0);const n=a=>{a.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const s=a.token!==this.R;return this.R=a.token,Ae("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>n(a))};const i=a=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.A.getImmediate({optional:!0});a?i(a):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new S2(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Tt(typeof t.token=="string"),this.R=t.token,new S2(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iA(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=kF(40);for(let a=0;a<i.length;++a)n.length<20&&i[a]<t&&(n+=e.charAt(i[a]%62))}return n}}function rt(r,e){return r<e?-1:r>e?1:0}function v0(r,e){let t=0;for(;t<r.length&&t<e.length;){const n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return rt(n,i);{const a=iA(),s=OF(a.encode(C2(r,t)),a.encode(C2(e,t)));return s!==0?s:rt(n,i)}}t+=n>65535?2:1}return rt(r.length,e.length)}function C2(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function OF(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return rt(r[t],e[t]);return rt(r.length,e.length)}function jl(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2=-62135596800,R2=1e6;class _n{static now(){return _n.fromMillis(Date.now())}static fromDate(e){return _n.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*R2);return new _n(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Be(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Be(we.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<A2)throw new Be(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Be(we.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/R2}_compareTo(e){return this.seconds===e.seconds?rt(this.nanoseconds,e.nanoseconds):rt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-A2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{static fromTimestamp(e){return new $e(e)}static min(){return new $e(new _n(0,0))}static max(){return new $e(new _n(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2="__name__";class Qi{constructor(e,t,n){t===void 0?t=0:t>e.length&&qe(),n===void 0?n=e.length-t:n>e.length-t&&qe(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Qi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qi?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const a=Qi.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return rt(e.length,t.length)}static compareSegments(e,t){const n=Qi.isNumericId(e),i=Qi.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?Qi.extractNumericId(e).compare(Qi.extractNumericId(t)):v0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Zo.fromString(e.substring(4,e.length-2))}}class jt extends Qi{construct(e,t,n){return new jt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Be(we.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new jt(t)}static emptyPath(){return new jt([])}}const MF=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Kn extends Qi{construct(e,t,n){return new Kn(e,t,n)}static isValidIdentifier(e){return MF.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Kn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===I2}static keyField(){return new Kn([I2])}static fromServerFormat(e){const t=[];let n="",i=0;const a=()=>{if(n.length===0)throw new Be(we.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Be(we.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Be(we.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(s=!s,i++):u!=="."||s?(n+=u,i++):(a(),i++)}if(a(),s)throw new Be(we.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Kn(t)}static emptyPath(){return new Kn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.path=e}static fromPath(e){return new Ue(jt.fromString(e))}static fromName(e){return new Ue(jt.fromString(e).popFirst(5))}static empty(){return new Ue(jt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&jt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return jt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ue(new jt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=-1;function PF(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=$e.fromTimestamp(n===1e9?new _n(t+1,0):new _n(t,n));return new is(i,Ue.empty(),e)}function LF(r){return new is(r.readTime,r.key,Wh)}class is{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new is($e.min(),Ue.empty(),Wh)}static max(){return new is($e.max(),Ue.empty(),Wh)}}function FF(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=Ue.comparator(r.documentKey,e.documentKey),t!==0?t:rt(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VF{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ac(r){if(r.code!==we.FAILED_PRECONDITION||r.message!==BF)throw r;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&qe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new be((n,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof be?t:be.resolve(t)}catch(t){return be.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):be.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):be.reject(t)}static resolve(e){return new be((t,n)=>{t(e)})}static reject(e){return new be((t,n)=>{n(e)})}static waitFor(e){return new be((t,n)=>{let i=0,a=0,s=!1;e.forEach(u=>{++i,u.next(()=>{++a,s&&a===i&&t()},c=>n(c))}),s=!0,a===i&&t()})}static or(e){let t=be.resolve(!1);for(const n of e)t=t.next(i=>i?be.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,a)=>{n.push(t.call(this,i,a))}),this.waitFor(n)}static mapArray(e,t){return new be((n,i)=>{const a=e.length,s=new Array(a);let u=0;for(let c=0;c<a;c++){const h=c;t(e[h]).next(d=>{s[h]=d,++u,u===a&&n(s)},d=>i(d))}})}static doWhile(e,t){return new be((n,i)=>{const a=()=>{e()===!0?t().next(()=>{a()},i):n()};a()})}}function UF(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function oc(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.oe(n),this._e=n=>t.writeSequenceNumber(n))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}km.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rb=-1;function Om(r){return r==null}function zp(r){return r===0&&1/r==-1/0}function zF(r){return typeof r=="number"&&Number.isInteger(r)&&!zp(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oA="";function jF(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=D2(e)),e=HF(r.get(t),e);return D2(e)}function HF(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const a=r.charAt(i);switch(a){case"\0":t+="";break;case oA:t+="";break;default:t+=a}}return t}function D2(r){return r+oA+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N2(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function ms(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function sA(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e,t){this.comparator=e,this.root=t||Wn.EMPTY}insert(e,t){return new Xt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wn.BLACK,null,null))}remove(e){return new Xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qd(this.root,e,this.comparator,!0)}}class Qd{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?n(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wn{constructor(e,t,n,i,a){this.key=e,this.value=t,this.color=n??Wn.RED,this.left=i??Wn.EMPTY,this.right=a??Wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,a){return new Wn(e??this.key,t??this.value,n??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const a=n(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,n),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Wn.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw qe();const e=this.left.check();if(e!==this.right.check())throw qe();return e+(this.isRed()?0:1)}}Wn.EMPTY=null,Wn.RED=!0,Wn.BLACK=!1;Wn.EMPTY=new class{constructor(){this.size=0}get key(){throw qe()}get value(){throw qe()}get color(){throw qe()}get left(){throw qe()}get right(){throw qe()}copy(e,t,n,i,a){return this}insert(e,t,n){return new Wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e){this.comparator=e,this.data=new Xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new k2(this.data.getIterator())}getIteratorFrom(e){return new k2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof wn)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new wn(this.comparator);return t.data=e,t}}class k2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e){this.fields=e,e.sort(Kn.comparator)}static empty(){return new Ur([])}unionWith(e){let t=new wn(Kn.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ur(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return jl(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new uA("Invalid base64 string: "+a):a}}(e);return new Xn(t)}static fromUint8Array(e){const t=function(i){let a="";for(let s=0;s<i.length;++s)a+=String.fromCharCode(i[s]);return a}(e);return new Xn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xn.EMPTY_BYTE_STRING=new Xn("");const WF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function as(r){if(Tt(!!r),typeof r=="string"){let e=0;const t=WF.exec(r);if(Tt(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:nn(r.seconds),nanos:nn(r.nanos)}}function nn(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function os(r){return typeof r=="string"?Xn.fromBase64String(r):Xn.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lA="server_timestamp",cA="__type__",hA="__previous_value__",fA="__local_write_time__";function Ib(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[cA])===null||t===void 0?void 0:t.stringValue)===lA}function Mm(r){const e=r.mapValue.fields[hA];return Ib(e)?Mm(e):e}function qh(r){const e=as(r.mapValue.fields[fA].timestampValue);return new _n(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(e,t,n,i,a,s,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=a,this.forceLongPolling=s,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}const jp="(default)";class Gh{constructor(e,t){this.projectId=e,this.database=t||jp}static empty(){return new Gh("","")}get isDefaultDatabase(){return this.database===jp}isEqual(e){return e instanceof Gh&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dA="__type__",GF="__max__",Zd={mapValue:{}},pA="__vector__",Hp="value";function ss(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ib(r)?4:XF(r)?9007199254740991:KF(r)?10:11:qe()}function ha(r,e){if(r===e)return!0;const t=ss(r);if(t!==ss(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return qh(r).isEqual(qh(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const s=as(i.timestampValue),u=as(a.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,a){return os(i.bytesValue).isEqual(os(a.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,a){return nn(i.geoPointValue.latitude)===nn(a.geoPointValue.latitude)&&nn(i.geoPointValue.longitude)===nn(a.geoPointValue.longitude)}(r,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return nn(i.integerValue)===nn(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const s=nn(i.doubleValue),u=nn(a.doubleValue);return s===u?zp(s)===zp(u):isNaN(s)&&isNaN(u)}return!1}(r,e);case 9:return jl(r.arrayValue.values||[],e.arrayValue.values||[],ha);case 10:case 11:return function(i,a){const s=i.mapValue.fields||{},u=a.mapValue.fields||{};if(N2(s)!==N2(u))return!1;for(const c in s)if(s.hasOwnProperty(c)&&(u[c]===void 0||!ha(s[c],u[c])))return!1;return!0}(r,e);default:return qe()}}function Kh(r,e){return(r.values||[]).find(t=>ha(t,e))!==void 0}function Hl(r,e){if(r===e)return 0;const t=ss(r),n=ss(e);if(t!==n)return rt(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return rt(r.booleanValue,e.booleanValue);case 2:return function(a,s){const u=nn(a.integerValue||a.doubleValue),c=nn(s.integerValue||s.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return O2(r.timestampValue,e.timestampValue);case 4:return O2(qh(r),qh(e));case 5:return v0(r.stringValue,e.stringValue);case 6:return function(a,s){const u=os(a),c=os(s);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(a,s){const u=a.split("/"),c=s.split("/");for(let h=0;h<u.length&&h<c.length;h++){const d=rt(u[h],c[h]);if(d!==0)return d}return rt(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(a,s){const u=rt(nn(a.latitude),nn(s.latitude));return u!==0?u:rt(nn(a.longitude),nn(s.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return M2(r.arrayValue,e.arrayValue);case 10:return function(a,s){var u,c,h,d;const m=a.fields||{},v=s.fields||{},y=(u=m[Hp])===null||u===void 0?void 0:u.arrayValue,_=(c=v[Hp])===null||c===void 0?void 0:c.arrayValue,E=rt(((h=y==null?void 0:y.values)===null||h===void 0?void 0:h.length)||0,((d=_==null?void 0:_.values)===null||d===void 0?void 0:d.length)||0);return E!==0?E:M2(y,_)}(r.mapValue,e.mapValue);case 11:return function(a,s){if(a===Zd.mapValue&&s===Zd.mapValue)return 0;if(a===Zd.mapValue)return 1;if(s===Zd.mapValue)return-1;const u=a.fields||{},c=Object.keys(u),h=s.fields||{},d=Object.keys(h);c.sort(),d.sort();for(let m=0;m<c.length&&m<d.length;++m){const v=v0(c[m],d[m]);if(v!==0)return v;const y=Hl(u[c[m]],h[d[m]]);if(y!==0)return y}return rt(c.length,d.length)}(r.mapValue,e.mapValue);default:throw qe()}}function O2(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return rt(r,e);const t=as(r),n=as(e),i=rt(t.seconds,n.seconds);return i!==0?i:rt(t.nanos,n.nanos)}function M2(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const a=Hl(t[i],n[i]);if(a)return a}return rt(t.length,n.length)}function Wl(r){return g0(r)}function g0(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=as(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return os(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return Ue.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const a of t.values||[])i?i=!1:n+=",",n+=g0(a);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const s of n)a?a=!1:i+=",",i+=`${s}:${g0(t.fields[s])}`;return i+"}"}(r.mapValue):qe()}function Tp(r){switch(ss(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Mm(r);return e?16+Tp(e):16;case 5:return 2*r.stringValue.length;case 6:return os(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,a)=>i+Tp(a),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return ms(n.fields,(a,s)=>{i+=a.length+Tp(s)}),i}(r.mapValue);default:throw qe()}}function y0(r){return!!r&&"integerValue"in r}function Db(r){return!!r&&"arrayValue"in r}function P2(r){return!!r&&"nullValue"in r}function L2(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Sp(r){return!!r&&"mapValue"in r}function KF(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[dA])===null||t===void 0?void 0:t.stringValue)===pA}function Oh(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return ms(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Oh(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Oh(r.arrayValue.values[t]);return e}return Object.assign({},r)}function XF(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===GF}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e){this.value=e}static empty(){return new _r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Sp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Oh(t)}setAll(e){let t=Kn.emptyPath(),n={},i=[];e.forEach((s,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}s?n[u.lastSegment()]=Oh(s):i.push(u.lastSegment())});const a=this.getFieldsMap(t);this.applyChanges(a,n,i)}delete(e){const t=this.field(e.popLast());Sp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ha(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Sp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){ms(t,(i,a)=>e[i]=a);for(const i of n)delete e[i]}clone(){return new _r(Oh(this.value))}}function mA(r){const e=[];return ms(r.fields,(t,n)=>{const i=new Kn([t]);if(Sp(n)){const a=mA(n.mapValue).fields;if(a.length===0)e.push(i);else for(const s of a)e.push(i.child(s))}else e.push(i)}),new Ur(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,t,n,i,a,s,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=a,this.data=s,this.documentState=u}static newInvalidDocument(e){return new tr(e,0,$e.min(),$e.min(),$e.min(),_r.empty(),0)}static newFoundDocument(e,t,n,i){return new tr(e,1,t,$e.min(),n,i,0)}static newNoDocument(e,t){return new tr(e,2,t,$e.min(),$e.min(),_r.empty(),0)}static newUnknownDocument(e,t){return new tr(e,3,t,$e.min(),$e.min(),_r.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_r.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_r.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e,t){this.position=e,this.inclusive=t}}function F2(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const a=e[i],s=r.position[i];if(a.field.isKeyField()?n=Ue.comparator(Ue.fromName(s.referenceValue),t.key):n=Hl(s,t.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function B2(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!ha(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(e,t="asc"){this.field=e,this.dir=t}}function $F(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vA{}class bn extends vA{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new QF(e,t,n):t==="array-contains"?new eB(e,n):t==="in"?new tB(e,n):t==="not-in"?new nB(e,n):t==="array-contains-any"?new rB(e,n):new bn(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new ZF(e,n):new JF(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Hl(t,this.value)):t!==null&&ss(this.value)===ss(t)&&this.matchesComparison(Hl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return qe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fa extends vA{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new fa(e,t)}matches(e){return gA(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function gA(r){return r.op==="and"}function yA(r){return YF(r)&&gA(r)}function YF(r){for(const e of r.filters)if(e instanceof fa)return!1;return!0}function b0(r){if(r instanceof bn)return r.field.canonicalString()+r.op.toString()+Wl(r.value);if(yA(r))return r.filters.map(e=>b0(e)).join(",");{const e=r.filters.map(t=>b0(t)).join(",");return`${r.op}(${e})`}}function bA(r,e){return r instanceof bn?function(n,i){return i instanceof bn&&n.op===i.op&&n.field.isEqual(i.field)&&ha(n.value,i.value)}(r,e):r instanceof fa?function(n,i){return i instanceof fa&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((a,s,u)=>a&&bA(s,i.filters[u]),!0):!1}(r,e):void qe()}function _A(r){return r instanceof bn?function(t){return`${t.field.canonicalString()} ${t.op} ${Wl(t.value)}`}(r):r instanceof fa?function(t){return t.op.toString()+" {"+t.getFilters().map(_A).join(" ,")+"}"}(r):"Filter"}class QF extends bn{constructor(e,t,n){super(e,t,n),this.key=Ue.fromName(n.referenceValue)}matches(e){const t=Ue.comparator(e.key,this.key);return this.matchesComparison(t)}}class ZF extends bn{constructor(e,t){super(e,"in",t),this.keys=wA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class JF extends bn{constructor(e,t){super(e,"not-in",t),this.keys=wA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function wA(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Ue.fromName(n.referenceValue))}class eB extends bn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Db(t)&&Kh(t.arrayValue,this.value)}}class tB extends bn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Kh(this.value.arrayValue,t)}}class nB extends bn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Kh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Kh(this.value.arrayValue,t)}}class rB extends bn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Db(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Kh(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iB{constructor(e,t=null,n=[],i=[],a=null,s=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=a,this.startAt=s,this.endAt=u,this.le=null}}function V2(r,e=null,t=[],n=[],i=null,a=null,s=null){return new iB(r,e,t,n,i,a,s)}function Nb(r){const e=Ze(r);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>b0(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(a){return a.field.canonicalString()+a.dir}(n)).join(","),Om(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Wl(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Wl(n)).join(",")),e.le=t}return e.le}function kb(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!$F(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!bA(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!B2(r.startAt,e.startAt)&&B2(r.endAt,e.endAt)}function _0(r){return Ue.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,t=null,n=[],i=[],a=null,s="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=a,this.limitType=s,this.startAt=u,this.endAt=c,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function aB(r,e,t,n,i,a,s,u){return new Pm(r,e,t,n,i,a,s,u)}function Ob(r){return new Pm(r)}function U2(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function oB(r){return r.collectionGroup!==null}function Mh(r){const e=Ze(r);if(e.he===null){e.he=[];const t=new Set;for(const a of e.explicitOrderBy)e.he.push(a),t.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let u=new wn(Kn.comparator);return s.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(a=>{t.has(a.canonicalString())||a.isKeyField()||e.he.push(new qp(a,n))}),t.has(Kn.keyField().canonicalString())||e.he.push(new qp(Kn.keyField(),n))}return e.he}function ia(r){const e=Ze(r);return e.Pe||(e.Pe=sB(e,Mh(r))),e.Pe}function sB(r,e){if(r.limitType==="F")return V2(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new qp(i.field,a)});const t=r.endAt?new Wp(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Wp(r.startAt.position,r.startAt.inclusive):null;return V2(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function w0(r,e,t){return new Pm(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Lm(r,e){return kb(ia(r),ia(e))&&r.limitType===e.limitType}function xA(r){return`${Nb(ia(r))}|lt:${r.limitType}`}function xl(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>_A(i)).join(", ")}]`),Om(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Wl(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Wl(i)).join(",")),`Target(${n})`}(ia(r))}; limitType=${r.limitType})`}function Fm(r,e){return e.isFoundDocument()&&function(n,i){const a=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):Ue.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)}(r,e)&&function(n,i){for(const a of Mh(n))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(r,e)&&function(n,i){for(const a of n.filters)if(!a.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(s,u,c){const h=F2(s,u,c);return s.inclusive?h<=0:h<0}(n.startAt,Mh(n),i)||n.endAt&&!function(s,u,c){const h=F2(s,u,c);return s.inclusive?h>=0:h>0}(n.endAt,Mh(n),i))}(r,e)}function uB(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function EA(r){return(e,t)=>{let n=!1;for(const i of Mh(r)){const a=lB(i,e,t);if(a!==0)return a;n=n||i.field.isKeyField()}return 0}}function lB(r,e,t){const n=r.field.isKeyField()?Ue.comparator(e.key,t.key):function(a,s,u){const c=s.data.field(a),h=u.data.field(a);return c!==null&&h!==null?Hl(c,h):qe()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return qe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,a]of n)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ms(this.inner,(t,n)=>{for(const[i,a]of n)e(i,a)})}isEmpty(){return sA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cB=new Xt(Ue.comparator);function io(){return cB}const TA=new Xt(Ue.comparator);function Rh(...r){let e=TA;for(const t of r)e=e.insert(t.key,t);return e}function SA(r){let e=TA;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function iu(){return Ph()}function CA(){return Ph()}function Ph(){return new bu(r=>r.toString(),(r,e)=>r.isEqual(e))}const hB=new Xt(Ue.comparator),fB=new wn(Ue.comparator);function ft(...r){let e=fB;for(const t of r)e=e.add(t);return e}const dB=new wn(rt);function pB(){return dB}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mb(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zp(e)?"-0":e}}function AA(r){return{integerValue:""+r}}function mB(r,e){return zF(e)?AA(e):Mb(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(){this._=void 0}}function vB(r,e,t){return r instanceof Gp?function(i,a){const s={fields:{[cA]:{stringValue:lA},[fA]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Ib(a)&&(a=Mm(a)),a&&(s.fields[hA]=a),{mapValue:s}}(t,e):r instanceof Xh?IA(r,e):r instanceof $h?DA(r,e):function(i,a){const s=RA(i,a),u=z2(s)+z2(i.Ie);return y0(s)&&y0(i.Ie)?AA(u):Mb(i.serializer,u)}(r,e)}function gB(r,e,t){return r instanceof Xh?IA(r,e):r instanceof $h?DA(r,e):t}function RA(r,e){return r instanceof Kp?function(n){return y0(n)||function(a){return!!a&&"doubleValue"in a}(n)}(e)?e:{integerValue:0}:null}class Gp extends Bm{}class Xh extends Bm{constructor(e){super(),this.elements=e}}function IA(r,e){const t=NA(e);for(const n of r.elements)t.some(i=>ha(i,n))||t.push(n);return{arrayValue:{values:t}}}class $h extends Bm{constructor(e){super(),this.elements=e}}function DA(r,e){let t=NA(e);for(const n of r.elements)t=t.filter(i=>!ha(i,n));return{arrayValue:{values:t}}}class Kp extends Bm{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function z2(r){return nn(r.integerValue||r.doubleValue)}function NA(r){return Db(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function yB(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Xh&&i instanceof Xh||n instanceof $h&&i instanceof $h?jl(n.elements,i.elements,ha):n instanceof Kp&&i instanceof Kp?ha(n.Ie,i.Ie):n instanceof Gp&&i instanceof Gp}(r.transform,e.transform)}class bB{constructor(e,t){this.version=e,this.transformResults=t}}class Ei{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ei}static exists(e){return new Ei(void 0,e)}static updateTime(e){return new Ei(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cp(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Vm{}function kA(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Pb(r.key,Ei.none()):new ff(r.key,r.data,Ei.none());{const t=r.data,n=_r.empty();let i=new wn(Kn.comparator);for(let a of e.fields)if(!i.has(a)){let s=t.field(a);s===null&&a.length>1&&(a=a.popLast(),s=t.field(a)),s===null?n.delete(a):n.set(a,s),i=i.add(a)}return new vs(r.key,n,new Ur(i.toArray()),Ei.none())}}function _B(r,e,t){r instanceof ff?function(i,a,s){const u=i.value.clone(),c=H2(i.fieldTransforms,a,s.transformResults);u.setAll(c),a.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(r,e,t):r instanceof vs?function(i,a,s){if(!Cp(i.precondition,a))return void a.convertToUnknownDocument(s.version);const u=H2(i.fieldTransforms,a,s.transformResults),c=a.data;c.setAll(OA(i)),c.setAll(u),a.convertToFoundDocument(s.version,c).setHasCommittedMutations()}(r,e,t):function(i,a,s){a.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function Lh(r,e,t,n){return r instanceof ff?function(a,s,u,c){if(!Cp(a.precondition,s))return u;const h=a.value.clone(),d=W2(a.fieldTransforms,c,s);return h.setAll(d),s.convertToFoundDocument(s.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof vs?function(a,s,u,c){if(!Cp(a.precondition,s))return u;const h=W2(a.fieldTransforms,c,s),d=s.data;return d.setAll(OA(a)),d.setAll(h),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),u===null?null:u.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(m=>m.field))}(r,e,t,n):function(a,s,u){return Cp(a.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u}(r,e,t)}function wB(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),a=RA(n.transform,i||null);a!=null&&(t===null&&(t=_r.empty()),t.set(n.field,a))}return t||null}function j2(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&jl(n,i,(a,s)=>yB(a,s))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ff extends Vm{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class vs extends Vm{constructor(e,t,n,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function OA(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function H2(r,e,t){const n=new Map;Tt(r.length===t.length);for(let i=0;i<t.length;i++){const a=r[i],s=a.transform,u=e.data.field(a.field);n.set(a.field,gB(s,u,t[i]))}return n}function W2(r,e,t){const n=new Map;for(const i of r){const a=i.transform,s=t.data.field(i.field);n.set(i.field,vB(a,s,e))}return n}class Pb extends Vm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xB extends Vm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&_B(a,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Lh(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Lh(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=CA();return this.mutations.forEach(i=>{const a=e.get(i.key),s=a.overlayedDocument;let u=this.applyToLocalView(s,a.mutatedFields);u=t.has(i.key)?null:u;const c=kA(s,u);c!==null&&n.set(i.key,c),s.isValidDocument()||s.convertToNoDocument($e.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ft())}isEqual(e){return this.batchId===e.batchId&&jl(this.mutations,e.mutations,(t,n)=>j2(t,n))&&jl(this.baseMutations,e.baseMutations,(t,n)=>j2(t,n))}}class Lb{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Tt(e.mutations.length===n.length);let i=function(){return hB}();const a=e.mutations;for(let s=0;s<a.length;s++)i=i.insert(a[s].key,n[s].version);return new Lb(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TB{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cn,vt;function CB(r){switch(r){case we.OK:return qe();case we.CANCELLED:case we.UNKNOWN:case we.DEADLINE_EXCEEDED:case we.RESOURCE_EXHAUSTED:case we.INTERNAL:case we.UNAVAILABLE:case we.UNAUTHENTICATED:return!1;case we.INVALID_ARGUMENT:case we.NOT_FOUND:case we.ALREADY_EXISTS:case we.PERMISSION_DENIED:case we.FAILED_PRECONDITION:case we.ABORTED:case we.OUT_OF_RANGE:case we.UNIMPLEMENTED:case we.DATA_LOSS:return!0;default:return qe()}}function MA(r){if(r===void 0)return ro("GRPC error has no .code"),we.UNKNOWN;switch(r){case cn.OK:return we.OK;case cn.CANCELLED:return we.CANCELLED;case cn.UNKNOWN:return we.UNKNOWN;case cn.DEADLINE_EXCEEDED:return we.DEADLINE_EXCEEDED;case cn.RESOURCE_EXHAUSTED:return we.RESOURCE_EXHAUSTED;case cn.INTERNAL:return we.INTERNAL;case cn.UNAVAILABLE:return we.UNAVAILABLE;case cn.UNAUTHENTICATED:return we.UNAUTHENTICATED;case cn.INVALID_ARGUMENT:return we.INVALID_ARGUMENT;case cn.NOT_FOUND:return we.NOT_FOUND;case cn.ALREADY_EXISTS:return we.ALREADY_EXISTS;case cn.PERMISSION_DENIED:return we.PERMISSION_DENIED;case cn.FAILED_PRECONDITION:return we.FAILED_PRECONDITION;case cn.ABORTED:return we.ABORTED;case cn.OUT_OF_RANGE:return we.OUT_OF_RANGE;case cn.UNIMPLEMENTED:return we.UNIMPLEMENTED;case cn.DATA_LOSS:return we.DATA_LOSS;default:return qe()}}(vt=cn||(cn={}))[vt.OK=0]="OK",vt[vt.CANCELLED=1]="CANCELLED",vt[vt.UNKNOWN=2]="UNKNOWN",vt[vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vt[vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vt[vt.NOT_FOUND=5]="NOT_FOUND",vt[vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",vt[vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",vt[vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",vt[vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vt[vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vt[vt.ABORTED=10]="ABORTED",vt[vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",vt[vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",vt[vt.INTERNAL=13]="INTERNAL",vt[vt.UNAVAILABLE=14]="UNAVAILABLE",vt[vt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AB=new Zo([4294967295,4294967295],0);function q2(r){const e=iA().encode(r),t=new QC;return t.update(e),new Uint8Array(t.digest())}function G2(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Zo([t,n],0),new Zo([i,a],0)]}class Fb{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ih(`Invalid padding: ${t}`);if(n<0)throw new Ih(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ih(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ih(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=Zo.fromNumber(this.Ee)}Ae(e,t,n){let i=e.add(t.multiply(Zo.fromNumber(n)));return i.compare(AB)===1&&(i=new Zo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=q2(e),[n,i]=G2(t);for(let a=0;a<this.hashCount;a++){const s=this.Ae(n,i,a);if(!this.Re(s))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),s=new Fb(a,i,t);return n.forEach(u=>s.insert(u)),s}insert(e){if(this.Ee===0)return;const t=q2(e),[n,i]=G2(t);for(let a=0;a<this.hashCount;a++){const s=this.Ae(n,i,a);this.Ve(s)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Ih extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t,n,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,df.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Um($e.min(),i,new Xt(rt),io(),ft())}}class df{constructor(e,t,n,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new df(n,t,ft(),ft(),ft())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap{constructor(e,t,n,i){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=i}}class PA{constructor(e,t){this.targetId=e,this.ge=t}}class LA{constructor(e,t,n=Xn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class K2{constructor(){this.pe=0,this.ye=X2(),this.we=Xn.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=ft(),t=ft(),n=ft();return this.ye.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:qe()}}),new df(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=X2()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Tt(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class RB{constructor(e){this.ke=e,this.qe=new Map,this.Qe=io(),this.$e=Jd(),this.Ue=Jd(),this.Ke=new Xt(rt)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:qe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((n,i)=>{this.Je(i)&&t(i)})}Ze(e){const t=e.targetId,n=e.ge.count,i=this.Xe(t);if(i){const a=i.target;if(_0(a))if(n===0){const s=new Ue(a.path);this.ze(t,s,tr.newNoDocument(s,$e.min()))}else Tt(n===1);else{const s=this.et(t);if(s!==n){const u=this.tt(e),c=u?this.nt(u,e,s):1;if(c!==0){this.Ye(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,h)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:a=0}=t;let s,u;try{s=os(n).toUint8Array()}catch(c){if(c instanceof uA)return zl("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Fb(s,i,a)}catch(c){return zl(c instanceof Ih?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ee===0?null:u}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let i=0;return n.forEach(a=>{const s=this.ke.it(),u=`projects/${s.projectId}/databases/${s.database}/documents/${a.path.canonicalString()}`;e.mightContain(u)||(this.ze(t,a,null),i++)}),i}ot(e){const t=new Map;this.qe.forEach((a,s)=>{const u=this.Xe(s);if(u){if(a.current&&_0(u.target)){const c=new Ue(u.target.path);this._t(c).has(s)||this.ut(s,c)||this.ze(s,c,tr.newNoDocument(c,e))}a.ve&&(t.set(s,a.Fe()),a.Me())}});let n=ft();this.Ue.forEach((a,s)=>{let u=!0;s.forEachWhile(c=>{const h=this.Xe(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(a))}),this.Qe.forEach((a,s)=>s.setReadTime(e));const i=new Um(e,t,this.Ke,this.Qe,n);return this.Qe=io(),this.$e=Jd(),this.Ue=Jd(),this.Ke=new Xt(rt),i}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const i=this.He(e);this.ut(e,t)?i.xe(t,1):i.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new K2,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new wn(rt),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new wn(rt),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new K2),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function Jd(){return new Xt(Ue.comparator)}function X2(){return new Xt(Ue.comparator)}const IB={asc:"ASCENDING",desc:"DESCENDING"},DB={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},NB={and:"AND",or:"OR"};class kB{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function x0(r,e){return r.useProto3Json||Om(e)?e:{value:e}}function Xp(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function FA(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function OB(r,e){return Xp(r,e.toTimestamp())}function aa(r){return Tt(!!r),$e.fromTimestamp(function(t){const n=as(t);return new _n(n.seconds,n.nanos)}(r))}function Bb(r,e){return E0(r,e).canonicalString()}function E0(r,e){const t=function(i){return new jt(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function BA(r){const e=jt.fromString(r);return Tt(HA(e)),e}function T0(r,e){return Bb(r.databaseId,e.path)}function Cy(r,e){const t=BA(e);if(t.get(1)!==r.databaseId.projectId)throw new Be(we.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Be(we.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Ue(UA(t))}function VA(r,e){return Bb(r.databaseId,e)}function MB(r){const e=BA(r);return e.length===4?jt.emptyPath():UA(e)}function S0(r){return new jt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function UA(r){return Tt(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function $2(r,e,t){return{name:T0(r,e),fields:t.value.mapValue.fields}}function PB(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:qe()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(h,d){return h.useProto3Json?(Tt(d===void 0||typeof d=="string"),Xn.fromBase64String(d||"")):(Tt(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Xn.fromUint8Array(d||new Uint8Array))}(r,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(h){const d=h.code===void 0?we.UNKNOWN:MA(h.code);return new Be(d,h.message||"")}(s);t=new LA(n,i,a,u||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=Cy(r,n.document.name),a=aa(n.document.updateTime),s=n.document.createTime?aa(n.document.createTime):$e.min(),u=new _r({mapValue:{fields:n.document.fields}}),c=tr.newFoundDocument(i,a,s,u),h=n.targetIds||[],d=n.removedTargetIds||[];t=new Ap(h,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=Cy(r,n.document),a=n.readTime?aa(n.readTime):$e.min(),s=tr.newNoDocument(i,a),u=n.removedTargetIds||[];t=new Ap([],u,s.key,s)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=Cy(r,n.document),a=n.removedTargetIds||[];t=new Ap([],a,i,null)}else{if(!("filter"in e))return qe();{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:a}=n,s=new SB(i,a),u=n.targetId;t=new PA(u,s)}}return t}function LB(r,e){let t;if(e instanceof ff)t={update:$2(r,e.key,e.value)};else if(e instanceof Pb)t={delete:T0(r,e.key)};else if(e instanceof vs)t={update:$2(r,e.key,e.data),updateMask:qB(e.fieldMask)};else{if(!(e instanceof xB))return qe();t={verify:T0(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(a,s){const u=s.transform;if(u instanceof Gp)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Xh)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof $h)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Kp)return{fieldPath:s.field.canonicalString(),increment:u.Ie};throw qe()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:OB(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:qe()}(r,e.precondition)),t}function FB(r,e){return r&&r.length>0?(Tt(e!==void 0),r.map(t=>function(i,a){let s=i.updateTime?aa(i.updateTime):aa(a);return s.isEqual($e.min())&&(s=aa(a)),new bB(s,i.transformResults||[])}(t,e))):[]}function BB(r,e){return{documents:[VA(r,e.path)]}}function VB(r,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=VA(r,i);const a=function(h){if(h.length!==0)return jA(fa.create(h,"and"))}(e.filters);a&&(t.structuredQuery.where=a);const s=function(h){if(h.length!==0)return h.map(d=>function(v){return{field:El(v.field),direction:jB(v.dir)}}(d))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=x0(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{ht:t,parent:i}}function UB(r){let e=MB(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){Tt(n===1);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let a=[];t.where&&(a=function(m){const v=zA(m);return v instanceof fa&&yA(v)?v.getFilters():[v]}(t.where));let s=[];t.orderBy&&(s=function(m){return m.map(v=>function(_){return new qp(Tl(_.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(v))}(t.orderBy));let u=null;t.limit&&(u=function(m){let v;return v=typeof m=="object"?m.value:m,Om(v)?null:v}(t.limit));let c=null;t.startAt&&(c=function(m){const v=!!m.before,y=m.values||[];return new Wp(y,v)}(t.startAt));let h=null;return t.endAt&&(h=function(m){const v=!m.before,y=m.values||[];return new Wp(y,v)}(t.endAt)),aB(e,i,s,a,u,"F",c,h)}function zB(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return qe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zA(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Tl(t.unaryFilter.field);return bn.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Tl(t.unaryFilter.field);return bn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Tl(t.unaryFilter.field);return bn.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Tl(t.unaryFilter.field);return bn.create(s,"!=",{nullValue:"NULL_VALUE"});default:return qe()}}(r):r.fieldFilter!==void 0?function(t){return bn.create(Tl(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return qe()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return fa.create(t.compositeFilter.filters.map(n=>zA(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return qe()}}(t.compositeFilter.op))}(r):qe()}function jB(r){return IB[r]}function HB(r){return DB[r]}function WB(r){return NB[r]}function El(r){return{fieldPath:r.canonicalString()}}function Tl(r){return Kn.fromServerFormat(r.fieldPath)}function jA(r){return r instanceof bn?function(t){if(t.op==="=="){if(L2(t.value))return{unaryFilter:{field:El(t.field),op:"IS_NAN"}};if(P2(t.value))return{unaryFilter:{field:El(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(L2(t.value))return{unaryFilter:{field:El(t.field),op:"IS_NOT_NAN"}};if(P2(t.value))return{unaryFilter:{field:El(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:El(t.field),op:HB(t.op),value:t.value}}}(r):r instanceof fa?function(t){const n=t.getFilters().map(i=>jA(i));return n.length===1?n[0]:{compositeFilter:{op:WB(t.op),filters:n}}}(r):qe()}function qB(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function HA(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,n,i,a=$e.min(),s=$e.min(),u=Xn.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Ko(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ko(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ko(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ko(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(e){this.Tt=e}}function KB(r){const e=UB({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?w0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XB{constructor(){this.Tn=new $B}addToCollectionParentIndex(e,t){return this.Tn.add(t),be.resolve()}getCollectionParents(e,t){return be.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return be.resolve()}deleteFieldIndex(e,t){return be.resolve()}deleteAllFieldIndexes(e){return be.resolve()}createTargetIndexes(e,t){return be.resolve()}getDocumentsMatchingTarget(e,t){return be.resolve(null)}getIndexType(e,t){return be.resolve(0)}getFieldIndexes(e,t){return be.resolve([])}getNextCollectionGroupToUpdate(e){return be.resolve(null)}getMinOffset(e,t){return be.resolve(is.min())}getMinOffsetFromCollectionGroup(e,t){return be.resolve(is.min())}updateCollectionGroup(e,t,n){return be.resolve()}updateIndexEntries(e,t){return be.resolve()}}class $B{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new wn(jt.comparator),a=!i.has(n);return this.index[t]=i.add(n),a}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new wn(jt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},WA=41943040;class yr{static withCacheSize(e){return new yr(e,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yr.DEFAULT_COLLECTION_PERCENTILE=10,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yr.DEFAULT=new yr(WA,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yr.DISABLED=new yr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new ql(0)}static Kn(){return new ql(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2="LruGarbageCollector",YB=1048576;function Z2([r,e],[t,n]){const i=rt(r,t);return i===0?rt(e,n):i}class QB{constructor(e){this.Hn=e,this.buffer=new wn(Z2),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Z2(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ZB{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Ae(Q2,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){oc(t)?Ae(Q2,"Ignoring IndexedDB error during garbage collection: ",t):await ac(t)}await this.er(3e5)})}}class JB{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return be.resolve(km.ae);const n=new QB(t);return this.tr.forEachTarget(e,i=>n.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>n.Zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ae("LruGarbageCollector","Garbage collection skipped; disabled"),be.resolve(Y2)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Y2):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,i,a,s,u,c,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(Ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,s=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,u=Date.now(),this.removeTargets(e,n,t))).next(m=>(a=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(h=Date.now(),wl()<=ht.DEBUG&&Ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-d}ms
	Determined least recently used ${i} in `+(u-s)+`ms
	Removed ${a} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(h-c)+`ms
Total Duration: ${h-d}ms`),be.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:m})))}}function eV(r,e){return new JB(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(){this.changes=new bu(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?be.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Lh(n.mutation,i,Ur.empty(),_n.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ft()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ft()){const i=iu();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(a=>{let s=Rh();return a.forEach((u,c)=>{s=s.insert(u,c.overlayedDocument)}),s}))}getOverlayedDocuments(e,t){const n=iu();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ft()))}populateOverlays(e,t,n){const i=[];return n.forEach(a=>{t.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((s,u)=>{t.set(s,u)})})}computeViews(e,t,n,i){let a=io();const s=Ph(),u=function(){return Ph()}();return t.forEach((c,h)=>{const d=n.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof vs)?a=a.insert(h.key,h):d!==void 0?(s.set(h.key,d.mutation.getFieldMask()),Lh(d.mutation,h,d.mutation.getFieldMask(),_n.now())):s.set(h.key,Ur.empty())}),this.recalculateAndSaveOverlays(e,a).next(c=>(c.forEach((h,d)=>s.set(h,d)),t.forEach((h,d)=>{var m;return u.set(h,new nV(d,(m=s.get(h))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(e,t){const n=Ph();let i=new Xt((s,u)=>s-u),a=ft();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(s=>{for(const u of s)u.keys().forEach(c=>{const h=t.get(c);if(h===null)return;let d=n.get(c)||Ur.empty();d=u.applyToLocalView(h,d),n.set(c,d);const m=(i.get(u.batchId)||ft()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{const s=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,d=c.value,m=CA();d.forEach(v=>{if(!a.has(v)){const y=kA(t.get(v),n.get(v));y!==null&&m.set(v,y),a=a.add(v)}}),s.push(this.documentOverlayCache.saveOverlays(e,h,m))}return be.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(s){return Ue.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oB(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(a=>{const s=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-a.size):be.resolve(iu());let u=Wh,c=a;return s.next(h=>be.forEach(h,(d,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),a.get(d)?be.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{c=c.insert(d,v)}))).next(()=>this.populateOverlays(e,h,a)).next(()=>this.computeViews(e,c,h,ft())).next(d=>({batchId:u,changes:SA(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ue(t)).next(n=>{let i=Rh();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const a=t.collectionGroup;let s=Rh();return this.indexManager.getCollectionParents(e,a).next(u=>be.forEach(u,c=>{const h=function(m,v){return new Pm(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(d=>{d.forEach((m,v)=>{s=s.insert(m,v)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(a=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,a,i))).next(s=>{a.forEach((c,h)=>{const d=h.getKey();s.get(d)===null&&(s=s.insert(d,tr.newInvalidDocument(d)))});let u=Rh();return s.forEach((c,h)=>{const d=a.get(c);d!==void 0&&Lh(d.mutation,h,Ur.empty(),_n.now()),Fm(t,h)&&(u=u.insert(c,h))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return be.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:aa(i.createTime)}}(t)),be.resolve()}getNamedQuery(e,t){return be.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(i){return{name:i.name,query:KB(i.bundledQuery),readTime:aa(i.readTime)}}(t)),be.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(){this.overlays=new Xt(Ue.comparator),this.Rr=new Map}getOverlay(e,t){return be.resolve(this.overlays.get(t))}getOverlays(e,t){const n=iu();return be.forEach(t,i=>this.getOverlay(e,i).next(a=>{a!==null&&n.set(i,a)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,a)=>{this.Et(e,t,a)}),be.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Rr.get(n);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.Rr.delete(n)),be.resolve()}getOverlaysForCollection(e,t,n){const i=iu(),a=t.length+1,s=new Ue(t.child("")),u=this.overlays.getIteratorFrom(s);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===a&&c.largestBatchId>n&&i.set(c.getKey(),c)}return be.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let a=new Xt((h,d)=>h-d);const s=this.overlays.getIterator();for(;s.hasNext();){const h=s.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let d=a.get(h.largestBatchId);d===null&&(d=iu(),a=a.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const u=iu(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,d)=>u.set(h,d)),!(u.size()>=i)););return be.resolve(u)}Et(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const s=this.Rr.get(i.largestBatchId).delete(n.key);this.Rr.set(i.largestBatchId,s)}this.overlays=this.overlays.insert(n.key,new TB(t,n));let a=this.Rr.get(t);a===void 0&&(a=ft(),this.Rr.set(t,a)),this.Rr.set(t,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(){this.sessionToken=Xn.EMPTY_BYTE_STRING}getSessionToken(e){return be.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,be.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(){this.Vr=new wn(Mn.mr),this.gr=new wn(Mn.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new Mn(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.wr(new Mn(e,t))}Sr(e,t){e.forEach(n=>this.removeReference(n,t))}br(e){const t=new Ue(new jt([])),n=new Mn(t,e),i=new Mn(t,e+1),a=[];return this.gr.forEachInRange([n,i],s=>{this.wr(s),a.push(s.key)}),a}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new Ue(new jt([])),n=new Mn(t,e),i=new Mn(t,e+1);let a=ft();return this.gr.forEachInRange([n,i],s=>{a=a.add(s.key)}),a}containsKey(e){const t=new Mn(e,0),n=this.Vr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Mn{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return Ue.comparator(e.key,t.key)||rt(e.Cr,t.Cr)}static pr(e,t){return rt(e.Cr,t.Cr)||Ue.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new wn(Mn.mr)}checkEmpty(e){return be.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const a=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new EB(a,t,n,i);this.mutationQueue.push(s);for(const u of i)this.Mr=this.Mr.add(new Mn(u.key,a)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return be.resolve(s)}lookupMutationBatch(e,t){return be.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.Nr(n),a=i<0?0:i;return be.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return be.resolve(this.mutationQueue.length===0?Rb:this.Fr-1)}getAllMutationBatches(e){return be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Mn(t,0),i=new Mn(t,Number.POSITIVE_INFINITY),a=[];return this.Mr.forEachInRange([n,i],s=>{const u=this.Or(s.Cr);a.push(u)}),be.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new wn(rt);return t.forEach(i=>{const a=new Mn(i,0),s=new Mn(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([a,s],u=>{n=n.add(u.Cr)})}),be.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let a=n;Ue.isDocumentKey(a)||(a=a.child(""));const s=new Mn(new Ue(a),0);let u=new wn(rt);return this.Mr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Cr)),!0)},s),be.resolve(this.Br(u))}Br(e){const t=[];return e.forEach(n=>{const i=this.Or(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Tt(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.Mr;return be.forEach(t.mutations,i=>{const a=new Mn(i.key,t.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=n})}qn(e){}containsKey(e,t){const n=new Mn(t,0),i=this.Mr.firstAfterOrEqual(n);return be.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,be.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(e){this.kr=e,this.docs=function(){return new Xt(Ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),a=i?i.size:0,s=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return be.resolve(n?n.document.mutableCopy():tr.newInvalidDocument(t))}getEntries(e,t){let n=io();return t.forEach(i=>{const a=this.docs.get(i);n=n.insert(i,a?a.document.mutableCopy():tr.newInvalidDocument(i))}),be.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let a=io();const s=t.path,u=new Ue(s.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:d}}=c.getNext();if(!s.isPrefixOf(h.path))break;h.path.length>s.length+1||FF(LF(d),n)<=0||(i.has(d.key)||Fm(t,d))&&(a=a.insert(d.key,d.mutableCopy()))}return be.resolve(a)}getAllFromCollectionGroup(e,t,n,i){qe()}qr(e,t){return be.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new lV(this)}getSize(e){return be.resolve(this.size)}}class lV extends tV{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(n)}),be.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(e){this.persistence=e,this.Qr=new bu(t=>Nb(t),kb),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Vb,this.targetCount=0,this.Kr=ql.Un()}forEachTarget(e,t){return this.Qr.forEach((n,i)=>t(i)),be.resolve()}getLastRemoteSnapshotVersion(e){return be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return be.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),be.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),be.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new ql(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,be.resolve()}updateTargetData(e,t){return this.zn(t),be.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,be.resolve()}removeTargets(e,t,n){let i=0;const a=[];return this.Qr.forEach((s,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Qr.delete(s),a.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),be.waitFor(a).next(()=>i)}getTargetCount(e){return be.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return be.resolve(n)}addMatchingKeys(e,t,n){return this.Ur.yr(t,n),be.resolve()}removeMatchingKeys(e,t,n){this.Ur.Sr(t,n);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach(s=>{a.push(i.markPotentiallyOrphaned(e,s))}),be.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),be.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ur.vr(t);return be.resolve(n)}containsKey(e,t){return be.resolve(this.Ur.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new km(0),this.zr=!1,this.zr=!0,this.jr=new oV,this.referenceDelegate=e(this),this.Hr=new cV(this),this.indexManager=new XB,this.remoteDocumentCache=function(i){return new uV(i)}(n=>this.referenceDelegate.Jr(n)),this.serializer=new GB(t),this.Yr=new iV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new aV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new sV(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){Ae("MemoryPersistence","Starting transaction:",e);const i=new hV(this.Gr.next());return this.referenceDelegate.Zr(),n(i).next(a=>this.referenceDelegate.Xr(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}ei(e,t){return be.or(Object.values(this.Wr).map(n=>()=>n.containsKey(e,t)))}}class hV extends VF{constructor(e){super(),this.currentSequenceNumber=e}}class Ub{constructor(e){this.persistence=e,this.ti=new Vb,this.ni=null}static ri(e){return new Ub(e)}get ii(){if(this.ni)return this.ni;throw qe()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),be.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),be.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),be.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(i=>this.ii.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(a=>this.ii.add(a.toString()))}).next(()=>n.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return be.forEach(this.ii,n=>{const i=Ue.fromPath(n);return this.si(e,i).next(a=>{a||t.removeEntry(i,$e.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(n=>{n?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return be.or([()=>be.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class $p{constructor(e,t){this.persistence=e,this.oi=new bu(n=>jF(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=eV(this,t)}static ri(e,t){return new $p(e,t)}Zr(){}Xr(e){return be.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}sr(e){let t=0;return this.rr(e,n=>{t++}).next(()=>t)}rr(e,t){return be.forEach(this.oi,(n,i)=>this.ar(e,n,i).next(a=>a?be.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.qr(e,s=>this.ar(e,s,t).next(u=>{u||(n++,a.removeEntry(s,$e.min()))})).next(()=>a.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),be.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),be.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),be.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),be.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Tp(e.data.value)),t}ar(e,t,n){return be.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.oi.get(t);return be.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=i}static Yi(e,t){let n=ft(),i=ft();for(const a of t.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new zb(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return EM()?8:UF(or())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,i){const a={result:null};return this.rs(e,t).next(s=>{a.result=s}).next(()=>{if(!a.result)return this.ss(e,t,i,n).next(s=>{a.result=s})}).next(()=>{if(a.result)return;const s=new fV;return this._s(e,t,s).next(u=>{if(a.result=u,this.Xi)return this.us(e,t,s,u.size)})}).next(()=>a.result)}us(e,t,n,i){return n.documentReadCount<this.es?(wl()<=ht.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",xl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),be.resolve()):(wl()<=ht.DEBUG&&Ae("QueryEngine","Query:",xl(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ts*i?(wl()<=ht.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",xl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ia(t))):be.resolve())}rs(e,t){if(U2(t))return be.resolve(null);let n=ia(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=w0(t,null,"F"),n=ia(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(a=>{const s=ft(...a);return this.ns.getDocuments(e,s).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.cs(t,u);return this.ls(t,h,s,c.readTime)?this.rs(e,w0(t,null,"F")):this.hs(e,h,t,c)}))})))}ss(e,t,n,i){return U2(t)||i.isEqual($e.min())?be.resolve(null):this.ns.getDocuments(e,n).next(a=>{const s=this.cs(t,a);return this.ls(t,s,n,i)?be.resolve(null):(wl()<=ht.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),xl(t)),this.hs(e,s,t,PF(i,Wh)).next(u=>u))})}cs(e,t){let n=new wn(EA(e));return t.forEach((i,a)=>{Fm(e,a)&&(n=n.add(a))}),n}ls(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}_s(e,t,n){return wl()<=ht.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",xl(t)),this.ns.getDocumentsMatchingQuery(e,t,is.min(),n)}hs(e,t,n,i){return this.ns.getDocumentsMatchingQuery(e,n,i).next(a=>(t.forEach(s=>{a=a.insert(s.key,s)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb="LocalStore",pV=3e8;class mV{constructor(e,t,n,i){this.persistence=e,this.Ps=t,this.serializer=i,this.Ts=new Xt(rt),this.Is=new bu(a=>Nb(a),kb),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rV(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function vV(r,e,t,n){return new mV(r,e,t,n)}async function GA(r,e){const t=Ze(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(a=>(i=a,t.As(e),t.mutationQueue.getAllMutationBatches(n))).next(a=>{const s=[],u=[];let c=ft();for(const h of i){s.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}for(const h of a){u.push(h.batchId);for(const d of h.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(n,c).next(h=>({Rs:h,removedBatchIds:s,addedBatchIds:u}))})})}function gV(r,e){const t=Ze(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),a=t.ds.newChangeBuffer({trackRemovals:!0});return function(u,c,h,d){const m=h.batch,v=m.keys();let y=be.resolve();return v.forEach(_=>{y=y.next(()=>d.getEntry(c,_)).next(E=>{const x=h.docVersions.get(_);Tt(x!==null),E.version.compareTo(x)<0&&(m.applyToRemoteDocument(E,h),E.isValidDocument()&&(E.setReadTime(h.commitVersion),d.addEntry(E)))})}),y.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,n,e,a).next(()=>a.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=ft();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function KA(r){const e=Ze(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function yV(r,e){const t=Ze(r),n=e.snapshotVersion;let i=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const s=t.ds.newChangeBuffer({trackRemovals:!0});i=t.Ts;const u=[];e.targetChanges.forEach((d,m)=>{const v=i.get(m);if(!v)return;u.push(t.Hr.removeMatchingKeys(a,d.removedDocuments,m).next(()=>t.Hr.addMatchingKeys(a,d.addedDocuments,m)));let y=v.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Xn.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,n)),i=i.insert(m,y),function(E,x,T){return E.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=pV?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(v,y,d)&&u.push(t.Hr.updateTargetData(a,y))});let c=io(),h=ft();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(a,d))}),u.push(bV(a,s,e.documentUpdates).next(d=>{c=d.Vs,h=d.fs})),!n.isEqual($e.min())){const d=t.Hr.getLastRemoteSnapshotVersion(a).next(m=>t.Hr.setTargetsMetadata(a,a.currentSequenceNumber,n));u.push(d)}return be.waitFor(u).next(()=>s.apply(a)).next(()=>t.localDocuments.getLocalViewOfDocuments(a,c,h)).next(()=>c)}).then(a=>(t.Ts=i,a))}function bV(r,e,t){let n=ft(),i=ft();return t.forEach(a=>n=n.add(a)),e.getEntries(r,n).next(a=>{let s=io();return t.forEach((u,c)=>{const h=a.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual($e.min())?(e.removeEntry(u,c.readTime),s=s.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),s=s.insert(u,c)):Ae(jb,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Vs:s,fs:i}})}function _V(r,e){const t=Ze(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Rb),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function wV(r,e){const t=Ze(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Hr.getTargetData(n,e).next(a=>a?(i=a,be.resolve(i)):t.Hr.allocateTargetId(n).next(s=>(i=new Ko(e,s,"TargetPurposeListen",n.currentSequenceNumber),t.Hr.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.Ts.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(n.targetId,n),t.Is.set(e,n.targetId)),n})}async function C0(r,e,t){const n=Ze(r),i=n.Ts.get(e),a=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",a,s=>n.persistence.referenceDelegate.removeTarget(s,i))}catch(s){if(!oc(s))throw s;Ae(jb,`Failed to update sequence numbers for target ${e}: ${s}`)}n.Ts=n.Ts.remove(e),n.Is.delete(i.target)}function J2(r,e,t){const n=Ze(r);let i=$e.min(),a=ft();return n.persistence.runTransaction("Execute query","readwrite",s=>function(c,h,d){const m=Ze(c),v=m.Is.get(d);return v!==void 0?be.resolve(m.Ts.get(v)):m.Hr.getTargetData(h,d)}(n,s,ia(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Hr.getMatchingKeysForTargetId(s,u.targetId).next(c=>{a=c})}).next(()=>n.Ps.getDocumentsMatchingQuery(s,e,t?i:$e.min(),t?a:ft())).next(u=>(xV(n,uB(e),u),{documents:u,gs:a})))}function xV(r,e,t){let n=r.Es.get(e)||$e.min();t.forEach((i,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)}),r.Es.set(e,n)}class eT{constructor(){this.activeTargetIds=pB()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class EV{constructor(){this.ho=new eT,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new eT,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="ConnectivityMonitor";class nT{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Ae(tT,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Ae(tT,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ep=null;function A0(){return ep===null?ep=function(){return 268435456+Math.round(2147483648*Math.random())}():ep++,"0x"+ep.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="RestConnection",SV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class CV{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${i}`,this.wo=this.databaseId.database===jp?`project_id=${n}`:`project_id=${n}&database_id=${i}`}So(e,t,n,i,a){const s=A0(),u=this.bo(e,t.toUriEncodedString());Ae(Ay,`Sending RPC '${e}' ${s}:`,u,n);const c={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(c,i,a),this.vo(e,u,c,n).then(h=>(Ae(Ay,`Received RPC '${e}' ${s}: `,h),h),h=>{throw zl(Ay,`RPC '${e}' ${s} failed with error: `,h,"url: ",u,"request:",n),h})}Co(e,t,n,i,a,s){return this.So(e,t,n,i,a)}Do(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ic}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,a)=>e[a]=i),n&&n.headers.forEach((i,a)=>e[a]=i)}bo(e,t){const n=SV[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zn="WebChannelConnection";class RV extends CV{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,i){const a=A0();return new Promise((s,u)=>{const c=new ZC;c.setWithCredentials(!0),c.listenOnce(JC.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ep.NO_ERROR:const d=c.getResponseJson();Ae(Zn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(d)),s(d);break;case Ep.TIMEOUT:Ae(Zn,`RPC '${e}' ${a} timed out`),u(new Be(we.DEADLINE_EXCEEDED,"Request time out"));break;case Ep.HTTP_ERROR:const m=c.getStatus();if(Ae(Zn,`RPC '${e}' ${a} failed with status:`,m,"response text:",c.getResponseText()),m>0){let v=c.getResponseJson();Array.isArray(v)&&(v=v[0]);const y=v==null?void 0:v.error;if(y&&y.status&&y.message){const _=function(x){const T=x.toLowerCase().replace(/_/g,"-");return Object.values(we).indexOf(T)>=0?T:we.UNKNOWN}(y.status);u(new Be(_,y.message))}else u(new Be(we.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new Be(we.UNAVAILABLE,"Connection failed."));break;default:qe()}}finally{Ae(Zn,`RPC '${e}' ${a} completed.`)}});const h=JSON.stringify(i);Ae(Zn,`RPC '${e}' ${a} sending request:`,i),c.send(t,"POST",h,n,15)})}Wo(e,t,n){const i=A0(),a=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=nA(),u=tA(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const d=a.join("");Ae(Zn,`Creating RPC '${e}' stream ${i}: ${d}`,c);const m=s.createWebChannel(d,c);let v=!1,y=!1;const _=new AV({Fo:x=>{y?Ae(Zn,`Not sending because RPC '${e}' stream ${i} is closed:`,x):(v||(Ae(Zn,`Opening RPC '${e}' stream ${i} transport.`),m.open(),v=!0),Ae(Zn,`RPC '${e}' stream ${i} sending:`,x),m.send(x))},Mo:()=>m.close()}),E=(x,T,C)=>{x.listen(T,A=>{try{C(A)}catch(R){setTimeout(()=>{throw R},0)}})};return E(m,Ah.EventType.OPEN,()=>{y||(Ae(Zn,`RPC '${e}' stream ${i} transport opened.`),_.Qo())}),E(m,Ah.EventType.CLOSE,()=>{y||(y=!0,Ae(Zn,`RPC '${e}' stream ${i} transport closed`),_.Uo())}),E(m,Ah.EventType.ERROR,x=>{y||(y=!0,zl(Zn,`RPC '${e}' stream ${i} transport errored:`,x),_.Uo(new Be(we.UNAVAILABLE,"The operation could not be completed")))}),E(m,Ah.EventType.MESSAGE,x=>{var T;if(!y){const C=x.data[0];Tt(!!C);const A=C,R=(A==null?void 0:A.error)||((T=A[0])===null||T===void 0?void 0:T.error);if(R){Ae(Zn,`RPC '${e}' stream ${i} received error:`,R);const k=R.status;let B=function(D){const O=cn[D];if(O!==void 0)return MA(O)}(k),P=R.message;B===void 0&&(B=we.INTERNAL,P="Unknown error status: "+k+" with message "+R.message),y=!0,_.Uo(new Be(B,P)),m.close()}else Ae(Zn,`RPC '${e}' stream ${i} received:`,C),_.Ko(C)}}),E(u,eA.STAT_EVENT,x=>{x.stat===m0.PROXY?Ae(Zn,`RPC '${e}' stream ${i} detected buffering proxy`):x.stat===m0.NOPROXY&&Ae(Zn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{_.$o()},0),_}}function Ry(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(r){return new kB(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,t,n=1e3,i=1.5,a=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=i,this.jo=a,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),i=Math.max(0,t-n);i>0&&Ae("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT="PersistentStream";class $A{constructor(e,t,n,i,a,s,u,c){this.Ti=e,this.n_=n,this.r_=i,this.connection=a,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new XA(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===we.RESOURCE_EXHAUSTED?(ro(t.toString()),ro("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===we.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.i_===t&&this.V_(n,i)},n=>{e(()=>{const i=new Be(we.UNKNOWN,"Fetching auth token failed: "+n.message);return this.m_(i)})})}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{n(()=>this.m_(i))}),this.stream.onMessage(i=>{n(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Ae(rT,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(Ae(rT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class IV extends $A{constructor(e,t,n,i,a,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=a}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=PB(this.serializer,e),n=function(a){if(!("targetChange"in a))return $e.min();const s=a.targetChange;return s.targetIds&&s.targetIds.length?$e.min():s.readTime?aa(s.readTime):$e.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=S0(this.serializer),t.addTarget=function(a,s){let u;const c=s.target;if(u=_0(c)?{documents:BB(a,c)}:{query:VB(a,c).ht},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){u.resumeToken=FA(a,s.resumeToken);const h=x0(a,s.expectedCount);h!==null&&(u.expectedCount=h)}else if(s.snapshotVersion.compareTo($e.min())>0){u.readTime=Xp(a,s.snapshotVersion.toTimestamp());const h=x0(a,s.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,e);const n=zB(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=S0(this.serializer),t.removeTarget=e,this.I_(t)}}class DV extends $A{constructor(e,t,n,i,a,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=a}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return Tt(!!e.streamToken),this.lastStreamToken=e.streamToken,Tt(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){Tt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=FB(e.writeResults,e.commitTime),n=aa(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=S0(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>LB(this.serializer,n))};this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{}class kV extends NV{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new Be(we.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,s])=>this.connection.So(e,E0(t,n),i,a,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Be(we.UNKNOWN,a.toString())})}Co(e,t,n,i,a){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection.Co(e,E0(t,n),i,s,u,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===we.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Be(we.UNKNOWN,s.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class OV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(ro(t),this.N_=!1):Ae("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du="RemoteStore";class MV{constructor(e,t,n,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=a,this.z_.To(s=>{n.enqueueAndForget(async()=>{_u(this)&&(Ae(du,"Restarting streams for network reachability change."),await async function(c){const h=Ze(c);h.W_.add(4),await pf(h),h.j_.set("Unknown"),h.W_.delete(4),await jm(h)}(this))})}),this.j_=new OV(n,i)}}async function jm(r){if(_u(r))for(const e of r.G_)await e(!0)}async function pf(r){for(const e of r.G_)await e(!1)}function YA(r,e){const t=Ze(r);t.K_.has(e.targetId)||(t.K_.set(e.targetId,e),Gb(t)?qb(t):sc(t).c_()&&Wb(t,e))}function Hb(r,e){const t=Ze(r),n=sc(t);t.K_.delete(e),n.c_()&&QA(t,e),t.K_.size===0&&(n.c_()?n.P_():_u(t)&&t.j_.set("Unknown"))}function Wb(r,e){if(r.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}sc(r).y_(e)}function QA(r,e){r.H_.Ne(e),sc(r).w_(e)}function qb(r){r.H_=new RB({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>r.K_.get(e)||null,it:()=>r.datastore.serializer.databaseId}),sc(r).start(),r.j_.B_()}function Gb(r){return _u(r)&&!sc(r).u_()&&r.K_.size>0}function _u(r){return Ze(r).W_.size===0}function ZA(r){r.H_=void 0}async function PV(r){r.j_.set("Online")}async function LV(r){r.K_.forEach((e,t)=>{Wb(r,e)})}async function FV(r,e){ZA(r),Gb(r)?(r.j_.q_(e),qb(r)):r.j_.set("Unknown")}async function BV(r,e,t){if(r.j_.set("Online"),e instanceof LA&&e.state===2&&e.cause)try{await async function(i,a){const s=a.cause;for(const u of a.targetIds)i.K_.has(u)&&(await i.remoteSyncer.rejectListen(u,s),i.K_.delete(u),i.H_.removeTarget(u))}(r,e)}catch(n){Ae(du,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yp(r,n)}else if(e instanceof Ap?r.H_.We(e):e instanceof PA?r.H_.Ze(e):r.H_.je(e),!t.isEqual($e.min()))try{const n=await KA(r.localStore);t.compareTo(n)>=0&&await function(a,s){const u=a.H_.ot(s);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const d=a.K_.get(h);d&&a.K_.set(h,d.withResumeToken(c.resumeToken,s))}}),u.targetMismatches.forEach((c,h)=>{const d=a.K_.get(c);if(!d)return;a.K_.set(c,d.withResumeToken(Xn.EMPTY_BYTE_STRING,d.snapshotVersion)),QA(a,c);const m=new Ko(d.target,c,h,d.sequenceNumber);Wb(a,m)}),a.remoteSyncer.applyRemoteEvent(u)}(r,t)}catch(n){Ae(du,"Failed to raise snapshot:",n),await Yp(r,n)}}async function Yp(r,e,t){if(!oc(e))throw e;r.W_.add(1),await pf(r),r.j_.set("Offline"),t||(t=()=>KA(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Ae(du,"Retrying IndexedDB access"),await t(),r.W_.delete(1),await jm(r)})}function JA(r,e){return e().catch(t=>Yp(r,t,e))}async function Hm(r){const e=Ze(r),t=us(e);let n=e.U_.length>0?e.U_[e.U_.length-1].batchId:Rb;for(;VV(e);)try{const i=await _V(e.localStore,n);if(i===null){e.U_.length===0&&t.P_();break}n=i.batchId,UV(e,i)}catch(i){await Yp(e,i)}eR(e)&&tR(e)}function VV(r){return _u(r)&&r.U_.length<10}function UV(r,e){r.U_.push(e);const t=us(r);t.c_()&&t.S_&&t.b_(e.mutations)}function eR(r){return _u(r)&&!us(r).u_()&&r.U_.length>0}function tR(r){us(r).start()}async function zV(r){us(r).C_()}async function jV(r){const e=us(r);for(const t of r.U_)e.b_(t.mutations)}async function HV(r,e,t){const n=r.U_.shift(),i=Lb.from(n,e,t);await JA(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await Hm(r)}async function WV(r,e){e&&us(r).S_&&await async function(n,i){if(function(s){return CB(s)&&s!==we.ABORTED}(i.code)){const a=n.U_.shift();us(n).h_(),await JA(n,()=>n.remoteSyncer.rejectFailedWrite(a.batchId,i)),await Hm(n)}}(r,e),eR(r)&&tR(r)}async function iT(r,e){const t=Ze(r);t.asyncQueue.verifyOperationInProgress(),Ae(du,"RemoteStore received new credentials");const n=_u(t);t.W_.add(3),await pf(t),n&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await jm(t)}async function qV(r,e){const t=Ze(r);e?(t.W_.delete(2),await jm(t)):e||(t.W_.add(2),await pf(t),t.j_.set("Unknown"))}function sc(r){return r.J_||(r.J_=function(t,n,i){const a=Ze(t);return a.M_(),new IV(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(r.datastore,r.asyncQueue,{xo:PV.bind(null,r),No:LV.bind(null,r),Lo:FV.bind(null,r),p_:BV.bind(null,r)}),r.G_.push(async e=>{e?(r.J_.h_(),Gb(r)?qb(r):r.j_.set("Unknown")):(await r.J_.stop(),ZA(r))})),r.J_}function us(r){return r.Y_||(r.Y_=function(t,n,i){const a=Ze(t);return a.M_(),new DV(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:zV.bind(null,r),Lo:WV.bind(null,r),D_:jV.bind(null,r),v_:HV.bind(null,r)}),r.G_.push(async e=>{e?(r.Y_.h_(),await Hm(r)):(await r.Y_.stop(),r.U_.length>0&&(Ae(du,`Stopping write stream with ${r.U_.length} pending writes`),r.U_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e,t,n,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=a,this.deferred=new Ja,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,a){const s=Date.now()+n,u=new Kb(e,t,s,i,a);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(we.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xb(r,e){if(ro("AsyncQueue",`${e}: ${r}`),oc(r))return new Be(we.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{static emptySet(e){return new kl(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ue.comparator(t.key,n.key):(t,n)=>Ue.comparator(t.key,n.key),this.keyedMap=Rh(),this.sortedSet=new Xt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof kl)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new kl;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT{constructor(){this.Z_=new Xt(Ue.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?e.type!==0&&n.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&n.type!==1?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.Z_=this.Z_.remove(t):e.type===1&&n.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):qe():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Gl{constructor(e,t,n,i,a,s,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=a,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,a){const s=[];return t.forEach(u=>{s.push({type:0,doc:u})}),new Gl(e,t,kl.emptySet(t),s,n,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class KV{constructor(){this.queries=oT(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,n){const i=Ze(t),a=i.queries;i.queries=oT(),a.forEach((s,u)=>{for(const c of u.ta)c.onError(n)})})(this,new Be(we.ABORTED,"Firestore shutting down"))}}function oT(){return new bu(r=>xA(r),Lm)}async function nR(r,e){const t=Ze(r);let n=3;const i=e.query;let a=t.queries.get(i);a?!a.na()&&e.ra()&&(n=2):(a=new GV,n=e.ra()?0:1);try{switch(n){case 0:a.ea=await t.onListen(i,!0);break;case 1:a.ea=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(s){const u=Xb(s,`Initialization of query '${xl(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,a),a.ta.push(e),e.sa(t.onlineState),a.ea&&e.oa(a.ea)&&$b(t)}async function rR(r,e){const t=Ze(r),n=e.query;let i=3;const a=t.queries.get(n);if(a){const s=a.ta.indexOf(e);s>=0&&(a.ta.splice(s,1),a.ta.length===0?i=e.ra()?0:1:!a.na()&&e.ra()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function XV(r,e){const t=Ze(r);let n=!1;for(const i of e){const a=i.query,s=t.queries.get(a);if(s){for(const u of s.ta)u.oa(i)&&(n=!0);s.ea=i}}n&&$b(t)}function $V(r,e,t){const n=Ze(r),i=n.queries.get(e);if(i)for(const a of i.ta)a.onError(t);n.queries.delete(e)}function $b(r){r.ia.forEach(e=>{e.next()})}var R0,sT;(sT=R0||(R0={}))._a="default",sT.Cache="cache";class iR{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Gl(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const n=t!=="Offline";return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Gl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==R0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(e){this.key=e}}class oR{constructor(e){this.key=e}}class YV{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=ft(),this.mutatedKeys=ft(),this.ya=EA(e),this.wa=new kl(this.ya)}get Sa(){return this.fa}ba(e,t){const n=t?t.Da:new aT,i=t?t.wa:this.wa;let a=t?t.mutatedKeys:this.mutatedKeys,s=i,u=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{const v=i.get(d),y=Fm(this.query,m)?m:null,_=!!v&&this.mutatedKeys.has(v.key),E=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let x=!1;v&&y?v.data.isEqual(y.data)?_!==E&&(n.track({type:3,doc:y}),x=!0):this.va(v,y)||(n.track({type:2,doc:y}),x=!0,(c&&this.ya(y,c)>0||h&&this.ya(y,h)<0)&&(u=!0)):!v&&y?(n.track({type:0,doc:y}),x=!0):v&&!y&&(n.track({type:1,doc:v}),x=!0,(c||h)&&(u=!0)),x&&(y?(s=s.add(y),a=E?a.add(d):a.delete(d)):(s=s.delete(d),a=a.delete(d)))}),this.query.limit!==null)for(;s.size>this.query.limit;){const d=this.query.limitType==="F"?s.last():s.first();s=s.delete(d.key),a=a.delete(d.key),n.track({type:1,doc:d})}return{wa:s,Da:n,ls:u,mutatedKeys:a}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const a=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const s=e.Da.X_();s.sort((d,m)=>function(y,_){const E=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qe()}};return E(y)-E(_)}(d.type,m.type)||this.ya(d.doc,m.doc)),this.Ca(n),i=i!=null&&i;const u=t&&!i?this.Fa():[],c=this.pa.size===0&&this.current&&!i?1:0,h=c!==this.ga;return this.ga=c,s.length!==0||h?{snapshot:new Gl(this.query,e.wa,a,s,e.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:u}:{Ma:u}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new aT,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=ft(),this.wa.forEach(n=>{this.xa(n.key)&&(this.pa=this.pa.add(n.key))});const t=[];return e.forEach(n=>{this.pa.has(n)||t.push(new oR(n))}),this.pa.forEach(n=>{e.has(n)||t.push(new aR(n))}),t}Oa(e){this.fa=e.gs,this.pa=ft();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Gl.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Yb="SyncEngine";class QV{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ZV{constructor(e){this.key=e,this.Ba=!1}}class JV{constructor(e,t,n,i,a,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=s,this.La={},this.ka=new bu(u=>xA(u),Lm),this.qa=new Map,this.Qa=new Set,this.$a=new Xt(Ue.comparator),this.Ua=new Map,this.Ka=new Vb,this.Wa={},this.Ga=new Map,this.za=ql.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function eU(r,e,t=!0){const n=fR(r);let i;const a=n.ka.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.Na()):i=await sR(n,e,t,!0),i}async function tU(r,e){const t=fR(r);await sR(t,e,!0,!1)}async function sR(r,e,t,n){const i=await wV(r.localStore,ia(e)),a=i.targetId,s=r.sharedClientState.addLocalQueryTarget(a,t);let u;return n&&(u=await nU(r,e,a,s==="current",i.resumeToken)),r.isPrimaryClient&&t&&YA(r.remoteStore,i),u}async function nU(r,e,t,n,i){r.Ha=(m,v,y)=>async function(E,x,T,C){let A=x.view.ba(T);A.ls&&(A=await J2(E.localStore,x.query,!1).then(({documents:P})=>x.view.ba(P,A)));const R=C&&C.targetChanges.get(x.targetId),k=C&&C.targetMismatches.get(x.targetId)!=null,B=x.view.applyChanges(A,E.isPrimaryClient,R,k);return lT(E,x.targetId,B.Ma),B.snapshot}(r,m,v,y);const a=await J2(r.localStore,e,!0),s=new YV(e,a.gs),u=s.ba(a.documents),c=df.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=s.applyChanges(u,r.isPrimaryClient,c);lT(r,t,h.Ma);const d=new QV(e,t,s);return r.ka.set(e,d),r.qa.has(t)?r.qa.get(t).push(e):r.qa.set(t,[e]),h.snapshot}async function rU(r,e,t){const n=Ze(r),i=n.ka.get(e),a=n.qa.get(i.targetId);if(a.length>1)return n.qa.set(i.targetId,a.filter(s=>!Lm(s,e))),void n.ka.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await C0(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Hb(n.remoteStore,i.targetId),I0(n,i.targetId)}).catch(ac)):(I0(n,i.targetId),await C0(n.localStore,i.targetId,!0))}async function iU(r,e){const t=Ze(r),n=t.ka.get(e),i=t.qa.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Hb(t.remoteStore,n.targetId))}async function aU(r,e,t){const n=fU(r);try{const i=await function(s,u){const c=Ze(s),h=_n.now(),d=u.reduce((y,_)=>y.add(_.key),ft());let m,v;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let _=io(),E=ft();return c.ds.getEntries(y,d).next(x=>{_=x,_.forEach((T,C)=>{C.isValidDocument()||(E=E.add(T))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,_)).next(x=>{m=x;const T=[];for(const C of u){const A=wB(C,m.get(C.key).overlayedDocument);A!=null&&T.push(new vs(C.key,A,mA(A.value.mapValue),Ei.exists(!0)))}return c.mutationQueue.addMutationBatch(y,h,T,u)}).next(x=>{v=x;const T=x.applyToLocalDocumentSet(m,E);return c.documentOverlayCache.saveOverlays(y,x.batchId,T)})}).then(()=>({batchId:v.batchId,changes:SA(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(s,u,c){let h=s.Wa[s.currentUser.toKey()];h||(h=new Xt(rt)),h=h.insert(u,c),s.Wa[s.currentUser.toKey()]=h}(n,i.batchId,t),await mf(n,i.changes),await Hm(n.remoteStore)}catch(i){const a=Xb(i,"Failed to persist write");t.reject(a)}}async function uR(r,e){const t=Ze(r);try{const n=await yV(t.localStore,e);e.targetChanges.forEach((i,a)=>{const s=t.Ua.get(a);s&&(Tt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?s.Ba=!0:i.modifiedDocuments.size>0?Tt(s.Ba):i.removedDocuments.size>0&&(Tt(s.Ba),s.Ba=!1))}),await mf(t,n,e)}catch(n){await ac(n)}}function uT(r,e,t){const n=Ze(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.ka.forEach((a,s)=>{const u=s.view.sa(e);u.snapshot&&i.push(u.snapshot)}),function(s,u){const c=Ze(s);c.onlineState=u;let h=!1;c.queries.forEach((d,m)=>{for(const v of m.ta)v.sa(u)&&(h=!0)}),h&&$b(c)}(n.eventManager,e),i.length&&n.La.p_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function oU(r,e,t){const n=Ze(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Ua.get(e),a=i&&i.key;if(a){let s=new Xt(Ue.comparator);s=s.insert(a,tr.newNoDocument(a,$e.min()));const u=ft().add(a),c=new Um($e.min(),new Map,new Xt(rt),s,u);await uR(n,c),n.$a=n.$a.remove(a),n.Ua.delete(e),Qb(n)}else await C0(n.localStore,e,!1).then(()=>I0(n,e,t)).catch(ac)}async function sU(r,e){const t=Ze(r),n=e.batch.batchId;try{const i=await gV(t.localStore,e);cR(t,n,null),lR(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await mf(t,i)}catch(i){await ac(i)}}async function uU(r,e,t){const n=Ze(r);try{const i=await function(s,u){const c=Ze(s);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return c.mutationQueue.lookupMutationBatch(h,u).next(m=>(Tt(m!==null),d=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,d,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>c.localDocuments.getDocuments(h,d))})}(n.localStore,e);cR(n,e,t),lR(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await mf(n,i)}catch(i){await ac(i)}}function lR(r,e){(r.Ga.get(e)||[]).forEach(t=>{t.resolve()}),r.Ga.delete(e)}function cR(r,e,t){const n=Ze(r);let i=n.Wa[n.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),n.Wa[n.currentUser.toKey()]=i}}function I0(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.qa.get(e))r.ka.delete(n),t&&r.La.Ja(n,t);r.qa.delete(e),r.isPrimaryClient&&r.Ka.br(e).forEach(n=>{r.Ka.containsKey(n)||hR(r,n)})}function hR(r,e){r.Qa.delete(e.path.canonicalString());const t=r.$a.get(e);t!==null&&(Hb(r.remoteStore,t),r.$a=r.$a.remove(e),r.Ua.delete(t),Qb(r))}function lT(r,e,t){for(const n of t)n instanceof aR?(r.Ka.addReference(n.key,e),lU(r,n)):n instanceof oR?(Ae(Yb,"Document no longer in limbo: "+n.key),r.Ka.removeReference(n.key,e),r.Ka.containsKey(n.key)||hR(r,n.key)):qe()}function lU(r,e){const t=e.key,n=t.path.canonicalString();r.$a.get(t)||r.Qa.has(n)||(Ae(Yb,"New document in limbo: "+t),r.Qa.add(n),Qb(r))}function Qb(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const e=r.Qa.values().next().value;r.Qa.delete(e);const t=new Ue(jt.fromString(e)),n=r.za.next();r.Ua.set(n,new ZV(t)),r.$a=r.$a.insert(t,n),YA(r.remoteStore,new Ko(ia(Ob(t.path)),n,"TargetPurposeLimboResolution",km.ae))}}async function mf(r,e,t){const n=Ze(r),i=[],a=[],s=[];n.ka.isEmpty()||(n.ka.forEach((u,c)=>{s.push(n.Ha(c,e,t).then(h=>{var d;if((h||t)&&n.isPrimaryClient){const m=h?!h.fromCache:(d=t==null?void 0:t.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){i.push(h);const m=zb.Yi(c.targetId,h);a.push(m)}}))}),await Promise.all(s),n.La.p_(i),await async function(c,h){const d=Ze(c);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>be.forEach(h,v=>be.forEach(v.Hi,y=>d.persistence.referenceDelegate.addReference(m,v.targetId,y)).next(()=>be.forEach(v.Ji,y=>d.persistence.referenceDelegate.removeReference(m,v.targetId,y)))))}catch(m){if(!oc(m))throw m;Ae(jb,"Failed to update sequence numbers: "+m)}for(const m of h){const v=m.targetId;if(!m.fromCache){const y=d.Ts.get(v),_=y.snapshotVersion,E=y.withLastLimboFreeSnapshotVersion(_);d.Ts=d.Ts.insert(v,E)}}}(n.localStore,a))}async function cU(r,e){const t=Ze(r);if(!t.currentUser.isEqual(e)){Ae(Yb,"User change. New user:",e.toKey());const n=await GA(t.localStore,e);t.currentUser=e,function(a,s){a.Ga.forEach(u=>{u.forEach(c=>{c.reject(new Be(we.CANCELLED,s))})}),a.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await mf(t,n.Rs)}}function hU(r,e){const t=Ze(r),n=t.Ua.get(e);if(n&&n.Ba)return ft().add(n.key);{let i=ft();const a=t.qa.get(e);if(!a)return i;for(const s of a){const u=t.ka.get(s);i=i.unionWith(u.view.Sa)}return i}}function fR(r){const e=Ze(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=uR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oU.bind(null,e),e.La.p_=XV.bind(null,e.eventManager),e.La.Ja=$V.bind(null,e.eventManager),e}function fU(r){const e=Ze(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uU.bind(null,e),e}class Qp{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=zm(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return vV(this.persistence,new dV,e.initialUser,this.serializer)}Xa(e){return new qA(Ub.ri,this.serializer)}Za(e){return new EV}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Qp.provider={build:()=>new Qp};class dU extends Qp{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){Tt(this.persistence.referenceDelegate instanceof $p);const n=this.persistence.referenceDelegate.garbageCollector;return new ZB(n,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?yr.withCacheSize(this.cacheSizeBytes):yr.DEFAULT;return new qA(n=>$p.ri(n,t),this.serializer)}}class D0{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>uT(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=cU.bind(null,this.syncEngine),await qV(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new KV}()}createDatastore(e){const t=zm(e.databaseInfo.databaseId),n=function(a){return new RV(a)}(e.databaseInfo);return function(a,s,u,c){return new kV(a,s,u,c)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,a,s,u){return new MV(n,i,a,s,u)}(this.localStore,this.datastore,e.asyncQueue,t=>uT(this.syncEngine,t,0),function(){return nT.D()?new nT:new TV}())}createSyncEngine(e,t){return function(i,a,s,u,c,h,d){const m=new JV(i,a,s,u,c,h);return d&&(m.ja=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const a=Ze(i);Ae(du,"RemoteStore shutting down."),a.W_.add(5),await pf(a),a.z_.shutdown(),a.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}D0.provider={build:()=>new D0};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):ro("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ls="FirestoreClient";class pU{constructor(e,t,n,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Jn.UNAUTHENTICATED,this.clientId=aA.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,async s=>{Ae(ls,"Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(n,s=>(Ae(ls,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ja;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Xb(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Iy(r,e){r.asyncQueue.verifyOperationInProgress(),Ae(ls,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await GA(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function cT(r,e){r.asyncQueue.verifyOperationInProgress();const t=await mU(r);Ae(ls,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>iT(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>iT(e.remoteStore,i)),r._onlineComponents=e}async function mU(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ae(ls,"Using user provided OfflineComponentProvider");try{await Iy(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===we.FAILED_PRECONDITION||i.code===we.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;zl("Error using user provided cache. Falling back to memory cache: "+t),await Iy(r,new Qp)}}else Ae(ls,"Using default OfflineComponentProvider"),await Iy(r,new dU(void 0));return r._offlineComponents}async function pR(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ae(ls,"Using user provided OnlineComponentProvider"),await cT(r,r._uninitializedComponentsProvider._online)):(Ae(ls,"Using default OnlineComponentProvider"),await cT(r,new D0))),r._onlineComponents}function vU(r){return pR(r).then(e=>e.syncEngine)}async function mR(r){const e=await pR(r),t=e.eventManager;return t.onListen=eU.bind(null,e.syncEngine),t.onUnlisten=rU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=tU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=iU.bind(null,e.syncEngine),t}function gU(r,e,t={}){const n=new Ja;return r.asyncQueue.enqueueAndForget(async()=>function(a,s,u,c,h){const d=new dR({next:v=>{d.su(),s.enqueueAndForget(()=>rR(a,m));const y=v.docs.has(u);!y&&v.fromCache?h.reject(new Be(we.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&v.fromCache&&c&&c.source==="server"?h.reject(new Be(we.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(v)},error:v=>h.reject(v)}),m=new iR(Ob(u.path),d,{includeMetadataChanges:!0,Ta:!0});return nR(a,m)}(await mR(r),r.asyncQueue,e,t,n)),n.promise}function yU(r,e,t={}){const n=new Ja;return r.asyncQueue.enqueueAndForget(async()=>function(a,s,u,c,h){const d=new dR({next:v=>{d.su(),s.enqueueAndForget(()=>rR(a,m)),v.fromCache&&c.source==="server"?h.reject(new Be(we.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(v)},error:v=>h.reject(v)}),m=new iR(u,d,{includeMetadataChanges:!0,Ta:!0});return nR(a,m)}(await mR(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vR(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gR(r,e,t){if(!t)throw new Be(we.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function bU(r,e,t,n){if(e===!0&&n===!0)throw new Be(we.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function fT(r){if(!Ue.isDocumentKey(r))throw new Be(we.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function dT(r){if(Ue.isDocumentKey(r))throw new Be(we.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zb(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":qe()}function da(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Be(we.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zb(r);throw new Be(we.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR="firestore.googleapis.com",pT=!0;class mT{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new Be(we.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yR,this.ssl=pT}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:pT;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=WA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YB)throw new Be(we.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}bU("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vR((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new Be(we.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new Be(we.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new Be(we.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wm{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(we.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Be(we.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new CF;switch(n.type){case"firstParty":return new DF(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Be(we.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=hT.get(t);n&&(Ae("ComponentProvider","Removing Datastore"),hT.delete(t),n.terminate())}(this),Promise.resolve()}}function _U(r,e,t,n={}){var i;const a=(r=da(r,Wm))._getSettings(),s=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),u=`${e}:${t}`;a.host!==yR&&a.host!==u&&zl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=Object.assign(Object.assign({},a),{host:u,ssl:!1,emulatorOptions:n});if(!rs(c,s)&&(r._setSettings(c),n.mockUserToken)){let h,d;if(typeof n.mockUserToken=="string")h=n.mockUserToken,d=Jn.MOCK_USER;else{h=gM(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new Be(we.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Jn(m)}r._authCredentials=new AF(new rA(h,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qm(this.firestore,e,this._query)}}class Tr{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tr(this.firestore,e,this._key)}}class Jo extends qm{constructor(e,t,n){super(e,t,Ob(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Tr(this.firestore,null,new Ue(e))}withConverter(e){return new Jo(this.firestore,e,this._path)}}function Jb(r,e,...t){if(r=Tn(r),gR("collection","path",e),r instanceof Wm){const n=jt.fromString(e,...t);return dT(n),new Jo(r,null,n)}{if(!(r instanceof Tr||r instanceof Jo))throw new Be(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(jt.fromString(e,...t));return dT(n),new Jo(r.firestore,null,n)}}function oa(r,e,...t){if(r=Tn(r),arguments.length===1&&(e=aA.newId()),gR("doc","path",e),r instanceof Wm){const n=jt.fromString(e,...t);return fT(n),new Tr(r,null,new Ue(n))}{if(!(r instanceof Tr||r instanceof Jo))throw new Be(we.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(jt.fromString(e,...t));return fT(n),new Tr(r.firestore,r instanceof Jo?r.converter:null,new Ue(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT="AsyncQueue";class gT{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new XA(this,"async_queue_retry"),this.Su=()=>{const n=Ry();n&&Ae(vT,"Visibility state changed to "+n.visibilityState),this.a_.t_()},this.bu=e;const t=Ry();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=Ry();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new Ja;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!oc(e))throw e;Ae(vT,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.bu.then(()=>(this.pu=!0,e().catch(n=>{this.gu=n,this.pu=!1;const i=function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),u}(n);throw ro("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.pu=!1,n))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const i=Kb.createAndSchedule(this,e,t,n,a=>this.Fu(a));return this.fu.push(i),i}Du(){this.gu&&qe()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}class uc extends Wm{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new gT,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gT(e),this._firestoreClient=void 0,await e}}}function wU(r,e){const t=typeof r=="object"?r:cb(),n=typeof r=="string"?r:jp,i=yu(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const a=mM("firestore");a&&_U(i,...a)}return i}function e_(r){if(r._terminated)throw new Be(we.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||xU(r),r._firestoreClient}function xU(r){var e,t,n;const i=r._freezeSettings(),a=function(u,c,h,d){return new qF(u,c,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,vR(d.experimentalLongPollingOptions),d.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new pU(r._authCredentials,r._appCheckCredentials,r._queue,a,r._componentsProvider&&function(u){const c=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(c),_online:c}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Kl(Xn.fromBase64String(e))}catch(t){throw new Be(we.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Kl(Xn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Be(we.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Be(we.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Be(we.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rt(this._lat,e._lat)||rt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EU=/^__.*__$/;class TU{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new vs(e,this.data,this.fieldMask,t,this.fieldTransforms):new ff(e,this.data,t,this.fieldTransforms)}}class bR{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new vs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function _R(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qe()}}class i_{constructor(e,t,n,i,a,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,a===void 0&&this.Bu(),this.fieldTransforms=a||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new i_(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.$u(e),i}Uu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.ku({path:n,Qu:!1});return i.Bu(),i}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Zp(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(_R(this.Lu)&&EU.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class SU{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zm(e)}ju(e,t,n,i=!1){return new i_({Lu:e,methodName:t,zu:n,path:Kn.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wR(r){const e=r._freezeSettings(),t=zm(r._databaseId);return new SU(r._databaseId,!!e.ignoreUndefinedProperties,t)}function CU(r,e,t,n,i,a={}){const s=r.ju(a.merge||a.mergeFields?2:0,e,t,i);a_("Data must be an object, but it was:",s,n);const u=xR(n,s);let c,h;if(a.merge)c=new Ur(s.fieldMask),h=s.fieldTransforms;else if(a.mergeFields){const d=[];for(const m of a.mergeFields){const v=N0(e,m,t);if(!s.contains(v))throw new Be(we.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);TR(d,v)||d.push(v)}c=new Ur(d),h=s.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=s.fieldTransforms;return new TU(new _r(u),c,h)}class Km extends t_{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Km}}function AU(r,e,t,n){const i=r.ju(1,e,t);a_("Data must be an object, but it was:",i,n);const a=[],s=_r.empty();ms(n,(c,h)=>{const d=o_(e,c,t);h=Tn(h);const m=i.Uu(d);if(h instanceof Km)a.push(d);else{const v=Xm(h,m);v!=null&&(a.push(d),s.set(d,v))}});const u=new Ur(a);return new bR(s,u,i.fieldTransforms)}function RU(r,e,t,n,i,a){const s=r.ju(1,e,t),u=[N0(e,n,t)],c=[i];if(a.length%2!=0)throw new Be(we.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<a.length;v+=2)u.push(N0(e,a[v])),c.push(a[v+1]);const h=[],d=_r.empty();for(let v=u.length-1;v>=0;--v)if(!TR(h,u[v])){const y=u[v];let _=c[v];_=Tn(_);const E=s.Uu(y);if(_ instanceof Km)h.push(y);else{const x=Xm(_,E);x!=null&&(h.push(y),d.set(y,x))}}const m=new Ur(h);return new bR(d,m,s.fieldTransforms)}function Xm(r,e){if(ER(r=Tn(r)))return a_("Unsupported field value:",e,r),xR(r,e);if(r instanceof t_)return function(n,i){if(!_R(i.Lu))throw i.Wu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(n,i){const a=[];let s=0;for(const u of n){let c=Xm(u,i.Ku(s));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),s++}return{arrayValue:{values:a}}}(r,e)}return function(n,i){if((n=Tn(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return mB(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=_n.fromDate(n);return{timestampValue:Xp(i.serializer,a)}}if(n instanceof _n){const a=new _n(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Xp(i.serializer,a)}}if(n instanceof n_)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Kl)return{bytesValue:FA(i.serializer,n._byteString)};if(n instanceof Tr){const a=i.databaseId,s=n.firestore._databaseId;if(!s.isEqual(a))throw i.Wu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Bb(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof r_)return function(s,u){return{mapValue:{fields:{[dA]:{stringValue:pA},[Hp]:{arrayValue:{values:s.toArray().map(h=>{if(typeof h!="number")throw u.Wu("VectorValues must only contain numeric values.");return Mb(u.serializer,h)})}}}}}}(n,i);throw i.Wu(`Unsupported field value: ${Zb(n)}`)}(r,e)}function xR(r,e){const t={};return sA(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ms(r,(n,i)=>{const a=Xm(i,e.qu(n));a!=null&&(t[n]=a)}),{mapValue:{fields:t}}}function ER(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _n||r instanceof n_||r instanceof Kl||r instanceof Tr||r instanceof t_||r instanceof r_)}function a_(r,e,t){if(!ER(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const n=Zb(t);throw n==="an object"?e.Wu(r+" a custom object"):e.Wu(r+" "+n)}}function N0(r,e,t){if((e=Tn(e))instanceof Gm)return e._internalPath;if(typeof e=="string")return o_(r,e);throw Zp("Field path arguments must be of type string or ",r,!1,void 0,t)}const IU=new RegExp("[~\\*/\\[\\]]");function o_(r,e,t){if(e.search(IU)>=0)throw Zp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Gm(...e.split("."))._internalPath}catch{throw Zp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Zp(r,e,t,n,i){const a=n&&!n.isEmpty(),s=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(a||s)&&(c+=" (found",a&&(c+=` in field ${n}`),s&&(c+=` in document ${i}`),c+=")"),new Be(we.INVALID_ARGUMENT,u+r+c)}function TR(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,t,n,i,a){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Tr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(CR("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class DU extends SR{data(){return super.data()}}function CR(r,e){return typeof e=="string"?o_(r,e):e instanceof Gm?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NU(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Be(we.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class kU{convertValue(e,t="none"){switch(ss(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(os(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw qe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ms(e,(i,a)=>{n[i]=this.convertValue(a,t)}),n}convertVectorValue(e){var t,n,i;const a=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[Hp].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(s=>nn(s.doubleValue));return new r_(a)}convertGeoPoint(e){return new n_(nn(e.latitude),nn(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Mm(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(qh(e));default:return null}}convertTimestamp(e){const t=as(e);return new _n(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=jt.fromString(e);Tt(HA(n));const i=new Gh(n.get(1),n.get(3)),a=new Ue(n.popFirst(5));return i.isEqual(t)||ro(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OU(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class AR extends SR{constructor(e,t,n,i,a,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Rp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(CR("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Rp extends AR{data(e={}){return super.data(e)}}class MU{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Dh(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Rp(this._firestore,this._userDataWriter,n.key,n,new Dh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Be(we.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(u=>{const c=new Rp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Dh(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:s++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>a||u.type!==3).map(u=>{const c=new Rp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Dh(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return u.type!==0&&(h=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(s=s.add(u.doc),d=s.indexOf(u.doc.key)),{type:PU(u.type),doc:c,oldIndex:h,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function PU(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qe()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(r){r=da(r,Tr);const e=da(r.firestore,uc);return gU(e_(e),r._key).then(t=>VU(e,r,t))}class RR extends kU{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tr(this.firestore,null,t)}}function LU(r){r=da(r,qm);const e=da(r.firestore,uc),t=e_(e),n=new RR(e);return NU(r._query),yU(t,r._query).then(i=>new MU(e,n,r,i))}function Yh(r,e,t){r=da(r,Tr);const n=da(r.firestore,uc),i=OU(r.converter,e,t);return s_(n,[CU(wR(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Ei.none())])}function FU(r,e,t,...n){r=da(r,Tr);const i=da(r.firestore,uc),a=wR(i);let s;return s=typeof(e=Tn(e))=="string"||e instanceof Gm?RU(a,"updateDoc",r._key,e,t,n):AU(a,"updateDoc",r._key,e),s_(i,[s.toMutation(r._key,Ei.exists(!0))])}function BU(r){return s_(da(r.firestore,uc),[new Pb(r._key,Ei.none())])}function s_(r,e){return function(n,i){const a=new Ja;return n.asyncQueue.enqueueAndForget(async()=>aU(await vU(n),i,a)),a.promise}(e_(r),e)}function VU(r,e,t){const n=t.docs.get(e._key),i=new RR(r);return new AR(r,i,e._key,n,new Dh(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){ic=i})(nc),ca(new Ai("firestore",(n,{instanceIdentifier:i,options:a})=>{const s=n.getProvider("app").getImmediate(),u=new uc(new RF(n.getProvider("auth-internal")),new NF(s,n.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Be(we.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gh(h.options.projectId,d)}(s,i),s);return a=Object.assign({useFetchStreams:t},a),u._setSettings(a),u},"PUBLIC").setMultipleInstances(!0)),li(E2,T2,e),li(E2,T2,"esm2017")})();const UU={apiKey:"AIzaSyCR2hryoH6x3ciYWh_GA9jsVIKTQcmgQb4",authDomain:"proyectogradoropa.firebaseapp.com",projectId:"proyectogradoropa",storageBucket:"proyectogradoropa.firebasestorage.app",messagingSenderId:"277592636735",appId:"1:277592636735:web:1ef22715ceedac615da78a",measurementId:"G-1J1GWY3BPX"},u_=KS(UU),pu=TF(u_),Ti=wU(u_);new Ji;o3(u_);function zU({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"}))}const IR=Y.forwardRef(zU);function jU({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const DR=Y.forwardRef(jU);function HU({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),Y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const NR=Y.forwardRef(HU);function WU({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"}))}const kR=Y.forwardRef(WU),OR="/assets/fondo-B9omR-eT.jpg",qU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAIAAAABc2X6AAAGsklEQVR4Ae3cA3jsShgG4Gvbtu1js7aObdu2bdbudmvbtu1VtUg2ydw7x95mstnt5rZ5voflG80/fzL72L89bOsF94J7wWgb2dSgiAzpPHmwbfPK1qWzxDNsRdb6Ar2BgtF9hSbDRbYG4mk2beuXwm+Q89yV+TmAILgHptrb5DyPtg3LhBZjBCP+RovewNZlc2TOl8nGel0HA4LA4qPhkRSM6XcHoEYk86fIfT2AQqFzYIBjMncHofkoZBWNCM1GSq+cpdpadQIMKEoRzIeXIroEkW08TObpDAiiO8F4Tga85TBnoEc8xVKZm9UNYECS0stnBCP/Ud+AnJH/SC+eAiShPTDZ3CRZPIN9CUokC6ZSYqE2wHhmKhw/2TegR2RnSFSUaRaMJccLxg7QsAQhktkTAACaAmOxkbA80h2taKIZKWzR1BFWRAQLRvXhphYdDEtcWDxxU4sOhjdDkdVYbmrRwYAgJIums3RTNWrftbHz/AmZh5MiLBAGVqOdZ4+1790inmrFvpYZuPPEATWdknmT5f7eZEN9V2N7o9zPu3XNInQte2BlcYE6tVTbltXw4kf9h5QlhW3rliBr1QcDAODsjPFlhmelqfNvKQty4S9B0KoPVgTxmWk7Tx0COMZCF6GzA3ZC0LWMwJSsTWiOXj+O6iP382KzowAAvMOhaxmAqw/Ijr4tGPsHgnbsACwxlpNNPABIIv5LIvxpzOVlkdXPNMGK8CCudi2pFi+ovRFlwLOtc7/uUgvnxhxu05LpIyD17nTu+EAw8q9HaVtXzgcAcBUMcAER/sx9YBj5pdeExr897NLtT9TVcLgRTzVcgbyHBuc9L5n8PdLJzAEwmWP1KDCMMvTp9jWf3tbC1gdQKDgMBhRBRL0GYaojO35zxOo8fZjbz5ZAZz700Anm9pLI9g+yoY7bYKrJBWJoRpk8SJ0/fDoc13QuRuNdgMmydfTBZPkGdcDDd0q1EDkOVIKzTOiDKVGY7oPLmylVYCKlL30wIKW6D44tJlSCE76nC45+CwHXfWDfdKVKcMwHdMEJ33MC7JqEqwRHvEgXnDaYE+ArMayBB3ECDAennnVKn4tUDU74gS446k1OgB3i8Z41LHmkKHtW4eGfpRpctv5/VlomlxOsTR6kKQN1H1wnptiZHpYFv27pMbqus4kxOChbySzTz8loakfukhIkYKEBEBzw6SBXk79cLQ5lXv5XuxtJAaMDdA/v+JMydVs8irBnDvB+g9QbGeY1SUFg2gTn1JD0z+cdPIVaTbym0JemeQ6FzrtzJtdFm+DT4Rh9MD9DybxNmxL03mg3g/u0MP3cbWo6GrWjbZMBg/0Id6wqAcWwEX+F/10fVzPIe2jmRW3VTiP+VBjC4bU6KgMAID9qaQt9frl3P6hSndOaP7HrxdSYPQiH92QYhvAwTRH7KdSWBL9h5j4GeugkqDpWc1oZBqaelSGNwMWNJMLjUkHxBn//zwZeH3topr+7bWxDmia0AID17gok7aTTMrTnw1KsfZTPVMhAyj9uVl5lIexqcQLs4KFpYXjpSjQw3HwrIqCBQQ5mXsZInBWtoIOac1GOqrU4IsUJwOSllsmha5iZTf3npzXnqXka+1dFmzo4D9vZgQp2TsAZvrZUIC7729WSmRlmVfz+HGExKpUCVGJj1oSQlTd+SZ9Lm4bubqKvtTkmk+OAIRhu+zMu3jEwyqTQ1d7lofWdzV0VyWSxpPJkjpOB76z7fsPfjjOHHMhBb0QzAhMUMS18nRrgOzHkz96YdPR4toNTMT+gKjq4OtatNPBCvgfcp9PD1w/wsFP14y7WA4/zu9SudVWw8HKpUC4Zw5uOLmQ//c4fGrZL8iit+WEpvMmxAIZbtrCor7uNLpj/ubpk6N6Kh059M6tINl8Qh4UUHGa73wzjNGHQ4dj7wC6JOPtLACLqkvq4WeuE2cWi/+nLt0csOKnQ1CKP+IYMWELqgPnGiLVh6O7Go8GYZpfxpDbnwkaHjpj3JfLRV7Wgb01SARxIupc6wntyfGOG9pbikRQJmzvodRg7mRq2tkkm7IbFlhktBdaBS7SsPZx1haDIbltOSwGKXxl5px7UZGaEb8gXlerEgmmMxB2KfEciTKHRAsvbmPo0nVsST1BEdH3Kyrh9bJVlQ7wmbk05USSu0PUPPWjDOtxLg5bF7h7tM42B08x//o7U0/AmrCSV3PtYiwZpS3B13MHMS/DIz4rYaBO0VM93JpwbwaJtqNfEsbwZFgEL50VtgcJLBV6wK9aKtfd+cEkvuBfcC37k9h8VGR+csPdltgAAAABJRU5ErkJggg==";function GU(){const[r,e]=Y.useState(""),[t,n]=Y.useState(""),[i,a]=Y.useState(!1),[s,u]=Y.useState(null),c=ma(),h=new Ji,d=async v=>{v.preventDefault();try{await lL(pu,r,t),c("/")}catch{u("Correo o contraseña incorrectos.")}},m=async()=>{try{const y=(await OL(pu,h)).user,_=oa(Ti,"usuarios",y.email);(await Xl(_)).exists()||await Yh(_,{email:y.email,estadoAnimo:"",preferencias:[]}),c("/")}catch(v){u(v.message)}};return Z.jsxs("div",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[Z.jsx("img",{src:OR,alt:"Fondo",className:"absolute inset-0 w-full h-full object-cover z-0"}),Z.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-0"}),Z.jsxs("form",{onSubmit:d,className:"relative z-10 bg-white/90 backdrop-blur-md p-8 rounded-xl shadow-2xl w-full max-w-md animate-fade-in",children:[Z.jsx("div",{className:"flex justify-center mb-6",children:Z.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full overflow-hidden",children:Z.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/847/847969.png",alt:"Avatar",className:"object-cover w-full h-full"})})}),Z.jsx("h2",{className:"text-3xl font-bold text-center text-red-600 mb-6",children:"Iniciar Sesión"}),s&&Z.jsx("p",{className:"text-red-500 text-sm mb-4",children:s}),Z.jsxs("div",{className:"mb-4 relative group",children:[Z.jsx(IR,{className:"w-5 h-5 text-gray-400 absolute top-3 left-3 group-focus-within:text-red-600 transition"}),Z.jsx("input",{type:"email",placeholder:"Correo electrónico",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-400 focus:outline-none transition-all duration-300",value:r,onChange:v=>e(v.target.value),required:!0})]}),Z.jsxs("div",{className:"mb-6 relative group",children:[Z.jsx(kR,{className:"w-5 h-5 text-gray-400 absolute top-3 left-3 group-focus-within:text-red-600 transition"}),Z.jsx("input",{type:i?"text":"password",placeholder:"Contraseña",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-400 focus:outline-none transition-all duration-300",value:t,onChange:v=>n(v.target.value),required:!0}),Z.jsx("div",{className:"absolute top-2.5 right-3 cursor-pointer text-gray-400 hover:text-red-600 transition",onClick:()=>a(v=>!v),children:i?Z.jsx(DR,{className:"w-5 h-5"}):Z.jsx(NR,{className:"w-5 h-5"})})]}),Z.jsx("button",{type:"submit",className:"w-full bg-red-500 text-white py-2 rounded-md hover:bg-red-600 hover:scale-[1.01] active:scale-95 transition-transform duration-200 shadow-md",children:"Entrar"}),Z.jsx("div",{className:"mt-4",children:Z.jsxs("button",{type:"button",onClick:m,className:"w-full flex items-center justify-center gap-3 border border-gray-300 bg-white py-2 rounded-md hover:shadow-md transition duration-200",children:[Z.jsx("img",{src:qU,alt:"Google",className:"w-5 h-5"}),Z.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Iniciar sesión con Google"})]})}),Z.jsxs("p",{className:"text-sm text-center mt-6 text-gray-700",children:["¿No tienes una cuenta?"," ",Z.jsx(Tm,{to:"/register",className:"text-red-600 hover:underline",children:"Regístrate aquí"})]})]})]})}function KU(){const[r,e]=Y.useState(""),[t,n]=Y.useState(""),[i,a]=Y.useState(!1),[s,u]=Y.useState(null),c=ma(),h=async d=>{d.preventDefault();try{await uL(pu,r,t),await Yh(oa(Ti,"usuarios",r),{email:r,estadoAnimo:"",preferencias:[]}),c("/")}catch(m){u(m.message)}};return Z.jsxs("div",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[Z.jsx("img",{src:OR,alt:"Fondo",className:"absolute inset-0 w-full h-full object-cover z-0"}),Z.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-0"}),Z.jsxs("form",{onSubmit:h,className:"relative z-10 bg-white/90 backdrop-blur-md p-8 rounded-xl shadow-2xl w-full max-w-md animate-fade-in",children:[Z.jsx("div",{className:"flex justify-center mb-6",children:Z.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full overflow-hidden",children:Z.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/847/847969.png",alt:"Avatar",className:"object-cover w-full h-full"})})}),Z.jsx("h2",{className:"text-3xl font-bold text-center text-blue-700 mb-6",children:"Crear Cuenta"}),s&&Z.jsx("p",{className:"text-red-500 text-sm mb-4",children:s}),Z.jsxs("div",{className:"mb-4 relative group",children:[Z.jsx(IR,{className:"w-5 h-5 text-gray-400 absolute top-3 left-3 group-focus-within:text-blue-600 transition"}),Z.jsx("input",{type:"email",placeholder:"Correo electrónico",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none transition-all duration-300",value:r,onChange:d=>e(d.target.value),required:!0})]}),Z.jsxs("div",{className:"mb-6 relative group",children:[Z.jsx(kR,{className:"w-5 h-5 text-gray-400 absolute top-3 left-3 group-focus-within:text-blue-600 transition"}),Z.jsx("input",{type:i?"text":"password",placeholder:"Contraseña",className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:outline-none transition-all duration-300",value:t,onChange:d=>n(d.target.value),required:!0}),Z.jsx("div",{className:"absolute top-2.5 right-3 cursor-pointer text-gray-400 hover:text-blue-600 transition",onClick:()=>a(d=>!d),children:i?Z.jsx(DR,{className:"w-5 h-5"}):Z.jsx(NR,{className:"w-5 h-5"})})]}),Z.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 hover:scale-[1.01] active:scale-95 transition-transform duration-200 shadow-md",children:"Registrarse"}),Z.jsxs("p",{className:"text-sm text-center mt-6 text-gray-700",children:["¿Ya tienes una cuenta?"," ",Z.jsx(Tm,{to:"/login",className:"text-blue-600 hover:underline",children:"Inicia sesión aquí"})]})]})]})}const XU=[{name:"Camiseta",value:"camiseta",image:"http://assets.myntassets.com/v1/images/style/properties/de13f5c9978eb2ac8b913a57f31994ef_images.jpg"},{name:"Camisa",value:"camisa",image:"http://assets.myntassets.com/v1/image/style/properties/39405/US-Polo-Assn-Men-Shirts_1_668b40d51c89ee02c36b3fa6258a2639.jpg"},{name:"Top",value:"top",image:"http://assets.myntassets.com/v1/images/style/properties/48373b0212c02b6c39c53ec2215e1c58_images.jpg"},{name:"Pantalones",value:"pantalon",image:"http://assets.myntassets.com/v1/images/style/properties/Gini-and-Jony-Kids-Unisex-Blue-Jeans_33fe744a002fcefce66f501f33573b11_images.jpg"},{name:"Short",value:"short",image:"http://assets.myntassets.com/v1/images/style/properties/7cfd016a492e718fdcf2dc0cef0cbc4e_images.jpg"},{name:"Falda/Vestido",value:"falda-vestido",image:"http://assets.myntassets.com/v1/images/style/properties/ONLY-Women-Peach-Dress_8f6ae2625bc3d394bfaf0b9de2b33adf_images.jpg"},{name:"Abrigo",value:"abrigo",image:"http://assets.myntassets.com/v1/images/style/properties/a4f1bf2e2d65054196bfca280b644526_images.jpg"}],$U=()=>{var x;const[r,e]=Y.useState(null),[t,n]=Y.useState("categorias"),[i,a]=Y.useState([]),s=ma(),u=(x=pu.currentUser)==null?void 0:x.email,c=Y.useRef(null),h=Y.useRef(null),[d,m]=Y.useState({});Y.useEffect(()=>{const T=()=>{const C=t==="categorias"?c.current:h.current;C&&m({width:C.offsetWidth+"px",left:C.offsetLeft+"px"})};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[t]);const v=T=>{e(T)},y=()=>{r?s(`/seleccion-prendas/${r}`):alert("Por favor selecciona una categoría.")},_=async()=>{if(u)try{const T=Jb(Ti,"usuarios",u,"preferencias"),A=(await LU(T)).docs.map(R=>({firestoreId:R.id,...R.data()}));a(A)}catch(T){console.error("Error al cargar favoritos:",T)}};Y.useEffect(()=>{_()},[u]);const E=async T=>{if(u)try{const C=oa(Ti,"usuarios",u,"preferencias",T);await BU(C),_()}catch(C){console.error("Error al eliminar favorito:",C)}};return Z.jsxs("div",{className:"pt-5 min-h-screen bg-gray-50 bg-amber-50 p-6 flex flex-col",children:[Z.jsx("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-4",children:Z.jsx("h1",{className:"text-3xl font-bold text-red-500",children:"¿Qué tipo de prenda buscas hoy?"})}),Z.jsxs("div",{className:"relative flex justify-center gap-0 mb-6 rounded-md",style:{width:"fit-content",margin:"0 auto",top:-10},children:[Z.jsx("div",{className:"absolute top-0.5 bottom-0.5 bg-red-500 rounded-md transition-all duration-300 ease-in-out",style:{left:d.left?`calc(${d.left} + 4px)`:0,width:d.width?`calc(${d.width} - 8px)`:"0px",zIndex:0}}),Z.jsx("button",{ref:c,style:{width:"120px"},className:`relative z-10 px-6 py-2 rounded-md font-medium transition-colors duration-300 ${t==="categorias"?"text-white":"text-gray-700"}`,onClick:()=>n("categorias"),children:"Categorías"}),Z.jsx("button",{ref:h,style:{width:"120px"},className:`relative z-10 px-6 py-2 rounded-md font-medium transition-colors duration-300 ${t==="favoritos"?"text-white":"text-gray-700"}`,onClick:()=>n("favoritos"),children:"Favoritos"})]}),t==="categorias"?Z.jsxs(Z.Fragment,{children:[Z.jsx("div",{className:"pt-3 grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 lg:gap-[10px] mb-6 w-full",children:XU.map(T=>Z.jsxs("button",{onClick:()=>v(T.value),className:`p-1 rounded-lg border-2 transition-transform rounded-xl bg-white duration-300 hover:scale-105 w-full lg:gap-[2px] ${r===T.value?"border-red-500":"border-transparent"}`,children:[Z.jsx("img",{src:T.image,alt:T.name,className:"w-full aspect-square object-cover rounded-md"}),Z.jsx("p",{className:"text-sm mt-1 text-center",children:T.name})]},T.name))}),Z.jsx("div",{className:"flex justify-center",children:Z.jsx("button",{onClick:y,className:"-mt-7 bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg",children:"Siguiente"})})]}):Z.jsx(Z.Fragment,{children:Z.jsx("div",{className:"pt-3 grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 lg:gap-2 mb-8 w-full",children:i.length>0?i.map(T=>Z.jsxs("div",{className:"p-1 rounded-lg border-2 transition-transform bg-white duration-300 hover:scale-105 w-full border-transparent relative",children:[Z.jsx("img",{src:T.link,alt:T.productDisplayName||"Prenda",className:"w-full aspect-square object-cover rounded-md"}),Z.jsx("p",{className:"text-sm mt-1 text-center",children:T.productDisplayName}),Z.jsx("button",{onClick:()=>E(T.firestoreId),className:"absolute top-0 right-0 sm:top-1 sm:right-1 w-12 h-12 text-2xl flex items-center justify-center text-red-600 hover:text-red-800 z-10","aria-label":"Eliminar favorito",title:"Eliminar favorito",children:Z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-8 h-8 sm:w-11 sm:h-11 md:w-12 md:h-12 transition-all duration-200",children:[Z.jsx("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"}),Z.jsx("path",{d:"m12 13-1-1 2-2-3-3 2-2"})]})})]},T.firestoreId)):Z.jsx("p",{className:"text-center text-gray-600 text-md col-span-full mt-4",children:"No tienes prendas favoritas aún :("})})})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var MR=function(r,e){return(MR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function Ni(r,e){function t(){this.constructor=r}MR(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function De(r,e,t,n){return new(t||(t=Promise))(function(i,a){function s(h){try{c(n.next(h))}catch(d){a(d)}}function u(h){try{c(n.throw(h))}catch(d){a(d)}}function c(h){h.done?i(h.value):new t(function(d){d(h.value)}).then(s,u)}c((n=n.apply(r,[])).next())})}function Ne(r,e){var t,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(h){return function(d){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(i=2&d[0]?n.return:d[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,d[1])).done)return i;switch(n=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return s.label++,{value:d[1],done:!1};case 5:s.label++,n=d[1],d=[0];continue;case 7:d=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){s=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){s.label=d[1];break}if(d[0]===6&&s.label<i[1]){s.label=i[1],i=d;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(d);break}i[2]&&s.ops.pop(),s.trys.pop();continue}d=e.call(r,s)}catch(m){d=[6,m],n=0}finally{t=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([c,h])}}}var YU=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,i=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];return QU(n,s[0],s[1]),s.join("=")}),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(a){var s=a.split(":"),u=s[0],c=s[1];e.urlFlags[u]=function(h,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+h+".")}(u,c)})}},r}();function QU(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function me(){return PR}var PR=null,Jp=new Map,k0=new Map;function LR(r,e){var t=BR(r,e);return Jp.get(t)}function ZU(r){return k0.get(r)}function yT(r){for(var e=Jp.entries(),t=[];;){var n=e.next(),i=n.done,a=n.value;if(i)break;var s=a[0],u=a[1];s.split("_")[0]===r&&t.push(u)}return t}function FR(r){var e=r.kernelName,t=r.backendName,n=BR(e,t);if(Jp.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Jp.set(n,r)}function JU(r){var e=r.kernelName;k0.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),k0.set(e,r)}function BR(r,e){return e+"_"+r}function O0(r,e,t){return Math.max(r,Math.min(e,t))}function VR(r){return r%2==0?r:r+1}function e6(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function W(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function St(r,e,t){t===void 0&&(t=""),W(Pn(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function lc(r){W(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function $l(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||sa(r)&&!t)for(var n=0;n<r.length;++n)$l(r[n],e,t);else e.push(r);return e}function Oe(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Pn(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function rn(r){return r%1==0}function t6(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function M0(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Ol(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function bT(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,i){var a=0,s=function(){if(r())n();else{a++;var u=e(a);t!=null&&a>=t?i():setTimeout(s,u)}};s()})}function n6(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=r.slice();return a[n]=e/t,a}function An(r,e){var t=e.length;return W((r=r==null?e.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),W(r.every(function(n){return rn(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function tu(r,e){for(var t=[],n=[],i=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||i?null:An(e,r).sort(),s=0,u=0;u<r.length;++u){if(a!=null){if(a[s]===u&&r[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+r[u]+"' is not 1");(a[s]==null||a[s]>u)&&r[u]===1&&(t.push(r[u]),n.push(u)),a[s]<=u&&s++}r[u]!==1&&(t.push(r[u]),n.push(u))}return{newShape:t,keptDims:n}}function Qh(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function em(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function r6(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function i6(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function a6(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function sa(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function UR(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function o6(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function l_(r){return typeof r=="string"||r instanceof String}function s6(r){return typeof r=="boolean"}function u6(r){return typeof r=="number"}function vf(r){return Array.isArray(r)?vf(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":u6(r)?"float32":l_(r)?"string":s6(r)?"bool":"float32"}function P0(r){return!!(r&&r.constructor&&r.call&&r.apply)}function L0(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function ua(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function zR(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=$l(r)),t&&r6(r,e),function(a,s){return a instanceof Float32Array&&s==="float32"||a instanceof Int32Array&&s==="int32"||a instanceof Uint8Array&&s==="bool"}(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function _T(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,i){return n*i});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return function n(i,a,s){var u=new Array;if(a.length===1)for(var c=a[0],h=0;h<c;h++)u[h]=s[i+h];else{c=a[0];var d=a.slice(1),m=d.reduce(function(v,y){return v*y});for(h=0;h<c;h++)u[h]=n(i+h*m,d,s)}return u}(0,r,e)}function jR(r,e){for(var t=gf(r,e),n=0;n<t.length;n++)t[n]=1;return t}function gf(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function Zi(){return me().platform.now()}function HR(r){r.forEach(function(e){W(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function l6(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.encode(r,e)}function tm(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",me().platform.decode(r,e)}function wT(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],i=0;i<r.length-1;++i)n+=t[i]*r[i];return n}function c6(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),i=0;i<n.length-1;++i)n[i]=Math.floor(r/t[i]),r-=n[i]*t[i];return n[n.length-1]=r,n}var h6=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new f6)}return r.prototype.profileKernel=function(e,t,n){var i,a=this,s=this.backendTimer.time(function(){i=n()});return i.forEach(function(u){u.data().then(function(c){(function(h,d,m){if(d!=="float32")return!1;for(var v=0;v<h.length;v++){var y=h[v];if(isNaN(y)||!isFinite(y))return console.warn("Found "+y+" in the result of '"+m+"'"),!0}})(c,u.dtype,e),s.then(function(h){var d="";h.getExtraProfileInfo!=null&&(d=h.getExtraProfileInfo()),a.logger.logKernelProfile(e,u,c,h.kernelMs,t,d)})})}),i},r}(),f6=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,a,s){var u=typeof i=="number"?Ol(i+"ms",9):i.error,c=Ol(e,25),h=t.rank,d=t.size,m=Ol(t.shape.toString(),14),v="";for(var y in a){var _=a[y].shape||t.shape,E=_.length;v+=y+": "+E+"D "+(E>0?_:"")+" "}console.log("%c"+c+"	%c"+u+"	%c"+h+"D "+m+"	%c"+d+"	%c"+v+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),xT=20,wh=3,Dy=7;function d6(r,e,t,n){var i=ua(e),a=function(h,d,m,v){var y=Oe(d),_=v[v.length-1],E=new Array(_).fill(0),x=d.length,T=m==="complex64"?Eh(h):h;if(x>1)for(var C=0;C<y/_;C++)for(var A=C*_,R=0;R<_;R++)E[R]=Math.max(E[R],xh(T[A+R],0,m).length);return E}(r,e,t,i),s=e.length,u=function h(d,m,v,y,_,E){E===void 0&&(E=!0);var x=v==="complex64"?2:1,T=m[0],C=m.length;if(C===0)return v==="complex64"?[xh(Eh(d)[0],0,v)]:v==="bool"?[WR(d[0])]:[d[0].toString()];if(C===1){if(T>xT){var A=wh*x,R=Array.from(d.slice(0,A)),k=Array.from(d.slice((T-wh)*x,T*x));return v==="complex64"&&(R=Eh(R),k=Eh(k)),["["+R.map(function(se,G){return xh(se,_[G],v)}).join(", ")+", ..., "+k.map(function(se,G){return xh(se,_[T-wh+G],v)}).join(", ")+"]"]}return["["+(v==="complex64"?Eh(d):Array.from(d)).map(function(se,G){return xh(se,_[G],v)}).join(", ")+"]"]}var B=m.slice(1),P=y.slice(1),I=y[0]*x,D=[];if(T>xT){for(var O=0;O<wh;O++){var L=(F=O*I)+I;D.push.apply(D,h(d.slice(F,L),B,v,P,_,!1))}for(D.push("..."),O=T-wh;O<T;O++)L=(F=O*I)+I,D.push.apply(D,h(d.slice(F,L),B,v,P,_,O===T-1))}else for(O=0;O<T;O++){var F;L=(F=O*I)+I,D.push.apply(D,h(d.slice(F,L),B,v,P,_,O===T-1))}var V=C===2?",":"";for(D[0]="["+D[0]+V,O=1;O<D.length-1;O++)D[O]=" "+D[O]+V;var ie=`,
`;for(O=2;O<C;O++)ie+=`
`;return D[D.length-1]=" "+D[D.length-1]+"]"+(E?"":ie),D}(r,e,t,i,a),c=["Tensor"];return n&&(c.push("  dtype: "+t),c.push("  rank: "+s),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(u.map(function(h){return"    "+h}).join(`
`)),c.join(`
`)}function xh(r,e,t){return Ol(Array.isArray(r)?parseFloat(r[0].toFixed(Dy))+" + "+parseFloat(r[1].toFixed(Dy))+"j":l_(r)?"'"+r+"'":t==="bool"?WR(r):parseFloat(r.toFixed(Dy)).toString(),e)}function WR(r){return r===0?"false":"true"}function Eh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Zh=function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=Oe(e),n!=null){var a=n.length;W(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||em(t,this.size),this.strides=ua(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),W(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(n);this.values[a]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,a=e;i<a.length;i++){var s=a[i];if(s<0||s>=this.shape[n]){var u="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(u)}n++}for(var c=e[e.length-1],h=0;h<e.length-1;++h)c+=this.strides[h]*e[h];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return ea().makeTensor(this.values,this.shape,this.dtype)},r}(),ea=null,he=null,qR=null,Gt=function(){function r(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Oe(e),this.strides=ua(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),W(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,a){return this.throwIfDisposed(),this.reshape([e,t,n,i,a])},r.prototype.asType=function(e){return this.throwIfDisposed(),he.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return De(this,void 0,void 0,function(){var e;return Ne(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,he.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return he.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return De(this,void 0,void 0,function(){var e;return Ne(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,_T(this.shape,e)]}})})},r.prototype.arraySync=function(){return _T(this.shape,this.dataSync())},r.prototype.data=function(){return De(this,void 0,void 0,function(){var e,t;return Ne(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ea().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(i){return tm(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var e=ea().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return tm(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return De(this,void 0,void 0,function(){var e;return Ne(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ea().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(ea().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),he.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),he.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),he.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),he.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),he.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),he.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),he.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),d6(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),he.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),he.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),he.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),he.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),he.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),he.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),he.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),he.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),he.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),he.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),he.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),he.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,i,a){return n===void 0&&(n=.001),qR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,i,n)},r.prototype.batchNorm=function(e,t,n,i,a){return a===void 0&&(a=.001),this.throwIfDisposed(),he.batchNorm(this,e,t,n,i,a)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),he.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),he.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),he.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),he.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),he.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),he.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),he.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),he.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),he.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),he.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),he.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),he.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),he.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),he.div(this,e)},r.prototype.divNoNan=function(e){return this.throwIfDisposed(),he.divNoNan(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),he.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),he.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),he.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),he.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),he.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),he.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),he.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),he.modStrict(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),he.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),he.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),he.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),he.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),he.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),he.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),he.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),he.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),he.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),he.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),he.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),he.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),he.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),he.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),he.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),he.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),he.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),he.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),he.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),he.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),he.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),he.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),he.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),he.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),he.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),he.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),he.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),he.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),he.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),he.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),he.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),he.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),he.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),he.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),he.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),he.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),he.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),he.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),he.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),he.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),he.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),he.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),he.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),he.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),he.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),he.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),he.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),he.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),he.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),he.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),he.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),he.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),he.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),he.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),he.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),he.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),he.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),he.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),he.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),he.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),he.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),he.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),he.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),he.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),he.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),he.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,a,s){return i===void 0&&(i="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),he.conv1d(this,e,t,n,i,a,s)},r.prototype.conv2d=function(e,t,n,i,a,s){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),he.conv2d(this,e,t,n,i,a,s)},r.prototype.conv2dTranspose=function(e,t,n,i,a){return this.throwIfDisposed(),he.conv2dTranspose(this,e,t,n,i,a)},r.prototype.depthwiseConv2D=function(e,t,n,i,a,s){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),he.depthwiseConv2d(this,e,t,n,i,a,s)},r.prototype.separableConv2d=function(e,t,n,i,a,s){return a===void 0&&(a=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),he.separableConv2d(this,e,t,n,i,a,s)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),he.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),he.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),he.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,a){return this.throwIfDisposed(),he.pool(this,e,t,n,i,a)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),ea().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),he.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),he.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),he.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),he.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,a,s,u,c){return i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),this.throwIfDisposed(),he.stridedSlice(this,e,t,n,i,a,s,u,c)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),he.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),he.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),he.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),he.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),he.spectral.irfft(this)},r}();Object.defineProperty(Gt,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var ET,F0,B0,V0,U0,Yl=function(r){function e(t,n,i,a){var s=r.call(this,t.shape,t.dtype,t.dataId,a)||this;return s.trainable=n,s.name=i,s}return Ni(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Pn(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ea().disposeTensor(this),this.dataId=t.dataId,ea().incRef(this,null)},e.prototype.dispose=function(){ea().disposeVariable(this),this.isDisposedInternal=!0},e}(Gt);Object.defineProperty(Yl,Symbol.hasInstance,{value:function(r){return r instanceof Gt&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(ET||(ET={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(F0||(F0={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(B0||(B0={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(V0||(V0={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(U0||(U0={}));var p6={float32:V0,int32:F0,bool:B0,complex64:U0};function qn(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return p6[r][e]}function Ny(r){return qn(r,"int32")}function $t(r,e){if(r.dtype===e.dtype)return[r,e];var t=qn(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function m6(r,e){W(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function GR(r){var e=[];return function t(n,i,a){if(n!=null){if(n instanceof Gt)return void i.push(n);if(s=n,!(!Array.isArray(s)&&typeof s!="object")){var s,u=n;for(var c in u){var h=u[c];a.has(h)||(a.add(h),t(h,i,a))}}}}(r,e,new Set),e}var ky,TT=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),v6=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new TT}return r.prototype.ready=function(){return De(this,void 0,void 0,function(){var e,t,n;return Ne(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return De(this,void 0,void 0,function(){var t,n,i;return Ne(this,function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=n,a.label=3;case 3:if(!i)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new h6(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this;yT(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this;yT(e).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var a=++this.pendingBackendInitId,s=i.then(function(u){return!(a<t.pendingBackendInitId)&&(t.registry[e]=u,t.pendingBackendInit=null,!0)}).catch(function(u){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),a=i.success,s=i.asyncInit;if(s||a)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),i=n.backend,a=this.readSync(t);i.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,i=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return i.startScope(a)},function(){return i.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(a){throw t(),a}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},r.prototype.runKernel=function(e,t,n,i,a){return this.runKernelFunc(null,t,null,e,n,i,a)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var i=this.backend.numDataIds(),a=0;n.forEach(function(c){a+=c.dtype==="complex64"?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=i-t-a-s;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,i,a,s,u){var c,h=this;s===void 0&&(s=[]),u===void 0&&(u=[]);var d=[],m=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var v,y=function(C){m&&(d=C.map(function(A){return h.keep(h.clone(A))}))},_=this.state.numBytes,E=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var x,T=LR(i,this.backendName);return v=T!=null?function(){var C=h.backend.numDataIds();x=T.kernelFunc({inputs:t,attrs:a,backend:h.backend});var A=Array.isArray(x)?x:[x];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,C,A);var R=A.map(function(B){var P=B.dataId,I=B.shape,D=B.dtype;return h.makeTensorFromDataId(P,I,D)}),k=R.filter(function(B,P){return u[P]});return y((s||[]).slice().concat(k)),R}:function(){var C=h.backend.numDataIds();x=h.tidy(function(){return e(h.backend,y)});var A=Array.isArray(x)?x:[x];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(i,C,A),A},this.scopedRun(function(){return h.state.kernelDepth++},function(){return h.state.kernelDepth--},function(){c=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(i,t,function(){return v()}):v()}),m&&this.addTapeNode(i,t,c,n,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-_,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-E,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(C){return t[C].shape}),outputShapes:c.map(function(C){return C.shape})}),Array.isArray(x)?c:c[0]},r.prototype.makeTensor=function(e,t,n,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var a=e;n==="string"&&l_(e[0])&&(a=e.map(function(d){return l6(d)}));var s=i.write(a,t,n),u=new Gt(t,n,s,this.nextTensorId());if(this.incRef(u,i),n==="string"){var c=this.state.tensorInfo.get(s),h=o6(a);this.state.numBytes+=h-c.bytes,c.bytes=h}return u},r.prototype.makeTensorFromDataId=function(e,t,n,i){var a=new Gt(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,i),a},r.prototype.makeVariable=function(e,t,n,i){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var a=new Yl(e,t,n,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*UR(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Yl||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return De(this,void 0,void 0,function(){var t,n;return Ne(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,i,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},c=ZU(e);c!=null&&(i=c.gradFunc),i!=null&&(u.gradient=function(h){return h=h.map(function(d,m){if(d==null){var v=n[m],y=gf(v.size,v.dtype);return s.makeTensor(y,v.shape,v.dtype)}return d}),i(h.length>1?h:h[0],a)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=GR(e),i=new Set(n.map(function(c){return c.id})),a=0;a<this.state.activeScope.track.length;a++){var s=this.state.activeScope.track[a];s.kept||i.has(s.id)||s.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(c){c.kept||c.scopeId!==u.id||t.track(c)})},r.prototype.gradients=function(e,t,n,i){var a=this;if(i===void 0&&(i=!1),W(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var s=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});W(s instanceof Gt,function(){return"The result y returned by f() must be a tensor."});var u=function(c,h,d){for(var m={},v={},y=0;y<h.length;y++)m[h[y].id]=!0;for(y=0;y<c.length;y++){var _=(B=c[y]).inputs;for(var E in _){for(var x=_[E],T=!1,C=0;C<h.length;C++)if(m[x.id]){B.outputs.forEach(function(O){return m[O.id]=!0}),T=!0,v[B.id]=!0;break}if(T)break}}var A={};A[d.id]=!0;var R={};for(y=c.length-1;y>=0;y--)for(_=(B=c[y]).inputs,C=0;C<B.outputs.length;C++)if(A[B.outputs[C].id]){for(var E in _)A[_[E].id]=!0,R[B.id]=!0;break}var k=[];for(y=0;y<c.length;y++){var B;if(v[(B=c[y]).id]&&R[B.id]){var P={};for(var E in B.inputs){var I=B.inputs[E];m[I.id]&&(P[E]=I)}var D=Object.assign({},B);D.inputs=P,D.outputs=B.outputs,k.push(D)}}return k}(this.state.activeTape,t,s);if(!i&&u.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,h,d={};d[s.id]=n??(c=s.shape,h=jR(Oe(c),"float32"),$.makeTensor(h,c,"float32")),function(v,y,_){for(var E=function(T){var C=y[T],A=[];if(C.outputs.forEach(function(P){var I=v[P.id];I!=null?A.push(I):A.push(null)}),C.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+C.kernelName+".");var R=C.gradient(A),k=function(P){if(!(P in R))throw new Error("Cannot backprop through input "+P+". Available gradients found: "+Object.keys(R)+".");var I=_(function(){return R[P]()});if(I.dtype!=="float32")throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input "+P+" must have 'float32' dtype, but has '"+I.dtype+"'");var D=C.inputs[P];if(!Pn(I.shape,D.shape))throw new Error("Error in gradient for op "+C.kernelName+". The gradient of input '"+P+"' has shape '"+I.shape+"', which does not match the shape of the input '"+D.shape+"'");if(v[D.id]==null)v[D.id]=I;else{var O=v[D.id];v[D.id]=O.add(I),O.dispose()}};for(var B in C.inputs)k(B)},x=y.length-1;x>=0;x--)E(x)}(d,u,function(v){return a.tidy(v)});var m=t.map(function(v){return d[v.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(v){for(var y=0,_=v.saved;y<_.length;y++)_[y].dispose()}),a.state.activeTape=null),{value:s,grads:m}})},r.prototype.customGrad=function(e){var t=this;return W(P0(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];W(i.every(function(u){return u instanceof Gt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(u,c){s[c]=u}),t.runKernelFunc(function(u,c){return W((n=e.apply(void 0,i.concat([c]))).value instanceof Gt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),W(P0(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},s,function(u,c){var h=n.gradFunc(u,c),d=Array.isArray(h)?h:[h];W(d.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),W(d.every(function(v){return v instanceof Gt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var m={};return d.forEach(function(v,y){m[y]=function(){return v}}),m})}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.time=function(e){return De(this,void 0,void 0,function(){var t,n;return Ne(this,function(i){switch(i.label){case 0:return t=Zi(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=Zi()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new TT,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),$=function(){var r=function(){if(ky==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}ky=t}return ky}();if(r._tfengine==null){var e=new YU(r);r._tfengine=new v6(e)}return function(t){PR=t}(r._tfengine.ENV),ea=function(){return r._tfengine},r._tfengine}();function KR(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ga=me();Ga.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ga.registerFlag("IS_BROWSER",function(){return KR()}),Ga.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Ga.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ga.registerFlag("PROD",function(){return!1}),Ga.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ga.getBool("DEBUG")}),Ga.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ga.registerFlag("IS_TEST",function(){return!1});var Jh,zr,Br,Js={},Oy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function g6(r,e){Js[r]=e}function va(r){r in Js||(Js[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Js[t]},!1),t===1?n.getContext("webgl",Oy)||n.getContext("experimental-webgl",Oy):n.getContext("webgl2",Oy)}(r));var e=Js[r];return e.isContextLost()?(delete Js[r],va(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Js[r])}function $m(r,e){return[e,r]}function Fh(r){var e=Oe(r);return M0(Math.ceil(e/4))}function yf(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function c_(r,e){var t,n,i,a,s,u,c,h,d,m=r;return me().getNumber("WEBGL_VERSION")===2?(t=m.R32F,n=m.R16F,i=m.RGBA16F,a=m.RGBA32F,s=m.RED,u=4,c=1,h=m.HALF_FLOAT,d=m.FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,a=m.RGBA,s=r.RGBA,u=4,c=4,h=e!=null?e.HALF_FLOAT_OES:null,d=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:s,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}function Me(r,e,t){var n=t();return e&&function(i){var a=i.getError();if(a!==i.NO_ERROR)throw new Error("WebGL Error: "+w6(i,a))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Jh||(Jh={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(zr||(zr={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Br||(Br={}));var y6=596e-10,b6=65504;function _6(r){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||y6<Math.abs(r)&&Math.abs(r)<b6)}function w6(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function tp(r,e,t){return oo(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function x6(r,e,t){var n=oo(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Me(r,e,function(){return r.shaderSource(n,t)}),Me(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function E6(r,e,t){var n=oo(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Me(r,e,function(){return r.shaderSource(n,t)}),Me(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(i,a){var s=T6.exec(a);if(s==null)return console.log("Couldn't parse line number in error: "+a),void console.log(i);for(var u=+s[1],c=i.split(`
`),h=c.length.toString().length+2,d=c.map(function(x,T){return Ol((T+1).toString(),h)+x}),m=0,v=0;v<d.length;v++)m=Math.max(d[v].length,m);var y=d.slice(0,u-1),_=d.slice(u-1,u),E=d.slice(u);console.log(y.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Ol(_[0],m),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(E.join(`
`))}(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var My,Py,T6=/ERROR: [0-9]+:([0-9]+):/g;function S6(r,e){return oo(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function C6(r,e,t){if(Me(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Ly(r,e,t){if(Me(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function A6(r,e,t){var n=oo(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Me(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Me(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function R6(r,e,t){var n=oo(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Me(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Me(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function I6(r,e){return oo(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function D6(r,e){var t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function N6(r,e){return oo(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ST(r,e,t,n,i,a,s,u){var c=r.getAttribLocation(t,n);return c!==-1&&(Me(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),Me(r,e,function(){return r.vertexAttribPointer(c,a,r.FLOAT,!1,s,u)}),Me(r,e,function(){return r.enableVertexAttribArray(c)}),!0)}function k6(r,e,t,n){F6(r,n),Me(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function O6(r,e,t,n){return oo(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function M6(r,e,t){return r.getUniformLocation(e,t)}function P6(r,e,t,n,i,a){Me(r,e,function(){return k6(r,e,n,a)}),Me(r,e,function(){return r.uniform1i(i,a)})}function Fy(r,e,t,n){Me(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Me(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function CT(r,e,t){Me(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Me(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function np(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+L6(r,e))}function L6(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function oo(r,e,t,n){var i=Me(r,e,function(){return t()});if(i==null)throw new Error(n);return i}function F6(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function nm(r,e){return e===void 0&&(e=2),Oe(r.slice(0,r.length-e))}function rm(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function By(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[nm(r)].concat(rm(r))),e}function B6(r,e){var t;e===void 0&&(e=!1);var n=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(h,d){return d>=r.length-2?VR(r[d]):r[d]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=tu(r);r=i.newShape}var a=Oe(r);if(r.length<=1&&a<=n)return[1,a];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var s=nm(r),u=2,c=2;return r.length&&(u=(t=rm(r))[0],c=t[1]),M0(a=s*(u/2)*(c/2)).map(function(h){return 2*h})}return M0(a)}function rp(r){return r%2==0}function ip(r,e){if(Pn(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||rp(t)&&rp(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&rp(r[0])&&rp(e[0])}function V6(r){if(My==null){var e=va(r);My=e.getParameter(e.MAX_TEXTURE_SIZE)}return My}function U6(r){if(Py==null){var e=va(r);Py=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Py)}function z6(r){if(r===0)return 0;var e=va(r);return ui(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ui(e,"EXT_disjoint_timer_query")?1:0}function ui(r,e){return r.getExtension(e)!=null}function AT(r){try{if(va(r)!=null)return!0}catch{return!1}return!1}function j6(r){if(r===0)return!1;var e=va(r);if(r===1){if(!ui(e,"OES_texture_float"))return!1}else if(!ui(e,"EXT_color_buffer_float"))return!1;return z0(e)}function H6(r){if(r===0)return!1;var e=va(r);if(r!==1){if(ui(e,"EXT_color_buffer_float"))return z0(e);if(ui(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(n,i){var a=c_(n,i),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var u=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,u),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);var c=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(u),c}(e,t)}return!1}return!!ui(e,"OES_texture_float")&&!!ui(e,"WEBGL_color_buffer_float")&&z0(e)}function z0(r){var e=c_(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),i}function W6(r){return r===2&&va(r).fenceSync!=null}var Ge=me();function XR(r){me().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Re(r,e){return $.tidy(r,e)}function Sr(r){GR(r).forEach(function(e){return e.dispose()})}function q6(r){return $.keep(r)}function im(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];me().getBool("IS_TEST")||console.warn.apply(console,r)}function gs(r,e){var t=r;if(sa(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||sa(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(a,s,u){if(u=u||[],!Array.isArray(a)&&!sa(a))return void W(s.length===0,function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"});W(s.length>0,function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),W(a.length===s[0],function(){return"Element arr["+u.join("][")+"] should have "+s[0]+" elements, but has "+a.length+" elements"});for(var c=s.slice(1),h=0;h<a.length;++h)i(a[h],c,u.concat(h))}(r,n,[]),n}function RT(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function j(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Gt)return RT(n,r.dtype,e,t),r;var i=vf(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),RT(n,i,e,t),r==null||!sa(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var a=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var s=gs(r,i);sa(r)||Array.isArray(r)||(r=[r]);var u=i!=="string"?zR(r,i,me().getBool("DEBUG")):$l(r,[],!0);return $.makeTensor(u,s,i)}function am(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,a){return j(i,e+"["+a+"]",t)},n)}function $R(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function G6(r,e,t){for(var n=r.length+e.length,i=[],a=0,s=0,u=0;u<n;u++)t.indexOf(u)===-1?i.push(r[a++]):i.push(e[s++]);return i}function er(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map(function(a){return r[a]})]}function Cr(r,e){return G6(r,e.map(function(t){return 1}),e)}function Fr(r,e,t){W($R(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function ga(r,e){if($R(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(i){return t.push(i)}),t}function h_(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ya(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function K6(r,e){var t=r[0].length;r.forEach(function(i,a){W(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"})}),W(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(i,a){for(var s=0;s<t;s++)W(s===e||i[s]===n[s],function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+a+"."})})}function Ql(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function K(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];$.startScope(t);try{var u=n.apply(void 0,a);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),$.endScope(u),u}catch(c){throw $.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Ge.registerFlag("HAS_WEBGL",function(){return Ge.getNumber("WEBGL_VERSION")>0}),Ge.registerFlag("WEBGL_VERSION",function(){return AT(2)?2:AT(1)?1:0}),Ge.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ge.get("WEBGL_VERSION")===2}),Ge.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ge.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ge.registerFlag("WEBGL_PACK",function(){return Ge.getBool("HAS_WEBGL")}),Ge.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_CLIP",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ge.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_PACK_REDUCE",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_CONV_IM2COL",function(){return Ge.getBool("WEBGL_PACK")}),Ge.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return V6(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return U6(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=Ge.getNumber("WEBGL_VERSION");return r===0?0:z6(r)}),Ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ge.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),Ge.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return j6(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ge.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ge.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ge.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return H6(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return W6(Ge.getNumber("WEBGL_VERSION"))}),Ge.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ge.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),qR=XR;var Hn=K({complex_:function(r,e){var t=j(r,"real","complex"),n=j(e,"imag","complex");return St(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),$.runKernelFunc(function(i){return i.complex(t,n)},{$real:t,$imag:n})}}),si=K({real_:function(r){var e=j(r,"input","real");return $.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),ta=K({imag_:function(r){var e=j(r,"input","imag");return $.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Gn(r,e,t){return ys(r,e,gs(r,t),t)}function ys(r,e,t,n){if(n==null&&(n=vf(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!sa(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){HR(e);var i=Oe(e),a=Oe(t);W(i===a,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a});for(var s=0;s<t.length;++s){var u=t[s],c=s!==t.length-1||u!==Oe(e.slice(s));W(t[s]===e[s]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return sa(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?zR(r,n,me().getBool("DEBUG")):$l(r,[],!0),$.makeTensor(r,e,n)}function Ce(r,e){if((sa(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&sa(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ys(r,[],[],e)}function hn(r,e){lc(r);var t=gs(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ys(r,null,t,e)}function es(r,e,t){if(lc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=gs(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ys(r,e,n,t)}function f_(r,e,t){if(lc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=gs(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ys(r,e,n,t)}function br(r,e,t){if(lc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=gs(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ys(r,e,n,t)}function X6(r,e,t){if(lc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=gs(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ys(r,e,n,t)}function $6(r,e,t){if(lc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=gs(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ys(r,e=e||n,n,t)}function Y6(r,e,t,n){return e===void 0&&(e=!0),$.makeVariable(r,e,t,n)}function cc(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=cc(r,"float32"),n=Bt(r,"float32");return Hn(t,n)}var i=jR(Oe(r),e);return $.makeTensor(i,r,e)}function Bt(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Bt(r,"float32"),n=Bt(r,"float32");return Hn(t,n)}var i=gf(Oe(r),e);return $.makeTensor(i,r,e)}function la(r,e,t){return $.runKernelFunc(function(n){return n.fill(r,e,t)},{})}function Q6(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return $.runKernelFunc(function(n){return n.linspace(r,e,t)},{})}function om(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Bt([0],n);var i=gf(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+t;return hn(i,n)}var YR=K({onesLike_:function(r){var e=j(r,"x","onesLike");if(e.dtype==="complex64"){var t=YR(si(e)),n=gt(ta(e));return Hn(t,n)}return $.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,a){return{$x:function(){return gt(i)}}})}}),gt=K({zerosLike_:function(r){var e=j(r,"x","zerosLike");return $.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return gt(t)}}})}}),xn=K({concat_:function(r,e){e===void 0&&(e=0),W(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=am(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(u){if(u.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+u.dtype+". ")}),e=An(e,t[0].shape)[0];var n=Ql(t.map(function(u){return u.shape}),e);if(Oe(n)===0)return Gn([],n);if((t=t.filter(function(u){return u.size>0})).length===1)return t[0];var i=t.map(function(u){return u.shape});K6(i,e);var a=t,s={axis:e};return $.runKernelFunc(function(u){return u.concat(t,e)},a,function(u){var c=i.map(function(h){return h[e]});return d_(u,c,e).map(function(h){return function(){return h}})},"Concat",s)}}),Z6=K({concat1d_:function(r){return xn(r,0)}}),J6=K({concat2d_:function(r,e){return xn(r,e)}}),e5=K({concat3d_:function(r,e){return xn(r,e)}}),t5=K({concat4d_:function(r,e){return xn(r,e)}}),d_=K({split_:function(r,e,t){t===void 0&&(t=0);var n,i=j(r,"x","split");return t=An(t,i.shape)[0],typeof e=="number"?(W(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(i.shape[t]/e)):(W(i.shape[t]===e.reduce(function(a,s){return a+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),$.runKernelFunc(function(a){return a.split(i,n,t)},{$x:i},function(a){return{$x:function(){return xn(a,t)}}})}});function wu(r,e){return r(e={exports:{}},e.exports),e.exports}var n5=wu(function(r){(function(e,t,n){function i(u){var c,h=this,d=(c=4022871197,function(m){m=m.toString();for(var v=0;v<m.length;v++){var y=.02519603282416938*(c+=m.charCodeAt(v));y-=c=y>>>0,c=(y*=c)>>>0,c+=4294967296*(y-=c)}return 23283064365386963e-26*(c>>>0)});h.next=function(){var m=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=m-(h.c=0|m)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function a(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function s(u,c){var h=new i(u),d=c&&c.state,m=h.next;return m.int32=function(){return 4294967296*h.next()|0},m.double=function(){return m()+11102230246251565e-32*(2097152*m()|0)},m.quick=m,d&&(typeof d=="object"&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.alea=s})(0,r)}),r5=wu(function(r){(function(e,t,n){function i(u){var c=this,h="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var m=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^m^m>>>8},u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c}function s(u,c){var h=new i(u),d=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},m.int32=h.next,m.quick=m,d&&(typeof d=="object"&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.xor128=s})(0,r)}),i5=wu(function(r){(function(e,t,n){function i(u){var c=this,h="";c.next=function(){var m=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^m^m<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,u===(0|u)?c.x=u:h+=u;for(var d=0;d<h.length+64;d++)c.x^=0|h.charCodeAt(d),d==h.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.v=u.v,c.d=u.d,c}function s(u,c){var h=new i(u),d=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},m.int32=h.next,m.quick=m,d&&(typeof d=="object"&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.xorwow=s})(0,r)}),a5=wu(function(r){(function(e,t,n){function i(u){var c=this;c.next=function(){var h,d,m=c.x,v=c.i;return h=m[v],d=(h^=h>>>7)^h<<24,d^=(h=m[v+1&7])^h>>>10,d^=(h=m[v+3&7])^h>>>3,d^=(h=m[v+4&7])^h<<7,h=m[v+7&7],d^=(h^=h<<13)^h<<9,m[v]=d,c.i=v+1&7,d},function(h,d){var m,v=[];if(d===(0|d))v[0]=d;else for(d=""+d,m=0;m<d.length;++m)v[7&m]=v[7&m]<<15^d.charCodeAt(m)+v[m+1&7]<<13;for(;v.length<8;)v.push(0);for(m=0;m<8&&v[m]===0;++m);for(m==8?v[7]=-1:v[m],h.x=v,h.i=0,m=256;m>0;--m)h.next()}(c,u)}function a(u,c){return c.x=u.x.slice(),c.i=u.i,c}function s(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},m.int32=h.next,m.quick=m,d&&(d.x&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.xorshift7=s})(0,r)}),o5=wu(function(r){(function(e,t,n){function i(u){var c=this;c.next=function(){var h,d,m=c.w,v=c.X,y=c.i;return c.w=m=m+1640531527|0,d=v[y+34&127],h=v[y=y+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,d=v[y]=d^h,c.i=y,d+(m^m>>>16)|0},function(h,d){var m,v,y,_,E,x=[],T=128;for(d===(0|d)?(v=d,d=null):(d+="\0",v=0,T=Math.max(T,d.length)),y=0,_=-32;_<T;++_)d&&(v^=d.charCodeAt((_+32)%d.length)),_===0&&(E=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,_>=0&&(E=E+1640531527|0,y=(m=x[127&_]^=v+E)==0?y+1:0);for(y>=128&&(x[127&(d&&d.length||0)]=-1),y=127,_=512;_>0;--_)v=x[y+34&127],m=x[y=y+1&127],v^=v<<13,m^=m<<17,v^=v>>>15,m^=m>>>12,x[y]=v^m;h.w=E,h.X=x,h.i=y}(c,u)}function a(u,c){return c.i=u.i,c.w=u.w,c.X=u.X.slice(),c}function s(u,c){u==null&&(u=+new Date);var h=new i(u),d=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},m.int32=h.next,m.quick=m,d&&(d.X&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.xor4096=s})(0,r)}),s5=wu(function(r){(function(e,t,n){function i(u){var c=this,h="";c.next=function(){var m=c.b,v=c.c,y=c.d,_=c.a;return m=m<<25^m>>>7^v,v=v-y|0,y=y<<24^y>>>8^_,_=_-m|0,c.b=m=m<<20^m>>>12^v,c.c=v=v-y|0,c.d=y<<16^v>>>16^_,c.a=_-m|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,u===Math.floor(u)?(c.a=u/4294967296|0,c.b=0|u):h+=u;for(var d=0;d<h.length+20;d++)c.b^=0|h.charCodeAt(d),c.next()}function a(u,c){return c.a=u.a,c.b=u.b,c.c=u.c,c.d=u.d,c}function s(u,c){var h=new i(u),d=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var v=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(v===0);return v},m.int32=h.next,m.quick=m,d&&(typeof d=="object"&&a(d,h),m.state=function(){return a(h,{})}),m}t&&t.exports?t.exports=s:this.tychei=s})(0,r)}),eu=wu(function(r){(function(e,t){var n,i=this,a=256,s=6,u="random",c=t.pow(a,s),h=t.pow(2,52),d=2*h,m=a-1;function v(T,C,A){var R=[],k=E(function I(D,O){var L,F=[],V=typeof D;if(O&&V=="object")for(L in D)try{F.push(I(D[L],O-1))}catch{}return F.length?F:V=="string"?D:D+"\0"}((C=C==1?{entropy:!0}:C||{}).entropy?[T,x(e)]:T??function(){try{var I;return n&&(I=n.randomBytes)?I=I(a):(I=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(I)),x(I)}catch{var D=i.navigator,O=D&&D.plugins;return[+new Date,i,O,i.screen,x(e)]}}(),3),R),B=new y(R),P=function(){for(var I=B.g(s),D=c,O=0;I<h;)I=(I+O)*a,D*=a,O=B.g(1);for(;I>=d;)I/=2,D/=2,O>>>=1;return(I+O)/D};return P.int32=function(){return 0|B.g(4)},P.quick=function(){return B.g(4)/4294967296},P.double=P,E(x(B.S),e),(C.pass||A||function(I,D,O,L){return L&&(L.S&&_(L,B),I.state=function(){return _(B,{})}),O?(t[u]=I,D):I})(P,k,"global"in C?C.global:this==t,C.state)}function y(T){var C,A=T.length,R=this,k=0,B=R.i=R.j=0,P=R.S=[];for(A||(T=[A++]);k<a;)P[k]=k++;for(k=0;k<a;k++)P[k]=P[B=m&B+T[k%A]+(C=P[k])],P[B]=C;(R.g=function(I){for(var D,O=0,L=R.i,F=R.j,V=R.S;I--;)D=V[L=m&L+1],O=O*a+V[m&(V[L]=V[F=m&F+D])+(V[F]=D)];return R.i=L,R.j=F,O})(a)}function _(T,C){return C.i=T.i,C.j=T.j,C.S=T.S.slice(),C}function E(T,C){for(var A,R=T+"",k=0;k<R.length;)C[m&k]=m&(A^=19*C[m&k])+R.charCodeAt(k++);return x(C)}function x(T){return String.fromCharCode.apply(0,T)}if(t["seed"+u]=v,E(t.random(),e),r.exports){r.exports=v;try{n=require("crypto")}catch{}}})([],Math)});eu.alea=n5,eu.xor128=r5,eu.xorwow=i5,eu.xorshift7=a5,eu.xor4096=o5,eu.tychei=s5;var Ym=eu.alea,p_=function(){function r(e,t,n,i,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=a||Math.random();this.random=Ym(s.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var a=void 0,s=void 0,u=void 0;do u=(a=2*this.random()-1)*a+(s=2*this.random()-1)*s;while(u>=1||u===0);var c=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*a*c,n=this.mean+this.stdDev*s*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),u5=function(){function r(e,t,n,i){this.alpha=e,this.beta=1/t,this.dtype=n;var a=i||Math.random();this.randu=Ym(a.toString()),this.randn=new p_(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,i,a,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,t=1-.331*(e=i*i)*e,n=.5*e+this.d*(1-s+Math.log(s)),(a=this.randu())<t||Math.log(a)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),l5=function(){function r(e,t,n,i){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Ym(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function Qe(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",HR(r),new Zh(r,e,t)}function c5(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var QR=K({batchToSpaceND_:function(r,e,t){var n=j(r,"x","batchToSpaceND"),i=e.reduce(function(a,s){return a*s});return W(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),W(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),W(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),$.runKernelFunc(function(a){return a.batchToSpaceND(n,e,t)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}})}}),h5=K({broadcastTo_:function(r,e){var t=j(r,"broadcastTo","x"),n=t.shape;if(e.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var a=Array.from(e),s=e.length-1;s>=0;s--)if(t.shape[s]===e[s])a[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=a.map(function(c,h){return c>1?h:-1}).filter(function(c){return c>=0});return u.length===0?t.clone():$.runKernelFunc(function(c){return c.tile(t,a)},{input:t},function(c){return{input:function(){return c.sum(u,!0)}}})}}),f5=K({cast_:function(r,e){var t=j(r,"x","cast");if(!i6(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return $.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",n)}}),d5=K({clone_:function(r){var e=j(r,"x","clone",null);return $.runKernelFunc(function(){return $.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),p5=K({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=j(r,"x","cumsum"),a=ga([e|=0],i.rank),s=i;a!=null&&(s=i.transpose(a));var u=ya(1,i.rank)[0],c=$.runKernelFunc(function(h){return h.cumsum(s,u,t,n)},{permutedX:s},function(h){return{permutedX:function(){return h.cumsum(e,t,!n)}}});return a!=null&&(c=c.transpose(a)),c}}),m5=K({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=j(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],a=t==="NHWC"?n.shape[2]:n.shape[3],s=t==="NHWC"?n.shape[3]:n.shape[1];return W(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),W(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+n.shape}),W(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+n.shape}),$.runKernelFunc(function(u){return u.depthToSpace(n,e,t)},{$x:n})}}),oi=K({expandDims_:function(r,e){e===void 0&&(e=0);var t=j(r,"x","expandDims",null);W(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&(W(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),wi(t,n)}}),ZR=K({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=Qe([r,e],n),a=r<=e?r:e,s=0;s<a;++s)i.set(1,s,s);var u=i.toTensor().as2D(r,e);if(t==null)return u;if(t.length===1)return Ml(oi(u,0),[t[0],1,1]);if(t.length===2)return Ml(oi(oi(u,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ml(oi(oi(oi(u,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),v5=K({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=j(r,"logits","multinomial"),a=i.size,s=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var u=s===1?i.as2D(1,-1):i,c=$.runKernelFunc(function(h){return h.multinomial(u,n,e,t)},{logits2D:u});return s===1?c.as1D():c}}),j0=K({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=j(r,"indices","oneHot","int32"),a=i.shape.concat([e]);return i=i.flatten(),$.runKernelFunc(function(s){return s.oneHot(i,e,t,n)},{$indices:i},function(s){return{$indices:function(){return Bt(i.shape,"float32")}}}).reshape(a)}}),xu=K({pad_:function(r,e,t){t===void 0&&(t=0);var n=j(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return $.runKernelFunc(function(a){return a.pad(n,e,t)},{x:n},function(a){var s=e.map(function(u){return u[0]});return{x:function(){return a.slice(s,n.shape)}}},"PadV2",i)}}),g5=K({pad1d_:function(r,e,t){return t===void 0&&(t=0),W(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),xu(r,[e],t)}}),y5=K({pad2d_:function(r,e,t){return t===void 0&&(t=0),W(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xu(r,e,t)}}),b5=K({pad3d_:function(r,e,t){return t===void 0&&(t=0),W(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xu(r,e,t)}}),_5=K({pad4d_:function(r,e,t){return t===void 0&&(t=0),W(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xu(r,e,t)}}),w5=K({rand_:function(r,e,t){var n=Oe(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var a=0;a<n;a++)i[a]=e();return $.makeTensor(i,r,t)}}),x5=K({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new p_(e,t,n,!1,i),s=Qe(r,n),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),E5=K({randomGamma_:function(r,e,t,n,i){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var a=new u5(e,t,n,i),s=Qe(r,n),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),JR=K({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var a=Qe(r,n),s=new l5(e,t,null,i),u=0;u<a.values.length;u++)a.values[u]=s.nextValue();return a.toTensor()}}),wi=K({reshape_:function(r,e){var t=j(r,"x","reshape",null);e=n6(e,t.size),W(t.size===Oe(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return $.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",n)}}),eI=K({spaceToBatchND_:function(r,e,t){var n=j(r,"x","spaceToBatchND");return W(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),W(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),W(n.shape.reduce(function(i,a,s){return s>0&&s<=e.length?i&&(a+t[s-1][0]+t[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),$.runKernelFunc(function(i){return i.spaceToBatchND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),tI=K({squeeze_:function(r,e){var t=j(r,"x","squeeze");return wi(t,tu(t.shape,e).newShape)}}),qr=K({stack_:function(r,e){e===void 0&&(e=0);var t=am(r,"tensors","stack");if(W(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,a=t[0].dtype;W(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(u){St(i,u.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(u){W(a===u.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=t.map(function(u){return u.expandDims(e)});return xn(s,e)}}),Ml=K({tile_:function(r,e){var t=j(r,"x","tile",null);W(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var n=[t],i={reps:e};return $.runKernelFunc(function(a,s){var u=a.tile(t,e);return s([t]),u},{x:t},function(a,s){var u=s[0];return{x:function(){var c=gt(u);if(u.rank===1)for(var h=0;h<e[0];++h)c=c.add(a.slice([h*u.shape[0]],[u.shape[0]]));else if(u.rank===2)for(h=0;h<e[0];++h)for(var d=0;d<e[1];++d)c=c.add(a.slice([h*u.shape[0],d*u.shape[1]],[u.shape[0],u.shape[1]]));else if(u.rank===3)for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(var m=0;m<e[2];++m)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],m*u.shape[2]],[u.shape[0],u.shape[1],u.shape[2]]));else{if(u.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+u.rank+" tensors yet.");for(h=0;h<e[0];++h)for(d=0;d<e[1];++d)for(m=0;m<e[2];++m)for(var v=0;v<e[3];++v)c=c.add(a.slice([h*u.shape[0],d*u.shape[1],m*u.shape[2],v*u.shape[3]],[u.shape[0],u.shape[1],u.shape[2],u.shape[3]]))}return c}}},"Tile",i,n)}}),T5=K({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new p_(e,t,n,!0,i),s=Qe(r,n),u=0;u<s.values.length;u++)s.values[u]=a.nextValue();return s.toTensor()}}),En=K({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=j(r,"x","unstack");W(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var n={axis:e};return $.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return qr(i,e)}}},"Unpack",n)}}),S5=function(r,e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u,c,h,d,m;return Ne(this,function(v){switch(v.label){case 0:return t=j(r,"x","setdiff1d"),n=j(e,"y","setdiff1d"),W(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),W(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),W(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return i=v.sent(),[4,n.data()];case 2:for(a=v.sent(),s=new Set(a),u=0,d=0;d<i.length;d++)s.has(i[d])||u++;for(c=new Zh([u],t.dtype),h=new Zh([u],"int32"),d=0,m=0;d<i.length;d++)s.has(i[d])||(c.values[m]=i[d],h.values[m]=d,m++);return[2,[c.toTensor(),h.toTensor()]]}})})};function sm(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var a=e.length,s=0;s<a;++s)i=i.concat([r[s+1]/e[s],e[s]]);i=i.concat(r.slice(a+1))}return i}function um(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var a=[],s=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?s.push(i):a.push(i);n.push.apply(n,a),n.push(0),n.push.apply(n,s)}return n}function lm(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var a=1;a<r.length;++a)a<=e.length?n?i.push(e[a-1]*r[a]):i.push(r[a]/e[a-1]):i.push(r[a]);return i}function nI(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function rI(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}function iI(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,a=0;a<t.length-1;++a)i*=t[a];var s=r.shape,u=t.slice();u.pop();var c=1;for(a=n;a<r.rank;++a)c*=s[a],u.push(s[a]);var h=ua(r.shape).map(function(d){return d/c}).concat([1]).slice(0,n);return[u,i,c,h]}var aI=30;function Vy(r){return r<=aI?r:L0(r,Math.floor(Math.sqrt(r)))}function C5(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+i+".";if(t.rank<i)throw new Error(a+" update.rank < "+i+". ");if(r.length<n+(t.rank-i))throw new Error(a+" Output shape length < "+(n+(t.rank-i)));if(t.rank!==i+r.length-n)throw new Error(a+" update.rank != "+(i+r.length-n));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(a+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==r[s+n])throw new Error(a+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+r[s+i]+")")}function A5(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}C5(t,e,r)}function cm(r,e,t){for(var n=e.shape.length,i=n>1?e.shape[n-1]:1,a=t.length,s=1,u=i;u<a;++u)s*=t[u];var c=i<1?1:i;return{sliceRank:i,numUpdates:Oe(e.shape)/c,sliceSize:s,strides:ua(t.slice(0,i)).concat([1]),outputSize:Oe(t)}}function R5(r,e,t){W(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."}),W(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var n=function(a){W(e[a]+t[a]<=r.shape[a],function(){return"Error in slice"+r.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+r.shape[a]+")"})},i=0;i<r.rank;++i)n(i)}function IT(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function m_(r,e,t){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((e[i]-r[i])/t[i]);return n}function I5(r,e,t,n,i){var a=e[i],s=t[i]||1;(r&1<<i||a==null)&&(a=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[i];return a<0&&(a+=u),a=O0(0,a,u-1)}function D5(r,e,t,n,i){var a=e[i],s=t[i]||1;(r&1<<i||a==null)&&(a=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[i];return a<0&&(a+=u),a=s>0?O0(0,a,u):O0(-1,a,u-1)}function oI(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function sI(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function N5(r,e){W(P0(r),function(){return"The f passed in variableGrads(f) must be a function"}),W(e==null||Array.isArray(e)&&e.every(function(d){return d instanceof Yl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],$.registeredVariables)e.push($.registeredVariables[n]);var i=t?e.filter(function(d){return!d.trainable}):null,a=e.length;W((e=e.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var s=$.gradients(r,e,null,!0),u=s.value,c=s.grads;W(c.some(function(d){return d!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),W(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"});var h={};return e.forEach(function(d,m){c[m]!=null&&(h[d.name]=c[m])}),i!=null&&i.forEach(function(d){return h[d.name]=null}),{value:u,grads:h}}function Qm(r){return $.customGrad(r)}var so=K({softmax_:function(r,e){e===void 0&&(e=-1);var t=j(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return $.runKernelFunc(function(n,i){var a=n.softmax(t,e);return i([a]),a},{logits:t},function(n,i){var a=i[0],s=n.mul(a);return{logits:function(){return s.sub(s.sum([e],!0).mul(a))}}},"Softmax",{dim:e},[],[!0])}}),k5=K({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=j(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Qm(function(n,i){var a=n.max(e,!0),s=n.sub(a),u=s.toFloat().sub(s.exp().sum(e,!0).log());return i([u]),{value:u,gradFunc:function(c,h){var d=h[0].exp();return c.sub(c.sum(e,!0).mul(d))}}})(t)}}),uI=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),lI=function(){function r(){}return r.prototype.time=function(e){return le("time")},r.prototype.read=function(e){return le("read")},r.prototype.readSync=function(e){return le("readSync")},r.prototype.numDataIds=function(){return le("numDataIds")},r.prototype.disposeData=function(e){return le("disposeData")},r.prototype.write=function(e,t,n){return le("write")},r.prototype.move=function(e,t,n,i){return le("move")},r.prototype.memory=function(){return le("memory")},r.prototype.floatPrecision=function(){return le("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,i){return le("batchMatMul")},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,le("fusedBatchMatMul")},r.prototype.slice=function(e,t,n){return le("slice")},r.prototype.stridedSlice=function(e,t,n,i){return le("stridedSlice")},r.prototype.unstack=function(e,t){return le("unstack")},r.prototype.reverse=function(e,t){return le("reverse")},r.prototype.concat=function(e,t){return le("concat")},r.prototype.neg=function(e){return le("neg")},r.prototype.add=function(e,t){return le("add")},r.prototype.addN=function(e){return le("addN")},r.prototype.subtract=function(e,t){return le("subtract")},r.prototype.multiply=function(e,t){return le("multiply")},r.prototype.realDivide=function(e,t){return le("realDivide")},r.prototype.floorDiv=function(e,t){return le("floorDiv")},r.prototype.sum=function(e,t){return le("sum")},r.prototype.prod=function(e,t){return le("prod")},r.prototype.unsortedSegmentSum=function(e,t,n){return le("unsortedSegmentSum")},r.prototype.argMin=function(e,t){return le("argMin")},r.prototype.argMax=function(e,t){return le("argMax")},r.prototype.equal=function(e,t){return le("equal")},r.prototype.notEqual=function(e,t){return le("notEqual")},r.prototype.less=function(e,t){return le("less")},r.prototype.lessEqual=function(e,t){return le("lessEqual")},r.prototype.greater=function(e,t){return le("greater")},r.prototype.greaterEqual=function(e,t){return le("greaterEqual")},r.prototype.logicalNot=function(e){return le("logicalNot")},r.prototype.logicalAnd=function(e,t){return le("logicalAnd")},r.prototype.logicalOr=function(e,t){return le("logicalOr")},r.prototype.where=function(e){return le("where")},r.prototype.select=function(e,t,n){return le("select")},r.prototype.topk=function(e,t,n){return le("topk")},r.prototype.min=function(e,t){return le("min")},r.prototype.minimum=function(e,t){return le("minimum")},r.prototype.mod=function(e,t){return le("mod")},r.prototype.max=function(e,t){return le("max")},r.prototype.maximum=function(e,t){return le("maximum")},r.prototype.all=function(e,t){return le("all")},r.prototype.any=function(e,t){return le("any")},r.prototype.squaredDifference=function(e,t){return le("squaredDifference")},r.prototype.ceil=function(e){return le("ceil")},r.prototype.floor=function(e){return le("floor")},r.prototype.round=function(e){return le("round")},r.prototype.sign=function(e){return le("sign")},r.prototype.isNaN=function(e){return le("isNaN")},r.prototype.isInf=function(e){return le("isInf")},r.prototype.isFinite=function(e){return le("isFinite")},r.prototype.pow=function(e,t){return le("pow")},r.prototype.exp=function(e){return le("exp")},r.prototype.expm1=function(e){return le("expm1")},r.prototype.softmax=function(e,t){return le("softmax")},r.prototype.log=function(e){return le("log")},r.prototype.log1p=function(e){return le("log1p")},r.prototype.sqrt=function(e){return le("sqrt")},r.prototype.rsqrt=function(e){return le("rsqrt")},r.prototype.square=function(e){return le("square")},r.prototype.reciprocal=function(e){return le("reciprocal")},r.prototype.relu=function(e){return le("relu")},r.prototype.relu6=function(e){return le("relu6")},r.prototype.prelu=function(e,t){return le("prelu")},r.prototype.elu=function(e){return le("elu")},r.prototype.eluDer=function(e,t){return le("eluDer")},r.prototype.selu=function(e){return le("selu")},r.prototype.int=function(e){return le("int")},r.prototype.clip=function(e,t,n){return le("clip")},r.prototype.abs=function(e){return le("abs")},r.prototype.complexAbs=function(e){return le("complexAbs")},r.prototype.sigmoid=function(e){return le("sigmoid")},r.prototype.softplus=function(e){return le("softplus")},r.prototype.sin=function(e){return le("sin")},r.prototype.cos=function(e){return le("cos")},r.prototype.tan=function(e){return le("tan")},r.prototype.asin=function(e){return le("asin")},r.prototype.acos=function(e){return le("acos")},r.prototype.atan=function(e){return le("atan")},r.prototype.atan2=function(e,t){return le("atan2")},r.prototype.sinh=function(e){return le("sinh")},r.prototype.cosh=function(e){return le("cosh")},r.prototype.tanh=function(e){return le("tanh")},r.prototype.asinh=function(e){return le("asinh")},r.prototype.acosh=function(e){return le("acosh")},r.prototype.atanh=function(e){return le("atanh")},r.prototype.erf=function(e){return le("erf")},r.prototype.step=function(e,t){return le("step")},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedConv2d")},r.prototype.conv2d=function(e,t,n){return le("conv2d")},r.prototype.conv2dDerInput=function(e,t,n){return le("conv2dDerInput")},r.prototype.conv2dDerFilter=function(e,t,n){return le("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,le("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(e,t,n){return le("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return le("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return le("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(e,t,n){return le("conv3d")},r.prototype.conv3dDerInput=function(e,t,n){return le("conv3dDerInput")},r.prototype.conv3dDerFilter=function(e,t,n){return le("conv3dDerFilter")},r.prototype.maxPool=function(e,t){return le("maxPool")},r.prototype.maxPoolBackprop=function(e,t,n,i){return le("maxPoolBackprop")},r.prototype.avgPool=function(e,t){return le("avgPool")},r.prototype.avgPoolBackprop=function(e,t,n){return le("avgPoolBackprop")},r.prototype.avgPool3d=function(e,t){return le("avgPool3d")},r.prototype.avgPool3dBackprop=function(e,t,n){return le("avgPool3dBackprop")},r.prototype.maxPool3d=function(e,t){return le("maxPool3d")},r.prototype.maxPool3dBackprop=function(e,t,n,i){return le("maxPool3dBackprop")},r.prototype.reshape=function(e,t){return le("reshape")},r.prototype.cast=function(e,t){return le("cast")},r.prototype.tile=function(e,t){return le("tile")},r.prototype.pad=function(e,t,n){return le("pad")},r.prototype.transpose=function(e,t){return le("transpose")},r.prototype.gather=function(e,t,n){return le("gather")},r.prototype.gatherND=function(e,t){return le("gatherND")},r.prototype.scatterND=function(e,t,n){return le("scatterND")},r.prototype.batchToSpaceND=function(e,t,n){return le("batchToSpaceND")},r.prototype.spaceToBatchND=function(e,t,n){return le("spaceToBatchND")},r.prototype.resizeBilinear=function(e,t,n,i){return le("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(e,t,n){return le("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(e,t,n,i){return le("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return le("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(e,t,n,i,a,s){return le("batchNormalization")},r.prototype.localResponseNormalization4D=function(e,t,n,i,a){return le("localResponseNormalization4D")},r.prototype.LRNGrad=function(e,t,n,i,a,s,u){return le("LRNGrad")},r.prototype.multinomial=function(e,t,n,i){return le("multinomial")},r.prototype.oneHot=function(e,t,n,i){return le("oneHot")},r.prototype.cumsum=function(e,t,n,i){return le("cumsum")},r.prototype.nonMaxSuppression=function(e,t,n,i,a){return le("nonMaxSuppression")},r.prototype.fft=function(e){return le("fft")},r.prototype.ifft=function(e){return le("ifft")},r.prototype.complex=function(e,t){return le("complex")},r.prototype.real=function(e){return le("real")},r.prototype.imag=function(e){return le("imag")},r.prototype.cropAndResize=function(e,t,n,i,a,s){return le("cropAndResize")},r.prototype.depthToSpace=function(e,t,n){return le("depthToSpace")},r.prototype.split=function(e,t,n){return le("split")},r.prototype.sparseToDense=function(e,t,n,i){return le("sparseToDense")},r.prototype.diag=function(e){return le("diag")},r.prototype.fill=function(e,t,n){return le("fill")},r.prototype.onesLike=function(e){return le("onesLike")},r.prototype.zerosLike=function(e){return le("zerosLike")},r.prototype.linspace=function(e,t,n){return le("linspace")},r.prototype.dispose=function(){return le("dispose")},r}();function le(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Xo(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var a=t-1-i,s=r[a]||1;(e[e.length-1-i]||1)>1&&s===1&&n.unshift(a)}return n}function Sn(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],a=e.length-n-1,s=e[a];(i==null||i===1&&s>1)&&t.unshift(a)}return t}function ut(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var a=r[r.length-i-1];a==null&&(a=1);var s=e[e.length-i-1];if(s==null&&(s=1),a===1)t.unshift(s);else if(s===1)t.unshift(a);else{if(a!==s)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(a)}}return t}function ef(r,e,t,n,i,a,s){s===void 0&&(s="channelsLast");var u,c=dm(e),h=c[0],d=c[1];if(s==="channelsLast")u=[h,d,r[3],r[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=[h,d,r[1],r[1]]}return Eu(r,u,t,n,i,a,!1,s)}function hm(r,e,t,n,i,a,s){s===void 0&&(s="NDHWC");var u,c,h=H0(e),d=h[0],m=h[1],v=h[2];if(s==="NDHWC")c="channelsLast",u=[d,m,v,r[4],r[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);c="channelsFirst",u=[d,m,v,r[1],r[1]]}return fm(r,u,t,n,i,!1,c,a)}function Eu(r,e,t,n,i,a,s,u){s===void 0&&(s=!1),u===void 0&&(u="channelsLast");var c=[-1,-1,-1,-1],h=c[0],d=c[1],m=c[2],v=c[3];if(u==="channelsLast")h=r[0],d=r[1],m=r[2],v=r[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=r[0],v=r[1],d=r[2],m=r[3]}var y,_=e[0],E=e[1],x=e[3],T=dm(t),C=T[0],A=T[1],R=dm(n),k=R[0],B=R[1],P=Pl(_,k),I=Pl(E,B),D=function(ie,se,G,Q,te,de,H,ee){var pe,ce,xe;if(typeof ie=="number"){pe={top:ie,bottom:ie,left:ie,right:ie,type:ie===0?"VALID":"NUMBER"};var Se=function(Xe,lt,tt,xt,Ct){xt==null&&(xt=cI(Xe,lt,tt));var It=Xe[0],Wt=Xe[1],dr=Bh((It-lt+2*xt)/tt+1,Ct);W(rn(dr),function(){return"The output # of rows ("+dr+") must be an integer. Change the stride and/or zero pad parameters"});var fn=Bh((Wt-lt+2*xt)/tt+1,Ct);return W(rn(fn),function(){return"The output # of columns ("+fn+") must be an integer. Change the stride and/or zero pad parameters"}),[dr,fn]}([se,G],de,Q,ie,ee);ce=Se[0],xe=Se[1]}else if(ie==="same"){ce=Math.ceil(se/Q),xe=Math.ceil(G/te);var Ee=Math.max(0,(ce-1)*Q+de-se),Ve=Math.max(0,(xe-1)*te+H-G),ke=Math.floor(Ee/2),Ke=Ee-ke,wt=Math.floor(Ve/2);pe={top:ke,bottom:Ke,left:wt,right:Ve-wt,type:"SAME"}}else{if(ie!=="valid")throw Error("Unknown padding parameter: "+ie);pe={top:0,bottom:0,left:0,right:0,type:"VALID"},ce=Math.ceil((se-de+1)/Q),xe=Math.ceil((G-H+1)/te)}return{padInfo:pe,outHeight:ce,outWidth:xe}}(i,d,m,C,A,P,I,a),O=D.padInfo,L=D.outHeight,F=D.outWidth,V=s?x*v:x;return u==="channelsFirst"?y=[h,V,L,F]:u==="channelsLast"&&(y=[h,L,F,V]),{batchSize:h,dataFormat:u,inHeight:d,inWidth:m,inChannels:v,outHeight:L,outWidth:F,outChannels:V,padInfo:O,strideHeight:C,strideWidth:A,filterHeight:_,filterWidth:E,effectiveFilterHeight:P,effectiveFilterWidth:I,dilationHeight:k,dilationWidth:B,inShape:r,outShape:y,filterShape:e}}function fm(r,e,t,n,i,a,s,u){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var c=[-1,-1,-1,-1,-1],h=c[0],d=c[1],m=c[2],v=c[3],y=c[4];if(s==="channelsLast")h=r[0],d=r[1],m=r[2],v=r[3],y=r[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);h=r[0],y=r[1],d=r[2],m=r[3],v=r[4]}var _,E=e[0],x=e[1],T=e[2],C=e[4],A=H0(t),R=A[0],k=A[1],B=A[2],P=H0(n),I=P[0],D=P[1],O=P[2],L=Pl(E,I),F=Pl(x,D),V=Pl(T,O),ie=function(H,ee,pe,ce,xe,Se,Ee,Ve,ke,Ke,wt){var Xe,lt,tt,xt;if(typeof H=="number"){Xe={top:H,bottom:H,left:H,right:H,front:H,back:H,type:H===0?"VALID":"NUMBER"};var Ct=function(Kr,pr,Pt,ct,Vt,an){Vt==null&&(Vt=cI(Kr,pr,ct));var Cu=Kr[0],hc=Kr[1],_a=Kr[2],fi=Bh((Cu-pr+2*Vt)/ct+1,an);W(rn(fi),function(){return"The output # of depths ("+fi+") must be an integer. Change the stride and/or zero pad parameters"});var di=Bh((hc-pr+2*Vt)/ct+1,an);W(rn(di),function(){return"The output # of rows ("+di+") must be an integer. Change the stride and/or zero pad parameters"});var ur=Bh((_a-pr+2*Vt)/ct+1,an);return W(rn(ur),function(){return"The output # of columns ("+ur+") must be an integer. Change the stride and/or zero pad parameters"}),[fi,di,ur,Pt]}([ee,pe,ce,1],Ve,1,xe,H,wt);lt=Ct[0],tt=Ct[1],xt=Ct[2]}else if(H==="same"){lt=Math.ceil(ee/xe),tt=Math.ceil(pe/Se),xt=Math.ceil(ce/Ee);var It=(lt-1)*xe+Ve-ee,Wt=(tt-1)*Se+ke-pe,dr=(xt-1)*Ee+Ke-ce,fn=Math.floor(It/2),Rr=It-fn,Fn=Math.floor(Wt/2),Gr=Wt-Fn,$n=Math.floor(dr/2);Xe={top:Fn,bottom:Gr,left:$n,right:dr-$n,front:fn,back:Rr,type:"SAME"}}else{if(H!=="valid")throw Error("Unknown padding parameter: "+H);Xe={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},lt=Math.ceil((ee-Ve+1)/xe),tt=Math.ceil((pe-ke+1)/Se),xt=Math.ceil((ce-Ke+1)/Ee)}return{padInfo:Xe,outDepth:lt,outHeight:tt,outWidth:xt}}(i,d,m,v,R,k,B,L,F,V,u),se=ie.padInfo,G=ie.outDepth,Q=ie.outHeight,te=ie.outWidth,de=a?C*y:C;return s==="channelsFirst"?_=[h,de,G,Q,te]:s==="channelsLast"&&(_=[h,G,Q,te,de]),{batchSize:h,dataFormat:s,inDepth:d,inHeight:m,inWidth:v,inChannels:y,outDepth:G,outHeight:Q,outWidth:te,outChannels:de,padInfo:se,strideDepth:R,strideHeight:k,strideWidth:B,filterDepth:E,filterHeight:x,filterWidth:T,effectiveFilterDepth:L,effectiveFilterHeight:F,effectiveFilterWidth:V,dilationDepth:I,dilationHeight:D,dilationWidth:O,inShape:r,outShape:_,filterShape:e}}function cI(r,e,t,n){n===void 0&&(n=1);var i=Pl(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function dm(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function H0(r){return typeof r=="number"?[r,r,r]:r}function Pl(r,e){return e<=1?r:r+(r-1)*(e-1)}function Bh(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Zl(r){var e=dm(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function Ar(r,e){return Zl(r)||Zl(e)}function v_(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function hI(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Bt(r.shape),i=r.toFloat(),a=t.complex(i,n);return n.dispose(),i.dispose(),a}if(!a6(r.dtype,e))return $.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var s=t.real(r);return a=s.cast(e),s.dispose(),a}if(e==="int32")return t.int(r);if(e==="bool"){var u=Ce(0,r.dtype);return a=t.notEqual(r,u),u.dispose(),a}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function W0(r,e){return $.makeTensorFromDataId(r.dataId,e,r.dtype)}function fI(r,e,t){var n=(e-r)/(t-1),i=gf(t,"float32");i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return hn(i,"float32")}function q0(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function DT(r,e){return{real:r[2*e],imag:r[2*e+1]}}function O5(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function M5(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function P5(r,e,t){var n=function(a,s,u){return function(c,h,d){for(var m=0,v=c.length,y=0,_=!1;m<v;){var E=d(h,c[y=m+(v-m>>>1)]);E>0?m=y+1:(v=y,_=!E)}return _?m:-m-1}(a,s,u||L5)}(r,e,t),i=n<0?-(n+1):n;r.splice(i,0,e)}function L5(r,e){return r>e?1:r<e?-1:0}function g_(r,e,t,n,i){return dI(r,e,t,n,i,0).selectedIndices}function y_(r,e,t,n,i,a){var s=dI(r,e,t,n,i,a);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function dI(r,e,t,n,i,a,s,u){u===void 0&&(u=!1);for(var c=Array.from(e).map(function(R,k){return{score:R,boxIndex:k,suppressBeginIndex:0}}).filter(function(R){return R.score>i}).sort(NT),h=a>0?-.5/a:0,d=[],m=[];d.length<t&&c.length>0;){var v=c.pop(),y=v.score,_=v.boxIndex,E=v.suppressBeginIndex;if(y<i)break;for(var x=!1,T=d.length-1;T>=E;--T){var C=F5(r,_,d[T]);if(C>=n){x=!0;break}if(v.score=v.score*B5(n,h,C),v.score<=i)break}v.suppressBeginIndex=d.length,x||(v.score===y?(d.push(_),m.push(v.score)):v.score>i&&P5(c,v,NT))}var A=d.length;return u&&(d.fill(0,A),m.fill(0,A)),{selectedIndices:hn(d,"int32"),selectedScores:hn(m,"float32"),numValidOutputs:Ce(A,"int32")}}function F5(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),a=Math.min(n[0],n[2]),s=Math.min(n[1],n[3]),u=Math.max(n[0],n[2]),c=Math.max(n[1],n[3]),h=Math.min(i[0],i[2]),d=Math.min(i[1],i[3]),m=Math.max(i[0],i[2]),v=Math.max(i[1],i[3]),y=(u-a)*(c-s),_=(m-h)*(v-d);if(y<=0||_<=0)return 0;var E=Math.max(a,h),x=Math.max(s,d),T=Math.min(u,m),C=Math.min(c,v),A=Math.max(T-E,0)*Math.max(C-x,0);return A/(y+_-A)}function B5(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function NT(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function pI(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map(function(a){i[t]=a;var s=r.slice(n,i);return n[t]+=a,s})}function mI(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=Qe(t,r.dtype);for(n=0;n<i.values.length;++n){for(var a=i.indexToLoc(n),s=new Array(r.rank),u=0;u<s.length;u++)s[u]=a[u]%r.shape[u];var c=r.locToIndex(s);i.values[n]=r.values[c]}return i.toTensor()}function vI(r,e,t,n,i){for(var a=e[e.length-1],s=[r.length/a,a],u=s[0],c=s[1],h=Qh(t,u*n),d=Qh("int32",u*n),m=0;m<u;m++){for(var v=m*c,y=r.subarray(v,v+c),_=[],E=0;E<y.length;E++)_.push({value:y[E],index:E});_.sort(function(R,k){return k.value-R.value});var x=m*n,T=h.subarray(x,x+n),C=d.subarray(x,x+n);for(E=0;E<n;E++)T[E]=_[E].value,C[E]=_[E].index}var A=e.slice();return A[A.length-1]=n,[Gn(h,A,t),Gn(d,A,"int32")]}function b_(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=Qe(r,"int32"),a=Qe([t.length,r.length],"int32");for(n=0;n<t.length;n++){var s=i.indexToLoc(t[n]),u=n*r.length;a.values.set(s,u)}return a.toTensor()}var V5=function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},U5=function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},z5=function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,a=r.inSize,s=Math.ceil(a/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var u=e==="max"?">":"<",c=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function gI(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function wr(r,e){return e===1?[r]:gI(r,e)}function rr(){var r,e,t,n,i,a,s,u,c,h;return me().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",a="outputColor",s="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",a="gl_FragColor",s="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:a,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:h}}function au(r,e,t){t===void 0&&(t="index");var n=ua(e);return n.map(function(i,a){return"int "+r[a]+" = "+t+" / "+i+"; "+(a===n.length-1?"int "+r[a+1]+" = "+t+" - "+r[a]+" * "+i:"index -= "+r[a]+" * "+i)+";"}).join("")}function __(r){var e=ua(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var yI=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function j5(r,e,t,n){var i=[];r.forEach(function(y){var _=Oe(y.shapeInfo.logicalShape);y.shapeInfo.isUniform?i.push("uniform float "+y.name+(_>1?"["+_+"]":"")+";"):(i.push("uniform sampler2D "+y.name+";"),i.push("uniform int offset"+y.name+";"))});var a,s,u=i.join(`
`),c=r.map(function(y){return function(_,E,x){x===void 0&&(x=!1);var T="";T+=x?bI(_):Sl(_);var C=_.shapeInfo.logicalShape,A=E.logicalShape;return C.length<=A.length&&(T+=x?function(R,k){var B,P=R.name,I=P.charAt(0).toUpperCase()+P.slice(1),D="get"+I+"AtOutCoords",O=R.shapeInfo.logicalShape.length,L=k.logicalShape.length,F=Xo(R.shapeInfo.logicalShape,k.logicalShape),V=Ft(L),ie=L-O,se=["x","y","z","w","u","v"];B=O===0?"":L<2&&F.length>=1?"coords = 0;":F.map(function(pe){return"coords."+se[pe+ie]+" = 0;"}).join(`
`);var G="";G=L<2&&O>0?"coords":R.shapeInfo.logicalShape.map(function(pe,ce){return"coords."+se[ce+ie]}).join(", ");var Q="return outputValue;",te=Oe(R.shapeInfo.logicalShape)===1,de=Oe(k.logicalShape)===1;if(O!==1||te||de){if(te&&!de)Q=L===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(F.length){var H=O-2,ee=O-1;F.indexOf(H)>-1&&F.indexOf(ee)>-1?Q="return vec4(outputValue.x);":F.indexOf(H)>-1?Q="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":F.indexOf(ee)>-1&&(Q="return vec4(outputValue.xx, outputValue.zz);")}}else Q=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+D+`() {
      `+V+` coords = getOutputCoords();
      `+B+`
      vec4 outputValue = get`+I+"("+G+`);
      `+Q+`
    }
  `}(_,E):function(R,k){var B=R.name,P=B.charAt(0).toUpperCase()+B.slice(1),I="get"+P+"AtOutCoords",D=k.texShape,O=R.shapeInfo.texShape,L=R.shapeInfo.logicalShape.length,F=k.logicalShape.length;if(!R.shapeInfo.isUniform&&L===F&&R.shapeInfo.flatOffset==null&&Pn(O,D))return`
      float `+I+`() {
        return sampleTexture(`+B+`, resultUV);
      }
    `;var V,ie=Ft(F),se=Xo(R.shapeInfo.logicalShape,k.logicalShape),G=F-L,Q=["x","y","z","w","u","v"];V=L===0?"":F<2&&se.length>=1?"coords = 0;":se.map(function(de){return"coords."+Q[de+G]+" = 0;"}).join(`
`);var te="";return te=F<2&&L>0?"coords":R.shapeInfo.logicalShape.map(function(de,H){return"coords."+Q[H+G]}).join(", "),`
    float `+I+`() {
      `+ie+` coords = getOutputCoords();
      `+V+`
      return get`+P+"("+te+`);
    }
  `}(_,E)),T}(y,e,n)}).join(`
`),h=e.texShape,d=rr(),m=function(y){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+y.texture2D+`(textureSampler, uv).r;
    }
  `}(d),v=function(y){return y.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+y.varyingFs+` vec2 resultUV;
    `+y.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+y.defineSpecialNaN+`
    `+y.defineSpecialInf+`
    `+y.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+H5+`
    `+W5+`
    `+q5+`
  `}(d);return e.isPacked?(a=function(y,_){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(R,k){var B=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return B[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+B[1]+`.0);
      }
    `:B[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+B[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));
      return 2 * (resTexRC.x * `+B[1]+` + resTexRC.y);
    }
  `}(0,_);case 2:return function(R,k){var B=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(Pn(R,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+B[0]+", "+B[1]+`));
      }
    `;var P=Math.ceil(R[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));

      int index = resTexRC.x * `+B[1]+` + resTexRC.y;
      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec2(r, c);
    }
  `}(y,_);case 3:return E=y,x=_,T=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],C=Math.ceil(E[2]/2),A=C*Math.ceil(E[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+T[0]+", "+T[1]+`));
      int index = resTexRC.x * `+T[1]+` + resTexRC.y;

      int b = index / `+A+`;
      index -= b * `+A+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(R,k){for(var B=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],P=Math.ceil(R[R.length-1]/2),I=P*Math.ceil(R[R.length-2]/2),D=I,O="",L="b, r, c",F=2;F<R.length-1;F++)D*=R[R.length-F-1],O=`
      int b`+F+" = index / "+D+`;
      index -= b`+F+" * "+D+`;
    `+O,L="b"+F+", "+L;return`
    ivec`+R.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+B[0]+", "+B[1]+`));
      int index = resTexRC.x * `+B[1]+` + resTexRC.y;

      `+O+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+P+`);
      int c = imod(index, `+P+`) * 2;

      return ivec`+R.length+"("+L+`);
    }
  `}(y,_)}var E,x,T,C,A}(e.logicalShape,h),s=function(y){return`
    void setOutput(vec4 val) {
      `+y.output+` = val;
    }
  `}(d)):(a=function(y,_){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(T,C){return C[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return resTexRC.x * `+C[1]+` + resTexRC.y;
    }
  `}(0,_);case 2:return function(T,C){return Pn(T,C)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `:T[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:T[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+C[0]+", "+C[1]+`));
        int index = resTexRC.x * `+C[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = index / `+T[1]+`;
      int c = index - r * `+T[1]+`;
      return ivec2(r, c);
    }
  `}(y,_);case 3:return E=_,x=au(["r","c","d"],y),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      `+x+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(T,C){var A=au(["r","c","d","d2"],T);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      `+A+`
      return ivec4(r, c, d, d2);
    }
  `}(y,_);case 5:return function(T,C){var A=au(["r","c","d","d2","d3"],T);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+C[0]+`,
                             `+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+A+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(y,_);case 6:return function(T,C){var A=au(["r","c","d","d2","d3","d4"],T);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+A+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(y,_);default:throw new Error(y.length+"-D output sampling is not yet supported")}var E,x}(e.logicalShape,h),s=function(y){return`
    void setOutput(float val) {
      `+y.output+` = vec4(val, 0, 0, 0);
    }
  `}(d)),n&&(v+=G5),[v,m,s,u,a,c,t].join(`
`)}function Sl(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var a=t.shapeInfo.texShape,s=a[0],u=a[1];if(s===1&&u===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var c=t.shapeInfo.texShape,h=c[0],d=c[1],m=Ys(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+h+", "+d+", "+m+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+gl(t)+`
      }
    `;var a=t.shapeInfo.texShape,s=a[0],u=a[1];if(u===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var c=Ys(n);return u===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+s+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+u+", index + "+c+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Pn(n,s)){var u=s[0],c=s[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+u+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var h=tu(n),d=h.newShape,m=h.keptDims,v=d;if(v.length<n.length){var y=Cl(t,v);return`
      `+Sl(y)+`
      float `+a+`(int row, int col) {
        return `+a+"("+Al(["row","col"],m)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+gl(t)+`
      }
    `;var _=s[0],E=s[1],x=Ys(i);return E===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+x+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+_+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:_===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+x+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+E+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+x+`;
    vec2 uv = uvFromFlat(`+_+", "+E+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(r);case 3:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[1]*n[2],u=n[2],c=tu(n),h=c.newShape,d=c.keptDims,m=h;if(m.length<n.length){var v=Cl(t,m);return`
        `+Sl(v)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+Al(["row","col","depth"],d)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+u+`, 1)));
        `+gl(t)+`
      }
    `;var y=t.shapeInfo.texShape,_=y[0],E=y[1],x=t.shapeInfo.flatOffset;if(E===s&&x==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+E+".0, "+_+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(E===u&&x==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+E+".0, "+_+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var T=Ys(i);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+u+" + depth + "+T+`;
        vec2 uv = uvFromFlat(`+_+", "+E+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(r);case 4:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[3],u=n[2]*s,c=n[1]*u,h=tu(n),d=h.newShape,m=h.keptDims;if(d.length<n.length){var v=Cl(t,d);return`
      `+Sl(v)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+Al(["row","col","depth","depth2"],m)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+u+", "+s+`, 1)));
        `+gl(t)+`
      }
    `;var y=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,E=_[0],x=_[1];if(x===c&&y==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===s&&y==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var T=Ys(i);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+E+", "+x+", index + "+T+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 5:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=n[4],u=n[3]*s,c=n[2]*u,h=n[1]*c,d=tu(n),m=d.newShape,v=d.keptDims;if(m.length<n.length){var y=Cl(t,m);return`
      `+Sl(y)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+Al(["row","col","depth","depth2","depth3"],v)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+c+", "+u+", "+s+`)) +
          depth3;
        `+gl(t)+`
      }
    `;var _=t.shapeInfo.flatOffset,E=t.shapeInfo.texShape,x=E[0],T=E[1];if(T===h&&_==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+u+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+T+".0, "+x+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(T===s&&_==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+T+".0, "+x+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var C=Ys(i);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+c+" + depth * "+u+` +
          depth2 * `+s+" + depth3 + "+C+`;
      vec2 uv = uvFromFlat(`+x+", "+T+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 6:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=tu(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var h=Cl(t,u);return`
      `+Sl(h)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+Al(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var d=n[5],m=n[4]*d,v=n[3]*m,y=n[2]*v,_=n[1]*y;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+_+", "+y+", "+v+", "+m+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+gl(t)+`
      }
    `;var E=t.shapeInfo.flatOffset,x=t.shapeInfo.texShape,T=x[0],C=x[1];if(C===_&&E==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+y+", "+v+", "+m+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+T+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(C===d&&E==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+T+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var A=Ys(i);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+_+" + col * "+y+" + depth * "+v+` +
          depth2 * `+m+" + depth3 * "+d+" + depth4 + "+A+`;
      vec2 uv = uvFromFlat(`+T+", "+C+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function bI(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=rr(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=rr();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(r);case 2:return function(i){var a=i.shapeInfo.logicalShape,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,h=c[0],d=c[1],m=rr();if(c!=null&&Pn(a,c))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+h+`.0);

        return `+m.texture2D+"("+s+`, uv);
      }
    `;var v=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],y=Math.ceil(a[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+y+", "+v[0]+", "+v[1]+`, row, col);
      return `+m.texture2D+"("+s+`, uv);
    }
  `}(r);case 3:return function(i){var a=i.shapeInfo.logicalShape,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(a[0]===1){var d=a.slice(1),m=Cl(i,d);return`
        `+bI(m)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+Al(["b","row","col"],[1,2])+`);
        }
      `}var v=h[0],y=h[1],_=Math.ceil(a[2]/2),E=_*Math.ceil(a[1]/2),x=rr();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+v+", "+y+", "+E+", "+_+`, b, row, col);
      return `+x.texture2D+"("+s+`, uv);
    }
  `}(r);default:return function(i){for(var a=i.shapeInfo.logicalShape,s=a.length,u=i.name,c="get"+u.charAt(0).toUpperCase()+u.slice(1),h=i.shapeInfo.texShape,d=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],m=d[0],v=d[1],y=Math.ceil(a[s-1]/2),_=y*Math.ceil(a[s-2]/2),E="int b, int row, int col",x="b * "+_+" + (row / 2) * "+y+" + (col / 2)",T=2;T<s-1;T++)E="int b"+T+", "+E,_*=a[s-T-1],x="b"+T+" * "+_+" + "+x;var C=rr();return`
    vec4 `+c+"("+E+`) {
      int index = `+x+`;
      int texR = index / `+v+`;
      int texC = index - texR * `+v+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+", "+m+`);
      return `+C.texture2D+"("+u+`, uv);
    }
  `}(r)}}var H5=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,W5=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,q5=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G5=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Ys(r){return"offset"+r}function gl(r){var e=r.name,t=Oe(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Ft(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function Cl(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Al(r,e){return e.map(function(t){return r[t]}).join(", ")}var K5=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,W(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],a=Math.ceil(i/e);this.outputShape=r.slice(0,-1),a>1&&this.outputShape.push(a),n||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,h=c.length,d=Ft(h),m=wr("coords",h);if(a===1){var v=Ft(u=h+1);s=`
        `+v+" sourceLocR = "+v+"("+m.join()+`, 0);
        ++`+m[h-1]+`;
        `+v+" sourceLocG = "+v+"("+m.join()+`, 0);
        ++`+m[h-2]+`;
        `+v+" sourceLocA = "+v+"("+m.join()+`, 0);
        --`+m[h-1]+`;
        `+v+" sourceLocB = "+v+"("+m.join()+`, 0);
        --`+m[h-2]+";"}else u=h,s=`
        `+d+` sourceLocR = coords;
        ++`+m[h-1]+`;
        `+d+` sourceLocG = coords;
        ++`+m[h-2]+`;
        `+d+` sourceLocA = coords;
        --`+m[h-1]+`;
        `+d+` sourceLocB = coords;
        --`+m[h-2]+";";var y=["x","y","z","w","u","v"].slice(0,u),_="."+y[u-1],E=y.map(function(I){return"int "+I}),x=wr("sourceLocR",u-1).concat("inIdx.r"),T=wr("sourceLocG",u-1).concat("inIdx.g"),C=wr("sourceLocB",u-1).concat("inIdx.b"),A=wr("sourceLocA",u-1).concat("inIdx.a"),R=t==="max"?"greaterThan":"lessThan",k=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+T.join()+`),
                             getBestIndicesAChannel(`+C.join()+`),
                             getBestIndicesAChannel(`+A.join()+")));",B=`vec4(
            getAChannel(`+x.join()+`),
            hasNextCol ? getAChannel(`+T.join()+`) : 0.,
            hasNextRow ? getAChannel(`+C.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+A.join()+") : 0.)",P=n?"":`
      float getBestIndicesAChannel(`+E.join()+`) {
        return getChannel(getBestIndicesA(`+y.join()+`),
                                          vec2(`+y.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+E.join()+`) {
        return getChannel(getA(`+y.join()+`),
                               vec2(`+y.slice(-2).join()+`));
      }
      `+P+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+m[h-1]+" < "+(c[h-1]-1)+`;
        bool hasNextRow = `+m[h-2]+" < "+(c[h-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+_+", sourceLocG"+_+`,
          sourceLocB`+_+", sourceLocA"+_+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+B+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+B+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+R+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},X5=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=u-1-r.padInfo.top,d=c-1-r.padInfo.left,m=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+d+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},$5=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,m=r.effectiveFilterHeight,v=r.effectiveFilterWidth,y=d-1-r.padInfo.front,_=m-1-r.padInfo.top,E=v-1-r.padInfo.left,x=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+y+", "+_+", "+E+`);
      const float avgMultiplier = float(`+x+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+m+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+v+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Y5=function(r,e,t,n,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],ut(r,e),ut(r,t);var s="0.0";n!=null&&(ut(r,n),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(ut(r,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Q5=function(r,e,t,n,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ut(r,e),ut(r,t);var s="vec4(0.0)";n!=null&&(ut(r,n),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(ut(r,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Z5="return areal * breal - aimag * bimag;",J5="return areal * bimag + aimag * breal;",kT=function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ut(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Uy="return a + b;",zy="return a - b;",OT="return a * b;",_I="return (a < 0.) ? b * a : a;",Zt=function(r,e,t){this.variableNames=["A","B"],this.outputShape=ut(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},wI=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ka=function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ut(e,t);var i=this.outputShape.length,a="";if(n)if(i===0||Oe(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+Ft(i)+` coords = getOutputCoords();
        `,i===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=wr("coords",i);a+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},ez=function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),tz=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),nz=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},rz=function(r){this.outputShape=[],this.outputShape=Ql(r,1),this.variableNames=r.map(function(u,c){return"T"+c});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var a=e.length,s=e[e.length-1];n.push("else setOutput(getT"+a+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},iz=function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ql(r,e);var t=this.outputShape,n=t.length,i=Ft(n),a=wr("coords",n),s=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(x,T){return"T"+T});var u=new Array(r.length-1);u[0]=r[0][e];for(var c=1;c<u.length;c++)u[c]=u[c-1]+r[c][e];var h=s[e],d=s.slice(-2),m=s.join(),v="if ("+h+" < "+u[0]+`) {
        return getChannel(
            getT0(`+m+"), vec2("+d.join()+`));
        }`;for(c=1;c<u.length;c++){var y=u[c-1];v+=`
        if (`+h+" < "+u[c]+"  && "+h+" >= "+u[c-1]+`) {
          return getChannel(
            getT`+c+"("+ap(s,h,y)+`),
            vec2(`+ap(d,h,y)+`));
        }`}var _=u.length,E=u[u.length-1];v+=`
        return getChannel(
          getT`+_+"("+ap(s,h,E)+`),
          vec2(`+ap(d,h,E)+"));",this.userCode=`
      float getValue(`+s.map(function(x){return"int "+x})+`) {
        `+v+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[n-1]+" = "+a[n-1]+` + 1;
        if (`+a[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[n-2]+" = "+a[n-2]+` + 1;
        if (`+a[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[n-1]+" = "+a[n-1]+` - 1;
        if (`+a[n-2]+" < "+t[n-2]+` &&
            `+a[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function ap(r,e,t){var n=r.indexOf(e);return r.map(function(i,a){return a===n?i+" - "+t:i}).join()}var az=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},oz=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dataFormat==="channelsLast",s=e-1-r.padInfo.top,u=t-1-r.padInfo.left,c=a?1:2,h=a?2:3,d=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},sz=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,a=r.padInfo.top,s=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+s+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},uz=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=e-1-r.padInfo.front,c=t-1-r.padInfo.top,h=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+c+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},lz=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},cz=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=e-1-r.padInfo.top,s=t-1-r.padInfo.left,u=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},MT=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,a=r.padInfo.left,s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,h=r.dilationWidth,d=r.filterHeight,m=r.filterWidth,v=4*Math.floor(r.inChannels/4),y=r.inChannels%4,_=r.dataFormat==="channelsLast",E=_?1:2,x=_?2:3,T=_?3:1,C="",A="";t&&(C=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,A="result = activation(result);");var R=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+s+", "+u+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+T+`];

        ivec2 xRCCorner =
            ivec2(coords[`+E+"], coords["+x+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+v+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+_+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(y===1)+`) {

              if (`+_+`) {
                dotProd +=
                    getX(batch, xR, xC, `+v+`) *
                    getW(wR, wC, `+v+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+v+`, xR, xC) *
                    getW(wR, wC, `+v+`, d2);
              }

            } else if (`+(y===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2)
              );

              if (`+_+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(y===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+v+`, d2),
                getW(wR, wC, `+v+` + 1, d2),
                getW(wR, wC, `+v+` + 2, d2)
              );

              if (`+_+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+v+`),
                  getX(batch, xR, xC, `+v+` + 1),
                  getX(batch, xR, xC, `+v+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+v+`, xR, xC),
                  getX(batch, `+v+` + 1, xR, xC),
                  getX(batch, `+v+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+R+`
        `+A+`
        setOutput(result);
      }
    `},hz=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.filterDepth,m=r.filterHeight,v=r.filterWidth,y=4*Math.floor(r.inChannels/4),_=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+a+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+m+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+v+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+y+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(_===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+y+`) *
                  getW(wF, wR, wC, `+y+`, d2);
              } else if (`+(_===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(_===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1),
                  getX(batch, xF, xR, xC, `+y+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2),
                  getW(wF, wR, wC, `+y+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},PT=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,a=r.inWidth,s=r.padInfo.top,u=r.padInfo.left,c=r.strideHeight,h=r.strideWidth,d=r.dilationHeight,m=r.dilationWidth,v=r.filterHeight,y=r.filterWidth,_=r.outChannels/r.inChannels,E="",x="";t&&(E=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,x="result = activation(result);");var T=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+E+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+_+`;
        int q = d2 - d1 * `+_+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+v+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+y+`; wC++) {
            int xC = xCCorner + wC * `+m+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+T+`
        `+x+`
        setOutput(result);
      }
    `},LT=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,a=r.inWidth,s=r.padInfo.top,u=r.padInfo.left,c=r.strideHeight,h=r.strideWidth,d=r.dilationHeight,m=r.dilationWidth,v=r.filterHeight,y=r.filterWidth,_=y,E="int xR; int xC; int xCOffset;",x=0;x<v;x++)for(var T=0;T<y;T++)E+=`
          vec4 xTexelR`+x+"C"+2*T+` = vec4(0.);
          vec4 wR`+x+"C"+T+` = vec4(0.);
          vec4 xR`+x+"C"+T+" = vec4(0.);";for(x=0;x<v;x++)for(var C=0;C<_;C++){if(E+=`
          xR = xRCorner + `+x*d+`;
          xC = xCCorner + `+(T=2*C)*m+`;
        `,h===1){if(T<y&&(E+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+x+"C"+T+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+x+"C"+T+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+x+"C"+T+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+x+"C"+T+" = vec4(previous.zw, xTexelR"+x+"C"+T+`.xy);
                } else {
                  xR`+x+"C"+T+" = vec4(0, 0, xTexelR"+x+"C"+T+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+x+"C"+T+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+x+"C"+T+` = vec4(0.);
                }

                xR`+x+"C"+T+" = xTexelR"+x+"C"+T+`;
              `,T+1<y)){var A=u%2==0?VR(m):m;m%2==0&&u%2==1||m%2!=0&&u%2!=1?(E+=`
                  xCOffset = xC + `+u%2+" + "+A+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+x+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,m>1&&(E+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+x+"C"+T+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+x+"C"+T+` = vec4(0.);
                    }
                  `),E+=`
                  xR`+x+"C"+(T+1)+` = vec4(
                    xTexelR`+x+"C"+T+".zw, xTexelR"+x+"C"+(T+2)+`.xy);
                `):E+=`
                  xCOffset = xC + `+A+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+x+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+x+"C"+(T+1)+" = xTexelR"+x+"C"+(T+2)+`;
                `}}else T<y&&(E+=`
              if(xR >= 0 && xR < `+i+`) {
            `,u%2==1?(E+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+x+"C"+T+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+x+"C"+T+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+x+"C"+(T+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+x+"C"+(T+2)+` = vec4(0.);
                }

                xR`+x+"C"+T+` = vec4(
                  xTexelR`+x+"C"+T+".zw, xTexelR"+x+"C"+(T+2)+`.zw);
              `,T+1<y&&(E+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+x+"C"+(T+1)+" = vec4(xTexelR"+x+"C"+(T+2)+`.xy, final.xy);
                `)):(E+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+x+"C"+T+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+x+"C"+T+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+x+"C"+(T+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+x+"C"+(T+2)+` = vec4(0.);
                }

                xR`+x+"C"+T+` = vec4(
                  xTexelR`+x+"C"+T+".xy, xTexelR"+x+"C"+(T+2)+`.xy);
              `,T+1<y&&(E+=`
                  xR`+x+"C"+(T+1)+` = vec4(
                    xTexelR`+x+"C"+T+".zw, xTexelR"+x+"C"+(T+2)+`.zw);
                `)),E+="}");T<y&&(E+=`
            vec4 wTexelR`+x+"C"+T+" = getW("+x+", "+T+`, d1, q);
            wR`+x+"C"+T+" = vec4(wTexelR"+x+"C"+T+".xz, wTexelR"+x+"C"+T+`.xz);
          `,T+1<y&&(E+=`
              vec4 wTexelR`+x+"C"+(T+1)+" = getW("+x+", "+(T+1)+`, d1, q);
              wR`+x+"C"+(T+1)+` =
                vec4(wTexelR`+x+"C"+(T+1)+".xz, wTexelR"+x+"C"+(T+1)+".xz);"))}for(x=0;x<v;x++)for(T=0;T<y;T++)E+="dotProd += xR"+x+"C"+T+" * wR"+x+"C"+T+";";var R="",k="";t&&(R=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,k="result = activation(result);");var B=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+R+`

      const ivec2 strides = ivec2(`+c+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+E+`

        vec4 result = dotProd;
        `+B+`
        `+k+`
        setOutput(result);
      }
    `},fz=function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=r[0],s=r[1],u=r[2],c=r[3],h=e[0],d=t[0],m=t[1];this.outputShape=[h,d,m,c];var v=n==="bilinear"?1:0,y=[s-1+".0",u-1+".0"],_=y[0],E=y[1],x=d>1?[""+(s-1)/(d-1),"(y2-y1) * height_ratio","y1*"+_+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+_],T=x[0],C=x[1],A=x[2],R=m>1?[""+(u-1)/(m-1),"(x2-x1) * width_ratio","x1*"+E+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+E],k=R[0],B=R[1],P=R[2];this.userCode=`
      const float height_ratio = float(`+T+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+C+`;
        float width_scale = `+B+`;

        float in_y = `+A+`;
        if( in_y < 0.0 || in_y > `+_+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+P+`;
        if( in_x < 0.0 || in_x > `+E+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+v+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},dz=function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ft(n)+` coords = getOutputCoords();
        int end = `+FT(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+FT(n,"coords")+` = idx;
          val += getX(`+function(s,u){if(s===1)return""+u;if(s===2)return u+".x, "+u+".y";if(s===3)return u+".x, "+u+".y, "+u+".z";if(s===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function FT(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var pz=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Jh.DENSE;var e=Fh(r),t=rr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+au(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},mz=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Jh.DENSE;var e=Fh(r),t=rr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+au(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},vz=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),gz=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},yz=function(r){this.variableNames=["A"],this.outTexUsage=zr.DOWNLOAD;var e=rr();this.outputShape=r,this.userCode=`
      `+yI+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},bz=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=zr.DOWNLOAD;var e=rr();this.outputShape=r,this.userCode=`
      `+yI+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},_z=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=rr(),i=e[0],a=e[1];this.outputShape=r;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+__(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},wz=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=rr(),i=e[0],a=e[1];this.outputShape=r;var s="",u="result";t&&(u="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var h=0;h<=1;h++){var d=2*c+h;s+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+r[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+c+" < "+r[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+__(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+n.output+" = "+u+`;
      }
    `},xz="return real * expR - imag * expI;",Ez="return real * expI + imag * expR;",BT=function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Tz=function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r}(),Sz=function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=Ft(this.rank),a=function(s,u){var c=s.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],m=0;m<s.length;m++)m===u?d.push("int(getIndices("+h[m]+"))"):d.push(""+h[m]);return d.join()}(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},Cz=function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=Ft(e.length),i=Ft(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Az(r,e){var t=rr();return x6(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Rz(r,e){return A6(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Iz(r,e){return R6(r,e,new Uint16Array([0,1,2,2,1,3]))}function bf(r,e,t,n,i,a,s){D6(t,n);var u=I6(r,e),c=r.TEXTURE_2D;return Me(r,e,function(){return r.bindTexture(c,u)}),Me(r,e,function(){return r.texParameteri(c,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Me(r,e,function(){return r.texParameteri(c,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Me(r,e,function(){return r.texParameteri(c,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Me(r,e,function(){return r.texParameteri(c,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Me(r,e,function(){return r.texImage2D(c,0,i,t,n,0,a,s,null)}),Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),u}function Dz(r,e,t,n,i){var a=$m(t,n);return bf(r,e,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function Nz(r,e,t,n,i){var a=$m(t,n);return bf(r,e,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function kz(r,e,t,n,i){var a=$m(t,n);return bf(r,e,a[0],a[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function Oz(r,e,t,n,i){var a=yf(t,n);return bf(r,e,a[0],a[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function Mz(r,e,t,n,i){var a=yf(t,n);return bf(r,e,a[0],a[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function Pz(r,e,t,n){return Me(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),ST(r,e,t,"clipSpacePos",n,3,20,0)&&ST(r,e,t,"uv",n,2,20,12)}function Lz(r,e,t,n,i,a,s){var u,c,h;Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),a instanceof Uint8Array?(u=new Uint8Array(n*i*4),c=r.UNSIGNED_BYTE,h=r.RGBA):(u=new Float32Array(n*i*4),c=r.FLOAT,h=s.internalFormatPackedFloat),u.set(a),Me(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,h,n,i,0,r.RGBA,c,u)}),Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Fz(r,e,t,n){Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?Me(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):Me(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Me(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Bz(r,e,t,n,i){var a=r.createBuffer();Me(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var s=16*t*n;return Me(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),Me(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),Me(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function Vz(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function Uz(r,e,t,n,i){var a=$m(t,n),s=a[0],u=a[1],c=new Uint8Array(t*n*4);return Me(r,e,function(){return r.readPixels(0,0,s,u,i.downloadTextureFormat,r.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function zz(r,e,t,n,i,a,s,u){var c=r,h=new Float32Array(function(d,m){var v=yf(d,m);return v[0]*v[1]*4}(a,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,h),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),h}function jz(r,e,t,n){var i=new Float32Array(t*n*4);return Me(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)}),i}var Hz=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=me().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,g6(t,e)):this.gl=va(t);var n="WEBGL_color_buffer_float";if(me().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=tp(this.gl,this.debug,"OES_texture_float"),ui(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=tp(this.gl,this.debug,"OES_texture_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ui(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=tp(this.gl,this.debug,"EXT_color_buffer_half_float");else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ui(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ui(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Rz(this.gl,this.debug),this.indexBuffer=Iz(this.gl,this.debug),this.framebuffer=N6(this.gl,this.debug),this.textureConfig=c_(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return me().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Me(t,this.debug,function(){return t.finish()}),Me(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Me(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Me(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Me(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Me(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Dz(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Nz(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),kz(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Fz(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),Lz(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Mz(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Oz(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(CT(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Me(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return Uz(i.gl,i.debug,t,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,a,s){return zz(this.gl,e,0,0,0,a,s,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Vz(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=Bz(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(me().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,s=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var u=a.clientWaitSync(s,0,0);return u===a.ALREADY_SIGNALED||u===a.CONDITION_SATISFIED},t=s}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return jz(i.gl,i.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=E6(t,this.debug,e),i=Az(t,this.debug),a=S6(t,this.debug);return Me(t,this.debug,function(){return t.attachShader(a,i)}),Me(t,this.debug,function(){return t.attachShader(a,n)}),C6(t,this.debug,a),this.debug&&Ly(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=Pz(t,this.debug,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Me(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ly(this.gl,this.debug,this.program),Me(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?O6(this.gl,this.debug,e,t):M6(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Me(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),P6(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=yf(t,n),a=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,a,s)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Ly(this.gl,this.debug,this.program),np(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Me(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Me(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=tp(this.gl,this.debug,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),a=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,a),a},r.prototype.endQuery=function(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return De(this,void 0,void 0,function(){var t=this;return Ne(this,function(n){switch(n.label){case 0:return[4,bT(function(){return t.disposed||t.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=function(n){for(var i=0;i<n.length&&n[i]();++i);return i-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||bT(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Fy(this.gl,this.debug,e,this.framebuffer),this.debug&&np(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Fy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&np(this.gl)):CT(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;Fy(i,this.debug,e,this.framebuffer),this.debug&&np(i),this.outputTexture=e,Me(i,this.debug,function(){return i.viewport(0,0,t,n)}),Me(i,this.debug,function(){return i.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var a=this;this.throwIfDisposed(),Me(this.gl,this.debug,function(){return a.gl.scissor(e,t,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function VT(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var i=t.logicalShape,a=e[n],s=a.shape;if(!Pn(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!a.isUniform){var u=t.texShape,c=a.isUniform?null:a.texData.texShape;if(!Pn(u,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+c+" must match")}})}var Wz=function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,i=t.inChannels,a=t.strideWidth,s=t.strideHeight,u=t.padInfo,c=t.outWidth,h=t.dilationWidth,d=t.dilationHeight,m=t.dataFormat,v=u.left,y=u.top,_=i*n,E=rr(),x=m==="channelsLast",T=x?0:1,C=x?1:2,A="",R=0;R<=1;R++)for(var k=0;k<=1;k++)A+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+R+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+s+" - "+y+`;
            d0 = offsetY + `+d+" * (pos / "+_+`);

            if(d0 < `+e[T]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+a+". - "+v+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+_+".) / "+i+`.));

              if(d1 < `+e[C]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+x+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*R+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*R+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+A+`

        `+E.output+` = result;
      }
    `},qz=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var a,s=e,u=r[3]-1;this.outputShape=r;var c="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},Gz=function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Kz=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,s=e,u=r[3]-1;this.outputShape=r;var c="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},Xz=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,a=r.effectiveFilterWidth,s=i-1-r.padInfo.top,u=a-1-r.padInfo.left,c=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},$z=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterDepth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=u-1-r.padInfo.front,m=c-1-r.padInfo.top,v=h-1-r.padInfo.left,y=u*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+m+", "+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+y+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},jy=function(r,e,t,n,i,a,s){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),a===void 0&&(a=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=t?r[1]:r[2],c=Math.ceil(u/2),h=t?"i * 2, rc.y":"rc.y, i * 2",d=n?"rc.z, i * 2":"i * 2, rc.z",m=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],y="",_="";a&&(y=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,_="result = activation(result);");var E=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+m[0]+" * "+v[0]+`);
          result += (`+m[1]+" * "+v[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+E+`

        `+_+`

        setOutput(result);
      }
    `},Yz=function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r}(),Qz=function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},Zz=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=wr("rc",e),n=Ft(e),i=function(u,c,h){if(u===1)return"rc > "+c[0];for(var d="",m=u-2;m<u;m++)d+=h[m]+" >= "+c[m],m<u-1&&(d+="||");return d}(e,r,t),a=function(u,c,h,d){if(u===1)return"";var m=d.slice(-2);return`
    int r = `+m[0]+`;
    int c = `+m[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+h+`;
  `}(e,r[r.length-1],r[r.length-2],t),s=function(u,c){var h=u.length,d=function(m,v){for(var y=[],_=0;_<=1;_++)for(var E=0;E<=1;E++){for(var x=(_===0?"r":"rp1")+", "+(E===0?"c":"cp1"),T=2;T<m;T++)x=v[v.length-1-T]+","+x;y.push(x)}return y}(h,c);return h===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"}(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},Jz=function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(c,h){return c[0]+r[h]+c[1]});var n=r.length,i=Ft(n),a=e.map(function(c){return c[0]}).join(","),s=e.map(function(c,h){return c[0]+r[h]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+a+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},ej=function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(x,T){return x[0]+r[T]+x[1]});for(var n=r.length,i=Ft(n),a=e.map(function(x){return x[0]}).join(","),s=e.map(function(x,T){return x[0]+r[T]}).join(","),u=wr("rc",n),c=wr("source",n),h=u[n-1]+" < "+this.outputShape[n-1],d=n===1?"source":"vec2("+c.slice(-2).join()+")",m=[i+" rc = outputLoc;",u[n-1]+` += 1;
       if(`+h+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+u[n-2]+` += 1;
       if(`+u[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+u[n-1]+` += 1;
         if(`+h+") {"],v=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",y="",_=0,E=n===1?2:4;_<E;_++)y+=`
        `+m[_]+`
        if (`+v+`) {
          result[`+_+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+_+"] = getChannel(getX("+c.join()+"), "+d+`);
        }
      `;y+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+a+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+y+`
        setOutput(result);
      }
    `},Hy=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var v=e==="avg",y="0.0";if(v||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+a+`);
        const ivec2 pads = ivec2(`+d+", "+m+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(_="avgValue / count");var E=4*Math.floor(n/4),x=n%4,T=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+d+", "+m+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+T+`
          }

          int xC = xCCorner + `+E+`;
          if (`+(x===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(x===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(x===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+T+`
          }
        }
        setOutput(`+_+`);
      }
    `}},Wy=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,m=r.effectiveFilterHeight,v=r.effectiveFilterWidth,y=r.padInfo.front,_=r.padInfo.top,E=r.padInfo.left;this.outputShape=r.outShape;var x=e==="avg",T="0.0";if(x||(T="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+a+", "+s+`);
        const ivec3 pads = ivec3(`+y+", "+_+", "+E+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+u+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+m+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+v+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+m+" * "+v+` +
                      wR * `+v+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var C=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(C="avgValue / count");var A=4*Math.floor(n/4),R=n%4,k=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+a+", "+s+`);
      const ivec3 pads = ivec3(`+y+", "+_+", "+E+`);
      const float initializationValue = `+T+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+T+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+u+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+m+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+A+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+k+`
            }

            int xC = xCCorner + `+A+`;
            if (`+(R===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(R===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(R===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+k+`
            }
          }
          setOutput(`+C+`);
        }
      }
    `}},tj=function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=Math.ceil(i/t);this.outputShape=[n,a];var s="0.0",u="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",u="min"):e==="max"&&(s="-1.0 / 1e-20",u="max");var c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");var h=4*Math.floor(t/4),d=t%4,m=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,v="vec4";e==="all"?(s="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):e==="any"&&(s="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");var y="";i%t>0&&(y=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+y+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+m+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(d===1)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+m+`
        } else if (`+(d===2)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+m+`
        } else if (`+(d===3)+`) {
          `+v+" values = "+v+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+m+`
        }
        setOutput(`+c+`);
      }
    `},nj=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+au(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+__(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},rj=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],s=r.shape,u=s[1],c=s[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],m=h[0]/d[0],v=h[1]/d[1],y=1/m,_=1/v,E=2*Math.ceil(y)+2,x=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+m+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+E+`);
        const int winWidth = int(`+x+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},ij=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],s=r[2],u=r[3];this.outputShape=[i,e,t,u];var c=[n&&e>1?a-1:a,n&&t>1?s-1:s],h=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},aj=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],a=r[1],s=r[2],u=r[3];this.outputShape=[i,e,t,u];var c=[n&&e>1?a-1:a,n&&t>1?s-1:s],h=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`,
          `+c[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},oj=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],s=r.shape,u=s[1],c=s[2],h=[t&&u>1?i-1:i,t&&c>1?a-1:a],d=[t&&u>1?u-1:u,t&&c>1?c-1:c],m=h[0]/d[0],v=h[1]/d[1],y=1/m,_=1/v,E=2*Math.ceil(y)+2,x=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+m+`);
        const float widthScale = float(`+v+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+E+`);
        const int winWidth = int(`+x+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},sj=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],s=r[2],u=r[3];this.outputShape=[i,e,t,u];var c=[n&&e>1?a-1:a,n&&t>1?s-1:s],h=[n&&e>1?e-1:e,n&&t>1?t-1:t],d=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/h[0]+`,
          `+c[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},uj=function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(a,s){return function(u){return e.indexOf(u)!==-1&&r[u]!==1?r[u]+" - coords["+u+"] - 1":"coords["+u+"]"}(s)}).join(","),i=Ft(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},lj=function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=wr("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],a=n[t-2]+" + 1 < "+this.outputShape[t-2],s=Ft(t);function u(c){var h=r.map(function(d,m){return function(v,y){return e.indexOf(v)!==-1&&r[v]!==1?r[v]+" - "+y[v]+" - 1":""+y[v]}(m,c)});return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(c){return u(c)}(n.slice())+`;
          if(`+i+`){
            result.g = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",u(c)}(n.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(c){return c[t-2]="("+c[t-2]+" + 1)",u(c)}(n.slice())+`;
            if(`+i+`) {
              result.a = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",u(c)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},UT=function(r,e,t,n,i,a,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var u=Ft(i.length),c=Ft(a.length),h="";t===1?h="i":t===2&&(h="i, j");var d="getIndices("+h+")",m="";n===1?m="i":n===2&&(m="i, coords[1]");var v="getUpdates("+m+")",y=e>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+y+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+v+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},cj=function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=r.numSegments,s=a*Math.ceil(i/t);this.outputShape=[n,s];var u=4*Math.floor(t/4),c=t%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var m="";i%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+m+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},hj=function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<e.length;c++)u.push(""+a[c]),c<r&&s.push(""+a[c]);n=s.join(),i=u.join()}var h=Ft(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},fj=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Ft(this.rank),i="uniform int start["+this.rank+"];",a=function(s){if(s===1)return"sourceLoc";if(s<=6)return qy.slice(0,s).map(function(u){return"sourceLoc."+u}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(s,u){return"sourceLoc."+qy[u]+" = start["+u+"] + coords."+qy[u]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),qy=["x","y","z","w","u","v"],dj=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Ft(this.rank),n=wr("coords",this.rank),i=wr("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+a+")",u=`
      result.x = `+s+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(d,m){return"start["+m+"]"}).join()+");":e.map(function(d,m){return i[m]+" = "+n[m]+" + start["+m+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+u+`
        `+c+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),pj=function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,i=Ft(t.length),a=Ft(t.length),s="";if(n===1)s="coords * strides + begin";else{var u=0;s=t.map(function(c,h){return u++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(u-1)+"] * strides["+h+"] + begin["+h+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},mj=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,a=zT(t,n),s=jT(e,a,n);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[s].shift();return this.usedTextures[s].push(u),u}return this.numUsedTextures++,this.log(),a===Br.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Br.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Br.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Br.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Br.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var a=jT(t,zT(n,i),i);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[a],u=s.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(u,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function zT(r,e){if(r===zr.UPLOAD)return Br.PACKED_2X2_FLOAT32;if(r===zr.RENDER||r==null)return function(t){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Br.PACKED_2X2_FLOAT32:Br.UNPACKED_FLOAT32:t?Br.PACKED_2X2_FLOAT16:Br.UNPACKED_FLOAT16}(e);if(r===zr.DOWNLOAD||r===zr.PIXELS)return Br.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function jT(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var vj=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=Ft(this.rank),a=function(s){var u=s.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+s[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],d=0;d<s.length;d++)h.push("imod("+c[d]+", "+s[d]+")");return h.join()}(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},gj=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=Ft(this.rank),a=function(s){var u=s.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(u),d=0;d<s.length;d++)h[s[d]]=c[d];return h.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},yj=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Ft(this.rank),a=gI("rc",this.rank),s=new Array(this.rank);for(n=0;n<e.length;n++)s[e[n]]=a[n];var u="vec2("+s.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+s.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+c+`) {
        result[1] = `+h+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+c+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `},w_=1.7580993408473768,x_=1.0507009873554805,et=function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ki="if (isnan(x)) return x;",bj="return x;",HT="return abs(x);",xI=ki+`
  return (x < 0.0) ? 0.0 : x;
`,EI=ki+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,TI="return (x >= 0.0) ? x : (exp(x) - 1.0);",_j=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+w_+`;
  float scale = `+x_+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,WT="return -x;",qT="return ceil(x);",GT="return floor(x);",KT="return exp(x);",XT="return exp(x) - 1.0;",wj=ki+`
  return sin(x);
`,xj=ki+`
  return cos(x);
`,Ej=ki+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Tj=ki+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Sj=ki+`
  return atan(x);
`,Cj=ki+"return log(x + sqrt(x * x + 1.0));",Aj=ki+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,Rj=ki+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,op="return x;",Ij="return x;",SI=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CI=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,AI=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Th=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Dj=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=wr("rc",e),n=Ft(e),i=function(u,c){if(u===1)return"rc";for(var h="",d=0;d<u;d++)h+=c[d],d<u-1&&(h+=",");return h}(e,t),a=t.slice(-2),s=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},sp={};function up(r,e){if(e===void 0&&(e=!1),r==="linear")return e?Ij:bj;if(r==="relu")return e?SI:xI;if(r==="elu")return e?AI:TI;if(r==="relu6")return e?CI:EI;if(r==="prelu")return e?wI:_I;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var Nj=600,kj=function(r){function e(t){var n,i=r.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=va(me().getNumber("WEBGL_VERSION"));i.binaryCache=((n=me().getNumber("WEBGL_VERSION"))in sp||(sp[n]={}),sp[n]),i.gpgpu=new Hz(a),i.canvas=a.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new mj(i.gpgpu),i.numMBBeforeWarning=me().global.screen==null?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*Nj/1024/1024,i.texData=new uI(i,$),i}return Ni(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,n,i){if(me().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:n,dtype:i,values:t,usage:zr.UPLOAD}),a},e.prototype.move=function(t,n,i,a){if(me().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:a,values:n,usage:zr.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),i=n.values,a=n.dtype,s=n.complexTensors,u=n.slice,c=n.shape,h=n.isPacked;if(u!=null){var d=void 0;d=h?new Th(c,op):new et(c,op);var m=this.runWebGLProgram(d,[{dataId:t,shape:c,dtype:a}],a),v=this.readSync(m.dataId);return this.disposeData(m.dataId),v}if(i!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return i;var y,_,E=this.activeTimers!=null;return E&&(y=Zi()),a==="complex64"?_=q0(s.real.dataSync(),s.imag.dataSync()):_=this.getValuesFromTexture(t),E&&(this.downloadWaitMs+=Zi()-y),this.convertAndCacheOnCPU(t,_)},e.prototype.read=function(t){return De(this,void 0,void 0,function(){var n,i,a,s,u,c,h,d,m,v,y,_,E,x,T,C,A,R,k,B,P,I;return Ne(this,function(D){switch(D.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(O){return n.push(O)})];if(i=this.texData.get(t),a=i.values,s=i.shape,u=i.slice,c=i.dtype,h=i.complexTensors,d=i.isPacked,u!=null)return m=void 0,m=d?new Th(s,op):new et(s,op),v=this.runWebGLProgram(m,[{dataId:t,shape:s,dtype:c}],c),y=this.read(v.dataId),this.disposeData(v.dataId),[2,y];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&me().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return _=null,c!=="complex64"&&me().get("WEBGL_BUFFER_SUPPORTED")&&(E=this.decode(t),x=this.texData.get(E.dataId),_=(I=this.gpgpu).createBufferFromTexture.apply(I,[x.texture].concat(Fh(s)))),this.pendingRead.set(t,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:D.sent(),D.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return C=D.sent(),A=C[0],R=C[1],T=q0(A,R),[3,5];case 4:_==null?T=this.getValuesFromTexture(t):(k=Oe(s),T=this.gpgpu.downloadFloat32MatrixFromBuffer(_,k)),D.label=5;case 5:return E!=null&&this.disposeData(E.dataId),B=this.convertAndCacheOnCPU(t,T),P=this.pendingRead.get(t),this.pendingRead.delete(t),P.forEach(function(O){return O(B)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,B]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var i=t[n];if(!_6(i))throw me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,i=this.texData.get(t),a=i.shape,s=i.dtype,u=i.isPacked,c=Oe(a);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),d=this.texData.get(h.dataId),m=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[d.texture].concat(Fh(a))).subarray(0,c);return this.disposeData(h.dataId),m}var v=me().getBool("WEBGL_PACK")&&u===!0,y=v?By(a):a,_=v?new bz(y):new yz(y),E=this.runWebGLProgram(_,[{shape:y,dtype:s,dataId:t}],"float32"),x=this.texData.get(E.dataId),T=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(x.texture,x.texShape[0],x.texShape[1]).subarray(0,c);return this.disposeData(E.dataId),T},e.prototype.time=function(t){return De(this,void 0,void 0,function(){var n,i,a,s,u,c,h;return Ne(this,function(d){switch(d.label){case 0:return n=this.activeTimers,i=[],a=!1,this.programTimersStack==null?(this.programTimersStack=i,a=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=$l(this.activeTimers.map(function(m){return m.query})).filter(function(m){return m!=null}),u=$l(this.activeTimers.map(function(m){return m.name})).filter(function(m){return m!=null}),this.activeTimers=n,a&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return h=d.sent(),c.kernelMs=e6(h),c.getExtraProfileInfo=function(){return h.map(function(m,v){return{name:u[v],ms:m}}).map(function(m){return m.name+": "+m.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zi(),endMs:null}},e.prototype.endTimer=function(t){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Zi(),t)},e.prototype.getQueryTime=function(t){return De(this,void 0,void 0,function(){var n;return Ne(this,function(i){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),i=n.texture,a=n.dtype,s=n.texShape,u=n.usage,c=n.isPacked,h=n.slice,d=h&&h.origDataId||t,m=this.dataRefCount.get(d);m>1?this.dataRefCount.set(d,m-1):(this.dataRefCount.delete(d),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,a),this.textureManager.releaseTexture(i,s,u,c)));var v=this.texData.get(t);v.texture=null,v.texShape=null,v.isPacked=!1,v.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return me().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=$.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every(function(a){return i.texData.get(a.dataId).texture==null&&a.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:$.keep(t.clone()),imag:$.keep(n.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,i);if(Oe(i)===0)return Gn([],i,t.dtype);var a=this.texData.get(t.dataId).isPacked,s=oI(t.shape,n,i);if(a||!s){var u=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dj(i):new fj(i),c=u.getCustomSetupFunc(n);return this.compileAndRun(u,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,i)},e.prototype.shallowSlice=function(t,n,i){var a=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),u=this.texData.get(s.dataId);Object.assign(u,a),u.shape=i,u.dtype=t.dtype;var c=sI(n,t.strides);a.slice&&(c+=a.slice.flatOffset),u.slice={flatOffset:c,origDataId:a.slice&&a.slice.origDataId||t.dataId};var h=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,h+1),s},e.prototype.stridedSlice=function(t,n,i,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,i,a);var s=m_(n,i,a);if(s.some(function(c){return c===0}))return Gn([],s);var u=new pj(n,a,s);return this.compileAndRun(u,[t])},e.prototype.reverse=function(t,n){var i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lj(t.shape,n):new uj(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var i=t.map(function(y){return si(y)}),a=t.map(function(y){return ta(y)});return Hn(this.concat(i,n),this.concat(a,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),u=this.concat(t.slice(0,s),n),c=this.concat(t.slice(s),n);return this.concat([u,c],n)}if(me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new iz(t.map(function(y){return y.shape}),n);return this.compileAndRun(h,t)}var d=Ql(t.map(function(y){return y.shape}),n),m=t.map(function(y){return y.as2D(-1,Oe(y.shape.slice(n)))}),v=new rz(m.map(function(y){return y.shape}));return this.compileAndRun(v,m).reshape(d)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WT,t.dtype);var n=new et(t.shape,WT);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,i,a){var s=i?t.shape[2]:t.shape[1],u=a?n.shape[1]:n.shape[2],c=i?t.shape[1]:t.shape[2],h=t.shape[0];if((s===1||u===1)&&c>1e3){i&&(t=t.transpose([0,2,1])),a&&(n=n.transpose([0,2,1]));var d=u===1?t:t.as3D(h,c,1),m=u===1?2:1,v=u===1?n.as3D(h,1,c):n;return this.multiply(d,v).sum(m,!0)}var y=qn(t.dtype,n.dtype),_=new jy(t.shape,[h,s,u],i,a);return this.compileAndRun(_,[t,n],y)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,s=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=a?n.shape[2]:n.shape[1],m=s?i.shape[1]:i.shape[2],v=n.shape[0],y=qn(n.dtype,i.dtype),_=u!=null,E=h!=null,x=c?up(c,!0):null,T=new jy(n.shape,[v,d,m],a,s,_,x,E),C=[n,i];return u&&C.push(u),h&&C.push(h),this.compileAndRun(T,C,y)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),a=this.texData.get(n.dataId),s=new kT(Z5,t.shape,n.shape),u=new kT(J5,t.shape,n.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],h=this.compileAndRun(s,c),d=this.compileAndRun(u,c),m=this.complex(h,d);return h.dispose(),d.dispose(),m}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,OT,t.dtype);var v=new Zt(OT,t.shape,n.shape);return this.compileAndRun(v,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,i,a,s,u){var c=[t,n,i],h=null;u!=null&&(h=u.shape,c.push(u));var d=null;if(s!=null&&(d=s.shape,c.push(s)),me().getBool("WEBGL_PACK_NORMALIZATION")){var m=new Q5(t.shape,n.shape,i.shape,h,d,a);return this.compileAndRun(m,c)}var v=new Y5(t.shape,n.shape,i.shape,h,d,a);return this.compileAndRun(v,c)},e.prototype.localResponseNormalization4D=function(t,n,i,a,s){var u=me().getBool("WEBGL_PACK_NORMALIZATION")?new Kz(t.shape,n,i,a,s):new qz(t.shape,n,i,a,s);return this.compileAndRun(u,[t])},e.prototype.LRNGrad=function(t,n,i,a,s,u,c){var h=new Gz(n.shape,a,s,u,c);return this.compileAndRun(h,[n,i,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(s){return tm(s)});return mI(Qe(t.shape,t.dtype,i),n)}var a=new vj(t.shape,n);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,n,i){var a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ej(t.shape,n,i):new Jz(t.shape,n,i);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,n);var i=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yj(t.shape,n):new gj(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,n,i){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,i);var a=new Sz(t.shape,n.size,i);return this.compileAndRun(a,[t,n])},e.prototype.batchToSpaceND=function(t,n,i){W(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(m,v){return m*v}),s=sm(t.shape,n,a),u=um(s.length,n.length),c=lm(t.shape,n,a),h=nI(i,n.length),d=rI(c,i,n.length);return t.reshape(s).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,n,i){W(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(v,y){return v*y}),s=[[0,0]];s.push.apply(s,i);for(var u=1+n.length;u<t.shape.length;++u)s.push([0,0]);var c=t.pad(s),h=sm(c.shape,n,a,!1),d=um(h.length,n.length,!1),m=lm(c.shape,n,a,!1);return c.reshape(h).transpose(d).reshape(m)},e.prototype.reduce=function(t,n,i){var a=t.shape[0],s=t.shape[1],u=Vy(s),c=new tj({windowSize:u,inSize:s,batchSize:a},n),h=this.compileAndRun(c,[t],i);return h.shape[1]===1?h:this.reduce(h,n,i)},e.prototype.argReduce=function(t,n,i){i===void 0&&(i=null);var a=t.shape[0],s=t.shape[1];i!=null&&(a=i.shape[0],s=i.shape[1]);var u=Vy(s),c=new z5({windowSize:u,inSize:s,batchSize:a},n,i==null),h=[t];i!=null&&h.push(i);var d=this.compileAndRun(c,h,"int32");return d.shape[1]===1?d:this.argReduce(t,n,d)},e.prototype.argReducePacked=function(t,n,i){i===void 0&&(i=null);var a=i!=null?i.shape:t.shape,s=Vy(a[a.length-1]),u=new K5(a,s,n,i==null),c=i==null?[t]:[t,i],h=this.compileAndRun(u,c,"int32");return h.rank===t.rank?this.argReducePacked(t,n,h):h},e.prototype.sum=function(t,n){Fr("sum",n,t.rank);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s),c=Ny(t.dtype);return this.reduce(u,"sum",c).reshape(a)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s),c=Ny(t.dtype);return this.reduce(u,"prod",c).reshape(a)},e.prototype.unsortedSegmentSum=function(t,n,i){var a=0,s=ga([a],t.rank),u=t;s!=null&&(u=t.transpose(s),a=ya(1,t.rank)[0]);var c=function(y,_,E){for(var x=[],T=y.length,C=0;C<T;C++)C!==_?x.push(y[C]):x.push(E);return x}(u.shape,a,i),h=Oe([u.shape[a]]),d=u.as2D(-1,h),m=Ny(t.dtype),v=this.segOpCompute(d,"unsortedSegmentSum",n,m,i).reshape(c);return s!=null&&(v=v.transpose(h_(s))),v},e.prototype.segOpCompute=function(t,n,i,a,s){var u=t.shape[0],c=t.shape[1],h=function(v,y){var _,E=!1;for(v<=aI?(_=v,E=!0):_=L0(v,Math.floor(Math.sqrt(v)));!E;)_>y||_===v?E=!0:_=L0(v,_+1);return _}(c,s),d=new cj({windowSize:h,inSize:c,batchSize:u,numSegments:s}),m=this.compileAndRun(d,[t,i],a);return m.shape[1]===s?m:(i=om(0,s).tile([c/h]),this.segOpCompute(m,n,i,a,s))},e.prototype.argMinMaxReduce=function(t,n,i){var a=[n];if(Fr("arg"+i.charAt(0).toUpperCase()+i.slice(1),a,t.rank),!me().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=er(t.shape,a),u=s[0],c=Oe(s[1]),h=t.as2D(-1,c);return this.argReduce(h,i).reshape(u)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,i,a){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var s=new dz(t.shape,i,a);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var i=new Zt("return float(a == b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new Zt("return float(a != b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new Zt("return float(a < b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new Zt("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new Zt("return float(a > b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new Zt("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new et(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new Zt("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new Zt("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.select=function(t,n,i){var a=new hj(t.rank,n.shape,n.rank);return this.compileAndRun(a,[t,n,i],qn(n.dtype,i.dtype))},e.prototype.where=function(t){im("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return b_(t.shape,n)},e.prototype.topk=function(t,n,i){return vI(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Fr("min",n,t.rank);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s);return this.reduce(u,"min",u.dtype).reshape(a)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new Zt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.mod=function(t,n){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new Zt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);Fr("max",n,t.rank);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s);return this.reduce(u,"max",u.dtype).reshape(a)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new Zt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.all=function(t,n){Fr("all",n,t.rank);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s);return this.reduce(u,"all",u.dtype).reshape(a)},e.prototype.any=function(t,n){Fr("any",n,t.rank);var i=er(t.shape,n),a=i[0],s=Oe(i[1]),u=t.as2D(-1,s);return this.reduce(u,"any",u.dtype).reshape(a)},e.prototype.realDivide=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new Zt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"float32")},e.prototype.floorDiv=function(t,n){if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new Zt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,Uy);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var i=qn(t.dtype,n.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Uy,i);var a=new Zt(Uy,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.packedUnaryOp=function(t,n,i){var a=new Th(t.shape,n);return this.compileAndRun(a,[t],i)},e.prototype.packedBinaryOp=function(t,n,i,a,s){s===void 0&&(s=!1);var u=new Ka(i,t.shape,n.shape,s);return this.compileAndRun(u,[t,n],a)},e.prototype.complexSeparableBinaryOp=function(t,n,i){var a=this,s=this.texData.get(t.dataId),u=this.texData.get(n.dataId),c=[[s.complexTensors.real,u.complexTensors.real],[s.complexTensors.imag,u.complexTensors.imag]].map(function(v){var y=v[0],_=v[1],E=a.makeComplexComponentTensorInfo(t,y),x=a.makeComplexComponentTensorInfo(n,_),T=new Zt(i,t.shape,n.shape);return a.compileAndRun(T,[E,x],qn(y.dtype,_.dtype))}),h=c[0],d=c[1],m=this.complex(h,d);return h.dispose(),d.dispose(),m},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>me().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),i=this.addN(t.slice(0,n)),a=this.addN(t.slice(n));return this.addN([i,a])}var s=t.map(function(h){return h.dtype}).reduce(function(h,d){return qn(h,d)}),u=t.map(function(h){return h.shape}),c=me().getBool("WEBGL_PACK")?new U5(t[0].shape,u):new V5(t[0].shape,u);return this.compileAndRun(c,t,s)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,zy);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var i=qn(t.dtype,n.dtype);if(me().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,zy,t.dtype);var a=new Zt(zy,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.pow=function(t,n){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new Zt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),a=qn(t.dtype,n.dtype);return this.compileAndRun(i,[t,n],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,qT,t.dtype);var n=new et(t.shape,qT);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GT,t.dtype);var n=new et(t.shape,GT);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new et(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new et(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new et(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new et(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new et(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,KT,t.dtype);var n=new et(t.shape,KT);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XT,t.dtype);var n=new et(t.shape,XT);return this.compileAndRun(n,[t])},e.prototype.softmax=function(t,n){var i=An([n],t.shape),a=this.max(t,i),s=Cr(a.shape,i),u=this.subtract(t,a.reshape(s)),c=this.exp(u),h=this.sum(c,i).reshape(s);return this.realDivide(c,h)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new et(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new et(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new et(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new et(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new et(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=me().getBool("WEBGL_PACK")?new Th(t.shape,SI):new et(t.shape,xI),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=me().getBool("WEBGL_PACK")?new Th(t.shape,CI):new et(t.shape,EI),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(wI,t.shape,n.shape):new Zt(_I,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.elu=function(t){if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,AI,t.dtype);var n=new et(t.shape,TI);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new Zt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.selu=function(t){var n=new et(t.shape,_j);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new et(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,i){var a,s=(a=me().getBool("WEBGL_PACK_CLIP")?new tz(t.shape):new ez(t.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(a,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HT,t.dtype);var n=new et(t.shape,HT);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),i=new nz(t.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(i,a)},e.prototype.sigmoid=function(t){var n=new et(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new et(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new et(t.shape,wj);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new et(t.shape,xj);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new et(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new et(t.shape,Ej);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new et(t.shape,Tj);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new et(t.shape,Sj);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new Zt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.sinh=function(t){var n=new et(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new et(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new et(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new et(t.shape,Cj);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new et(t.shape,Aj);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new et(t.shape,Rj);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new et(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var i=new et(t.shape,function(a){return a===void 0&&(a=0),ki+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(n));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,n,i,a,s,u){var c=t.shape,h=this.texData.get(t.dataId),d=i.inChannels,m=c[0]*c[1]*c[2],v=i.outChannels,y=i.dataFormat==="channelsLast",_=(m===1||v===1)&&d>1e3,E=c[2]%2!=0&&!!h.isPacked;if(_||!me().getBool("WEBGL_LAZILY_UNPACK")||!me().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!E){var x=y?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],T=this.reshape(t,[1,x,i.inChannels]),C=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:T,b:C,transposeA:!1,transposeB:!1,bias:a,activation:s,preluActivationWeights:u}),i.outShape)}var A=y?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),R={dataId:t.dataId,shape:[1,A,i.inChannels],dtype:t.dtype},k=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,W(ip(h.shape,R.shape),function(){return"packed reshape "+h.shape+" to "+R.shape+" isn't free"});var B=this.reshape(n,[1,i.inChannels,i.outChannels]),P=this.fusedBatchMatMul({a:R,b:B,transposeA:!1,transposeB:!1,bias:a,activation:s,preluActivationWeights:u}),I=this.texData.get(P.dataId);return W(I.isPacked,function(){return"batchMatMul result is expected to be packed"}),h.shape=k,I.shape=i.outShape,$.makeTensorFromDataId(P.dataId,i.outShape,P.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,i,a,s,u){var c=i.filterWidth,h=i.filterHeight,d=i.inChannels,m=i.outWidth,v=i.outHeight,y=i.dataFormat==="channelsLast",_=c*h*d,E=v*m,x=[_,E],T=t.squeeze([0]),C=n.reshape([1,_,-1]),A=new Wz(x,T.shape,i),R=this.compileAndRun(A,[T]).reshape([1,x[0],x[1]]),k=a!=null,B=u!=null,P=s?up(s,!0):null,I=new jy(R.shape,[1,E,i.outChannels],!0,!1,k,P,B),D=[R,C];a&&D.push(a),B&&D.push(u);var O=this.compileAndRun(I,D);return y?O.reshape([1,v,m,i.outChannels]):O.reshape([1,i.outChannels,v,m])},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,a,s,u,c);if(me().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,a,s,u,c);var h=s!=null,d=c!=null,m=u?up(u,!1):null,v=new MT(a,h,m,d),y=[n,i];return s&&y.push(s),c&&y.push(c),this.compileAndRun(v,y)},e.prototype.conv2d=function(t,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,i);if(me().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,i);var a=new MT(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerInput=function(t,n,i){var a=new oz(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerFilter=function(t,n,i){var a=new az(i);return this.compileAndRun(a,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,i=t.input,a=t.filter,s=t.convInfo,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,m=c?up(c,d):null,v=[i,a],y=u!=null,_=h!=null;return y&&v.push(u),_&&v.push(h),d?(n=new LT(s,y,m,_),this.compileAndRun(n,v)):(n=new PT(s,y,m,_),this.compileAndRun(n,v))},e.prototype.depthwiseConv2D=function(t,n,i){var a;return me().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(a=new LT(i),this.compileAndRun(a,[t,n])):(a=new PT(i),this.compileAndRun(a,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,i){var a=new cz(i);return this.compileAndRun(a,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){var a=new lz(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3d=function(t,n,i){var a=new hz(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerInput=function(t,n,i){var a=new uz(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerFilter=function(t,n,i){var a=new sz(i);return this.compileAndRun(a,[t,n])},e.prototype.maxPool=function(t,n){var i=new Hy(n,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,n){var i=new Hy(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,i,a){var s=new Hy(a,"max",!0),u=this.compileAndRun(s,[n]),c=new Xz(a),h=this.compileAndRun(c,[t,u],n.dtype);return u.dispose(),h},e.prototype.avgPoolBackprop=function(t,n,i){var a=new X5(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.cast=function(t,n){return hI(t,n,this)},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),s=0,u=0;u<t.rank;u++)u!==n&&(a[s++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[n]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[n]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.avgPool3d=function(t,n){var i=new Wy(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,i){var a=new $5(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var i=new Wy(n,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,i,a){var s=new Wy(a,"max",!0),u=this.compileAndRun(s,[n]),c=new $z(a),h=this.compileAndRun(c,[t,u],n.dtype);return u.dispose(),h},e.prototype.reshape=function(t,n){var i=this.texData.get(t.dataId);if(i.isPacked&&!ip(t.shape,n)&&(i.texture===null||!ip(i.shape,n))){var a=this.packedReshape(t,n);return $.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return W0(t,n)},e.prototype.resizeBilinear=function(t,n,i,a){var s=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new aj(t.shape,n,i,a):new ij(t.shape,n,i,a);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,n,i){var a=new rj(t,n,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,n,i,a){var s=new sj(t.shape,n,i,a);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){var a=new oj(t,n,i);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,n,i,a){var s=n?t:so(t),u=s.shape[0],c=s.shape[1],h=new Yz(u,c,i),d=h.getCustomSetupFunc(a);return this.compileAndRun(h,[s],"int32",d)},e.prototype.oneHot=function(t,n,i,a){var s=new Qz(t.size,n,i,a);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var n=new gz(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,i,a,s){return im("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),g_(t.dataSync(),n.dataSync(),i,a,s)},e.prototype.cropAndResize=function(t,n,i,a,s,u){var c=new fz(t.shape,n.shape,a,s,u);return this.compileAndRun(c,[t,n,i],"float32")},e.prototype.depthToSpace=function(t,n,i){W(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var a=t.shape[0],s=i==="NHWC"?t.shape[1]:t.shape[2],u=i==="NHWC"?t.shape[2]:t.shape[3],c=i==="NHWC"?t.shape[3]:t.shape[1],h=s*n,d=u*n,m=c/(n*n),v=new vz(i==="NHWC"?[a,h,d,m]:[a,m,h,d],n,i);return this.compileAndRun(v,[t])},e.prototype.split=function(t,n,i){return pI(t,n,i)},e.prototype.scatterND=function(t,n,i){var a=cm(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,m=[d/c,c],v=t.reshape([u,s]),y=n.reshape([u,c]);if(d===0)return W0(Gn([]),i);var _=Ce(0),E=new UT(u,s,v.rank,y.rank,h,m);return this.compileAndRun(E,[y,v,_]).reshape(i)},e.prototype.sparseToDense=function(t,n,i,a){var s=cm(0,t,i),u=s.sliceRank,c=s.numUpdates,h=s.strides,d=s.outputSize,m=new UT(c,u,t.rank,n.rank,h,[d,1]);return this.compileAndRun(m,[n,t,a]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var i=this.texData.get(t.dataId),a=new BT(xz,t.shape,n),s=new BT(Ez,t.shape,n),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(a,u),h=this.compileAndRun(s,u),d=this.complex(c,h).as2D(t.shape[0],t.shape[1]);return c.dispose(),h.dispose(),d},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],s=iI(t,n),u=s[0],c=s[1],h=s[2],d=s[3],m=n.reshape([c,a]),v=t.reshape([t.size/h,h]),y=new Cz(a,d,[c,h]);return this.compileAndRun(y,[v,m]).reshape(u)},e.prototype.fill=function(t,n,i){if((i=i||vf(n))==="string"){var a=em(i,Oe(t));return a.fill(n),$.makeTensor(a,t,i,this)}var s=new Tz(t,n),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[],i,u)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,i){return fI(t,n,i)},e.prototype.makeTensorInfo=function(t,n){var i=this.write(null,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var i=this.makeTensorInfo(t,n).dataId;return $.makeTensorFromDataId(i,t,n,this)},e.prototype.unpackTensor=function(t){var n=new Dj(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new Zz(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var i=[nm(t.shape)].concat(rm(t.shape)),a={dtype:t.dtype,shape:i,dataId:t.dataId},s=[nm(n)].concat(rm(n)),u=new nj(s,i),c=this.runWebGLProgram(u,[a],t.dtype,null,!0);return{dataId:c.dataId,shape:n,dtype:c.dtype}},e.prototype.decode=function(t){var n,i=this.texData.get(t),a=i.isPacked,s=i.shape,u=i.dtype,c=By(s);return n=a?new mz(c):new pz(c),{dtype:u,shape:s,dataId:this.runWebGLProgram(n,[{shape:c,dtype:u,dataId:t}],u,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,i,a,s){var u=this;s===void 0&&(s=!1);var c=this.makeTensorInfo(t.outputShape,i),h=this.texData.get(c.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===Jh.DENSE){var d=Fh(t.outputShape);h.texShape=d.map(function(A){return 2*A})}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),Oe(c.shape)===0)return h.values=Qh(c.dtype,0),c;var m=[],v=n.map(function(A){if(A.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var R=u.texData.get(A.dataId);if(R.texture==null){if(!t.packedInputs&&Oe(A.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:A.shape,texData:null,isUniform:!0,uniformValues:R.values};t.packedInputs&&(R.isPacked=!0,R.shape=A.shape)}else if(!!R.isPacked!=!!t.packedInputs)A=R.isPacked?u.unpackTensor(A):u.packTensor(A),m.push(A),R=u.texData.get(A.dataId);else if(R.isPacked&&!ip(R.shape,A.shape)){var k=A,B=A.shape;A.shape=R.shape,A=u.packedReshape(A,B),m.push(A),R=u.texData.get(A.dataId),k.shape=B}return u.uploadToGPU(A.dataId),{shape:A.shape,texData:R,isUniform:!1}});this.uploadToGPU(c.dataId);var y,_={shape:c.shape,texData:h,isUniform:!1},E=function(A,R,k){var B="";R.concat(k).forEach(function(D){var O=D.texData!=null&&D.texData.slice!=null&&D.texData.slice.flatOffset>0,L=D.isUniform?"uniform":D.texData.texShape;B+=D.shape+"_"+L+"_"+O});var P=A.userCode,I=A.constructor.name;return I+="_"+B+"_"+P}(t,v,_),x=this.getAndSaveBinary(E,function(){return function(A,R,k,B){var P=R.userCode,I=k.map(function(te,de){var H={logicalShape:te.shape,texShape:te.isUniform?null:te.texData.texShape,isUniform:te.isUniform,isPacked:!te.isUniform&&te.texData.isPacked,flatOffset:null};return te.texData!=null&&te.texData.slice!=null&&te.texData.slice.flatOffset>0&&(H.flatOffset=te.texData.slice.flatOffset),{name:R.variableNames[de],shapeInfo:H}}),D=I.map(function(te){return te.shapeInfo}),O={logicalShape:B.shape,texShape:B.texData.texShape,isUniform:!1,isPacked:B.texData.isPacked,flatOffset:null},L=j5(I,O,P,R.packedInputs),F=A.createProgram(L),V=null,ie=A.getUniformLocation(F,"NAN",!1);me().getNumber("WEBGL_VERSION")===1&&(V=A.getUniformLocation(F,"INFINITY",!1));for(var se={},G=0;G<R.variableNames.length;G++){var Q=R.variableNames[G];se[Q]=A.getUniformLocation(F,Q,!1),se["offset"+Q]=A.getUniformLocation(F,"offset"+Q,!1)}return{program:R,source:L,webGLProgram:F,uniformLocations:se,inShapeInfos:D,outShapeInfo:O,infLoc:V,nanLoc:ie}}(u.gpgpu,t,v,_)}),T=this.activeTimers!=null;if(T&&(y=this.startTimer()),function(A,R,k,B,P){VT(R.inShapeInfos,k),VT([R.outShapeInfo],[B]);var I=B.texData.texture,D=B.texData.texShape;B.texData.isPacked?A.setOutputPackedMatrixTexture(I,D[0],D[1]):A.setOutputMatrixTexture(I,D[0],D[1]),A.setProgram(R.webGLProgram),me().getNumber("WEBGL_VERSION")===1&&R.infLoc!==null&&A.gl.uniform1f(R.infLoc,1/0),R.nanLoc!==null&&A.gl.uniform1f(R.nanLoc,NaN),k.forEach(function(O,L){var F=R.program.variableNames[L],V=R.uniformLocations[F],ie=R.uniformLocations["offset"+F];if(V!=null)if(O.isUniform)if(Oe(O.shape)<2)A.gl.uniform1f(V,O.uniformValues[0]);else{var se=O.uniformValues;se instanceof Float32Array||(se=new Float32Array(se)),A.gl.uniform1fv(V,se)}else O.texData.slice!=null&&ie!=null&&A.gl.uniform1i(ie,O.texData.slice.flatOffset),A.setInputMatrixTexture(O.texData.texture,V,L)}),P!=null&&P(A,R.webGLProgram),A.executeProgram()}(this.gpgpu,x,v,_,a),m.forEach(function(A){return u.disposeData(A.dataId)}),T&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)})),!me().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&s===!1){var C=this.unpackTensor(c);return this.disposeData(c.dataId),C}return c},e.prototype.compileAndRun=function(t,n,i,a,s){s===void 0&&(s=!1),i=i||n[0].dtype;var u=this.runWebGLProgram(t,n,i,a,s);return $.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(me().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(n){t.gpgpu.deleteProgram(t.binaryCache[n].webGLProgram),delete t.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Re(function(){if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=me().getBool("DEBUG");me().set("DEBUG",!1);var i=t.abs(Ce(1e-8)).dataSync()[0];if(me().set("DEBUG",n),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,i=this.texData.get(t),a=i.shape,s=i.dtype,u=i.values,c=i.texture,h=i.usage,d=i.isPacked;if(c==null){var m,v=this.activeTimers!=null;v&&(m=Zi());var y=i.texShape;if(y==null&&(y=B6(a,d),i.texShape=y),u!=null){var _=By(a),E=void 0,x=y[1],T=y[0],C=u instanceof Uint8Array;d?(x=(n=yf(y[0],y[1]))[0],T=n[1],E=new wz(_,[T,x],C)):E=new _z(_,[T,x],C);var A=this.makeTensorInfo([T,x],s);this.texData.get(A.dataId).usage=C?zr.PIXELS:zr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(A.dataId),x,T,u);var R=this.runWebGLProgram(E,[A],s,null,!0),k=this.texData.get(R.dataId);i.texture=k.texture,i.texShape=k.texShape,i.isPacked=k.isPacked,i.usage=k.usage,this.disposeData(A.dataId),this.texData.delete(R.dataId),i.values=null,v&&(this.uploadWaitMs+=Zi()-m)}else{var B=this.acquireTexture(y,h,s,d);i.texture=B}}},e.prototype.convertAndCacheOnCPU=function(t,n){var i=this.texData.get(t),a=i.dtype;return this.releaseGPUData(t),n!=null&&(i.values=function(s,u){if(u==="float32"||u==="complex64")return s;if(u==="int32"||u==="bool"){for(var c=u==="int32"?new Int32Array(s.length):new Uint8Array(s.length),h=0;h<c.length;++h)c[h]=Math.round(s[h]);return c}throw new Error("Unknown dtype "+u)}(n,a)),i.values},e.prototype.acquireTexture=function(t,n,i,a){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,a)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*UR(n)},e}(lI);KR()&&$.registerBackend("webgl",function(){return new kj},2);var Oj=K({square_:function(r){var e=j(r,"x","square"),t=[e];return $.runKernelFunc(function(n,i){return i([e]),n.square(e)},{x:e},null,"Square",{},t,[])}}),tf="SquaredDifference",RI=K({squaredDifference_:function(r,e){var t,n=j(r,"a","squaredDifference"),i=j(e,"b","squaredDifference");t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape);var a={a:n,b:i},s=[n,i];return $.runKernelFunc(function(u,c){var h=u.squaredDifference(n,i);return c([n,i]),h},a,function(u,c){var h=c[0],d=c[1],m=Ce(2);return{a:function(){return u.mul(h.sub(d).mul(m))},b:function(){return u.mul(d.sub(h).mul(m))}}},tf,{},s,[])}}),Mj=K({abs_:function(r){var e=j(r,"x","abs");return e.dtype==="complex64"?$.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):$.runKernelFunc(function(t,n){var i=t.abs(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),Pj=K({acos_:function(r){var e=j(r,"x","acos");return $.runKernelFunc(function(t,n){var i=t.acos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ce(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),Lj=K({acosh_:function(r){var e=j(r,"x","acosh");return $.runKernelFunc(function(t,n){var i=t.acosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Fj=K({asin_:function(r){var e=j(r,"x","asin");return $.runKernelFunc(function(t,n){var i=t.asin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ce(1).sub(i.toFloat().square()).sqrt())}}})}}),Bj=K({asinh_:function(r){var e=j(r,"x","asinh");return $.runKernelFunc(function(t,n){var i=t.asinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ce(1).add(i.toFloat().square()).sqrt())}}})}}),Vj=K({atan_:function(r){var e=j(r,"x","atan");return $.runKernelFunc(function(t,n){var i=t.atan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),Uj=K({atanh_:function(r){var e=j(r,"x","atanh");return $.runKernelFunc(function(t,n){var i=t.atanh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(Ce(1).sub(i.toFloat().square()))}}})}}),zj=K({ceil_:function(r){var e=j(r,"x","ceil");return $.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),E_=K({clipByValue_:function(r,e,t){var n=j(r,"x","clipByValue");W(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[n],a={min:e,max:t};return $.runKernelFunc(function(s,u){var c=s.clip(n,e,t);return u([n]),c},{x:n},function(s,u){var c=u[0];return{x:function(){return s.where(c.greaterEqual(e).logicalAnd(c.lessEqual(t)),gt(s))}}},"ClipByValue",a,i)}}),jj=K({cos_:function(r){var e=j(r,"x","cos"),t=[e];return $.runKernelFunc(function(n,i){var a=n.cos(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return a.toFloat().sin().neg().mul(n)}}},"Cos",{},t)}}),Hj=K({cosh_:function(r){var e=j(r,"x","cosh");return $.runKernelFunc(function(t,n){var i=t.cosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),Wj=K({erf_:function(r){var e=j(r,"x","erf");return W(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),$.runKernelFunc(function(t,n){var i=t.erf(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),G0=K({exp_:function(r){var e=j(r,"x","exp");return $.runKernelFunc(function(t,n){var i=t.exp(e);return n([i]),i},{x:e},function(t,n){return{x:function(){return t.mulStrict(n[0])}}},"Exp",{},[],[!0])}}),qj=K({expm1_:function(r){var e=j(r,"x","expm1");return $.runKernelFunc(function(t,n){var i=t.expm1(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}})}}),Gj=K({floor_:function(r){var e=j(r,"x","floor");return $.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),Kj=K({log_:function(r){var e=j(r,"x","log"),t=[e];return $.runKernelFunc(function(n,i){var a=n.log(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return n.div(a.toFloat())}}},"Log",{},t)}}),Xj=K({log1p_:function(r){var e=j(r,"x","log1p");return $.runKernelFunc(function(t,n){var i=t.log1p(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}})}}),$j=K({logSigmoid_:function(r){var e=j(r,"x","logSigmoid");return $.runKernelFunc(function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),pm=K({neg_:function(r){var e=j(r,"x","neg"),t=[e];return $.runKernelFunc(function(n){return n.neg(e)},{x:e},function(n){return{x:function(){return n.neg()}}},"Neg",{},t)}}),Yj=K({reciprocal_:function(r){var e=j(r,"x","reciprocal");return $.runKernelFunc(function(t,n){var i=t.reciprocal(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}})}}),Qj=K({round_:function(r){var e=j(r,"x","round");return $.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),II=K({rsqrt_:function(r){var e=j(r,"x","rsqrt"),t=[e];return $.runKernelFunc(function(n,i){var a=n.rsqrt(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return n.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),DI=K({sigmoid_:function(r){var e=j(r,"x","sigmoid");return $.runKernelFunc(function(t,n){var i=t.sigmoid(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.mul(Ce(1).sub(i)))}}},"Sigmoid")}}),Zj=K({sign_:function(r){var e=j(r,"x","sign");return $.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),Jj=K({isNaN_:function(r){var e=j(r,"x","isNaN");return $.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),e9=K({isInf_:function(r){var e=j(r,"x","isInf");return $.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),t9=K({isFinite_:function(r){var e=j(r,"x","isFinite");return $.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return gt(t)}}})}}),n9=K({sin_:function(r){var e=j(r,"x","sin"),t=[e];return $.runKernelFunc(function(n,i){var a=n.sin(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return a.toFloat().cos().mul(n)}}},"Sin",{},t)}}),r9=K({sinh_:function(r){var e=j(r,"x","sinh");return $.runKernelFunc(function(t,n){var i=t.sinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),i9=K({softplus_:function(r){var e=j(r,"x","softplus");return $.runKernelFunc(function(t,n){var i=t.softplus(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),a9=K({sqrt_:function(r){var e=j(r,"x","sqrt");return $.runKernelFunc(function(t,n){var i=t.sqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),o9=K({step_:function(r,e){e===void 0&&(e=0);var t=j(r,"x","step");return $.runKernelFunc(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return gt(n)}}})}}),s9=K({tan_:function(r){var e=j(r,"x","tan");return $.runKernelFunc(function(t,n){var i=t.tan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}})}}),u9=K({tanh_:function(r){var e=j(r,"x","tanh");return $.runKernelFunc(function(t,n){var i=t.tanh(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return Ce(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function NI(r,e,t,n,i,a){var s,u,c=j(r,"x","batchNorm"),h=j(e,"mean","batchNorm"),d=j(t,"variance","batchNorm");return i!=null&&(s=j(i,"scale","batchNorm")),n!=null&&(u=j(n,"offset","batchNorm")),W(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),W(h.rank===2||h.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."}),W(d.rank===2||d.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),s!=null&&W(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),u!=null&&W(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),_f(c,h,d,u,s,a)}function kI(r,e,t,n,i,a){var s,u,c=j(r,"x","batchNorm"),h=j(e,"mean","batchNorm"),d=j(t,"variance","batchNorm");return i!=null&&(s=j(i,"scale","batchNorm")),n!=null&&(u=j(n,"offset","batchNorm")),W(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),W(h.rank===3||h.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."}),W(d.rank===3||d.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),s!=null&&W(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),u!=null&&W(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),_f(c,h,d,u,s,a)}function OI(r,e,t,n,i,a){var s,u,c=j(r,"x","batchNorm"),h=j(e,"mean","batchNorm"),d=j(t,"variance","batchNorm");return i!=null&&(s=j(i,"scale","batchNorm")),n!=null&&(u=j(n,"offset","batchNorm")),W(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),W(h.rank===4||h.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."}),W(d.rank===4||d.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),s!=null&&W(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),u!=null&&W(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),_f(c,h,d,u,s,a)}function _f(r,e,t,n,i,a){a==null&&(a=.001);var s,u,c,h=j(r,"x","batchNorm"),d=j(e,"mean","batchNorm"),m=j(t,"variance","batchNorm");i!=null&&(s=j(i,"scale","batchNorm")),n!=null&&(u=j(n,"offset","batchNorm")),W(d.rank===m.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),W(u==null||d.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),W(s==null||d.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var v=[h,d,m,s];return $.runKernelFunc(function(y,_){var E=y.batchNormalization(c,lp(d),lp(m),a,lp(s),lp(u));return _([h,d,m,s]),E},{x:h,mean:d,variance:m,scale:s,offset:u},function(y,_){var E=_,x=E[0],T=E[1],C=E[2],A=E[3],R=A??Ce(1),k=Sn(T.shape,c.shape),B=[];if(T.rank===1){for(var P=0;P<c.shape.length-1;++P)B.push(c.shape[P]);B.push(1)}var I=x.sub(T),D=y.mul(R),O=II(C.add(Ce(a))),L=O.mul(O).mul(O).mul(Ce(-.5));return{x:function(){return T.rank===1?y.mul(Ml(O.as4D(1,1,1,T.shape[0]),B)).mul(R).reshape(x.shape):y.mul(O).mul(R).reshape(x.shape)},mean:function(){var F=O.mul(Ce(-1)).mul(D);return T.rank===1&&(F=F.sum(k)),F.reshape(T.shape)},variance:function(){var F=L.mul(I).mul(D);return T.rank===1&&(F=F.sum(k)),F.reshape(T.shape)},scale:function(){var F=I.mul(O),V=y.mul(F);return T.rank===1&&(V=V.sum(k)),V.reshape(T.shape)},offset:function(){var F=y;return T.rank===1&&(F=F.sum(k)),F.reshape(T.shape)}}},"BatchNormalization",{varianceEpsilon:a},v).reshape(h.shape)}function lp(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Zm(){XR("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var l9=K({batchNormalization2d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Zm(),NI(r,e,t,a,i,n)}}),c9=K({batchNormalization3d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Zm(),kI(r,e,t,a,i,n)}}),h9=K({batchNormalization4d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Zm(),OI(r,e,t,a,i,n)}}),f9=K({batchNormalization_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Zm(),_f(r,e,t,a,i,n)}}),MI=K({batchNorm_:_f}),d9=K({batchNorm2d_:NI}),p9=K({batchNorm3d_:kI}),m9=K({batchNorm4d_:OI}),Jm=K({logicalAnd_:function(r,e){var t=j(r,"a","logicalAnd","bool"),n=j(e,"b","logicalAnd","bool");return ut(t.shape,n.shape),$.runKernelFunc(function(i){return i.logicalAnd(t,n)},{a:t,b:n},null,"LogicalAnd")}}),v9=K({logicalNot_:function(r){var e=j(r,"x","logicalNot","bool");return $.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),PI=K({logicalOr_:function(r,e){var t=j(r,"a","logicalOr","bool"),n=j(e,"b","logicalOr","bool");return ut(t.shape,n.shape),$.runKernelFunc(function(i){return i.logicalOr(t,n)},{$a:t,$b:n})}}),g9=K({logicalXor_:function(r,e){var t=j(r,"a","logicalXor","bool"),n=j(e,"b","logicalXor","bool");return ut(t.shape,n.shape),PI(r,e).logicalAnd(Jm(r,e).logicalNot())}}),mu=K({where_:function(r,e,t){var n=j(e,"a","where"),i=j(t,"b","where"),a=j(r,"condition","where","bool");return St(n.shape,i.shape,"Error in where: "),a.rank===1?W(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):St(a.shape,i.shape,"Error in where: "),$.runKernelFunc(function(s,u){var c=s.select(a,n,i);return u([a]),c},{$condition:a,$a:n,$b:i},function(s,u){var c=u[0];return{$condition:function(){return gt(c).toFloat()},$a:function(){return s.mul(c.cast(s.dtype))},$b:function(){return s.mul(c.logicalNot().cast(s.dtype))}}})}}),LI=function(r){return De(this,void 0,void 0,function(){var e,t,n;return Ne(this,function(i){switch(i.label){case 0:return[4,(e=j(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=b_(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},at=K({add_:function(r,e){var t,n=j(r,"a","add"),i=j(e,"b","add");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s){return s.add(n,i)},{a:n,b:i},function(s){return{a:function(){var u=s,c=Sn(n.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(n.shape)},b:function(){var u=s,c=Sn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(i.shape)}}},"Add")}}),y9=K({addN_:function(r){W(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),W(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(i,a){return j(i,"tensors"+a,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Pn(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return $.runKernelFunc(function(i){return i.addN(e)},n,function(i){var a={};return e.forEach(function(s,u){a[u]=function(){return i.clone()}}),a},"AddN")}}),b9=K({addStrict_:function(r,e){var t=j(r,"a","addStrict"),n=j(e,"b","addStrict");return St(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),_9=K({atan2_:function(r,e){var t,n=j(r,"a","atan2"),i=j(e,"b","atan2");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s,u){var c=s.atan2(n,i);return u([n,i]),c},{$a:n,$b:i},function(s,u){var c=u[0],h=u[1];return{$a:function(){var d=at(c.square(),h.square()),m=s.mul(h.div(d)),v=Sn(c.shape,a);return v.length>0&&(m=m.sum(v)),m.reshape(c.shape)},$b:function(){var d=at(c.square(),h.square()),m=pm(s.mul(c.div(d))),v=Sn(h.shape,a);return v.length>0&&(m=m.sum(v)),m.reshape(h.shape)}}})}}),bi=K({div_:function(r,e){var t,n=j(r,"a","div"),i=j(e,"b","div");if(t=$t(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return FI(n,i);var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s,u){var c=s.realDivide(n,i);return u([n,i]),c},{a:n,b:i},function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.div(h.toFloat()),m=Sn(c.shape,a);return m.length>0?d.sum(m).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),m=Sn(h.shape,a);m.length>0&&(d=d.sum(m).reshape(h.shape));var v=h.square();return d.div(v.toFloat()).neg()}}},"Div")}}),w9=K({divNoNan_:function(r,e){var t,n=j(r,"a","div"),i=j(e,"b","div");n=(t=$t(n,i))[0],i=t[1];var a=bi(n,i),s=gt(a),u=i.equal(s);return mu(u,s,a)}}),x9=K({divStrict_:function(r,e){var t=j(r,"a","div"),n=j(e,"b","div");return St(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),FI=K({floorDiv_:function(r,e){var t,n=j(r,"a","floorDiv"),i=j(e,"b","floorDiv");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s,u){var c=s.floorDiv(n,i);return u([n,i]),c},{a:n,b:i},function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.div(h.toFloat()),m=Sn(c.shape,a);return m.length>0?d.sum(m).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),m=Sn(h.shape,a);m.length>0&&(d=d.sum(m).reshape(h.shape));var v=h.square();return d.div(v.toFloat()).neg()}}},"FloorDiv")}}),T_=K({maximum_:function(r,e){var t,n=j(r,"a","maximum"),i=j(e,"b","maximum");return t=$t(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),ut(n.shape,i.shape),$.runKernelFunc(function(a,s){var u=a.maximum(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){return a.mul(u.greaterEqual(c).toFloat())},b:function(){return a.mul(u.less(c).toFloat())}}},"Maximum")}}),E9=K({maximumStrict_:function(r,e){var t=j(r,"a","maximumStrict"),n=j(e,"b","maximumStrict");return St(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),BI=K({minimum_:function(r,e){var t,n=j(r,"a","minimum"),i=j(e,"b","minimum");return t=$t(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),ut(n.shape,i.shape),$.runKernelFunc(function(a,s){var u=a.minimum(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){return a.mul(u.lessEqual(c).toFloat())},b:function(){return a.mul(u.greater(c).toFloat())}}},"Minimum")}}),T9=K({minimumStrict_:function(r,e){var t=j(r,"a","minimumStrict"),n=j(e,"b","minimumStrict");return St(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),S9=K({mod_:function(r,e){var t,n=j(r,"a","mod"),i=j(e,"b","mod");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s,u){var c=s.mod(n,i);return u([n,i]),c},{$a:n,$b:i},function(s,u){var c=u[0],h=u[1];return{$a:function(){var d=Sn(c.shape,a);return d.length>0?s.sum(d).reshape(c.shape):s},$b:function(){var d=s.mul(c.div(h).floor().neg()),m=Sn(h.shape,a);return m.length>0?d.sum(m).reshape(h.shape):d}}})}}),C9=K({modStrict_:function(r,e){var t=j(r,"a","modStrict"),n=j(e,"b","modStrict");return St(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),ar=K({mul_:function(r,e){var t,n=j(r,"a","mul"),i=j(e,"b","mul");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s,u){var c=s.multiply(n,i);return u([n,i]),c},{a:n,b:i},function(s,u){var c=u[0],h=u[1];return{a:function(){var d=s.mul(h.toFloat()),m=Sn(c.shape,a);return m.length>0?d.sum(m).reshape(c.shape):d},b:function(){var d=s.mul(c.toFloat()),m=Sn(h.shape,a);return m.length>0?d.sum(m).reshape(h.shape):d}}},"Mul")}}),A9=K({mulStrict_:function(r,e){var t=j(r,"a","mul"),n=j(e,"b","mul");return St(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),mm=K({pow_:function(r,e){var t,n=j(r,"base","pow"),i=j(e,"exp","pow");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape),s=[n,i];return $.runKernelFunc(function(u,c){var h=u.pow(n,i);return c([n,i,h]),h},{a:n,b:i},function(u,c){var h=c[0],d=c[1],m=c[2];return{a:function(){var v=d.toFloat(),y=u.mul(v.mul(h.pow(v.sub(Ce(1))))),_=Sn(h.shape,a);return _.length>0&&(y=y.sum(_)),y.reshape(h.shape)},b:function(){var v=h.greater(0),y=h.log().where(v,gt(h)),_=u.mul(m.mul(y)),E=Sn(d.shape,a);return E.length>0&&(_=_.sum(E)),_.reshape(d.shape)}}},"Pow",{},s,[!0])}}),R9=K({powStrict_:function(r,e){return St(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),I9=K({squaredDifferenceStrict_:function(r,e){var t=j(r,"a","squaredDifferenceStrict"),n=j(e,"b","squaredDifferenceStrict");return St(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),Cn=K({sub_:function(r,e){var t,n=j(r,"a","sub"),i=j(e,"b","sub");t=$t(n,i),n=t[0],i=t[1];var a=ut(n.shape,i.shape);return $.runKernelFunc(function(s){return s.subtract(n,i)},{a:n,b:i},function(s){return{a:function(){var u=s,c=Sn(n.shape,a);return c.length>0&&(u=u.sum(c)),u.reshape(n.shape)},b:function(){var u=s,c=Sn(i.shape,a);return c.length>0&&(u=u.sum(c)),u.neg().reshape(i.shape)}}},"Sub")}}),D9=K({subStrict_:function(r,e){var t=j(r,"a","subStrict"),n=j(e,"b","subStrict");return St(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),VI=K({equal_:function(r,e){var t,n=j(r,"a","equal"),i=j(e,"b","equal");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a){return a.equal(n,i)},{$a:n,$b:i})}}),N9=K({equalStrict_:function(r,e){var t=j(r,"a","equalStrict"),n=j(e,"b","equalStrict");return St(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),k9=K({greater_:function(r,e){var t,n=j(r,"a","greater"),i=j(e,"b","greater");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a){return a.greater(n,i)},{a:n,b:i},null,"Greater")}}),UI=K({greaterEqual_:function(r,e){var t,n=j(r,"a","greaterEqual"),i=j(e,"b","greaterEqual");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a,s){var u=a.greaterEqual(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){return gt(u)},b:function(){return gt(c)}}},"GreaterEqual")}}),O9=K({greaterEqualStrict_:function(r,e){var t=j(r,"a","greaterEqualStrict"),n=j(e,"b","greaterEqualStrict");return St(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),M9=K({greaterStrict_:function(r,e){var t=j(r,"a","greaterStrict"),n=j(e,"b","greaterStrict");return St(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),P9=K({less_:function(r,e){var t,n=j(r,"a","less"),i=j(e,"b","less");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a){return a.less(n,i)},{a:n,b:i},null,"Less")}}),L9=K({lessEqual_:function(r,e){var t,n=j(r,"a","lessEqual"),i=j(e,"b","lessEqual");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a,s){var u=a.lessEqual(n,i);return s([n,i]),u},{a:n,b:i},null,"LessEqual")}}),F9=K({lessEqualStrict_:function(r,e){var t=j(r,"a","lessEqualStrict"),n=j(e,"b","lessEqualStrict");return St(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),B9=K({lessStrict_:function(r,e){var t=j(r,"a","lessStrict"),n=j(e,"b","lessStrict");return St(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),V9=K({notEqual_:function(r,e){var t,n=j(r,"a","notEqual"),i=j(e,"b","notEqual");return t=$t(n,i),n=t[0],i=t[1],ut(n.shape,i.shape),$.runKernelFunc(function(a){return a.notEqual(n,i)},{a:n,b:i},null,"NotEqual")}}),U9=K({notEqualStrict_:function(r,e){var t=j(r,"a","notEqualStrict"),n=j(e,"b","notEqualStrict");return St(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function $T(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function YT(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var S_=K({gather_:function(r,e,t){t===void 0&&(t=0);var n=j(r,"x","gather"),i=j(e,"indices","gather","int32");t=An(t,n.shape)[0];var a=function(s,u,c){for(var h=s.shape[c],d=[],m=1,v=1,y=0;y<c;y++)d.push(s.shape[y]),m*=s.shape[y];for(y=0;y<u.rank;y++)d.push(u.shape[y]);for(y=c+1;y<s.rank;y++)d.push(s.shape[y]),v*=s.shape[y];return{batchSize:m,sliceSize:v,dimSize:h,outputShape:d}}(n,i,t);return $.runKernelFunc(function(s,u){var c=s.gather(n,i.flatten(),t);return u([i]),c},{x:n,indices:i},function(s,u){var c=u[0];return{x:function(){var h=n.shape,d=c.size,m=h.slice(0,t),v=m.length,y=h.slice(t,h.length).slice(1),_=y.length,E=$T(0,v),x=$T(v+1,v+1+_),T=YT([m,[d],y]),C=s.reshape(T),A=c.reshape([d]),R=YT([[v],E,x]),k=C.transpose(R),B=zI(k,A,n.shape[t]),P=h_(R);return B=B.transpose(P)},indices:function(){return c}}},"Gather",{axis:t}).reshape(a.outputShape)}}),zI=K({unsortedSegmentSum_:function(r,e,t){var n=j(r,"x","unsortedSegmentSum"),i=j(e,"segmentIds","unsortedSegmentSum","int32");return W(rn(t),function(){return"numSegments must be of dtype int"}),$.runKernelFunc(function(a,s){var u=a.unsortedSegmentSum(n,i,t);return s([i]),u},{$x:n},function(a,s){var u=s[0];return{$x:function(){return function(c,h){for(var d=T_(h,gt(h)),m=S_(c,d),v=UI(h,Ce(0,"int32")),y=m.rank-v.rank,_=0;_<y;++_)v=oi(v,_+1);v=Jm(v,cc(m.shape,"bool"));var E=gt(m);return mu(v,m,E)}(a,u)}}})}}),z9=function(r,e,t){return De(this,void 0,void 0,function(){var n,i,a,s,u,c,h,d,m,v,y,_,E;return Ne(this,function(x){switch(x.label){case 0:for(n=j(r,"tensor","boolMask"),i=j(e,"mask","boolMask","bool"),a=t??0,s=i.rank,u=n.shape,W(s>0,function(){return"mask cannot be scalar"}),St(u.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,h=a;h<a+s;h++)c*=u[h];return d=u.slice(0,a).concat([c],u.slice(a+s)),m=n.reshape(d),v=i.reshape([-1]),[4,LI(v)];case 1:return y=x.sent(),_=y.squeeze([1]),E=S_(m,_,a),r!==n&&n.dispose(),e!==i&&i.dispose(),_.dispose(),m.dispose(),v.dispose(),y.dispose(),[2,E]}})})};function jI(r,e,t,n,i,a,s){a===void 0&&(a="NHWC"),W(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var u=r,c=e,h=!1;e.rank===3&&(h=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),u=[1,r[0],r[1],r[2]]),W(u.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."}),W(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),W(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var d=a==="NHWC"?u[3]:u[1],m=a==="NHWC"?c.shape[3]:c.shape[1];W(d===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+t.shape[2]+"."}),W(m===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+m+") must match output depth for filter "+t.shape[3]+"."}),s!=null&&W(rn(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var v=v_(a),y=Eu(u,t.shape,n,1,i,s,!1,v),_=$.runKernelFunc(function(E,x){var T=E.conv2dDerInput(c,t,y);return x([t,c]),T},{dy4D:c,filter:t},function(E,x){var T=x[0],C=x[1];return{dy4D:function(){return hi(E,T,n,i,a,1,s)},filter:function(){return C_(E,C,T.shape,n,i,a,s)}}});return h?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}function Gy(r){var e=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function HI(r,e,t,n,i){W(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var a=r,s=e,u=!1;e.rank===4&&(u=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,r[0],r[1],r[2],r[3]]);var c=a[4],h=s.shape[4];W(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),W(s.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),W(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),W(c===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."}),W(h===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."});var d=fm(a,t.shape,n,1,i),m=$.runKernelFunc(function(v){return v.conv3dDerInput(s,t,d)},{dy5D:s});return u?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}var j9=K({conv1d_:function(r,e,t,n,i,a,s){i===void 0&&(i="NWC"),a===void 0&&(a=1);var u=j(r,"x","conv1d"),c=j(e,"filter","conv1d"),h=u,d=!1;u.rank===2&&(d=!0,h=u.as3D(1,u.shape[0],u.shape[1])),W(h.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."}),W(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),s!=null&&W(rn(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."}),W(h.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),W(Ar(t,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"}),W(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var m=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),v=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),y=hi(v,m,[1,t],n,"NHWC",[1,a],s);return d?y.as2D(y.shape[2],y.shape[3]):y.as3D(y.shape[0],y.shape[2],y.shape[3])}}),hi=K({conv2d_:function(r,e,t,n,i,a,s){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var u=j(r,"x","conv2d"),c=j(e,"filter","conv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),W(h.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."}),W(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),s!=null&&W(rn(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."});var m=i==="NHWC"?h.shape[3]:h.shape[1];W(m===c.shape[2],function(){return"Error in conv2d: depth of input ("+m+") must match input depth for filter "+c.shape[2]+"."}),W(Ar(t,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"});var v=v_(i),y=Eu(h.shape,c.shape,t,a,n,s,!1,v),_=[c,h],E=$.runKernelFunc(function(x,T){var C=x.conv2d(h,c,y);return T([c,h]),C},{x:h,filter:c},function(x,T){var C=T,A=C[0],R=C[1];return W(Zl(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return WI(R.shape,x,A,t,n,i)},filter:function(){return C_(R,x,A.shape,t,n,i)}}},"Conv2D",y,_);return d?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),H9=K({conv3d_:function(r,e,t,n,i,a){i===void 0&&(i="NDHWC"),a===void 0&&(a=[1,1,1]);var s=j(r,"x","conv3d"),u=j(e,"filter","conv3d"),c=s,h=!1;s.rank===4&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),W(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),W(u.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),W(c.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),W(function(v,y){return Gy(v)||Gy(y)}(t,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),W(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var d=fm(c.shape,u.shape,t,a,n),m=$.runKernelFunc(function(v,y){var _=v.conv3d(c,u,d);return y([c,u]),_},{x:c,$filter:u},function(v,y){W(Gy(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var _=y[0],E=y[1];return{x:function(){return HI(_.shape,v,E,t,n)},$filter:function(){return function(x,T,C,A,R){var k=x;x.rank===4&&(k=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]));var B=T;B.rank===4&&(B=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),W(k.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."}),W(B.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+B.shape+"."}),W(C.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+C+"."}),W(k.shape[4]===C[3],function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+C[3]+"."}),W(B.shape[4]===C[4],function(){return"Error in conv3dDerFilter: depth of dy ("+B.shape[4]+") must match output depth for filter ("+C[4]+")."});var P=fm(k.shape,C,A,1,R);return $.runKernelFunc(function(I){return I.conv3dDerFilter(k,B,P)},{x5D:k,dy5D:B})}(_,v,E.shape,t,n)}}});return h?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),C_=K({conv2dDerFilter_:function(r,e,t,n,i,a,s){a===void 0&&(a="NHWC");var u=r;r.rank===3&&(u=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var c=e;c.rank===3&&(c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),W(u.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."}),W(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),W(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var h=a==="NHWC"?u.shape[3]:u.shape[1],d=a==="NHWC"?c.shape[3]:c.shape[1];W(h===t[2],function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."}),W(d===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+t[3]+")."}),s!=null&&W(rn(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var m=v_(a),v=Eu(u.shape,t,n,1,i,s,!1,m);return $.runKernelFunc(function(y){return y.conv2dDerFilter(u,c,v)},{x4D:u,dy4D:c})}}),WI=K({conv2dDerInput_:jI}),ev=K({depthwiseConv2d_:function(r,e,t,n,i,a,s){a===void 0&&(a=[1,1]);var u=j(r,"x","depthwiseConv2d"),c=j(e,"filter","depthwiseConv2d"),h=u,d=!1;u.rank===3&&(d=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),W(h.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."}),W(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),W(h.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),a==null&&(a=[1,1]),W(Ar(t,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),s!=null&&W(rn(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."});var m=Eu(h.shape,c.shape,t,a,n,s,!0),v=[h,c],y=$.runKernelFunc(function(_,E){var x=_.depthwiseConv2D(h,c,m);return E([h,c]),x},{x:h,filter:c},function(_,E){W(Zl(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var x=E[0],T=E[1];return{x:function(){return qI(x.shape,_,T,m)},filter:function(){return GI(x,_,T.shape,m)}}},"DepthwiseConv2dNative",m,v);return d?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),qI=K({depthwiseConv2dDerInput_:function(r,e,t,n){var i=e,a=!1;e.rank===3&&(a=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=$.runKernelFunc(function(u){return u.depthwiseConv2DDerInput(i,t,n)},{dy4D:i});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),GI=K({depthwiseConv2dDerFilter_:function(r,e,t,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),$.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,a,n)},{x4D:i,dy4D:a})}}),A_=K({separableConv2d_:function(r,e,t,n,i,a,s){a===void 0&&(a=[1,1]),s===void 0&&(s="NHWC");var u=j(r,"x","separableConv2d"),c=j(e,"depthwiseFilter","separableConv2d"),h=j(t,"pointwiseFilter","separableConv2d"),d=u,m=!1;if(u.rank===3&&(m=!0,d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(d.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),W(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),W(h.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),W(h.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."}),W(h.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."});var v=c.shape[2],y=c.shape[3];W(h.shape[2]===v*y,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+v*y+", but got "+h.shape[2]+"."});var _=ev(d,c,n,i,s,a),E=hi(_,h,1,"valid",s);return m?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),W9=K({conv2dTranspose_:function(r,e,t,n,i,a){return jI(t,j(r,"x","conv2dTranspose"),j(e,"filter","conv2dTranspose"),n,i,"NHWC",a)}}),q9=K({conv3dTranspose_:function(r,e,t,n,i){return HI(t,j(r,"x","conv3dTranspose"),j(e,"filter","conv3dTranspose"),n,i)}}),tv=K({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var a=j(r,"a","matMul"),s=j(e,"b","matMul");i=$t(a,s),a=i[0],s=i[1];var u=t?a.shape[a.rank-2]:a.shape[a.rank-1],c=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=t?a.shape[a.rank-1]:a.shape[a.rank-2],d=n?s.shape[s.rank-2]:s.shape[s.rank-1],m=a.shape.slice(0,-2),v=s.shape.slice(0,-2),y=Oe(m),_=Oe(v);W(a.rank>=2&&s.rank>=2&&a.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+s.rank+"."}),W(Pn(m,v),function(){return"Error in matMul: outer dimensions ("+m+") and ("+v+") of Tensors with shapes "+a.shape+" and "+s.shape+" must match."}),W(u===c,function(){return"Error in matMul: inner shapes ("+u+") and ("+c+") of Tensors with shapes "+a.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var E=a.shape.slice(0,-2).concat([h,d]),x=t?a.as3D(y,u,h):a.as3D(y,h,u),T=n?s.as3D(_,d,c):s.as3D(_,c,d),C={transposeA:t,transposeB:n};return $.runKernelFunc(function(A,R){var k=A.batchMatMul(x,T,t,n);return R([x,T]),k},{a:x,b:T},function(A,R){var k=R,B=k[0],P=k[1];return t||n?!t&&n?{a:function(){return A.matMul(P,!1,!1)},b:function(){return A.matMul(B,!0,!1)}}:t&&!n?{a:function(){return P.matMul(A,!1,!0)},b:function(){return B.matMul(A,!1,!1)}}:{a:function(){return P.matMul(A,!0,!0)},b:function(){return A.matMul(B,!0,!0)}}:{a:function(){return A.matMul(P,!1,!0)},b:function(){return B.matMul(A,!0,!1)}}},"BatchMatMul",C).reshape(E)}}),G9=K({dot_:function(r,e){var t=j(r,"t1","dot"),n=j(e,"t2","dot");W(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var i=t.rank===1?t.size:t.shape[1],a=n.rank===1?n.size:n.shape[0];return W(i===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),K9=K({outerProduct_:function(r,e){var t=j(r,"v1","outerProduct"),n=j(e,"v2","outerProduct");return W(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),wf=K({reverse_:function(r,e){var t=j(r,"x","reverse");if(t.rank===0)return t.clone();var n=An(e,t.shape);return $.runKernelFunc(function(i){return i.reverse(t,n)},{$x:t},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(t)}}),X9=K({reverse1d_:function(r){var e=j(r,"x","reverse");return W(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),wf(e,0)}}),$9=K({reverse2d_:function(r,e){var t=j(r,"x","reverse");return W(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),wf(t,e)}}),Y9=K({reverse3d_:function(r,e){var t=j(r,"x","reverse");return W(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),wf(t,e)}}),Q9=K({reverse4d_:function(r,e){var t=j(r,"x","reverse");return W(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),wf(t,e)}});function KI(r,e,t,n,i,a){var s=j(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),W(u.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),W(Ar(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),a!=null&&W(rn(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=ef(u.shape,e,t,n,i,a);if(h.filterWidth===1&&h.filterHeight===1&&Pn(h.inShape,h.outShape))return s.clone();var d=[u],m=$.runKernelFunc(function(v,y){var _=v.maxPool(u,h);return y([u,_]),_},{x:u},function(v,y){var _=y[0],E=y[1];return{x:function(){return function(x,T,C,A,R,k,B,P){var I=j(x,"dy","maxPoolBackprop"),D=j(T,"input","maxPoolBackprop"),O=j(C,"output","maxPoolBackprop");W(D.rank===I.rank,function(){return"Rank of input ("+D.rank+") does not match rank of dy ("+I.rank+")"}),W(Ar(R,k),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+R+" and dilations '"+k+"'"}),W(I.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."}),W(D.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+D.rank+"."});var L=ef(D.shape,A,R,k,B,P);return $.runKernelFunc(function(F){return F.maxPoolBackprop(I,D,O,L)},{$dy:I,$input:D})}(v,_,E,e,t,n,i)}}},"MaxPool",h,d);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function XI(r,e,t,n,i,a){var s=j(r,"x","avgPool","float32");W(Ar(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),W(u.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),a!=null&&W(rn(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=ef(u.shape,e,t,n,i,a);if(h.filterWidth===1&&h.filterHeight===1&&Pn(h.inShape,h.outShape))return s.clone();var d=$.runKernelFunc(function(m){return m.avgPool(u,h)},{x:u},function(m){return{x:function(){return function(v,y,_,E,x,T){var C=j(v,"dy","avgPoolBackprop"),A=j(y,"input","avgPoolBackprop");W(A.rank===C.rank,function(){return"Rank of input ("+A.rank+") does not match rank of dy ("+C.rank+")"}),W(Ar(E,x),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+x+"'"});var R=A,k=C,B=!1;A.rank===3&&(B=!0,R=A.as4D(1,A.shape[0],A.shape[1],A.shape[2]),k=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),W(k.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),W(R.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var P=ef(R.shape,_,E,x,T),I=$.runKernelFunc(function(D){return D.avgPoolBackprop(k,R,P)},{dy4D:k,input4D:R});return B?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}(m,u,e,t,n,i)}}},"AvgPool",h);return d=d.cast(s.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var On=K({maxPool_:function(r,e,t,n,i){return KI(r,e,t,1,n,i)}}),xf=K({avgPool_:function(r,e,t,n,i){return XI(r,e,t,1,n,i)}}),Z9=K({pool_:function(r,e,t,n,i,a){i==null&&(i=[1,1]),a==null&&(a=1),n===0&&(n="valid");var s=j(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),W(Ar(a,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"});var h,d=ef(u.shape,e,a,i,n),m=[d.dilationHeight,d.dilationWidth];h=n==="same"?function(R,k){var B=R.map(function(D,O){return D+(D-1)*(k[O]-1)}).map(function(D){return D-1}),P=B.map(function(D){return Math.floor(D/2)}),I=B.map(function(D,O){return D-P[O]});return B.map(function(D,O){return[P[O],I[O]]})}([d.filterHeight,d.filterWidth],m):[[0,0],[0,0]];var v=m[0]===1&&m[1]===1,y=function(R,k,B){var P=B.map(function(ie){return ie[0]}),I=B.map(function(ie){return ie[1]}),D=R.concat(P,I),O=k.map(function(ie,se){return(ie-D[se]%ie)%ie}),L=I.map(function(ie,se){return ie+O[se]}),F=k.map(function(ie,se){return[P[se],L[se]]}),V=k.map(function(ie,se){return[0,O[se]]});return[F,V]}([d.inHeight,d.inWidth],m,h),_=y[0],E=y[1],x=v?n:"valid",T=v?u:eI(u,m,_),C=(t==="avg"?function(){return XI(T,e,a,1,x)}:function(){return KI(T,e,a,1,x)})(),A=v?C:QR(C,m,E);return c?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),J9=K({maxPool3d_:function(r,e,t,n,i,a,s){a===void 0&&(a="NDHWC");var u=j(r,"x","maxPool3d"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),W(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),W(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),W(Ar(t,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),i!=null&&W(rn(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var d=hm(c.shape,e,t,s,n,i,a),m=$.runKernelFunc(function(v,y){var _=v.maxPool3d(c,d);return y([c,_]),_},{x:c},function(v,y){var _=y[0],E=y[1];return{x:function(){return function(x,T,C,A,R,k,B,P){var I=j(x,"dy","maxPool3dBackprop"),D=j(T,"input","maxPool3dBackprop"),O=j(C,"output","maxPool3dBackprop"),L=I,F=D,V=O,ie=!1;D.rank===4&&(ie=!0,L=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),F=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),V=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3])),W(L.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+L.rank+"."}),W(F.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+F.rank+"."}),W(V.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+V.rank+"."}),k==null&&(k=[1,1,1]),W(Ar(R,k),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+R+" and dilations '"+k+"'"}),P!=null&&W(rn(B),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+P+" but got pad "+B+"."});var se=hm(F.shape,A,R,k,B,P),G=$.runKernelFunc(function(Q){return Q.maxPool3dBackprop(L,F,V,se)},{dy5D:L,input5D:F});return ie?G.as4D(G.shape[1],G.shape[2],G.shape[3],G.shape[4]):G}(v,_,E,e,t,s,n,i)}}});return h?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),eH=K({avgPool3d_:function(r,e,t,n,i,a,s){a===void 0&&(a="NDHWC");var u=j(r,"x","avgPool3d","float32"),c=u,h=!1;u.rank===4&&(h=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),s==null&&(s=[1,1,1]),W(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),W(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),W(Ar(t,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),i!=null&&W(rn(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var d=hm(c.shape,e,t,s,n,i,a),m=$.runKernelFunc(function(v){return v.avgPool3d(c,d)},{x:c},function(v){return{x:function(){return function(y,_,E,x,T,C,A){var R=j(y,"dy","avgPool3dBackprop"),k=j(_,"input","avgPool3dBackprop"),B=R,P=k,I=!1;k.rank===4&&(I=!0,B=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),P=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),W(B.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+B.rank+"."}),W(P.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),T==null&&(T=[1,1,1]),W(Ar(x,T),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+T+"'"}),A!=null&&W(rn(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+C+"."});var D=hm(P.shape,E,x,T,C,A),O=$.runKernelFunc(function(L){return L.avgPool3dBackprop(B,P,D)},{dy5D:B,input5D:P});return I?O.as4D(O.shape[1],O.shape[2],O.shape[3],O.shape[4]):O}(v,c,e,t,s,n,i)}}});return m=m.cast(c.dtype),h?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),pa=K({slice_:function(r,e,t){var n,i,a=j(r,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach(function(c){W(c!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map(function(c,h){return c>=0?c:(W(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+h+"."}),a.shape[h]-n[h])}),R5(a,n,i);var s=a.shape,u={begin:n,size:i};return $.runKernelFunc(function(c){return c.slice(a,n,i)},{x:a},function(c){for(var h=[],d=0;d<c.rank;d++)h.push([n[d],s[d]-n[d]-i[d]]);return{x:function(){return c.pad(h)}}},"Slice",u)}}),tH=K({slice1d_:function(r,e,t){var n=j(r,"x","slice1d");return W(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),pa(n,[e],[t])}}),nH=K({slice2d_:function(r,e,t){var n=j(r,"x","slice2d");return W(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),pa(n,e,t)}}),$I=K({slice3d_:function(r,e,t){var n=j(r,"x","slice3d");return W(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),pa(n,e,t)}}),rH=K({slice4d_:function(r,e,t){var n=j(r,"x","slice4d");return W(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),pa(n,e,t)}});function YI(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(Cr(e.shape,n))),r.rank<t.rank&&(r=r.reshape(Cr(r.shape,n))),{x:function(){var a=r.mul(t.equal(e).cast(r.dtype));return i==null?a:a.transpose(i)}}}var iH=K({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","all","bool"),i=An(e,n.shape),a=i,s=ga(a,n.rank);s!=null&&(n=n.transpose(s),a=ya(a.length,n.rank));var u=$.runKernelFunc(function(h){return h.all(n,a)},{$x:n});if(t){var c=Cr(u.shape,i);return u.reshape(c)}return u}}),aH=K({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","any","bool"),i=An(e,n.shape),a=i,s=ga(a,n.rank);s!=null&&(n=n.transpose(s),a=ya(a.length,n.rank));var u=$.runKernelFunc(function(h){return h.any(n,a)},{$x:n});if(t){var c=Cr(u.shape,i);return u.reshape(c)}return u}}),oH=K({argMax_:function(r,e){e===void 0&&(e=0);var t=j(r,"x","argMax");e==null&&(e=0);var n=An(e,t.shape),i=ga(n,t.rank);i!=null&&(t=t.transpose(i),n=ya(n.length,t.rank));var a={axis:n[0]},s=[t];return $.runKernelFunc(function(u,c){var h=u.argMax(t,n[0]);return c([t]),h},{x:t},function(u,c){var h=c[0];return{x:function(){return gt(h)}}},"ArgMax",a,s)}}),sH=K({argMin_:function(r,e){e===void 0&&(e=0);var t=j(r,"x","argMin");e==null&&(e=0);var n=An(e,t.shape),i=ga(n,t.rank);return i!=null&&(t=t.transpose(i),n=ya(n.length,t.rank)),$.runKernelFunc(function(a,s){var u=a.argMin(t,n[0]);return s([t]),u},{$x:t},function(a,s){var u=s[0];return{$x:function(){return gt(u)}}})}}),uH=K({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","logSumExp"),i=An(e,n.shape),a=n.max(i,!0),s=n.sub(a).exp().sum(i).log(),u=a.reshape(s.shape).add(s);if(t){var c=Cr(u.shape,i);return u.reshape(c)}return u}}),nv=K({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","max"),i=n,a=An(e,n.shape),s=a,u=ga(s,n.rank);u!=null&&(n=n.transpose(u),s=ya(s.length,n.rank));var c=[n],h=$.runKernelFunc(function(m,v){var y=m.max(n,s);return v([i,y]),y},{x:n},function(m,v){return YI(m,v[1],v[0],a,u)},"Max",{axes:s},c,[!0]);if(t){var d=Cr(h.shape,a);h=h.reshape(d)}return h}}),lH=K({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","mean"),i=An(e,n.shape),a=Oe(er(n.shape,i)[1]);return Qm(function(s){var u=Ce(a);return{value:(u.dtype===s.dtype?s:s.cast(u.dtype)).div(u).sum(e,t),gradFunc:function(c){var h=s.shape.slice();return i.forEach(function(d){h[d]=1}),c.reshape(h).mul(cc(s.shape,"float32")).div(a)}}})(n)}}),cH=K({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","min"),i=n,a=An(e,n.shape),s=a,u=ga(s,n.rank);u!=null&&(n=n.transpose(u),s=ya(s.length,n.rank));var c=[n],h=$.runKernelFunc(function(m,v){var y=m.min(n,s);return v([i,y]),y},{x:n},function(m,v){return YI(m,v[1],v[0],a,u)},"Min",{axes:s},c,[!0]);if(t){var d=Cr(h.shape,a);h=h.reshape(d)}return h}}),hH=K({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=An(e,(r=j(r,"x","moments")).shape),i=r.mean(n,t),a=i.shape;t||(a=Cr(i.shape,n));var s=r.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:s.mean(n,t)}}}),QI=K({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=An(e,n.shape);return Qm(function(a){var s=ga(i,a.rank),u=i,c=a;s!=null&&(c=a.transpose(s),u=ya(u.length,a.rank));var h=function(y){var _=a.shape.slice();return i.forEach(function(E){_[E]=1}),y.reshape(_).mul(cc(a.shape,"float32"))},d={axes:u},m=$.runKernelFunc(function(y){return y.sum(c,u)},{x:c},function(y){return{x:function(){return h(y)}}},"Sum",d);if(t){var v=Cr(m.shape,i);m=m.reshape(v)}return{value:m,gradFunc:h}})(n)}}),fH=K({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=j(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=An(e,n.shape),a=ga(i,n.rank),s=i,u=n;a!=null&&(u=n.transpose(a),s=ya(s.length,n.rank));var c=$.runKernelFunc(function(d){return d.prod(u,s)},{permutedX:u});if(t){var h=Cr(c.shape,i);c=c.reshape(h)}return c}}),ZI=K({elu_:function(r){var e=j(r,"x","elu");return $.runKernelFunc(function(t,n){var i=t.elu(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return $.runKernelFunc(function(a){return a.eluDer(t,i)},{dy:t,y:i})}}})}}),dH=K({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=j(r,"x","leakyRelu");return T_(Ce(e).mul(t),t)}}),JI=K({prelu_:function(r,e){var t=j(r,"x","prelu"),n=j(e,"alpha","prelu");return $.runKernelFunc(function(i,a){var s=i.prelu(t,n);return a([t,n]),s},{x:t,alpha:n},function(i,a){var s=a[0],u=a[1],c=s.greater(0);return{x:function(){return mu(c,i,i.mul(u))},alpha:function(){var h=mu(c,gt(i),i.mul(s)),d=Sn(u.shape,i.shape);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)}}},"Prelu")}}),Kt=K({relu_:function(r){var e=j(r,"x","relu");return e.dtype==="bool"?e.toInt():$.runKernelFunc(function(t,n){var i=t.relu(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),eD=K({relu6_:function(r){var e=j(r,"x","relu6");return e.dtype==="bool"?e.toInt():$.runKernelFunc(function(t,n){var i=t.relu6(e);return n([e]),i},{x:e},function(t,n){var i=n[0],a=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(a.toFloat())}}},"Relu6")}}),pH=K({selu_:function(r){var e=j(r,"x","selu");return $.runKernelFunc(function(t,n){var i=t.selu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){var a=i.greater(Ce(0)),s=Ce(w_),u=Ce(x_),c=t.mul(u),h=t.mul(s).mul(i.toFloat().exp());return mu(a,c,h)}}})}}),cs=K({transpose_:function(r,e){var t=j(r,"x","transpose");if(e==null&&(e=t.shape.map(function(i,a){return a}).reverse()),W(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){W(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var n={perm:e};return $.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var a=h_(e);return{x:function(){return i.transpose(a)}}},"Transpose",n)}}),mH=K({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var a=j(r,"x","localResponseNormalization");W(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),W(rn(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=$.runKernelFunc(function(h,d){var m=h.localResponseNormalization4D(s,e,t,n,i);return d([s,m]),m},{x4D:s},function(h,d){var m=d[0],v=d[1];return{x4D:function(){return $.runKernelFunc(function(y){return y.LRNGrad(h,m,v,e,t,n,i)},{})}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),tD=K({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=function u(c,h,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return u(c.reshape([-1]),h,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(h===1)return c.abs().sum(d);if(h===1/0)return c.abs().max(d);if(h===-1/0)return c.abs().min(d);if(h==="euclidean"||h===2)return c.abs().pow(Ce(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(d)&&d.length===2){if(h===1)return c.abs().sum(d[0]).max(d[1]-1);if(h===1/0)return c.abs().sum(d[1]).max(d[0]);if(h===-1/0)return c.abs().sum(d[1]).min(d[0]);if(h==="fro"||h==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+d)}(r=j(r,"x","norm"),e,t),a=i.shape;if(n){var s=An(t,r.shape);a=Cr(i.shape,s)}return i.reshape(a)}}),vH=K({basicLSTMCell_:function(r,e,t,n,i,a){var s=j(r,"forgetBias","basicLSTMCell"),u=j(e,"lstmKernel","basicLSTMCell"),c=j(t,"lstmBias","basicLSTMCell"),h=j(n,"data","basicLSTMCell"),d=j(i,"c","basicLSTMCell"),m=j(a,"h","basicLSTMCell"),v=h.concat(m,1).matMul(u).add(c),y=v.shape[0],_=v.shape[1]/4,E=[y,_],x=v.slice([0,0],E),T=v.slice([0,_],E),C=v.slice([0,2*_],E),A=v.slice([0,3*_],E),R=x.sigmoid().mulStrict(T.tanh()).addStrict(d.mulStrict(s.add(C).sigmoid())),k=R.tanh().mulStrict(A.sigmoid());return[R,k]}}),gH=K({multiRNNCell_:function(r,e,t,n){for(var i=j(e,"data","multiRNNCell"),a=am(t,"c","multiRNNCell"),s=am(n,"h","multiRNNCell"),u=i,c=[],h=0;h<r.length;h++){var d=r[h](u,a[h],s[h]);c.push(d[0]),c.push(d[1]),u=d[1]}var m=[],v=[];for(h=0;h<c.length;h+=2)m.push(c[h]),v.push(c[h+1]);return[m,v]}}),yH=K({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var a=j(r,"v","movingAverage"),s=j(e,"x","movingAverage"),u=j(t,"decay","movingAverage");m6(a,s),W(Pn(a.shape,s.shape),function(){return"Shape mismatch in v and x"});var c=Ce(1),h=c.sub(u),d=s.sub(a).mul(h);if(i){W(n!=null,function(){return"When using zeroDebias: true, step is required."});var m=j(n,"step","movingAverage");d=d.div(c.sub(mm(u,m)))}return a.add(d)}}),bH=K({stridedSlice_:function(r,e,t,n,i,a,s,u,c){if(i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),c===void 0&&(c=0),n==null&&(n=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var h=j(r,"x","stridedSlice"),d=IT(u),m=h.shape.slice();d.forEach(function(x){e[x]=0,t[x]=1,m.splice(x,0,1)}),h=h.reshape(m);for(var v=0;v<h.rank;v++)e[v]=I5(i,e,n,h.shape,v),t[v]=D5(a,t,n,h.shape,v),n[v]=n[v]||1;var y=IT(c);y.forEach(function(x){t[x]=e[x]+1,n[x]=1});var _=m_(e,t,n),E=_.filter(function(x,T){return y.indexOf(T)===-1});return n.every(function(x){return x===1})?pa(h,e,_).reshape(E):$.runKernelFunc(function(x){return x.stridedSlice(h,e,t,n)},{$x:h}).reshape(E)}}),_H=K({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=j(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var a=$.runKernelFunc(function(s){return s.topk(n,e,t)},{$x:n});return{values:a[0],indices:a[1]}}}),wH=K({scatterND_:function(r,e,t){var n=j(r,"indices","scatterND","int32"),i=j(e,"updates","scatterND");return A5(i,n,t),$.runKernelFunc(function(a){return a.scatterND(n,i,t)},{indices:n,updates:i},null,"ScatterNd",{shape:t})}}),R_=K({fft_:function(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return $.runKernelFunc(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),vm=K({ifft_:function(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return $.runKernelFunc(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),I_=K({rfft_:function(r,e){W(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var a=r.shape.map(function(T){return 0}),s=r.shape.map(function(T){return T});s[r.shape.length-1]=e,t=r.slice(a,s),n=e}else if(e!=null&&e>n){var u=r.shape.map(function(T){return T});u[r.shape.length-1]=e-n,t=r.concat(Bt(u),r.shape.length-1),n=e}else t=r;var c=t.zerosLike(),h=Hn(t,c).as2D(i,n),d=R_(h),m=Math.floor(n/2)+1,v=si(d),y=ta(d),_=v.split([m,n-m],v.shape.length-1),E=y.split([m,n-m],y.shape.length-1),x=t.shape.slice();return x[t.shape.length-1]=m,Hn(_[0],E[0]).reshape(x)}}),nD=K({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=vm(n);return si(i)}var a=[t,2*(e-1)],s=si(r).as2D(t,e),u=ta(r).as2D(t,e),c=s.slice([0,1],[t,e-2]).reverse(1),h=u.slice([0,1],[t,e-2]).reverse(1).mul(Ce(-1)),d=s.concat(c,1),m=u.concat(h,1);return n=Hn(d,m).as2D(a[0],a[1]),i=vm(n),si(i)}}),xH=Object.freeze({fft:R_,ifft:vm,rfft:I_,irfft:nD}),EH=K({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=j(r,"sparseIndices","sparseToDense","int32"),a=j(e,"sparseValues","sparseToDense"),s=j(n,"defaultValue","sparseToDense",a.dtype);return function(u,c,h,d){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var m=u.rank>0?u.shape[0]:1,v=u.rank>1?u.shape[1]:1;if(h.length!==v)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+v+".");var y=c.size;if(c.rank!==0&&(c.rank!==1||y!==m))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+m+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,t,s),$.runKernelFunc(function(u){return u.sparseToDense(i,a,t,s)},{$sparseIndices:i,$sparseValues:a,$defaultValue:s})}}),TH=K({gatherND_:function(r,e){var t=j(e,"indices","gatherND","int32"),n=j(r,"x","gatherND");return $.runKernelFunc(function(i){return i.gatherND(n,t)},{x:n,indices:t},null,"GatherNd")}}),SH=K({diag_:function(r){var e=j(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return $.runKernelFunc(function(n){return n.diag(e)},{$x:e}).reshape(t)}}),CH=K({dropout_:function(r,e,t,n){var i=j(r,"x","dropout");if(W(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),W(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Gt?i.clone():i;var a=function(c,h){if(h==null)return c.shape.slice();if(Pn(c.shape,h))return h;if(c.shape.length===h.length){for(var d=[],m=0;m<c.shape.length;m++)h[m]==null&&c.shape[m]!=null?d.push(c.shape[m]):d.push(h[m]);return d}return h}(i,t),s=1-e,u=JR(a,0,1,"float32",n).add(s).floor().div(s);return i.mul(u)}});function rD(r,e,t){for(var n=1-r%2,i=new Float32Array(r),a=0;a<r;++a){var s=2*Math.PI*a/(r+n-1);i[a]=e-t*Math.cos(s)}return hn(i,"float32")}var D_=K({hannWindow_:function(r){return rD(r,.5,.5)}}),iD=K({hammingWindow_:function(r){return rD(r,.54,.46)}}),N_=K({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var a=0,s=[];a+e<=r.size;)s.push(pa(r,a,e)),a+=t;if(n)for(;a<r.size;){var u=a+e-r.size,c=xn([pa(r,a,e-u),la([u],i)]);s.push(c),a+=t}return s.length===0?es([],[0,e]):xn(s).as2D(s.length,e)}}),aD=K({stft_:function(r,e,t,n,i){var a;i===void 0&&(i=D_),n==null&&(a=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var s=N_(r,e,t),u=ar(s,i(e)),c=[],h=0;h<s.shape[0];h++)c.push(I_(u.slice([h,0],[1,e]),n));return xn(c)}}),AH=Object.freeze({hannWindow:D_,hammingWindow:iD,frame:N_,stft:aD}),ir,RH=function(r,e,t){return t===void 0&&(t=1),De(this,void 0,void 0,function(){var n,i,a,s,u,c,h,d,m,v,y,_,E,x;return Ne(this,function(T){switch(T.label){case 0:return n=j(r,"predictions","inTopK"),i=j(e,"targets","inTopK"),W(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),W(n.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank}),St(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],W(t>0&&t<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t}),[4,n.data()];case 1:return s=T.sent(),[4,i.data()];case 2:for(u=T.sent(),c=[s.length/a,a],d=c[1],m=Qh("bool",h=c[0]),v=0;v<h;v++){for(y=v*d,_=s.subarray(y,y+d),E=[],x=0;x<_.length;x++)E.push({value:_[x],index:x});for(E.sort(function(C,A){return A.value-C.value}),m[v]=0,x=0;x<t;x++)if(E[x].index===u[v]){m[v]=1;break}}return r!==n&&n.dispose(),e!==i&&i.dispose(),[2,Gn(m,i.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ir||(ir={}));var IH=K({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","absoluteDifference"),a=j(e,"predictions","absoluteDifference"),s=null;t!=null&&(s=j(t,"weights","absoluteDifference")),St(i.shape,a.shape,"Error in absoluteDifference: ");var u=i.sub(a).abs();return uo(u,s,n)}}),uo=K({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=ir.SUM_BY_NONZERO_WEIGHTS);var n=j(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=j(e,"weights","computeWeightedLoss"));var a=i==null?n:n.mul(i);if(t===ir.NONE)return a;if(t===ir.SUM)return a.sum();if(t===ir.MEAN){if(i==null)return a.mean();var s=n.size/i.size,u=a.sum().div(i.sum());return s>1?u.div(Ce(s)):u}if(t===ir.SUM_BY_NONZERO_WEIGHTS){if(i==null)return a.sum().div(Ce(n.size));var c=i.mul(cc(n.shape)).notEqual(Ce(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+t)}}),DH=K({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=ir.SUM_BY_NONZERO_WEIGHTS);var a=j(r,"labels","cosineDistance"),s=j(e,"predictions","cosineDistance"),u=null;n!=null&&(u=j(n,"weights","cosineDistance")),St(a.shape,s.shape,"Error in cosineDistance: ");var c=Ce(1).sub(a.mul(s).sum(t,!0));return uo(c,u,i)}}),NH=K({hingeLoss_:function(r,e,t,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","hingeLoss"),a=j(e,"predictions","hingeLoss"),s=null;t!=null&&(s=j(t,"weights","hingeLoss")),St(i.shape,a.shape,"Error in hingeLoss: ");var u=Ce(1);i=Ce(2).mul(i).sub(u);var c=u.sub(i.mul(a)).relu();return uo(c,s,n)}}),kH=K({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=ir.SUM_BY_NONZERO_WEIGHTS);var a=j(r,"labels","huberLoss"),s=j(e,"predictions","huberLoss"),u=null;t!=null&&(u=j(t,"weights","huberLoss")),St(a.shape,s.shape,"Error in huberLoss: ");var c=Ce(n),h=s.sub(a).abs(),d=BI(h,c),m=h.sub(d),v=Ce(.5).mul(d.square()).add(c.mul(m));return uo(v,u,i)}}),OH=K({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=ir.SUM_BY_NONZERO_WEIGHTS);var a=j(r,"labels","logLoss"),s=j(e,"predictions","logLoss"),u=null;t!=null&&(u=j(t,"weights","logLoss")),St(a.shape,s.shape,"Error in logLoss: ");var c=Ce(1),h=Ce(n),d=a.mul(s.add(h).log()).neg().sub(c.sub(a).mul(c.sub(s).add(h).log()));return uo(d,u,i)}}),MH=K({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=ir.SUM_BY_NONZERO_WEIGHTS);var i=j(r,"labels","meanSquaredError"),a=j(e,"predictions","meanSquaredError"),s=null;t!=null&&(s=j(t,"weights","meanSquaredError")),St(i.shape,a.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(a);return uo(u,s,n)}}),PH=K({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=ir.SUM_BY_NONZERO_WEIGHTS);var a=j(r,"multiClassLabels","sigmoidCrossEntropy"),s=j(e,"logits","sigmoidCrossEntropy"),u=null;if(t!=null&&(u=j(t,"weights","sigmoidCrossEntropy")),St(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),n>0){var c=Ce(n),h=Ce(1),d=Ce(.5);a=a.mul(h.sub(c)).add(d.mul(c))}var m=function(v,y){var _=j(v,"labels","sigmoidCrossEntropyWithLogits"),E=j(y,"logits","sigmoidCrossEntropyWithLogits");St(_.shape,E.shape,"Error in sigmoidCrossEntropyWithLogits: ");var x=E.relu(),T=E.mul(_),C=E.abs().neg().exp().log1p();return x.sub(T).add(C)}(a,s);return uo(m,u,i)}}),LH=K({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=ir.SUM_BY_NONZERO_WEIGHTS);var a=j(r,"onehotLabels","softmaxCrossEntropy"),s=j(e,"logits","softmaxCrossEntropy"),u=null;if(t!=null&&(u=j(t,"weights","softmaxCrossEntropy")),St(a.shape,s.shape,"Error in softmaxCrossEntropy: "),n>0){var c=Ce(n),h=Ce(1),d=Ce(a.shape[1]);a=a.mul(h.sub(c)).add(c.div(d))}var m=function(v,y,_){if(_===void 0&&(_=-1),_===-1&&(_=y.rank-1),_!==y.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+y.rank+" and dim was "+_);return Qm(function(E,x,T){var C=x.logSumExp([_],!0),A=x.toFloat().sub(C);return T([E,A]),{value:A.mul(E).neg().sum([_]),gradFunc:function(R,k){var B=k[0],P=k[1],I=Cr(R.shape,[_]);return[R.reshape(I).mul(B.toFloat().sub(P.exp())),R.reshape(I).mul(P.exp().sub(B.toFloat()))]}}})(v,y)}(a,s);return uo(m,u,i)}}),FH=Object.freeze({get Reduction(){return ir},absoluteDifference:IH,computeWeightedLoss:uo,cosineDistance:DH,hingeLoss:NH,huberLoss:kH,logLoss:OH,meanSquaredError:MH,sigmoidCrossEntropy:PH,softmaxCrossEntropy:LH});function QT(r,e){return e===void 0&&(e=!1),$.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=ZR(t),a=r.clone(),s=es([[1]],[1,1]),u=s.clone(),c=t>=n?n:t,h=function(m){var v,y=a,_=u,E=i;v=$.tidy(function(){var x=a.slice([m,m],[t-m,1]),T=x.norm(),C=a.slice([m,m],[1,1]),A=es([[-1]]).where(C.greater(0),es([[1]])),R=C.sub(A.mul(T)),k=x.div(R);u=k.shape[0]===1?s.clone():s.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var B=A.matMul(R).div(T).neg(),P=a.slice([m,0],[t-m,n]),I=B.mul(u);if(m===0)a=P.sub(I.matMul(u.transpose().matMul(P)));else{var D=P.sub(I.matMul(u.transpose().matMul(P)));a=a.slice([0,0],[m,n]).concat(D,0)}var O=i.slice([0,m],[t,i.shape[1]-m]);if(m===0)i=O.sub(O.matMul(u).matMul(I.transpose()));else{var L=O.sub(O.matMul(u).matMul(I.transpose()));i=i.slice([0,0],[t,m]).concat(L,1)}return[u,a,i]}),u=v[0],a=v[1],i=v[2],Sr([y,_,E])},d=0;d<c;++d)h(d);return!e&&t>n&&(i=i.slice([0,0],[t,n]),a=a.slice([0,0],[n,n])),[i,a]})}var BH=K({bandPart_:function(r,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var n=j(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var i=n.shape,a=n.shape.slice(-2),s=a[0],u=a[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=u))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+u+").");e<0&&(e=s),t<0&&(t=u);var c=om(0,s,1,"int32").reshape([-1,1]),h=om(0,u,1,"int32"),d=Cn(c,h),m=Jm(d.lessEqual(Ce(+e,"int32")),d.greaterEqual(Ce(-t,"int32"))),v=Bt([s,u],n.dtype);return qr(En(n.reshape([-1,s,u])).map(function(y){return mu(m,y,v)})).reshape(i)}}),VH=K({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,W(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(c){W(r[c].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[c].shape[0]+" vs. "+t+")"})},i=1;i<r.length;++i)n(i)}else e=!0,r=d_(r,r.shape[0],0).map(function(c){return tI(c,[0])});W(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var a=[],s=r,u=function(c){a.push($.tidy(function(){var h=s[c];if(c>0)for(var d=0;d<c;++d){var m=QI(a[d].mulStrict(h)).mul(a[d]);h=h.sub(m)}return h.div(tD(h,"euclidean"))}))};for(i=0;i<r.length;++i)u(i);return e?qr(a,0):a}}),UH=K({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return QT(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(s,u){return s*u}),n=En(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],a=[];return n.forEach(function(s){var u=QT(s,e),c=u[0],h=u[1];i.push(c),a.push(h)}),[qr(i,0).reshape(r.shape),qr(a,0).reshape(r.shape)]}}),zH=Object.freeze({bandPart:BH,gramSchmidt:VH,qr:UH});function rv(r,e,t,n,i,a){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY),a==null&&(a=0);var s=r.shape[0];return t=Math.min(t,s),W(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),W(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),W(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),W(e.rank===1,function(){return"scores must be a 1D tensor"}),W(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),W(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i,softNmsSigma:a}}var jH=K({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=j(r,"images","resizeBilinear");W(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),W(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e[0],u=e[1],c=$.runKernelFunc(function(h,d){return d([i]),h.resizeBilinear(i,s,u,t)},{x:i},function(h,d){return{x:function(){return $.runKernelFunc(function(m){return m.resizeBilinearBackprop(h,d[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:u});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),HH=K({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=j(r,"images","resizeNearestNeighbor");W(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),W(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),W(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e[0],u=e[1],c=$.runKernelFunc(function(h,d){return d([i]),h.resizeNearestNeighbor(i,s,u,t)},{batchImages:i},function(h,d){return{batchImages:function(){return $.runKernelFunc(function(m){return m.resizeNearestNeighborBackprop(h,d[0],t)},{})}}});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),WH=K({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var a=j(r,"boxes","nonMaxSuppression"),s=j(e,"scores","nonMaxSuppression"),u=rv(a,s,t,n,i);t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold;var c={maxOutputSize:t,iouThreshold:n,scoreThreshold:i};return $.runKernelFunc(function(h){return h.nonMaxSuppression(a,s,t,n,i)},{boxes:a,scores:s},null,"NonMaxSuppressionV3",c)}}),qH=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),De(this,void 0,void 0,function(){var a,s,u,c,h,d,m;return Ne(this,function(v){switch(v.label){case 0:return a=j(r,"boxes","nonMaxSuppressionAsync"),s=j(e,"scores","nonMaxSuppressionAsync"),u=rv(a,s,t,n,i),t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([a.data(),s.data()])];case 1:return c=v.sent(),h=c[0],d=c[1],m=g_(h,d,t,n,i),a!==r&&a.dispose(),s!==e&&s.dispose(),[2,m]}})})},GH=K({nonMaxSuppressionWithScore_:function(r,e,t,n,i,a){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var s=j(r,"boxes","nonMaxSuppression"),u=j(e,"scores","nonMaxSuppression"),c=rv(s,u,t,n,i,a),h={maxOutputSize:t=c.maxOutputSize,iouThreshold:n=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:a=c.softNmsSigma},d=$.runKernel("NonMaxSuppressionV5",{boxes:s,scores:u},h);return{selectedIndices:d[0],selectedScores:d[1]}}}),KH=function(r,e,t,n,i,a){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),De(this,void 0,void 0,function(){var s,u,c,h,d,m,v;return Ne(this,function(y){switch(y.label){case 0:return s=j(r,"boxes","nonMaxSuppressionAsync"),u=j(e,"scores","nonMaxSuppressionAsync"),c=rv(s,u,t,n,i,a),t=c.maxOutputSize,n=c.iouThreshold,i=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([s.data(),u.data()])];case 1:return h=y.sent(),d=h[0],m=h[1],v=y_(d,m,t,n,i,a),s!==r&&s.dispose(),u!==e&&u.dispose(),[2,v]}})})},XH=K({cropAndResize_:function(r,e,t,n,i,a){var s=j(r,"image","cropAndResize"),u=j(e,"boxes","cropAndResize","float32"),c=j(t,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var h=u.shape[0];return W(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),W(u.rank===2&&u.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."}),W(c.rank===1&&c.shape[0]===h,function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."}),W(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),W(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),W(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),$.runKernelFunc(function(d,m){return d.cropAndResize(s,u,c,n,i,a)},{images:s,boxes:u,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:n})}}),k_=Object.freeze({resizeBilinear:jH,resizeNearestNeighbor:HH,nonMaxSuppression:WH,nonMaxSuppressionAsync:qH,nonMaxSuppressionWithScore:GH,nonMaxSuppressionWithScoreAsync:KH,cropAndResize:XH}),O_=function(r,e){return!(r>0)||e==="linear"},M_=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},P_=function(r,e){var t=e,n=Sn(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},L_=function(r,e,t){if(e==="linear")return r;if(e==="relu")return Kt(r);if(e==="elu")return ZI(r);if(e==="relu6")return eD(r);if(e==="prelu")return JI(r,t);throw new Error("Unknown fused activation "+e+".")},$H=K({fusedMatMul_:function(r){var e,t=r.a,n=r.b,i=r.transposeA,a=i!==void 0&&i,s=r.transposeB,u=s!==void 0&&s,c=r.bias,h=r.activation,d=h===void 0?"linear":h,m=r.preluActivationWeights;if(O_($.state.gradientDepth,d)===!1){var v=tv(t,n,a,u);return c!=null&&(v=at(v,c)),L_(v,d,m)}var y=j(t,"a","fused matMul"),_=j(n,"b","fused matMul");e=$t(y,_),y=e[0],_=e[1];var E=a?y.shape[y.rank-2]:y.shape[y.rank-1],x=u?_.shape[_.rank-1]:_.shape[_.rank-2],T=a?y.shape[y.rank-1]:y.shape[y.rank-2],C=u?_.shape[_.rank-2]:_.shape[_.rank-1],A=y.shape.slice(0,-2),R=_.shape.slice(0,-2),k=Oe(A),B=Oe(R);W(y.rank>=2&&_.rank>=2&&y.rank===_.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+y.rank+" and "+_.rank+"."}),W(Pn(A,R),function(){return"Error in fused matMul: outer dimensions ("+A+") and ("+R+") of Tensors with shapes "+y.shape+" and "+_.shape+" must match."}),W(E===x,function(){return"Error in fused matMul: inner shapes ("+E+") and ("+x+") of Tensors with shapes "+y.shape+" and "+_.shape+" and transposeA="+a+" and transposeB="+u+" must match."});var P,I,D=y.shape.slice(0,-2).concat([T,C]),O=a?y.as3D(k,E,T):y.as3D(k,T,E),L=u?_.as3D(B,C,x):_.as3D(B,x,C);c!=null&&ut(D,(P=$t(P=j(c,"bias","fused matMul"),y)[0]).shape),m!=null&&(I=j(m,"prelu weights","fused matMul"));var F={a:O,b:L};c!=null&&(F.bias=P),m!=null&&(F.preluActivationWeights=I);var V=[O,L];return $.runKernelFunc(function(ie,se){var G=ie.fusedBatchMatMul({a:O,b:L,transposeA:a,transposeB:u,bias:P,activation:d,preluActivationWeights:I});return se([O,L,G]),G},F,function(ie,se){var G=se[0],Q=se[1],te=se[2],de=M_(ie,te,d),H={};return c!=null&&(H={bias:function(){return P_(P,de)}}),Object.assign(a||u?!a&&u?{a:function(){return de.matMul(Q,!1,!1)},b:function(){return de.matMul(G,!0,!1)}}:a&&!u?{a:function(){return Q.matMul(de,!1,!0)},b:function(){return G.matMul(de,!1,!1)}}:{a:function(){return Q.matMul(de,!0,!0)},b:function(){return de.matMul(G,!0,!0)}}:{a:function(){return de.matMul(Q,!1,!0)},b:function(){return G.matMul(de,!0,!1)}},H)},"_FusedMatMul",{transposeA:a,transposeB:u,activation:d},V,[!0]).reshape(D)}}),YH=K({fusedConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,s=a===void 0?"NHWC":a,u=r.dilations,c=u===void 0?[1,1]:u,h=r.dimRoundingMode,d=r.bias,m=r.activation,v=m===void 0?"linear":m,y=r.preluActivationWeights;if(v=v||"linear",O_($.state.gradientDepth,v)===!1){var _=hi(e,t,n,i,s,c,h);return d!=null&&(_=at(_,d)),L_(_,v,y)}var E=j(e,"x","conv2d"),x=j(t,"filter","conv2d"),T=E,C=!1;E.rank===3&&(C=!0,T=E.as4D(1,E.shape[0],E.shape[1],E.shape[2])),W(T.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+T.rank+"."}),W(x.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+x.rank+"."}),h!=null&&W(rn(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+i+"."}),W(T.shape[3]===x.shape[2],function(){return"Error in conv2d: depth of input ("+T.shape[3]+") must match input depth for filter "+x.shape[2]+"."}),W(Ar(n,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+c+"'"}),W(s==="NHWC",function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var A,R,k=Eu(T.shape,x.shape,n,c,i,h);d!=null&&(A=$t(A=j(d,"bias","fused conv2d"),E)[0],ut(k.outShape,A.shape)),y!=null&&(R=j(y,"prelu weights","fused conv2d"));var B={x:T,filter:x};d!=null&&(B.bias=A),y!=null&&(B.preluActivationWeights=R);var P=[x,T],I=$.runKernelFunc(function(D,O){var L=D.fusedConv2d({input:T,filter:x,convInfo:k,bias:A,activation:v,preluActivationWeights:R});return O([x,T,L]),L},B,function(D,O){var L=O,F=L[0],V=L[1],ie=L[2],se=M_(D,ie,v);W(Zl(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var G={};return d!=null&&(G={bias:function(){return P_(A,se)}}),Object.assign({x:function(){return WI(V.shape,se,F,n,i)},filter:function(){return C_(V,se,F.shape,n,i)}},G)},"FusedConv2D",{convInfo:k,activation:v},P,[!0]);return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),QH=K({fusedDepthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,s=a===void 0?"NHWC":a,u=r.dilations,c=u===void 0?[1,1]:u,h=r.dimRoundingMode,d=r.bias,m=r.activation,v=m===void 0?"linear":m,y=r.preluActivationWeights;if(O_($.state.gradientDepth,v)===!1){var _=ev(e,t,n,i,s,c,h);return d!=null&&(_=at(_,d)),L_(_,v,y)}var E=j(e,"x","depthwiseConv2d"),x=j(t,"filter","depthwiseConv2d"),T=E,C=!1;E.rank===3&&(C=!0,T=E.as4D(1,E.shape[0],E.shape[1],E.shape[2])),W(T.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+T.rank+"."}),W(x.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+x.rank+"."}),W(T.shape[3]===x.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+T.shape[3]+") must match the inChannels dimension in filter "+x.shape[2]+"."}),c==null&&(c=[1,1]),W(Ar(n,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+c+"'"}),h!=null&&W(rn(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+i+"."});var A,R,k=Eu(T.shape,x.shape,n,c,i,h,!0);d!=null&&(A=$t(A=j(d,"bias","fused conv2d"),E)[0],ut(k.outShape,A.shape)),y!=null&&(R=j(y,"prelu weights","fused depthwiseConv2d"));var B={x:T,filter:x};d!=null&&(B.bias=A),y!=null&&(B.preluActivationWeights=R);var P=[x,T],I=$.runKernelFunc(function(D,O){var L=D.fusedDepthwiseConv2D({input:T,filter:x,convInfo:k,bias:A,activation:v,preluActivationWeights:R});return O([x,T,L]),L},B,function(D,O){W(Zl(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var L=O[0],F=O[1],V=O[2],ie=M_(D,V,v),se={};return d!=null&&(se={bias:function(){return P_(A,ie)}}),Object.assign({x:function(){return qI(F.shape,ie,L,k)},filter:function(){return GI(F,ie,L.shape,k)}},se)},"FusedDepthwiseConv2D",{convInfo:k,activation:v},P,[!0]);return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),ZH=Object.freeze({matMul:$H,conv2d:YH,depthwiseConv2d:QH}),JH=Object.freeze({image:k_,linalg:zH,losses:FH,spectral:xH,fused:ZH,signal:AH,square:Oj,squaredDifference:RI,conv1d:j9,conv2d:hi,conv3d:H9,depthwiseConv2d:ev,separableConv2d:A_,conv2dTranspose:W9,conv3dTranspose:q9,op:K,batchNormalization2d:l9,batchNormalization3d:c9,batchNormalization4d:h9,batchNormalization:f9,batchNorm:MI,batchNorm2d:d9,batchNorm3d:p9,batchNorm4d:m9,booleanMaskAsync:z9,complex:Hn,real:si,imag:ta,concat:xn,concat1d:Z6,concat2d:J6,concat3d:e5,concat4d:t5,split:d_,matMul:tv,dot:G9,outerProduct:K9,reverse:wf,reverse1d:X9,reverse2d:$9,reverse3d:Y9,reverse4d:Q9,maxPool:On,avgPool:xf,pool:Z9,maxPool3d:J9,avgPool3d:eH,slice:pa,slice1d:tH,slice2d:nH,slice3d:$I,slice4d:rH,abs:Mj,acos:Pj,acosh:Lj,asin:Fj,asinh:Bj,atan:Vj,atanh:Uj,ceil:zj,clipByValue:E_,cos:jj,cosh:Hj,erf:Wj,exp:G0,expm1:qj,floor:Gj,log:Kj,log1p:Xj,logSigmoid:$j,neg:pm,reciprocal:Yj,round:Qj,rsqrt:II,sigmoid:DI,sign:Zj,isNaN:Jj,isInf:e9,isFinite:t9,sin:n9,sinh:r9,softplus:i9,sqrt:a9,step:o9,tan:s9,tanh:u9,all:iH,any:aH,argMax:oH,argMin:sH,logSumExp:uH,max:nv,mean:lH,min:cH,moments:hH,sum:QI,prod:fH,equal:VI,equalStrict:N9,greater:k9,greaterEqual:UI,greaterEqualStrict:O9,greaterStrict:M9,less:P9,lessEqual:L9,lessEqualStrict:F9,lessStrict:B9,notEqual:V9,notEqualStrict:U9,add:at,addN:y9,addStrict:b9,atan2:_9,div:bi,divNoNan:w9,divStrict:x9,floorDiv:FI,maximum:T_,maximumStrict:E9,minimum:BI,minimumStrict:T9,mod:S9,modStrict:C9,mul:ar,mulStrict:A9,pow:mm,powStrict:R9,squaredDifferenceStrict:I9,sub:Cn,subStrict:D9,elu:ZI,leakyRelu:dH,prelu:JI,relu:Kt,relu6:eD,selu:pH,logicalAnd:Jm,logicalNot:v9,logicalOr:PI,logicalXor:g9,where:mu,whereAsync:LI,buffer:Qe,print:c5,batchToSpaceND:QR,broadcastTo:h5,cast:f5,clone:d5,cumsum:p5,depthToSpace:m5,expandDims:oi,eye:ZR,multinomial:v5,oneHot:j0,pad:xu,pad1d:g5,pad2d:y5,pad3d:b5,pad4d:_5,rand:w5,randomNormal:x5,randomGamma:E5,randomUniform:JR,reshape:wi,spaceToBatchND:eI,squeeze:tI,stack:qr,tile:Ml,truncatedNormal:T5,unstack:En,setdiff1dAsync:S5,fill:la,linspace:Q6,ones:cc,range:om,scalar:Ce,tensor:Gn,tensor1d:hn,tensor2d:es,tensor3d:f_,tensor4d:br,tensor5d:X6,tensor6d:$6,variable:Y6,zeros:Bt,onesLike:YR,zerosLike:gt,transpose:cs,softmax:so,logSoftmax:k5,localResponseNormalization:mH,norm:tD,gather:S_,unsortedSegmentSum:zI,basicLSTMCell:vH,multiRNNCell:gH,movingAverage:yH,stridedSlice:bH,topk:_H,scatterND:wH,fft:R_,ifft:vm,rfft:I_,irfft:nD,sparseToDense:EH,gatherND:TH,diag:SH,dropout:CH,hannWindow:D_,hammingWindow:iD,frame:N_,stft:aD,inTopKAsync:RH});function _e(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&W(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function Ky(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var eW=function(r){function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new uI(t,$),t}return Ni(e,r),e.prototype.write=function(t,n,i){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&im(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:t,dtype:i}),a},e.prototype.move=function(t,n,i,a){this.data.set(t,{values:n,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),i=n.dtype,a=n.complexTensors;return i==="complex64"?q0(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),i=n;if(t.dtype==="string")try{i=n.map(function(a){return tm(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Qe(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,n,i){var a=this.write(t,n,i);return $.makeTensorFromDataId(a,n,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return De(this,void 0,void 0,function(){var n;return Ne(this,function(i){return n=Zi(),t(),[2,{kernelMs:Zi()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:$.keep(t.clone()),imag:$.keep(n.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(_e(t,"slice"),oI(t.shape,n,i)){var a=sI(n,t.strides),s=Oe(i);return Gn(this.readSync(t.dataId).subarray(a,a+s),i,t.dtype)}for(var u=Qe(i,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h).map(function(m,v){return m+n[v]});u.values[h]=c.get.apply(c,d)}return u.toTensor()},e.prototype.stridedSlice=function(t,n,i,a){_e(t,"stridedSlice");var s=m_(n,i,a);if(s.some(function(y){return y===0}))return Gn([],s);for(var u=Qe(s,t.dtype),c=this.bufferSync(t),h=0;h<u.size;h++){for(var d=u.indexToLoc(h),m=new Array(d.length),v=0;v<m.length;v++)m[v]=d[v]*a[v]+n[v];u.set.apply(u,[c.get.apply(c,m)].concat(d))}return u.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),i=Qe([t.size,t.size],t.dtype),a=i.values,s=0;s<n.length;s++)a[s*t.size+s]=n[s];return i.toTensor()},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),s=0,u=0;u<t.rank;u++)u!==n&&(a[s++]=t.shape[u]);var c=new Array(t.rank).fill(0),h=t.shape.slice();h[n]=1;var d=new Array(i);for(u=0;u<d.length;u++)c[n]=u,d[u]=this.slice(t,c,h).reshape(a);return d},e.prototype.reverse=function(t,n){_e(t,"reverse");for(var i=Qe(t.shape,t.dtype),a=this.bufferSync(t),s=function(c){var h=i.indexToLoc(c),d=h.slice();n.forEach(function(m){return d[m]=t.shape[m]-1-d[m]}),i.set.apply(i,[a.get.apply(a,d)].concat(h))},u=0;u<i.size;u++)s(u);return i.toTensor()},e.prototype.concat=function(t,n){var i=this;if(t[0].dtype==="complex64"){var a=t.map(function(y){return si(y)}),s=t.map(function(y){return ta(y)});return Hn(this.concat(a,n),this.concat(s,n))}var u=t.map(function(y){var _=Oe(y.shape.slice(n));return y.as2D(-1,_)}),c=Ql(u.map(function(y){return y.shape}),1),h=Qe(c,t[0].dtype).values;if(u[0].shape[0]===1){var d=0;u.forEach(function(y){h.set(i.readSync(y.dataId),d),d+=y.size})}else{var m=0;u.forEach(function(y){for(var _=i.readSync(y.dataId),E=0,x=0;x<y.shape[0];++x)for(var T=x*c[1]+m,C=0;C<y.shape[1];++C)h[T+C]=_[E++];m+=y.shape[1]})}var v=Ql(t.map(function(y){return y.shape}),n);return Gn(h,v,t[0].dtype)},e.prototype.neg=function(t){return _e(t,"neg"),this.multiply(Ce(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,s,u){return{real:i+s,imag:a+u}}):this.broadcastedBinaryOp(t,n,qn(t.dtype,n.dtype),function(i,a){return i+a})},e.prototype.addN=function(t){var n=this;_e(t,"addN");for(var i=t.map(function(d){return n.readSync(d.dataId)}),a=Qe(t[0].shape,t[0].dtype),s=a.values,u=0;u<t.length;u++)for(var c=i[u],h=0;h<s.length;h++)s[h]+=c[h];return a.toTensor()},e.prototype.softmax=function(t,n){var i=An([n],t.shape),a=this.max(t,i),s=Cr(a.shape,i),u=this.subtract(t,a.reshape(s)),c=this.exp(u),h=this.sum(c,i).reshape(s);return this.realDivide(c,h)},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,s,u){return{real:i-s,imag:a-u}}):this.broadcastedBinaryOp(t,n,qn(t.dtype,n.dtype),function(i,a){return i-a})},e.prototype.pow=function(t,n){return _e([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.pow(i,a)})},e.prototype.batchMatMul=function(t,n,i,a){_e([t,n],"matMul");for(var s=i?t.shape[1]:t.shape[2],u=i?t.shape[2]:t.shape[1],c=a?n.shape[1]:n.shape[2],h=t.shape[0],d=this.readSync(t.dataId),m=this.readSync(n.dataId),v=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],y=v[0],_=v[1],E=v[2],x=a?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],T=x[0],C=x[1],A=x[2],R=u*c,k=Qe([h,u,c],t.dtype),B=k.values,P=this.blockSize,I=0;I<h;I++)for(var D=0;D<u;D+=P)for(var O=0;O<c;O+=P)for(var L=0;L<s;L+=P)for(var F=Math.min(D+P,u),V=Math.min(O+P,c),ie=Math.min(L+P,s),se=D;se<F;se++)for(var G=O;G<V;G++){for(var Q=0,te=L;te<ie;te++)Q+=d[I*y+se*_+te*E]*m[te*T+G*C+I*A];B[I*R+(se*c+G)]+=Q}return k.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,s=t.transposeB,u=t.bias,c=t.activation,h=t.preluActivationWeights,d=this.batchMatMul(n,i,a,s);return u&&(d=this.add(d,u)),c&&(d=Ky(this,d,c,h)),d},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,s,u){return{real:i*s-a*u,imag:i*u+a*s}}):this.broadcastedBinaryOp(t,n,qn(t.dtype,n.dtype),function(i,a){return i*a})},e.prototype.realDivide=function(t,n){return _e([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(i,a){return i/a})},e.prototype.floorDiv=function(t,n){return _e([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(i,a){return Math.floor(i/a)})},e.prototype.sum=function(t,n){_e(t,"sum"),Fr("sum",n,t.rank);for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,qn(t.dtype,"int32")),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=0,_=0;_<c;++_)y+=d[v+_];h[m]=y}return u},e.prototype.prod=function(t,n){_e(t,"sum");for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,qn(t.dtype,"int32")),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=1,_=0;_<c;++_)y*=d[v+_];h[m]=y}return u},e.prototype.unsortedSegmentSum=function(t,n,i){_e(t,"unsortedSegmentSum");for(var a=[],s=t.rank-n.rank,u=0;u<s;++u)n=n.expandDims(u+1);for(u=0;u<i;++u){var c=Ce(u,"int32"),h=VI(c,n).asType("float32").mul(t).sum(0);a.push(h)}return qr(a)},e.prototype.argMin=function(t,n){_e(t,"argMin");var i=[n];Fr("argMin",i,t.rank);for(var a=er(t.shape,i),s=a[0],u=a[1],c=Bt(s,"int32"),h=Oe(u),d=this.readSync(c.dataId),m=this.readSync(t.dataId),v=0;v<d.length;++v){for(var y=v*h,_=m[y],E=0,x=0;x<h;++x){var T=m[y+x];T<_&&(_=T,E=x)}d[v]=E}return c},e.prototype.argMax=function(t,n){_e(t,"argMax");var i=[n];Fr("argMax",i,t.rank);for(var a=er(t.shape,i),s=a[0],u=a[1],c=Bt(s,"int32"),h=Oe(u),d=this.readSync(c.dataId),m=this.readSync(t.dataId),v=0;v<d.length;++v){for(var y=v*h,_=m[y],E=0,x=0;x<h;++x){var T=m[y+x];T>_&&(_=T,E=x)}d[v]=E}return c},e.prototype.cumsum=function(t,n,i,a){if(_e(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var s=qn(t.dtype,"int32"),u=Bt(t.shape,s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),d=t.shape[t.rank-1],m=a?function(x,T){return x+d-T-1}:function(x,T){return x+T},v=0;v<h.length;v+=d)for(var y=0;y<d;y++){var _=m(v,y);if(y===0)c[_]=i?0:h[_];else{var E=m(v,y-1);c[_]=i?h[E]+c[E]:h[_]+c[E]}}return u},e.prototype.equal=function(t,n){return _e([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i===a?1:0})},e.prototype.notEqual=function(t,n){return _e([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i!==a?1:0})},e.prototype.less=function(t,n){return _e([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<a?1:0})},e.prototype.lessEqual=function(t,n){return _e([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<=a?1:0})},e.prototype.greater=function(t,n){return _e([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>a?1:0})},e.prototype.greaterEqual=function(t,n){return _e([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>=a?1:0})},e.prototype.logicalNot=function(t){_e(t,"logicalNot");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n[a]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return _e([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i&&a})},e.prototype.logicalOr=function(t,n){return _e([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i||a})},e.prototype.select=function(t,n,i){_e([t,n,i],"select");for(var a=this.readSync(t.dataId),s=this.readSync(n.dataId),u=this.readSync(i.dataId),c=Bt(n.shape,qn(n.dtype,i.dtype)),h=this.readSync(c.dataId),d=0,m=t.rank===0||t.rank>1||n.rank===1?1:Oe(n.shape.slice(1)),v=0;v<a.length;v++)for(var y=0;y<m;y++)a[v]===1?h[d++]=s[v]:h[d++]=u[v];return c},e.prototype.where=function(t){_e([t],"where");var n=this.readSync(t.dataId);return b_(t.shape,n)},e.prototype.topk=function(t,n,i){return _e(t,"topk"),vI(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){_e(t,"min"),Fr("min",n,t.rank);for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,t.dtype),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=d[v],_=0;_<c;++_){var E=d[v+_];E<y&&(y=E)}h[m]=y}return u},e.prototype.minimum=function(t,n){return _e([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.min(i,a)})},e.prototype.mod=function(t,n){return _e([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var s=i%a;return i<0&&a<0||i>=0&&a>=0?s:(s+a)%a})},e.prototype.max=function(t,n){_e(t,"max"),Fr("max",n,t.rank);for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,t.dtype),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=d[v],_=0;_<c;++_){var E=d[v+_];E>y&&(y=E)}h[m]=y}return u},e.prototype.maximum=function(t,n){return _e([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.max(i,a)})},e.prototype.all=function(t,n){_e(t,"all"),Fr("all",n,t.rank);for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,t.dtype),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=d[v],_=0;_<c;++_){var E=d[v+_];y=y&&E}h[m]=y}return u},e.prototype.any=function(t,n){_e(t,"any"),Fr("any",n,t.rank);for(var i=er(t.shape,n),a=i[0],s=i[1],u=Bt(a,t.dtype),c=Oe(s),h=this.readSync(u.dataId),d=this.readSync(t.dataId),m=0;m<h.length;++m){for(var v=m*c,y=d[v],_=0;_<c;++_){var E=d[v+_];y=y||E}h[m]=y}return u},e.prototype.squaredDifference=function(t,n){return _e([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var s=i-a;return s*s})},e.prototype.ceil=function(t){_e(t,"ceil");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.ceil(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){_e(t,"floor");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.floor(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){_e(t,"x");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)n[a]<0?i[a]=-1:n[a]>0?i[a]=1:i[a]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){_e(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isNaN(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){_e(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Math.abs(n[a])===1/0&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){_e(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isFinite(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){_e(t,"round");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var s=Math.floor(n[a]);n[a]-s<.5?i[a]=Math.floor(n[a]):n[a]-s>.5?i[a]=Math.ceil(n[a]):i[a]=s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){_e(t,"exp");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.exp(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){_e(t,"expm1");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.expm1(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){_e(t,"log");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var s=n[a];i[a]=Math.log(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){_e(t,"log1p");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var s=n[a];i[a]=Math.log1p(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){_e(t,"sqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var s=n[a];i[a]=Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){_e(t,"rsqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var s=n[a];i[a]=1/Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){_e(t,"reciprocal");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=1/n[a];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){_e(t,"relu");for(var n=Bt(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),s=0;s<a.length;++s)i[s]=Math.max(0,a[s]);return n},e.prototype.relu6=function(t){_e(t,"relu");for(var n=Bt(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),s=0;s<a.length;++s)i[s]=Math.min(Math.max(0,a[s]),6);return n},e.prototype.prelu=function(t,n){return _e([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return i<0?a*i:i})},e.prototype.elu=function(t){_e(t,"elu");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];n[a]=s>=0?s:Math.exp(s)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){_e([t,n],"eluDer");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){var c=a[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return this.makeOutput(i,n.shape,"float32")},e.prototype.selu=function(t){_e(t,"selu");for(var n=w_,i=x_,a=new Float32Array(t.size),s=this.readSync(t.dataId),u=0;u<s.length;++u){var c=s[u];a[u]=c>=0?i*c:n*(Math.exp(c)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,n,i){_e(t,"clip");for(var a=new Float32Array(t.size),s=this.readSync(t.dataId),u=0;u<s.length;++u){var c=s[u];a[u]=c>i?i:c<n?n:c}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.abs(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<t.size;++a){var s=i[2*a],u=i[2*a+1];n[a]=Math.hypot(s,u)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){_e(t,"int");for(var n=new Int32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=i[a];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){_e(t,"sigmoid");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=1/(1+Math.exp(-i[a]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){_e(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s]>-n,c=a[s]<n,h=Math.exp(a[s]),d=void 0;d=c?h:u?a[s]:Math.log(1+h),i[s]=d}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){_e(t,"sin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){_e(t,"cos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){_e(t,"tan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.tan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){_e(t,"asin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){_e(t,"acos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){_e(t,"atan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return _e([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.atan2(i,a)})},e.prototype.sinh=function(t){_e(t,"sinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){_e(t,"cosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){_e(t,"tanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=t6(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){_e(t,"asinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){_e(t,"acosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){_e(t,"atanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atanh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){_e(t,"erf");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=Math.sign(i[a]),u=Math.abs(i[a]),c=1/(1+.3275911*u);n[a]=s*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-u*u))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),_e(t,"step");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];isNaN(u)?i[s]=NaN:i[s]=u>0?1:n}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.conv2d(n,i,a);return s&&(h=this.add(h,s)),u&&(h=Ky(this,h,u,c)),h},e.prototype.conv2d=function(t,n,i){_e([t,n],"conv2d");for(var a=i.filterHeight,s=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,m=i.dataFormat==="channelsLast",v=Qe(i.outShape,t.dtype),y=t.strides[0],_=m?t.strides[1]:t.strides[2],E=m?t.strides[2]:1,x=m?1:t.strides[1],T=v.strides[0],C=m?v.strides[1]:v.strides[2],A=m?v.strides[2]:1,R=m?1:v.strides[1],k=this.readSync(t.dataId),B=this.readSync(n.dataId),P=v.values,I=0;I<i.batchSize;++I)for(var D=I*y,O=I*T,L=0;L<i.outHeight;++L)for(var F=O+L*C,V=L*i.strideHeight-d,ie=0;ie<a;ie++){var se=V+ie*u;if(!(se<0||se>=i.inHeight))for(var G=ie*n.strides[0],Q=D+se*_,te=0;te<i.outWidth;++te)for(var de=F+te*A,H=te*i.strideWidth-h,ee=0;ee<s;ee++){var pe=H+ee*c;if(!(pe<0||pe>=i.inWidth))for(var ce=Q+pe*E,xe=G+ee*n.strides[1],Se=0;Se<i.inChannels;++Se){for(var Ee=k[ce+Se*x],Ve=0;Ve<i.outChannels;++Ve)P[de+Ve*R]+=Ee*B[xe+Ve];xe+=i.outChannels}}}return v.toTensor()},e.prototype.conv3d=function(t,n,i){for(var a=i.filterDepth,s=i.filterHeight,u=i.filterWidth,c=i.dilationDepth,h=i.dilationHeight,d=i.dilationWidth,m=i.padInfo.front,v=i.padInfo.left,y=i.padInfo.top,_=Qe(i.outShape,t.dtype),E=this.readSync(t.dataId),x=this.readSync(n.dataId),T=_.values,C=0;C<i.batchSize;++C)for(var A=C*t.strides[0],R=C*_.strides[0],k=0;k<i.outDepth;++k)for(var B=R+k*_.strides[1],P=k*i.strideDepth-m,I=0;I<a;I++){var D=P+I*c;if(!(D<0||D>=i.inDepth))for(var O=I*n.strides[0],L=A+D*t.strides[1],F=0;F<i.outHeight;++F)for(var V=B+F*_.strides[2],ie=F*i.strideHeight-y,se=0;se<s;se++){var G=ie+se*h;if(!(G<0||G>=i.inHeight))for(var Q=O+se*n.strides[1],te=L+G*t.strides[2],de=0;de<i.outWidth;++de)for(var H=V+de*i.outChannels,ee=de*i.strideWidth-v,pe=0;pe<u;pe++){var ce=ee+pe*d;if(!(ce<0||ce>=i.inWidth))for(var xe=Q+pe*n.strides[2],Se=te+ce*i.inChannels,Ee=xe,Ve=0;Ve<i.inChannels;++Ve){for(var ke=E[Se+Ve],Ke=0;Ke<i.outChannels;++Ke)T[H+Ke]+=ke*x[Ee+Ke];Ee+=i.outChannels}}}}return _.toTensor()},e.prototype.conv2dDerInput=function(t,n,i){_e([t,n],"conv2dDerInput");for(var a=Qe(i.inShape,"float32"),s=a.values,u=this.readSync(t.dataId),c=this.readSync(n.dataId),h=n.strides,d=h[0],m=h[1],v=h[2],y=i.batchSize,_=i.filterHeight,E=i.filterWidth,x=i.inChannels,T=i.inHeight,C=i.inWidth,A=i.outChannels,R=i.outHeight,k=i.outWidth,B=i.strideHeight,P=i.strideWidth,I=i.dataFormat,D=_-1-i.padInfo.top,O=E-1-i.padInfo.left,L=I==="channelsLast",F=a.strides[0],V=L?a.strides[1]:a.strides[2],ie=L?a.strides[2]:1,se=L?1:a.strides[1],G=t.strides[0],Q=L?t.strides[1]:t.strides[2],te=L?t.strides[2]:1,de=L?1:t.strides[1],H=0;H<y;++H)for(var ee=0;ee<x;++ee)for(var pe=0;pe<T;++pe)for(var ce=pe-D,xe=Math.max(0,Math.ceil(ce/B)),Se=Math.min(R,(_+ce)/B),Ee=0;Ee<C;++Ee){for(var Ve=Ee-O,ke=Math.max(0,Math.ceil(Ve/P)),Ke=Math.min(k,(E+Ve)/P),wt=0,Xe=xe;Xe<Se;++Xe)for(var lt=Xe*B-ce,tt=ke;tt<Ke;++tt)for(var xt=G*H+Q*Xe+te*tt,Ct=d*(_-1-lt)+m*(E-1-(tt*P-Ve))+v*ee,It=0;It<A;++It)wt+=u[xt+de*It]*c[Ct+It];s[F*H+V*pe+ie*Ee+se*ee]=wt}return a.toTensor()},e.prototype.conv3dDerInput=function(t,n,i){for(var a=Qe(i.inShape,"float32"),s=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],m=u[3],v=this.readSync(t.dataId),y=t.strides,_=y[0],E=y[1],x=y[2],T=y[3],C=this.readSync(n.dataId),A=n.strides,R=A[0],k=A[1],B=A[2],P=A[3],I=i.batchSize,D=i.filterDepth,O=i.filterHeight,L=i.filterWidth,F=i.inChannels,V=i.inDepth,ie=i.inHeight,se=i.inWidth,G=i.outChannels,Q=i.outDepth,te=i.outHeight,de=i.outWidth,H=i.strideDepth,ee=i.strideHeight,pe=i.strideWidth,ce=D-1-i.padInfo.front,xe=O-1-i.padInfo.top,Se=L-1-i.padInfo.left,Ee=0;Ee<I;++Ee)for(var Ve=0;Ve<F;++Ve)for(var ke=0;ke<V;++ke)for(var Ke=ke-ce,wt=Math.max(0,Math.ceil(Ke/H)),Xe=Math.min(Q,(D+Ke)/H),lt=0;lt<ie;++lt)for(var tt=lt-xe,xt=Math.max(0,Math.ceil(tt/ee)),Ct=Math.min(te,(O+tt)/ee),It=0;It<se;++It){for(var Wt=It-Se,dr=Math.max(0,Math.ceil(Wt/pe)),fn=Math.min(de,(L+Wt)/pe),Rr=0,Fn=wt;Fn<Xe;++Fn)for(var Gr=Fn*H-Ke,$n=xt;$n<Ct;++$n)for(var Kr=$n*ee-tt,pr=dr;pr<fn;++pr)for(var Pt=_*Ee+E*Fn+x*$n+T*pr,ct=R*(D-1-Gr)+k*(O-1-Kr)+B*(L-1-(pr*pe-Wt))+P*Ve,Vt=0;Vt<G;++Vt)Rr+=v[Pt+Vt]*C[ct+Vt];s[c*Ee+h*ke+d*lt+m*It+Ve]=Rr}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,n,i){_e([t,n],"conv2dDerFilter");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dataFormat==="channelsLast",d=Qe(i.filterShape,"float32"),m=i.padInfo.left,v=i.padInfo.top,y=this.bufferSync(t),_=this.bufferSync(n),E=0;E<u;++E)for(var x=Math.max(0,Math.ceil((v-E)/a)),T=Math.min(i.outHeight,(i.inHeight+v-E)/a),C=0;C<c;++C)for(var A=Math.max(0,Math.ceil((m-C)/s)),R=Math.min(i.outWidth,(i.inWidth+m-C)/s),k=0;k<i.inChannels;++k)for(var B=0;B<i.outChannels;++B){for(var P=0,I=0;I<i.batchSize;++I)for(var D=x;D<T;++D)for(var O=E+D*a-v,L=A;L<R;++L){var F=C+L*s-m;P+=h?y.get(I,O,F,k)*_.get(I,D,L,B):y.get(I,k,O,F)*_.get(I,B,D,L)}d.set(P,E,C,k,B)}return d.toTensor()},e.prototype.conv3dDerFilter=function(t,n,i){for(var a=i.strideDepth,s=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,m=Qe(i.filterShape,"float32"),v=m.values,y=m.strides,_=y[0],E=y[1],x=y[2],T=y[3],C=this.readSync(n.dataId),A=n.strides,R=A[0],k=A[1],B=A[2],P=A[3],I=this.readSync(t.dataId),D=t.strides,O=D[0],L=D[1],F=D[2],V=D[3],ie=i.padInfo.front,se=i.padInfo.left,G=i.padInfo.top,Q=0;Q<c;++Q)for(var te=Math.max(0,Math.ceil((ie-Q)/a)),de=Math.min(i.outDepth,(i.inDepth+ie-Q)/a),H=Q*_,ee=0;ee<h;++ee)for(var pe=Math.max(0,Math.ceil((G-ee)/s)),ce=Math.min(i.outHeight,(i.inHeight+G-ee)/s),xe=ee*E+H,Se=0;Se<d;++Se)for(var Ee=Math.max(0,Math.ceil((se-Se)/u)),Ve=Math.min(i.outWidth,(i.inWidth+se-Se)/u),ke=Se*x+xe,Ke=0;Ke<i.inChannels;++Ke)for(var wt=Ke*T+ke,Xe=0;Xe<i.outChannels;++Xe){for(var lt=0,tt=0;tt<i.batchSize;++tt)for(var xt=tt*O,Ct=tt*R,It=te;It<de;++It)for(var Wt=(Q+It*a-ie)*L+xt,dr=It*k+Ct,fn=pe;fn<ce;++fn)for(var Rr=(ee+fn*s-G)*F+Wt,Fn=fn*B+dr,Gr=Ee;Gr<Ve;++Gr){var $n=Gr*P+Fn;lt+=I[(Se+Gr*u-se)*V+Rr+Ke]*C[$n+Xe]}v[wt+Xe]=lt}return m.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,h=this.depthwiseConv2D(n,i,a);return s&&(h=this.add(h,s)),u&&(h=Ky(this,h,u,c)),h},e.prototype.depthwiseConv2D=function(t,n,i){_e([t,n],"depthwiseConv2D");for(var a=i.filterHeight,s=i.filterWidth,u=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.left,d=i.padInfo.top,m=i.outChannels/i.inChannels,v=Qe(i.outShape,t.dtype),y=this.readSync(t.dataId),_=this.readSync(n.dataId),E=v.values,x=0;x<i.batchSize;++x)for(var T=x*t.strides[0],C=x*v.strides[0],A=0;A<i.outHeight;++A)for(var R=C+A*v.strides[1],k=A*i.strideHeight-h,B=0;B<a;++B){var P=k+B*u;if(!(P<0||P>=i.inHeight))for(var I=B*n.strides[0],D=T+P*t.strides[1],O=0;O<i.outWidth;++O)for(var L=R+O*v.strides[2],F=O*i.strideWidth-d,V=0;V<s;++V){var ie=F+V*c;if(!(ie<0||ie>=i.inWidth))for(var se=I+V*n.strides[1],G=D+ie*i.inChannels,Q=L,te=se,de=0;de<i.inChannels;++de){for(var H=y[G+de],ee=0;ee<m;++ee)E[Q+ee]+=H*_[te+ee];Q+=m,te+=m}}}return v.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,i){_e([t,n],"depthwiseConv2DDerInput");for(var a=Qe(i.inShape,"float32"),s=a.values,u=a.strides,c=u[0],h=u[1],d=u[2],m=this.readSync(t.dataId),v=t.strides,y=v[0],_=v[1],E=v[2],x=this.readSync(n.dataId),T=n.strides,C=T[0],A=T[1],R=T[2],k=i.batchSize,B=i.filterHeight,P=i.filterWidth,I=i.inChannels,D=i.inHeight,O=i.inWidth,L=i.outChannels,F=i.outHeight,V=i.outWidth,ie=i.strideHeight,se=i.strideWidth,G=B-1-i.padInfo.top,Q=P-1-i.padInfo.left,te=L/I,de=0;de<k;++de)for(var H=0;H<I;++H)for(var ee=0;ee<D;++ee)for(var pe=ee-G,ce=Math.max(0,Math.ceil(pe/ie)),xe=Math.min(F,(B+pe)/ie),Se=0;Se<O;++Se){for(var Ee=Se-Q,Ve=Math.max(0,Math.ceil(Ee/se)),ke=Math.min(V,(P+Ee)/se),Ke=0,wt=ce;wt<xe;++wt)for(var Xe=wt*ie-pe,lt=Ve;lt<ke;++lt)for(var tt=y*de+_*wt+E*lt,xt=C*(B-1-Xe)+A*(P-1-(lt*se-Ee))+R*H,Ct=0;Ct<te;++Ct)Ke+=m[tt+(H*te+Ct)]*x[xt+Ct];s[c*de+h*ee+d*Se+H]=Ke}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){_e([t,n],"depthwiseConv2DDerFilter");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=Qe(i.filterShape,"float32"),d=i.padInfo.left,m=i.padInfo.top,v=i.outChannels/i.inChannels,y=this.bufferSync(t),_=this.bufferSync(n),E=0;E<u;++E)for(var x=Math.max(0,Math.ceil((m-E)/a)),T=Math.min(i.outHeight,(i.inHeight+m-E)/a),C=0;C<c;++C)for(var A=Math.max(0,Math.ceil((d-C)/s)),R=Math.min(i.outWidth,(i.inWidth+d-C)/s),k=0;k<i.outChannels;++k){for(var B=Math.trunc(k/v),P=k%v,I=0,D=0;D<i.batchSize;++D)for(var O=x;O<T;++O)for(var L=E+O*a-m,F=A;F<R;++F){var V=C+F*s-d;I+=y.get(D,L,V,B)*_.get(D,O,F,k)}h.set(I,E,C,B,P)}return h.toTensor()},e.prototype.tile=function(t,n){return _e(t,"tile"),mI(this.bufferSync(t),n)},e.prototype.pad=function(t,n,i){_e(t,"pad");var a=n.map(function(v,y){return v[0]+t.shape[y]+v[1]}),s=n.map(function(v){return v[0]}),u=this.bufferSync(t),c=Qe(a,t.dtype);i!==0&&c.values.fill(i);for(var h=0;h<t.size;h++){var d=u.indexToLoc(h),m=d.map(function(v,y){return v+s[y]});c.set.apply(c,[u.get.apply(u,d)].concat(m))}return c.toTensor()},e.prototype.transpose=function(t,n){_e(t,"transpose");for(var i=new Array(t.rank),a=0;a<i.length;a++)i[a]=t.shape[n[a]];var s=this.readSync(t.dataId),u=Qe(i,t.dtype),c=this.bufferSync(t);for(a=0;a<t.size;++a){for(var h=c.indexToLoc(a),d=new Array(h.length),m=0;m<d.length;m++)d[m]=h[n[m]];var v=u.locToIndex(d);u.values[v]=s[a]}return u.toTensor()},e.prototype.gather=function(t,n,i){_e([t,n],"gather");var a=t.shape.slice(),s=this.readSync(n.dataId);a[i]=s.length;for(var u=Qe(a,t.dtype),c=this.bufferSync(t),h=0;h<u.size;++h){var d=u.indexToLoc(h),m=d.slice();m[i]=s[d[i]];var v=c.locToIndex(m);u.values[h]=c.values[v]}return u.toTensor()},e.prototype.batchToSpaceND=function(t,n,i){_e([t],"batchToSpaceND");var a=n.reduce(function(m,v){return m*v}),s=sm(t.shape,n,a),u=um(s.length,n.length),c=lm(t.shape,n,a),h=nI(i,n.length),d=rI(c,i,n.length);return t.reshape(s).transpose(u).reshape(c).slice(h,d)},e.prototype.spaceToBatchND=function(t,n,i){_e([t],"spaceToBatchND");var a=n.reduce(function(v,y){return v*y}),s=[[0,0]];s.push.apply(s,i);for(var u=1+n.length;u<t.shape.length;++u)s.push([0,0]);var c=t.pad(s),h=sm(c.shape,n,a,!1),d=um(h.length,n.length,!1),m=lm(c.shape,n,a,!1);return c.reshape(h).transpose(d).reshape(m)},e.prototype.pool=function(t,n,i){_e(t,"pool");for(var a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=n.padInfo.top,v=n.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,_=this.readSync(t.dataId),E=Qe(n.outShape,t.dtype),x=E.values,T=n.outShape[1]*n.outShape[2]*n.outShape[3],C=n.outShape[2]*n.outShape[3],A=n.outShape[3],R=0;R<n.batchSize;++R)for(var k=R*T,B=R*t.strides[0],P=0;P<n.inChannels;++P)for(var I=0;I<n.outHeight;++I)for(var D=I*a-m,O=Math.max(0,D),L=Math.min(n.inHeight,h+D),F=k+I*C,V=0;V<n.outWidth;++V){for(var ie=V*s-v,se=Math.max(0,ie),G=Math.min(n.inWidth,d+ie),Q=y,te=0,de=0,H=O;H<L;H+=u){for(var ee=B+H*t.strides[1],pe=se;pe<G;pe+=c){var ce=_[ee+pe*t.strides[2]+P];i==="max"&&ce>Q?Q=ce:i==="avg"&&(te+=ce,de++)}if(isNaN(Q))break}x[F+V*A+P]=i==="avg"?te/de:Q}return E.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var i=Qe(n.outShape,"int32"),a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=n.padInfo.top,v=n.padInfo.left,y=this.bufferSync(t),_=0;_<n.batchSize;++_)for(var E=0;E<n.inChannels;++E)for(var x=0;x<n.outHeight;++x){for(var T=x*a-m,C=T;C<0;)C+=u;for(var A=Math.min(n.inHeight,h+T),R=0;R<n.outWidth;++R){for(var k=R*s-v,B=k;B<0;)B+=c;for(var P=Math.min(n.inWidth,d+k),I=Number.NEGATIVE_INFINITY,D=-1,O=C;O<A;O+=u)for(var L=O-T,F=B;F<P;F+=c){var V=F-k,ie=y.get(_,O,F,E);ie>I&&(I=ie,D=L*d+V)}i.set(D,_,x,R,E)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,n,i,a){_e([n,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(n,a),u=a.strideHeight,c=a.strideWidth,h=a.dilationHeight,d=a.dilationWidth,m=a.effectiveFilterHeight,v=a.effectiveFilterWidth,y=v-1-a.padInfo.left,_=m-1-a.padInfo.top,E=Qe(n.shape,"float32"),x=this.bufferSync(s),T=this.bufferSync(t),C=0;C<a.batchSize;++C)for(var A=0;A<a.inChannels;++A)for(var R=0;R<a.inHeight;++R)for(var k=0;k<a.inWidth;++k){for(var B=R-_,P=k-y,I=0,D=0;D<m;D+=h){var O=(B+D)/u;if(!(O<0||O>=a.outHeight||Math.floor(O)!==O))for(var L=0;L<v;L+=d){var F=(P+L)/c;if(!(F<0||F>=a.outWidth||Math.floor(F)!==F)){var V=m*v-1-x.get(C,O,F,A)===D*v+L?1:0;V!==0&&(I+=T.get(C,O,F,A)*V)}}}E.set(I,C,R,k,A)}return E.toTensor()},e.prototype.avgPoolBackprop=function(t,n,i){_e([t,n],"avgPoolBackprop");for(var a=i.strideHeight,s=i.strideWidth,u=i.filterHeight,c=i.filterWidth,h=i.dilationHeight,d=i.dilationWidth,m=i.effectiveFilterHeight,v=i.effectiveFilterWidth,y=v-1-i.padInfo.left,_=m-1-i.padInfo.top,E=Qe(n.shape,"float32"),x=1/(u*c),T=this.bufferSync(t),C=0;C<i.batchSize;++C)for(var A=0;A<i.inChannels;++A)for(var R=0;R<i.inHeight;++R)for(var k=0;k<i.inWidth;++k){for(var B=R-_,P=k-y,I=0,D=0;D<m;D+=h){var O=(B+D)/a;if(!(O<0||O>=i.outHeight||Math.floor(O)!==O))for(var L=0;L<v;L+=d){var F=(P+L)/s;F<0||F>=i.outWidth||Math.floor(F)!==F||(I+=T.get(C,O,F,A))}}E.set(I*x,C,R,k,A)}return E.toTensor()},e.prototype.pool3d=function(t,n,i){_e(t,"pool3d");for(var a=n.strideDepth,s=n.strideHeight,u=n.strideWidth,c=n.dilationDepth,h=n.dilationHeight,d=n.dilationWidth,m=n.effectiveFilterDepth,v=n.effectiveFilterHeight,y=n.effectiveFilterWidth,_=n.padInfo.front,E=n.padInfo.top,x=n.padInfo.left,T=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=this.readSync(t.dataId),A=Qe(n.outShape,t.dtype),R=A.values,k=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],B=n.outShape[2]*n.outShape[3]*n.outShape[4],P=n.outShape[3]*n.outShape[4],I=n.outShape[4],D=0;D<n.batchSize;++D)for(var O=D*k,L=D*t.strides[0],F=0;F<n.inChannels;++F)for(var V=0;V<n.outDepth;++V){for(var ie=V*a-_,se=ie;se<0;)se+=c;for(var G=Math.min(n.inDepth,m+ie),Q=O+V*B,te=0;te<n.outHeight;++te){for(var de=te*s-E,H=de;H<0;)H+=h;for(var ee=Math.min(n.inHeight,v+de),pe=Q+te*P,ce=0;ce<n.outWidth;++ce){for(var xe=ce*u-x,Se=xe;Se<0;)Se+=d;for(var Ee=Math.min(n.inWidth,y+xe),Ve=pe+ce*I,ke=T,Ke=0,wt=0,Xe=se;Xe<G;Xe+=c){for(var lt=L+Xe*t.strides[1],tt=H;tt<ee;tt+=h){for(var xt=lt+tt*t.strides[2],Ct=Se;Ct<Ee;Ct+=d){var It=C[xt+Ct*t.strides[3]+F];if(i==="max"&&It>ke?ke=It:i==="avg"&&(Ke+=It,wt++),isNaN(ke))break}if(isNaN(ke))break}if(isNaN(ke))break}R[Ve+F]=i==="avg"?Ke/wt:ke}}}return A.toTensor()},e.prototype.avgPool3d=function(t,n){return _e(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,i){_e([t,n],"avgPool3dBackprop");for(var a=i.strideDepth,s=i.strideHeight,u=i.strideWidth,c=i.filterDepth,h=i.filterHeight,d=i.filterWidth,m=i.dilationDepth,v=i.dilationHeight,y=i.dilationWidth,_=i.effectiveFilterDepth,E=i.effectiveFilterHeight,x=i.effectiveFilterWidth,T=_-1-i.padInfo.front,C=x-1-i.padInfo.left,A=E-1-i.padInfo.top,R=Qe(n.shape,"float32"),k=1/(c*h*d),B=this.bufferSync(t),P=0;P<i.batchSize;++P)for(var I=0;I<i.inChannels;++I)for(var D=0;D<i.inDepth;++D)for(var O=0;O<i.inHeight;++O)for(var L=0;L<i.inWidth;++L){for(var F=D-T,V=O-A,ie=L-C,se=0,G=0;G<_;G+=m){var Q=(F+G)/a;if(!(Q<0||Q>=i.outDepth||Math.floor(Q)!==Q))for(var te=0;te<E;te+=v){var de=(V+te)/s;if(!(de<0||de>=i.outHeight||Math.floor(de)!==de))for(var H=0;H<x;H+=y){var ee=(ie+H)/u;ee<0||ee>=i.outWidth||Math.floor(ee)!==ee||(se+=B.get(P,Q,de,ee,I))}}}R.set(se*k,P,D,O,L,I)}return R.toTensor()},e.prototype.maxPool3d=function(t,n){return _e(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var i=Qe(n.outShape,"int32"),a=n.strideDepth,s=n.strideHeight,u=n.strideWidth,c=n.dilationDepth,h=n.dilationHeight,d=n.dilationWidth,m=n.effectiveFilterDepth,v=n.effectiveFilterHeight,y=n.effectiveFilterWidth,_=n.padInfo.front,E=n.padInfo.top,x=n.padInfo.left,T=this.bufferSync(t),C=0;C<n.batchSize;++C)for(var A=0;A<n.inChannels;++A)for(var R=0;R<n.outDepth;++R){for(var k=R*a-_,B=k;B<0;)B+=c;for(var P=Math.min(n.inDepth,m+k),I=0;I<n.outHeight;++I){for(var D=I*s-E,O=D;O<0;)O+=h;for(var L=Math.min(n.inHeight,v+D),F=0;F<n.outWidth;++F){for(var V=F*u-x,ie=V;ie<0;)ie+=d;for(var se=Math.min(n.inWidth,y+V),G=Number.NEGATIVE_INFINITY,Q=-1,te=B;te<P;te+=c)for(var de=te-k,H=O;H<L;H+=h)for(var ee=H-D,pe=ie;pe<se;pe+=d){var ce=pe-V,xe=T.get(C,te,H,pe,A);xe>=G&&(G=xe,Q=de*v*y+ee*v+ce)}i.set(Q,C,R,I,F,A)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,i,a){_e([n,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(n,a),u=a.strideDepth,c=a.strideHeight,h=a.strideWidth,d=a.dilationDepth,m=a.dilationHeight,v=a.dilationWidth,y=a.effectiveFilterDepth,_=a.effectiveFilterHeight,E=a.effectiveFilterWidth,x=y-1-a.padInfo.front,T=E-1-a.padInfo.left,C=_-1-a.padInfo.top,A=Qe(n.shape,"float32"),R=this.bufferSync(s),k=this.bufferSync(t),B=0;B<a.batchSize;++B)for(var P=0;P<a.inChannels;++P)for(var I=0;I<a.inDepth;++I)for(var D=0;D<a.inHeight;++D)for(var O=0;O<a.inWidth;++O){for(var L=I-x,F=D-C,V=O-T,ie=0,se=0;se<y;se+=d){var G=(L+se)/u;if(!(G<0||G>=a.outDepth||Math.floor(G)!==G))for(var Q=0;Q<_;Q+=m){var te=(F+Q)/c;if(!(te<0||te>=a.outHeight||Math.floor(te)!==te))for(var de=0;de<E;de+=v){var H=(V+de)/h;if(!(H<0||H>=a.outWidth||Math.floor(H)!==H)){var ee=y*_*E-1-R.get(B,G,te,H,P)===se*_*E+Q*E+de?1:0;ee!==0&&(ie+=k.get(B,G,te,H,P)*ee)}}}}A.set(ie,B,I,D,O,P)}return A.toTensor()},e.prototype.cast=function(t,n){return hI(t,n,this)},e.prototype.reshape=function(t,n){return W0(t,n)},e.prototype.avgPool=function(t,n){return _e(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,i,a){_e(t,"resizeBilinear");for(var s=t.shape,u=s[0],c=s[1],h=s[2],d=s[3],m=this.readSync(t.dataId),v=new Float32Array(Oe([u,n,i,d])),y=[a&&n>1?c-1:c,a&&i>1?h-1:h],_=[a&&n>1?n-1:n,a&&i>1?i-1:i],E=0,x=y[0]/_[0],T=y[1]/_[1],C=0;C<u;C++)for(var A=0;A<n;A++)for(var R=x*A,k=Math.floor(R),B=R-k,P=Math.min(c-1,Math.ceil(R)),I=C*t.strides[0]+k*t.strides[1],D=C*t.strides[0]+P*t.strides[1],O=0;O<i;O++)for(var L=T*O,F=Math.floor(L),V=L-F,ie=Math.min(h-1,Math.ceil(L)),se=I+F*t.strides[2],G=D+F*t.strides[2],Q=I+ie*t.strides[2],te=D+ie*t.strides[2],de=0;de<d;de++){var H=m[se+de],ee=m[G+de],pe=H+(m[Q+de]-H)*V,ce=pe+(ee+(m[te+de]-ee)*V-pe)*B;v[E++]=ce}return Gn(v,[u,n,i,d])},e.prototype.resizeBilinearBackprop=function(t,n,i){_e([t,n],"resizeBilinearBackprop");for(var a=n.shape,s=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,m=d[1],v=d[2],y=new Float32Array(s*u*c*h),_=[i&&m>1?u-1:u,i&&v>1?c-1:c],E=[i&&m>1?m-1:m,i&&v>1?v-1:v],x=_[0]/E[0],T=_[1]/E[1],C=this.readSync(t.dataId),A=0,R=0;R<s;R++)for(var k=R*n.strides[0],B=0;B<m;B++)for(var P=B*x,I=Math.floor(P),D=Math.min(Math.ceil(P),u-1),O=k+I*n.strides[1],L=k+D*n.strides[1],F=P-I,V=1-F,ie=0;ie<v;ie++)for(var se=ie*T,G=Math.floor(se),Q=Math.min(Math.ceil(se),c-1),te=se-G,de=1-te,H=O+G*n.strides[2],ee=O+Q*n.strides[2],pe=L+G*n.strides[2],ce=L+Q*n.strides[2],xe=V*de,Se=V*te,Ee=F*de,Ve=F*te,ke=0;ke<h;ke++){var Ke=C[A++];y[H+ke]+=Ke*xe,y[ee+ke]+=Ke*Se,y[pe+ke]+=Ke*Ee,y[ce+ke]+=Ke*Ve}return br(y,[s,c,u,h],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,i,a){_e(t,"resizeNearestNeighbor");for(var s=t.shape,u=s[0],c=s[1],h=s[2],d=s[3],m=this.readSync(t.dataId),v=new Float32Array(u*n*i*d),y=[a&&n>1?c-1:c,a&&i>1?h-1:h],_=[a&&n>1?n-1:n,a&&i>1?i-1:i],E=y[0]/_[0],x=y[1]/_[1],T=0,C=0;C<u;C++)for(var A=C*t.strides[0],R=0;R<n;R++)for(var k=E*R,B=A+Math.min(c-1,a?Math.round(k):Math.floor(k))*t.strides[1],P=0;P<i;P++)for(var I=x*P,D=B+Math.min(h-1,a?Math.round(I):Math.floor(I))*t.strides[2],O=0;O<d;O++){var L=m[D+O];v[T++]=L}return Gn(v,[u,n,i,d],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){_e([t,n],"resizeNearestNeighborBackprop");for(var a=n.shape,s=a[0],u=a[1],c=a[2],h=a[3],d=t.shape,m=d[1],v=d[2],y=new Float32Array(s*u*c*h),_=this.readSync(t.dataId),E=[i&&m>1?u-1:u,i&&v>1?c-1:c],x=[i&&m>1?m-1:m,i&&v>1?v-1:v],T=E[0]/x[0],C=E[1]/x[1],A=1/T,R=1/C,k=2*Math.ceil(A)+2,B=2*Math.ceil(R)+2,P=0;P<s;P++)for(var I=P*n.strides[0],D=0;D<u;D++)for(var O=I+D*n.strides[1],L=Math.floor(D*A),F=Math.floor(L-k/2),V=0;V<c;V++)for(var ie=O+V*n.strides[2],se=Math.floor(V*R),G=Math.floor(se-B/2),Q=0;Q<h;Q++){for(var te=0,de=0;de<k;de++){var H=de+F;if(!(H<0||H>=m)){var ee=I+H*t.strides[1],pe=H*T;if(D===Math.min(u-1,i?Math.round(pe):Math.floor(pe)))for(var ce=0;ce<B;ce++){var xe=ce+G;if(!(xe<0||xe>=v)){var Se=ee+xe*t.strides[2],Ee=xe*C;V===Math.min(c-1,i?Math.round(Ee):Math.floor(Ee))&&(te+=_[Se+Q])}}}}y[ie+Q]=te}return br(y,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,i,a,s,u){_e([t,n,i,s,u],"batchNorm");for(var c=this.readSync(t.dataId),h=this.readSync(n.dataId),d=this.readSync(i.dataId),m=s?this.readSync(s.dataId):new Float32Array([1]),v=u?this.readSync(u.dataId):new Float32Array([0]),y=new Float32Array(c.length),_=v.length,E=m.length,x=d.length,T=h.length,C=0,A=0,R=0,k=0,B=0;B<c.length;++B)y[B]=v[C++]+(c[B]-h[A++])*m[R++]/Math.sqrt(d[k++]+a),C>=_&&(C=0),A>=T&&(A=0),R>=E&&(R=0),k>=x&&(k=0);return br(y,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,i,a,s){_e(t,"localResponseNormalization4D");var u=t.shape[3],c=u-1,h=this.readSync(t.dataId),d=t.size,m=new Float32Array(d);function v(x){for(var T=x%u,C=x-T+Math.max(0,T-n),A=x-T+Math.min(T+n,c),R=0;C<=A;C++){var k=h[C];R+=k*k}return R}for(var y=0;y<d;y++){var _=v(y),E=h[y]*Math.pow(i+a*_,-s);m[y]=E}return br(m,t.shape)},e.prototype.LRNGrad=function(t,n,i,a,s,u,c){_e(t,"LRNGrad");for(var h=t.shape[3],d=this.readSync(t.dataId),m=this.readSync(n.dataId),v=this.readSync(i.dataId),y=new Float32Array(t.size),_=t.size,E=0;E<_;E++){for(var x=E%h,T=E-x+Math.max(0,x-a),C=E-x+Math.min(h,x+a+1),A=0,R=T;R<C;R++)A+=Math.pow(m[R],2);for(A=u*A+s,R=T;R<C;R++){var k=-2*u*c*m[R]*v[E]/A;E===R&&(k+=Math.pow(A,-c)),k*=d[E],y[R]+=k}}return br(y,t.shape)},e.prototype.multinomial=function(t,n,i,a){_e(t,"multinomial");for(var s=n?t:so(t),u=s.shape[0],c=s.shape[1],h=Bt([u,i],"int32"),d=this.readSync(h.dataId),m=this.readSync(s.dataId),v=0;v<u;++v){var y=v*c,_=new Float32Array(c-1);_[0]=m[y];for(var E=1;E<_.length;++E)_[E]=_[E-1]+m[y+E];for(var x=Ym(a.toString()),T=v*i,C=0;C<i;++C){var A=x();d[T+C]=_.length;for(var R=0;R<_.length;R++)if(A<_[R]){d[T+C]=R;break}}}return h},e.prototype.oneHot=function(t,n,i,a){_e(t,"oneHot");var s=new Float32Array(t.size*n);s.fill(a);for(var u=this.readSync(t.dataId),c=0;c<t.size;++c)u[c]>=0&&u[c]<n&&(s[c*n+u[c]]=i);return es(s,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,i,a,s){return _e(t,"nonMaxSuppression"),g_(this.readSync(t.dataId),this.readSync(n.dataId),i,a,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var i=t.shape[0],a=t.shape[1],s=Qe(t.shape,"float32"),u=Qe(t.shape,"float32"),c=si(t).as2D(i,a),h=ta(t).as2D(i,a),d=0;d<i;d++)for(var m=c.slice([d,0],[1,a]),v=h.slice([d,0],[1,a]),y=Hn(m,v),_=this.readSync(this.fftImpl(y,n).dataId),E=0;E<a;E++){var x=DT(_,E);s.values[d*a+E]=x.real,u.values[d*a+E]=x.imag}return Hn(s.toTensor(),u.toTensor()).as2D(i,a)},e.prototype.fftImpl=function(t,n){var i=t.as1D(),a=i.size;if(this.isExponentOf2(a)){var s=this.fftRadix2(i,a,n).as2D(t.shape[0],t.shape[1]);return n&&(s=Hn(si(s).div(Ce(a)),ta(s).div(Ce(a)))),s}var u=this.readSync(t.dataId),c=function(h){for(var d=new Float32Array(h.length/2),m=new Float32Array(h.length/2),v=0;v<h.length;v+=2)d[v/2]=h[v],m[v/2]=h[v+1];return{real:d,imag:m}}(this.fourierTransformByMatmul(u,a,n));return Hn(c.real,c.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,i){if(n===1)return t;var a=this.readSync(t.dataId),s=n/2,u=function(T){for(var C=Math.ceil(T.length/4),A=new Float32Array(C),R=new Float32Array(C),k=0;k<T.length;k+=4)A[Math.floor(k/4)]=T[k],R[Math.floor(k/4)]=T[k+1];return{real:A,imag:R}}(a),c=Hn(u.real,u.imag).as1D(),h=function(T){for(var C=Math.floor(T.length/4),A=new Float32Array(C),R=new Float32Array(C),k=2;k<T.length;k+=4)A[Math.floor(k/4)]=T[k],R[Math.floor(k/4)]=T[k+1];return{real:A,imag:R}}(a),d=Hn(h.real,h.imag).as1D();c=this.fftRadix2(c,s,i),d=this.fftRadix2(d,s,i);var m=function(T,C){for(var A=new Float32Array(T/2),R=new Float32Array(T/2),k=0;k<Math.ceil(T/2);k++){var B=(C?2:-2)*Math.PI*(k/T);A[k]=Math.cos(B),R[k]=Math.sin(B)}return{real:A,imag:R}}(n,i),v=Hn(m.real,m.imag).mul(d),y=c.add(v),_=c.sub(v),E=si(y).concat(si(_)),x=ta(y).concat(ta(_));return Hn(E,x).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,i){for(var a=new Float32Array(2*n),s=0;s<n;s++){for(var u=0,c=0,h=0;h<n;h++){var d=M5(s*h,n,i),m=DT(t,h);u+=m.real*d.real-m.imag*d.imag,c+=m.real*d.imag+m.imag*d.real}i&&(u/=n,c/=n),O5(a,u,c,s)}return a},e.prototype.depthToSpace=function(t,n,i){W(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),W(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var a=t.shape[0],s=t.shape[1],u=t.shape[2],c=t.shape[3],h=s*n,d=u*n,m=c/(n*n),v=this.readSync(t.dataId),y=new Float32Array(a*h*d*m),_=0,E=0;E<a;++E)for(var x=0;x<h;++x)for(var T=Math.floor(x/n),C=x%n,A=0;A<d;++A)for(var R=Math.floor(A/n),k=(C*n+A%n)*m,B=0;B<m;++B){var P=B+k+c*(R+u*(T+s*E));y[_++]=v[P]}return br(y,[a,h,d,m])},e.prototype.broadcastedBinaryOp=function(t,n,i,a){var s=ut(t.shape,n.shape),u=Qe(s,i),c=this.readSync(t.dataId),h=this.readSync(n.dataId),d=Xo(t.shape,s),m=Xo(n.shape,s),v=u.values;if(d.length+m.length===0)for(var y=0;y<v.length;++y)v[y]=a(c[y%c.length],h[y%h.length]);else{var _=this.bufferSync(t),E=this.bufferSync(n),x=function(T){var C=u.indexToLoc(T),A=C.slice(-t.rank);d.forEach(function(P){return A[P]=0});var R=_.locToIndex(A),k=C.slice(-n.rank);m.forEach(function(P){return k[P]=0});var B=E.locToIndex(k);v[T]=a(c[R],h[B])};for(y=0;y<v.length;++y)x(y)}return u.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,i){var a=ut(t.shape,n.shape),s=Qe(a,"float32"),u=Qe(a,"float32"),c=this.readSync(t.dataId),h=this.readSync(n.dataId),d=Xo(t.shape,a),m=Xo(n.shape,a),v=s.values,y=u.values;if(d.length+m.length===0)for(var _=0;_<v.length;_++){var E=_%c.length,x=_%h.length,T=i(c[2*E],c[2*E+1],h[2*x],h[2*x+1]);v[_]=T.real,y[_]=T.imag}else{var C=this.bufferSync(this.data.get(t.dataId).complexTensors.real),A=this.bufferSync(this.data.get(n.dataId).complexTensors.real),R=function(k){var B=s.indexToLoc(k),P=B.slice(-t.rank);d.forEach(function(F){return P[F]=0});var I=C.locToIndex(P),D=B.slice(-n.rank);m.forEach(function(F){return D[F]=0});var O=A.locToIndex(D),L=i(c[2*I],c[2*I+1],h[2*O],h[2*O+1]);v[k]=L.real,y[k]=L.imag};for(_=0;_<v.length;_++)R(_)}return this.complex(s.toTensor(),u.toTensor())},e.prototype.split=function(t,n,i){return pI(t,n,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,i,a,s,u){for(var c=t.shape,h=c[0],d=c[1],m=c[2],v=c[3],y=n.shape[0],_=a[0],E=a[1],x=Qe([y,_,E,v],"float32"),T=this.readSync(n.dataId),C=this.readSync(i.dataId),A=this.readSync(t.dataId),R=t.strides,k=x.strides,B=0;B<y;B++){var P=4*B,I=T[P],D=T[P+1],O=T[P+2],L=T[P+3],F=C[B];if(!(F>=h))for(var V=_>1?(O-I)*(d-1)/(_-1):0,ie=E>1?(L-D)*(m-1)/(E-1):0,se=0;se<_;se++){var G=_>1?I*(d-1)+se*V:.5*(I+O)*(d-1);if(G<0||G>d-1)for(var Q=0;Q<E;Q++)for(var te=0;te<v;te++){var de=te+Q*k[2]+se*k[1]+B*k[0];x.values[de]=u}else if(s==="bilinear"){var H=Math.floor(G),ee=Math.ceil(G),pe=G-H;for(Q=0;Q<E;Q++)if((Xe=E>1?D*(m-1)+Q*ie:.5*(D+L)*(m-1))<0||Xe>m-1)for(te=0;te<v;te++)de=te+Q*k[2]+se*k[1]+B*k[0],x.values[de]=u;else{var ce=Math.floor(Xe),xe=Math.ceil(Xe),Se=Xe-ce;for(te=0;te<v;te++){var Ee=A[de=te+ce*R[2]+H*R[1]+F*R[0]],Ve=A[de=te+xe*R[2]+H*R[1]+F*R[0]],ke=A[de=te+ce*R[2]+ee*R[1]+F*R[0]],Ke=Ee+(Ve-Ee)*Se,wt=ke+(A[de=te+xe*R[2]+ee*R[1]+F*R[0]]-ke)*Se;de=te+Q*k[2]+se*k[1]+B*k[0],x.values[de]=Ke+(wt-Ke)*pe}}}else for(Q=0;Q<E;++Q){var Xe;if((Xe=E>1?D*(m-1)+Q*ie:.5*(D+L)*(m-1))<0||Xe>m-1)for(te=0;te<v;te++)de=te+Q*k[2]+se*k[1]+B*k[0],x.values[de]=u;else{var lt=Math.round(Xe),tt=Math.round(G);for(te=0;te<v;te++){var xt=te+lt*R[2]+tt*R[1]+F*R[0],Ct=te+Q*k[2]+se*k[1]+B*k[0];x.values[Ct]=A[xt]}}}}}return x.toTensor()},e.prototype.sparseToDense=function(t,n,i,a){var s=cm(0,t,i),u=s.sliceRank,c=s.numUpdates,h=s.sliceSize,d=s.strides,m=s.outputSize;return this.scatter(t,n,i,m,h,c,u,d,a,!1)},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],s=iI(t,n),u=s[0],c=s[1],h=s[2],d=s[3];if(c===0)return Gn([],u,t.dtype);for(var m=new Zh([c,h],t.dtype),v=this.readSync(n.dataId),y=this.readSync(t.dataId),_=0;_<c;_++){for(var E=[],x=0,T=0;T<a;T++){var C=v[_*a+T];x+=C*d[T],E.push(C)}if(x<0||x>=t.size/h)throw new Error("Invalid indices: "+E+" does not index into "+t.shape);for(var A=0;A<h;A++)m.values[_*h+A]=y[x*h+A]}return m.toTensor().reshape(u)},e.prototype.scatterND=function(t,n,i){var a=cm(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,h=a.strides,d=a.outputSize,m=Ce(0);return this.scatter(t,n,i,d,c,u,s,h,m,!0)},e.prototype.fill=function(t,n,i){var a=em(i=i||vf(n),Oe(t));return a.fill(n),$.makeTensor(a,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=em(t.dtype,Oe(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,i){return fI(t,n,i)},e.prototype.scatter=function(t,n,i,a,s,u,c,h,d,m){var v=[a/s,s],y=this.readSync(t.dataId),_=this.readSync(n.dataId);if(a===0)return Gn([],i,n.dtype);var E=new Zh(v,n.dtype);E.values.fill(this.readSync(d.dataId)[0]);for(var x=0;x<u;x++){for(var T=[],C=0,A=0;A<c;A++){var R=y[x*c+A];T.push(R),C+=R*h[A]}if(C<0||C>=a/s)throw new Error("Invalid indices: "+T+" does not index into "+i);for(var k=0;k<s;k++)m?E.values[C*s+k]+=_[x*s+k]:E.values[C*s+k]=n.rank===0?_[0]:_[x*s+k]}return E.toTensor().reshape(i)},e}(lI);$.registerBackend("cpu",function(){return new eW},1);for(var Xy=0,ZT=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e,a=i.boxes,s=i.scores,u=n,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,m=u.softNmsSigma,v=t;_e(a,"NonMaxSuppressionWithScore");var y=y_(v.data.get(a.dataId).values,v.data.get(s.dataId).values,c,h,d,m);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t;_e(n,"square");for(var a=i.data.get(n.dataId).values,s=new Float32Array(a.length),u=0;u<a.length;++u){var c=a[u];s[u]=c*c}return{dataId:i.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:tf,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,a=n.b,s=t;_e([i,a],tf);var u=s.data.get(i.dataId).values,c=s.data.get(a.dataId).values,h=function(v,y,_,E,x,T){var C=ut(v,y),A=C.length,R=ua(C),k=Qh(x,Oe(C)),B=v.length,P=y.length,I=ua(v),D=ua(y),O=Xo(v,C),L=Xo(y,C);if(O.length+L.length===0)for(var F=0;F<k.length;++F)k[F]=T(_[F%_.length],E[F%E.length]);else{var V=function(ie){var se=c6(ie,A,R),G=se.slice(-B);O.forEach(function(H){return G[H]=0});var Q=wT(G,B,I),te=se.slice(-P);L.forEach(function(H){return te[H]=0});var de=wT(te,P,D);k[ie]=T(_[Q],E[de])};for(F=0;F<k.length;++F)V(F)}return[k,C]}(i.shape,a.shape,u,c,i.dtype,function(v,y){var _=v-y;return _*_}),d=h[0],m=h[1];return{dataId:s.write(d,m,i.dtype),shape:m,dtype:i.dtype}}}];Xy<ZT.length;Xy++)FR(ZT[Xy]);var yl,tW=function(r){this.variableNames=["A"];var e=rr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},nW=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=rr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var $y=0,JT=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e.pixels,a=n.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,c=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=c[0],d=c[1],m=[d,h],v=[d,h,a];(u||s)&&(yl==null&&(yl=document.createElement("canvas").getContext("2d")),yl.canvas.width=h,yl.canvas.height=d,yl.drawImage(i,0,0,h,d),i=yl.canvas);var y=t.makeTensorInfo(m,"int32");t.texData.get(y.dataId).usage=zr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(y.dataId),i);var _=me().getBool("WEBGL_PACK")?new nW(v):new tW(v),E=t.runWebGLProgram(_,[y],"int32");return t.disposeData(y.dataId),E}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs;im("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,a=i.boxes,s=i.scores,u=n,c=u.maxOutputSize,h=u.iouThreshold,d=u.scoreThreshold,m=u.softNmsSigma,v=t,y=y_(v.readSync(a.dataId),v.readSync(s.dataId),c,h,d,m);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t,a=new et(n.shape,"return x * x;");return i.runWebGLProgram(a,[n],n.dtype)}},{kernelName:tf,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,a=n.b,s=t,u=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ka("return (a - b) * (a - b);",i.shape,a.shape):new Zt("return (a - b) * (a - b);",i.shape,a.shape);return s.compileAndRun(u,[i,a])}}];$y<JT.length;$y++)FR(JT[$y]);for(var Yy=0,eS=[{kernelName:"Square",gradFunc:function(r,e){var t=e[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:tf,gradFunc:function(r,e){var t=e[0],n=e[1],i=Ce(2);return{a:function(){return ar(r,ar(i,Cn(t,n)))},b:function(){return ar(r,ar(i,Cn(n,t)))}}}}];Yy<eS.length;Yy++)JU(eS[Yy]);var rW=function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r}();me().get("IS_BROWSER")&&me().setPlatform("browser",new rW);var Qy,iW=function(){return require("node-fetch")},aW=function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return me().global.fetch!=null?me().global.fetch(e,t):(Qy==null&&(Qy=iW()),Qy(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();me().get("IS_NODE")&&me().setPlatform("node",new aW);var K0={float32:4,int32:4,uint16:2,uint8:1,bool:1},gm=4;function oD(r,e){for(var t={},n=0,i=function(u){var c=u.name,h=u.dtype,d=u.shape,m=Oe(d),v=void 0;if("quantization"in u){var y=u.quantization;if(y.dtype!=="uint8"&&y.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+y.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var _=K0[y.dtype],E=r.slice(n,n+m*_),x=y.dtype==="uint8"?new Uint8Array(E):new Uint16Array(E);if(h==="float32")v=Float32Array.from(x,function(B){return B*y.scale+y.min});else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+h);v=Int32Array.from(x,function(B){return Math.round(B*y.scale+y.min)})}n+=m*_}else if(h==="string"){var T=Oe(u.shape);v=[];for(var C=0;C<T;C++){var A=new Uint32Array(r.slice(n,n+gm))[0];n+=gm;var R=new Uint8Array(r.slice(n,n+A));v.push(R),n+=A}}else{var k=K0[h];if(E=r.slice(n,n+m*k),h==="float32")v=new Float32Array(E);else if(h==="int32")v=new Int32Array(E);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+h);v=new Uint8Array(E)}n+=m*k}t[c]=Gn(v,d,h)},a=0,s=e;a<s.length;a++)i(s[a]);return t}function oW(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(e),i=0;return t.forEach(function(a){n.set(new Uint8Array(a.buffer),i),i+=a.byteLength}),n.buffer}var X0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function tS(r){return X0?Buffer.byteLength(r):new Blob([r]).size}function F_(r){var e=0;r.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(i){t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function nS(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function Ef(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:tS(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:tS(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var jr=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(a){var s=a(e,n);s!==null&&i.push(s)}),i},r}(),Ll="://",ts=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){W(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Ll)&&(e=e.slice(0,e.indexOf(Ll))),W(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();W(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function Ip(r){if(r.indexOf(Ll)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ts.getSchemes().join(","));return{scheme:r.split(Ll)[0],path:r.split(Ll)[1]}}function rS(r,e,t){return t===void 0&&(t=!1),De(this,void 0,void 0,function(){var n,i,a,s,u,c,h,d,m;return Ne(this,function(v){switch(v.label){case 0:return W(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),W((n=jr.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),W(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),i=n[0],W((a=jr.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),W(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),s=a[0],u=Ip(r).scheme,c=Ip(r).path,h=u===Ip(r).scheme,[4,i.load()];case 1:return d=v.sent(),t&&h?[4,ts.getManager(u).removeModel(c)]:[3,3];case 2:v.sent(),v.label=3;case 3:return[4,s.save(d)];case 4:return m=v.sent(),!t||h?[3,6]:[4,ts.getManager(u).removeModel(c)];case 5:v.sent(),v.label=6;case 6:return[2,m.modelArtifactsInfo]}})})}var ou="models_store",$o="model_info_store";function sD(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function $0(r){var e=r.result;e.createObjectStore(ou,{keyPath:"modelPath"}),e.createObjectStore($o,{keyPath:"modelPath"})}var Fl=function(){function r(e){if(this.indexedDB=sD(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return De(this,void 0,void 0,function(){return Ne(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return De(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(i,a){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return $0(s)},s.onsuccess=function(){var u=s.result;if(t==null){var c=u.transaction(ou,"readonly"),h=c.objectStore(ou).get(n.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),a(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(h.result.modelArtifacts)},h.onerror=function(E){return u.close(),a(h.error)},c.oncomplete=function(){return u.close()}}else{var d,m=Ef(t),v=u.transaction($o,"readwrite"),y=v.objectStore($o),_=y.put({modelPath:n.modelPath,modelArtifactsInfo:m});_.onsuccess=function(){var E=(d=u.transaction(ou,"readwrite")).objectStore(ou).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:m});E.onsuccess=function(){return i({modelArtifactsInfo:m})},E.onerror=function(x){var T=(y=v.objectStore($o)).delete(n.modelPath);T.onsuccess=function(){return u.close(),a(E.error)},T.onerror=function(C){return u.close(),a(E.error)}}},_.onerror=function(E){return u.close(),a(_.error)},v.oncomplete=function(){d==null?u.close():d.oncomplete=function(){return u.close()}}}},s.onerror=function(u){return a(s.error)}})},r.URL_SCHEME="indexeddb://",r}(),iS=function(r){return me().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Fl.URL_SCHEME)?(e=r.slice(Fl.URL_SCHEME.length),new Fl(e)):null;var e};jr.registerSaveRouter(iS),jr.registerLoadRouter(iS);var sW=function(){function r(){this.indexedDB=sD()}return r.prototype.listModels=function(){return De(this,void 0,void 0,function(){var e=this;return Ne(this,function(t){return[2,new Promise(function(n,i){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return $0(a)},a.onsuccess=function(){var s=a.result,u=s.transaction($o,"readonly"),c=u.objectStore($o).getAll();c.onsuccess=function(){for(var h={},d=0,m=c.result;d<m.length;d++){var v=m[d];h[v.modelPath]=v.modelArtifactsInfo}n(h)},c.onerror=function(h){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}},a.onerror=function(s){return i(a.error)}})]})})},r.prototype.removeModel=function(e){return De(this,void 0,void 0,function(){var t=this;return Ne(this,function(n){var i;return e=(i=e).startsWith(Fl.URL_SCHEME)?i.slice(Fl.URL_SCHEME.length):i,[2,new Promise(function(a,s){var u=t.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return $0(u)},u.onsuccess=function(){var c,h=u.result,d=h.transaction($o,"readwrite"),m=d.objectStore($o),v=m.get(e);v.onsuccess=function(){if(v.result==null)return h.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var y=m.delete(e),_=function(){var E=(c=h.transaction(ou,"readwrite")).objectStore(ou).delete(e);E.onsuccess=function(){return a(v.result.modelArtifactsInfo)},E.onerror=function(x){return s(v.error)}};y.onsuccess=_,y.onerror=function(E){return _(),h.close(),s(v.error)}},v.onerror=function(y){return h.close(),s(v.error)},d.oncomplete=function(){c==null?h.close():c.oncomplete=function(){return h.close()}}},u.onerror=function(c){return s(u.error)}})]})})},r}();if(me().getBool("IS_BROWSER"))try{ts.registerManager(Fl.URL_SCHEME,new sW)}catch{}var Xa="/",Rl="tensorflowjs_models",uD="info",uW="model_topology",lW="weight_specs",cW="weight_data",hW="model_metadata";function lD(r){return{info:[Rl,r,uD].join(Xa),topology:[Rl,r,uW].join(Xa),weightSpecs:[Rl,r,lW].join(Xa),weightData:[Rl,r,cW].join(Xa),modelMetadata:[Rl,r,hW].join(Xa)}}function fW(r){var e=r.split(Xa);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(Xa)}var Bl=function(){function r(e){if(!me().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=lD(this.modelPath)}return r.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,n,i;return Ne(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=Ef(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(s){if(X0)return Buffer.from(s).toString("base64");for(var u=new Uint8Array(s),c="",h=0,d=u.length;h<d;h++)c+=String.fromCharCode(u[h]);return btoa(c)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,n,i,a,s,u;return Ne(this,function(c){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(a),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(h){if(X0){var d=Buffer.from(h,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var m=atob(h),v=new Uint8Array(m.length),y=0;y<m.length;++y)v.set([m.charCodeAt(y)],y);return v.buffer}(u),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),aS=function(r){return me().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Bl.URL_SCHEME)?(e=r.slice(Bl.URL_SCHEME.length),new Bl(e)):null;var e};jr.registerSaveRouter(aS),jr.registerLoadRouter(aS);var dW=function(){function r(){W(me().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),W(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return De(this,void 0,void 0,function(){var e,t,n,i,a,s;return Ne(this,function(u){for(e={},t=Rl+Xa,n=Xa+uD,i=0;i<this.LS.length;++i)(a=this.LS.key(i)).startsWith(t)&&a.endsWith(n)&&(s=fW(a),e[s]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},r.prototype.removeModel=function(e){return De(this,void 0,void 0,function(){var t,n;return Ne(this,function(i){var a;if(e=(a=e).startsWith(Bl.URL_SCHEME)?a.slice(Bl.URL_SCHEME.length):a,t=lD(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r}();if(me().getBool("IS_BROWSER"))try{ts.registerManager(Bl.URL_SCHEME,new dW)}catch{}var pW="model",mW=".json",vW=".weights.bin";function oS(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Zy=function(){function r(e){if(!me().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=pW),this.modelTopologyFileName=e+mW,this.weightDataFileName=e+vW}return r.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u;return Ne(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=a,[4,oS(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=t,[4,oS(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Ef(e)}]}})})},r.URL_SCHEME="downloads://",r}(),gW=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,n=this;return Ne(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(a,s){var u=new FileReader;u.onload=function(c){var h=JSON.parse(c.target.result),d=h.modelTopology;if(d!=null){t.length===0&&a({modelTopology:d});var m=h.weightsManifest;if(m!=null){var v;try{v=n.checkManifestAndWeightFiles(m,t)}catch(x){return void s(x)}var y=[],_=[],E=[];m.forEach(function(x){x.paths.forEach(function(T){_.push(T),E.push(null)}),y.push.apply(y,x.weights)}),m.forEach(function(x){x.paths.forEach(function(T){var C=new FileReader;C.onload=function(A){var R=A.target.result,k=_.indexOf(T);E[k]=R,E.indexOf(null)===-1&&a({modelTopology:d,weightSpecs:y,weightData:F_(E),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},C.onerror=function(A){return s("Failed to weights data from file of path '"+T+"'.")},C.readAsArrayBuffer(v[T])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},u.onerror=function(c){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(e)})]})})},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],i=t.map(function(c){return nS(c.name)}),a={},s=0,u=e;s<u.length;s++)u[s].paths.forEach(function(c){var h=nS(c);if(n.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(n.push(h),i.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");a[c]=t[i.indexOf(h)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},r}();function sS(r,e,t,n){(function(a){W(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(r),function(a,s){W(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),W(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),W(s>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+s})}(t=t??0,n=n??1);var i=0;return Promise.all(r.map(function(a){return a.then(function(s){var u=t+ ++i/r.length*(n-t);return e(u),s}),a}))}function cD(r,e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u,c,h,d;return Ne(this,function(m){switch(m.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?me().platform.fetch:e.fetchFunc,n=r.map(function(v){return t(v,e.requestInit,{isBinary:!0})}),i=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=m.sent(),[3,4];case 2:return[4,sS(n,e.onProgress,i,a)];case 3:s=m.sent(),m.label=4;case 4:return u=s.map(function(v){return v.arrayBuffer()}),c=.5,h=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return d=m.sent(),[3,8];case 6:return[4,sS(u,e.onProgress,c,h)];case 7:d=m.sent(),m.label=8;case 8:return[2,d]}})})}function uS(r){var e=this;return function(t,n,i){return n===void 0&&(n=""),De(e,void 0,void 0,function(){var a,s,u,c,h,d,m,v,y,_;return Ne(this,function(E){switch(E.label){case 0:if(a=t.map(function(){return!1}),s={},u=i!=null?i.map(function(){return!1}):[],c=[],t.forEach(function(x,T){var C=0;x.weights.forEach(function(A){var R="quantization"in A?A.quantization.dtype:A.dtype,k=K0[R]*Oe(A.shape),B=function(){a[T]=!0,s[T]==null&&(s[T]=[]),s[T].push({manifestEntry:A,groupOffset:C,sizeBytes:k})};i!=null?i.forEach(function(P,I){P===A.name&&(B(),u[I]=!0)}):B(),c.push(A.name),C+=k})}),!u.every(function(x){return x}))throw h=i.filter(function(x,T){return!u[T]}),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return d=a.reduce(function(x,T,C){return T&&x.push(C),x},[]),m=[],d.forEach(function(x){t[x].paths.forEach(function(T){var C=n+(n.endsWith("/")?"":"/")+T;m.push(C)})}),[4,r(m)];case 1:return v=E.sent(),y={},_=0,d.forEach(function(x){for(var T=t[x].paths.length,C=0,A=0;A<T;A++)C+=v[_+A].byteLength;for(var R=new ArrayBuffer(C),k=new Uint8Array(R),B=0,P=0;P<T;P++){var I=new Uint8Array(v[_+P]);k.set(I,B),B+=I.byteLength}s[x].forEach(function(D){var O=oD(R.slice(D.groupOffset,D.groupOffset+D.sizeBytes),[D.manifestEntry]);for(var L in O)y[L]=O[L]}),_+=T}),[2,y]}})})}}jr.registerSaveRouter(function(r){return me().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Zy.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new Zy(e)}(r.slice(Zy.URL_SCHEME.length)):null});var hD=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(W(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=me().platform.fetch,W(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&W(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return De(this,void 0,void 0,function(){var t,n,i,a;return Ne(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=s.sent()).ok)return[2,{modelArtifactsInfo:Ef(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},r.prototype.load=function(){return De(this,void 0,void 0,function(){var e,t,n,i,a,s,u,c,h,d,m,v;return Ne(this,function(y){switch(y.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=y.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");y.label=2;case 2:return y.trys.push([2,4,,5]),[4,e.json()];case 3:return t=y.sent(),[3,5];case 4:throw y.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,a=t.weightsManifest,s=t.generatedBy,u=t.convertedBy,c=t.format,h=t.userDefinedMetadata,i==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:v=y.sent(),d=v[0],m=v[1],y.label=7;case 7:return[2,{modelTopology:i,weightSpecs:d,weightData:m,userDefinedMetadata:h,generatedBy:s,convertedBy:u,format:c}]}})})},r.prototype.loadWeights=function(e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u,c,h,d,m,v;return Ne(this,function(y){switch(y.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(_){var E=_.lastIndexOf("/"),x=_.lastIndexOf("?"),T=_.substring(0,E),C=x>E?_.substring(x):"";return[T+"/",C]}(t),i=n[0],a=n[1],s=this.weightPathPrefix||i,u=[],c=0,h=e;c<h.length;c++)d=h[c],u.push.apply(u,d.weights);return m=[],e.forEach(function(_){_.paths.forEach(function(E){m.push(s+E+a)})}),[4,cD(m,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return v=y.sent(),[2,[u,F_(v)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function Y0(r){return r.match(hD.URL_SCHEME_REGEX)!=null}var lS=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return Y0(t)}):Y0(r))?Q0(r,{onProgress:e}):null};function Q0(r,e){return new hD(r,e)}jr.registerSaveRouter(lS),jr.registerLoadRouter(lS);var Jy=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return De(this,void 0,void 0,function(){return Ne(this,function(e){return[2,this.modelArtifacts]})})},r}(),yW=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return De(this,void 0,void 0,function(){return Ne(this,function(t){return[2,this.saveHandler(e)]})})},r}(),fD=Object.freeze({browserFiles:function(r){return new gW(r)},browserHTTPRequest:function(r,e){return Q0(r,e)},concatenateArrayBuffers:F_,decodeWeights:oD,encodeWeights:function(r,e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u=this;return Ne(this,function(c){switch(c.label){case 0:for(t=[],n=[],i=Array.isArray(r)?r.map(function(h){return h.name}):Object.keys(r),a=function(h){var d=i[h],m=Array.isArray(r)?r[h].tensor:r[d];if(m.dtype!=="float32"&&m.dtype!=="int32"&&m.dtype!=="bool"&&m.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+m.dtype);var v={name:d,shape:m.shape,dtype:m.dtype};if(m.dtype==="string"){var y=new Promise(function(_){return De(u,void 0,void 0,function(){var E,x,T,C,A,R,k;return Ne(this,function(B){switch(B.label){case 0:return[4,m.bytes()];case 1:for(E=B.sent(),x=E.reduce(function(P,I){return P+I.length},0)+gm*E.length,T=new Uint8Array(x),C=0,A=0;A<E.length;A++)R=E[A],k=new Uint8Array(new Uint32Array([R.length]).buffer),T.set(k,C),C+=gm,T.set(R,C),C+=R.length;return _(T),[2]}})})});n.push(y)}else n.push(m.data());e!=null&&(v.group=e),t.push(v)},s=0;s<i.length;++s)a(s);return[4,Promise.all(n)];case 1:return[2,{data:oW(c.sent()),specs:t}]}})})},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new Jy(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jy({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jy({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return jr.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:Ef,getSaveHandlers:function(r){return jr.getSaveHandlers(r)},http:Q0,isHTTPScheme:Y0,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),De(this,void 0,void 0,function(){return Ne(this,function(i){return[2,uS(function(a){return cD(a,{requestInit:n})})(r,e,t)]})})},registerLoadRouter:function(r){return jr.registerLoadRouter(r)},registerSaveRouter:function(r){return jr.registerSaveRouter(r)},weightsLoaderFactory:uS,withSaveHandler:function(r){return new yW(r)},copyModel:function(r,e){return De(this,void 0,void 0,function(){return Ne(this,function(t){return[2,rS(r,e,!1)]})})},listModels:function(){return De(this,void 0,void 0,function(){var r,e,t,n,i,a,s;return Ne(this,function(u){switch(u.label){case 0:r=ts.getSchemes(),e={},t=0,n=r,u.label=1;case 1:return t<n.length?(i=n[t],[4,ts.getManager(i).listModels()]):[3,4];case 2:for(s in a=u.sent())e[i+Ll+s]=a[s];u.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(r,e){return De(this,void 0,void 0,function(){return Ne(this,function(t){return[2,rS(r,e,!0)]})})},removeModel:function(r){return De(this,void 0,void 0,function(){var e;return Ne(this,function(t){return e=Ip(r),[2,ts.getManager(e.scheme).removeModel(e.path)]})})}}),bl;K({confusionMatrix_:function(r,e,t){var n=j(r,"labels","confusionMatrix"),i=j(e,"predictions","confusionMatrix");W(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),W(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),W(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),W(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),W(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var a=j0(n.asType("int32"),t),s=j0(i.asType("int32"),t);return a.transpose().matMul(s).asType("int32")}});var bW=K({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,i=!1,a=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)a=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);s=!0}if(i&&i&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(LR("FromPixels",$.backendName)!=null)return $.runKernel("FromPixels",{pixels:r},{numChannels:e});var u,c,h=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=h[0],m=h[1];if(s?u=r.getContext("2d").getImageData(0,0,d,m).data:n||t?u=r.data:(a||i)&&(bl==null&&(bl=document.createElement("canvas").getContext("2d")),bl.canvas.width=d,bl.canvas.height=m,bl.drawImage(r,0,0,d,m),u=bl.getImageData(0,0,d,m).data),e===4)c=new Int32Array(u);else{var v=d*m;c=new Int32Array(v*e);for(var y=0;y<v;y++)for(var _=0;_<e;++_)c[y*e+_]=u[4*y+_]}return f_(c,[m,d,e],"int32")}}),B_=Object.freeze({toPixels:function(r,e){return De(this,void 0,void 0,function(){var t,n,i,a,s,u,c,h,d,m,v,y,_,E,x,T,C,A,R,k,B,P,I;return Ne(this,function(D){switch(D.label){case 0:if(t=j(r,"img","toPixels"),r instanceof Gt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],a=n[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return u=D.sent(),c=t.min(),h=t.max(),[4,Promise.all([c.data(),h.data()])];case 2:if(d=D.sent(),m=d[0],v=d[1],y=m[0],_=v[0],c.dispose(),h.dispose(),t.dtype==="float32"){if(y<0||_>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+y+" - "+_+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(y<0||_>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+y+" - "+_+"].")}for(E=t.dtype==="float32"?255:1,x=new Uint8ClampedArray(a*i*4),T=0;T<i*a;++T)C=void 0,A=void 0,R=void 0,k=void 0,s===1?(C=u[T]*E,A=u[T]*E,R=u[T]*E,k=255):s===3?(C=u[3*T]*E,A=u[3*T+1]*E,R=u[3*T+2]*E,k=255):s===4&&(C=u[4*T]*E,A=u[4*T+1]*E,R=u[4*T+2]*E,k=u[4*T+3]*E),x[(B=4*T)+0]=Math.round(C),x[B+1]=Math.round(A),x[B+2]=Math.round(R),x[B+3]=Math.round(k);return e!=null&&(e.width=a,e.height=i,P=e.getContext("2d"),I=new ImageData(x,a,i),P.putImageData(I,0,0)),t!==r&&t.dispose(),[2,x]}})})},fromPixels:bW}),_W=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),wW=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function Tu(r){W(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),W(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),W(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),wW.register(r)}var Su=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Ni(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var a=this.computeGradients(t,i),s=a.value,u=a.grads;if(i!=null){var c=i.map(function(h){return{name:h.name,tensor:u[h.name]}});this.applyGradients(c)}else this.applyGradients(u);return Sr(u),n?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return N5(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Sr(this.iterations_)},e.prototype.saveIterations=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ce(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return De(this,void 0,void 0,function(){var n;return Ne(this,function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(_W);Object.defineProperty(Su,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var xW=function(r){function e(t,n,i){i===void 0&&(i=null);var a=r.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],i==null&&(a.epsilon=$.backend.epsilon()),a}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var s=$.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accum_grad",variable:Re(function(){return gt(s).variable(!1)})}),n.accumulatedUpdates[a]==null&&(n.accumulatedUpdates[a]={originalName:i+"/accum_var",variable:Re(function(){return gt(s).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=n.accumulatedGrads[a].variable,h=n.accumulatedUpdates[a].variable;Re(function(){var d=c.mul(n.rho).add(u.square().mul(1-n.rho)),m=h.add(n.epsilon).sqrt().div(c.add(n.epsilon).sqrt()).mul(u),v=h.mul(n.rho).add(m.square().mul(1-n.rho));c.assign(d),h.assign(v);var y=m.mul(-n.learningRate).add(s);s.assign(y)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Sr(this.accumulatedGrads.map(function(t){return t.variable})),Sr(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Ne(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var n;return Ne(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e}(Su);Tu(xW);var EW=function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var s=$.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accumulator",variable:Re(function(){return la(s.shape,n.initialAccumulatorValue).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=n.accumulatedGrads[a].variable;Re(function(){var h=c.add(u.square());c.assign(h);var d=u.div(h.add($.backend.epsilon()).sqrt()).mul(-n.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Sr(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e}(Su);Tu(EW);var TW=function(r){function e(t,n,i,a){a===void 0&&(a=null);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=i,s.epsilon=a,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],Re(function(){s.accBeta1=Ce(n).variable(),s.accBeta2=Ce(i).variable()}),a==null&&(s.epsilon=$.backend.epsilon()),s}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);Re(function(){var a=Cn(1,n.accBeta1),s=Cn(1,n.accBeta2);i.forEach(function(u,c){var h=$.registeredVariables[u];n.accumulatedFirstMoment[c]==null&&(n.accumulatedFirstMoment[c]={originalName:u+"/m",variable:Re(function(){return gt(h).variable(!1)})}),n.accumulatedSecondMoment[c]==null&&(n.accumulatedSecondMoment[c]={originalName:u+"/v",variable:Re(function(){return gt(h).variable(!1)})});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var m=n.accumulatedFirstMoment[c].variable,v=n.accumulatedSecondMoment[c].variable,y=m.mul(n.beta1).add(d.mul(1-n.beta1)),_=v.mul(n.beta2).add(d.square().mul(1-n.beta2)),E=y.div(a),x=_.div(s);m.assign(y),v.assign(_);var T=E.div(x.sqrt().add(n.epsilon)).mul(-n.learningRate).add(h);h.assign(T)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Sr(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Sr(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Ne(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var n,i=this;return Ne(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),Re(function(){i.accBeta1.assign(mm(i.beta1,i.iterations_+1)),i.accBeta2.assign(mm(i.beta2,i.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e}(Su);Tu(TW);var SW=function(r){function e(t,n,i,a,s){a===void 0&&(a=null),s===void 0&&(s=0);var u=r.call(this)||this;return u.learningRate=t,u.beta1=n,u.beta2=i,u.epsilon=a,u.decay=s,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],Re(function(){u.iteration=Ce(0).variable(),u.accBeta1=Ce(n).variable()}),a==null&&(u.epsilon=$.backend.epsilon()),u}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);Re(function(){var a=Cn(1,n.accBeta1),s=bi(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(u,c){var h=$.registeredVariables[u];n.accumulatedFirstMoment[c]==null&&(n.accumulatedFirstMoment[c]={originalName:u+"/m",variable:gt(h).variable(!1)}),n.accumulatedWeightedInfNorm[c]==null&&(n.accumulatedWeightedInfNorm[c]={originalName:u+"/v",variable:gt(h).variable(!1)});var d=Array.isArray(t)?t[c].tensor:t[u];if(d!=null){var m=n.accumulatedFirstMoment[c].variable,v=n.accumulatedWeightedInfNorm[c].variable,y=m.mul(n.beta1).add(d.mul(1-n.beta1)),_=v.mul(n.beta2),E=d.abs(),x=_.maximum(E);m.assign(y),v.assign(x);var T=s.div(a).mul(y.div(x.add(n.epsilon))).add(h);h.assign(T)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Sr(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Sr(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e}(Su);Tu(SW);var dD=function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var s=Array.isArray(t)?t[a].tensor:t[i];if(s!=null){var u=$.registeredVariables[i];Re(function(){var c=n.c.mul(s).add(u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=q6(Ce(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e}(Su);Tu(dD);var CW=function(r){function e(t,n,i){i===void 0&&(i=!1);var a=r.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=i,a.accumulations=[],a.m=Ce(a.momentum),a}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var s=$.registeredVariables[i];n.accumulations[a]==null&&(n.accumulations[a]={originalName:i+"/momentum",variable:Re(function(){return gt(s).variable(!1)})});var u=n.accumulations[a].variable,c=Array.isArray(t)?t[a].tensor:t[i];c!=null&&Re(function(){var h,d=n.m.mul(u).add(c);h=n.useNesterov?n.c.mul(c.add(d.mul(n.m))).add(s):n.c.mul(d).add(s),u.assign(d),s.assign(h)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Sr(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){return Ne(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){return Ne(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e}(dD);Tu(CW);var AW=function(r){function e(t,n,i,a,s){n===void 0&&(n=.9),i===void 0&&(i=0),a===void 0&&(a=null),s===void 0&&(s=!1);var u=r.call(this)||this;if(u.learningRate=t,u.decay=n,u.momentum=i,u.epsilon=a,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=s,a==null&&(u.epsilon=$.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return u}return Ni(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var s=$.registeredVariables[i];n.accumulatedMeanSquares[a]==null&&(n.accumulatedMeanSquares[a]={originalName:i+"/rms",variable:Re(function(){return gt(s).variable(!1)})}),n.accumulatedMoments[a]==null&&(n.accumulatedMoments[a]={originalName:i+"/momentum",variable:Re(function(){return gt(s).variable(!1)})}),n.accumulatedMeanGrads[a]==null&&n.centered&&(n.accumulatedMeanGrads[a]={originalName:i+"/mg",variable:Re(function(){return gt(s).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var c=n.accumulatedMeanSquares[a].variable,h=n.accumulatedMoments[a].variable;Re(function(){var d=c.mul(n.decay).add(u.square().mul(1-n.decay));if(n.centered){var m=n.accumulatedMeanGrads[a].variable,v=m.mul(n.decay).add(u.mul(1-n.decay)),y=h.mul(n.momentum).add(u.mul(n.learningRate).div(d.sub(v.square().add(n.epsilon)).sqrt()));c.assign(d),m.assign(v),h.assign(y);var _=s.sub(y);s.assign(_)}else{var E=c.mul(n.decay).add(u.square().mul(1-n.decay));y=h.mul(n.momentum).add(u.mul(n.learningRate).div(E.add(n.epsilon).sqrt())),c.assign(E),h.assign(y),_=s.sub(y),s.assign(_)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Sr(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Sr(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Sr(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return De(this,void 0,void 0,function(){var t;return Ne(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return De(this,void 0,void 0,function(){var n;return Ne(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e}(Su);Tu(AW);Gt.prototype.squaredDifference=function(r){return RI(this,r)},he=JH;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Z0=function(r,e){return Z0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Z0(r,e)};function Ye(r,e){Z0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var nr=function(){return nr=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},nr.apply(this,arguments)};function Pe(r,e,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function u(d){try{h(n.next(d))}catch(m){s(m)}}function c(d){try{h(n.throw(d))}catch(m){s(m)}}function h(d){d.done?a(d.value):i(d.value).then(u,c)}h((n=n.apply(r,[])).next())})}function Le(r,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(h){return function(d){return c([h,d])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(d){h=[6,d],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Vh(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),i=0,e=0;e<t;e++)for(var a=arguments[e],s=0,u=a.length;s<u;s++,i++)n[i]=a[s];return n}var Vl=function(){function r(e,t){if(!su(e)||!su(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function iv(r,e){return r instanceof Gt&&r.shape.length===e}function RW(r){return iv(r,2)}function av(r){return iv(r,3)}function ns(r){return iv(r,4)}function IW(r){return r%1!==0}function cS(r){return r%2===0}function DW(r,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(r*t)/t}function hS(r){return r&&r.width&&r.height}function NW(r,e){var t=r.width,n=r.height,i=e/Math.max(n,t);return new Vl(Math.round(t*i),Math.round(n*i))}function V_(r){return r.reduce(function(e,t){return e.add(t)},new _t(0,0)).div(new _t(r.length,r.length))}function nf(r,e,t){return Array(r).fill(0).map(function(n,i){return e+i*t})}function su(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function fS(r){return su(r)&&0<=r&&r<=1}var _t=function(){function r(e,t){this._x=e,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.sub=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.mul=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.div=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}(),hs=function(){function r(e,t){t===void 0&&(t=!0);var n=e||{},i=[n.left,n.top,n.right,n.bottom].every(su),a=[n.x,n.y,n.width,n.height].every(su);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var s=a?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],u=s[0],c=s[1],h=s[2],d=s[3];r.assertIsValidBox({x:u,y:c,width:h,height:d},"Box.constructor",t),this._x=u,this._y=c,this._width=h,this._height=d}return r.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(su)},r.assertIsValidBox=function(e,t,n){if(n===void 0&&(n=!1),!r.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new _t(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new _t(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new _t(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new _t(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),t=e[0],n=e[1],i=e[2],a=e[3];return new r({x:t,y:n,width:i,height:a})},r.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),t=e[0],n=e[1],i=e[2],a=e[3];return new r({x:t,y:n,width:i,height:a})},r.prototype.toSquare=function(){var e=this,t=e.x,n=e.y,i=e.width,a=e.height,s=Math.abs(i-a);return i<a&&(t-=s/2,i+=s),a<i&&(n-=s/2,a+=s),new r({x:t,y:n,width:i,height:a})},r.prototype.rescale=function(e){var t=hS(e)?e.width:e,n=hS(e)?e.height:e;return new r({x:this.x*t,y:this.y*n,width:this.width*t,height:this.height*n})},r.prototype.pad=function(e,t){var n=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=n[0],a=n[1],s=n[2],u=n[3];return new r({x:i,y:a,width:s,height:u})},r.prototype.clipAtImageBorders=function(e,t){var n=this,i=n.x,a=n.y,s=n.right,u=n.bottom,c=Math.max(i,0),h=Math.max(a,0),d=s-c,m=u-h,v=Math.min(d,e-c),y=Math.min(m,t-h);return new r({x:c,y:h,width:v,height:y}).floor()},r.prototype.shift=function(e,t){var n=this,i=n.width,a=n.height,s=this.x+e,u=this.y+t;return new r({x:s,y:u,width:i,height:a})},r.prototype.padAtBorders=function(e,t){var n=this.width+1,i=this.height+1,a=1,s=1,u=n,c=i,h=this.left,d=this.top,m=this.right,v=this.bottom;return m>t&&(u=-m+t+n,m=t),v>e&&(c=-v+e+i,v=e),h<1&&(c=2-h,h=1),d<1&&(c=2-d,d=1),{dy:s,edy:c,dx:a,edx:u,y:d,ey:v,x:h,ex:m,w:n,h:i}},r.prototype.calibrate=function(e){return new r({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},r}(),ov=function(r){Ye(e,r);function e(t,n,i,a,s){return s===void 0&&(s=!1),r.call(this,{left:t,top:n,right:i,bottom:a},s)||this}return e}(hs),pD=function(){function r(e,t,n,i,a){this._imageDims=new Vl(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new hs(i).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new hs(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},r}(),ba=function(r){Ye(e,r);function e(t,n,i){return r.call(this,t,t,"",n,i)||this}return e.prototype.forSize=function(t,n){var i=r.prototype.forSize.call(this,t,n),a=i.score,s=i.relativeBox,u=i.imageDims;return new e(a,s,u)},e}(pD);function kW(r,e,t){t===void 0&&(t=!0);var n=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),i=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top)),a=n*i;return t?a/(r.area+e.area-a):a/Math.min(r.area,e.area)}function OW(r){var e=r.map(function(u){return u.x}),t=r.map(function(u){return u.y}),n=e.reduce(function(u,c){return c<u?c:u},1/0),i=t.reduce(function(u,c){return c<u?c:u},1/0),a=e.reduce(function(u,c){return u<c?c:u},0),s=t.reduce(function(u,c){return u<c?c:u},0);return new ov(n,i,a,s)}function rf(r,e,t,n){n===void 0&&(n=!0);for(var i=e.map(function(u,c){return{score:u,boxIndex:c}}).sort(function(u,c){return u.score-c.score}).map(function(u){return u.boxIndex}),a=[],s=function(){var u=i.pop();a.push(u);for(var c=i,h=[],d=0;d<c.length;d++){var m=c[d],v=r[u],y=r[m];h.push(kW(v,y,n))}i=i.filter(function(_,E){return h[E]<=t})};i.length>0;)s();return a}function Tf(r,e){return Re(function(){var t=e[0],n=e[1],i=e[2],a=la(Vh(r.shape.slice(0,3),[1]),t),s=la(Vh(r.shape.slice(0,3),[1]),n),u=la(Vh(r.shape.slice(0,3),[1]),i),c=xn([a,s,u],3);return Cn(r,c)})}function MW(r,e){return e===void 0&&(e=!1),Re(function(){var t=r.shape.slice(1),n=t[0],i=t[1];if(n===i)return r;var a=Math.abs(n-i),s=Math.round(a*(e?.5:1)),u=n>i?2:1,c=function(y){var _=r.shape.slice();return _[u]=y,la(_,0)},h=c(s),d=a-h.shape[u],m=e&&d?c(d):null,v=[m,r,h].filter(function(y){return!!y}).map(function(y){return y.toFloat()});return xn(v,u)})}function e0(r){return 1/(1+Math.exp(-r))}var U_=function(r){Ye(e,r);function e(t,n,i,a,s){return s===void 0&&(s=!1),r.call(this,{x:t,y:n,width:i,height:a},s)||this}return e}(hs),PW=.5,LW=.43,FW=.45,ym=function(){function r(e,t,n){n===void 0&&(n=new _t(0,0));var i=t.width,a=t.height;this._imgDims=new Vl(i,a),this._shift=n,this._positions=e.map(function(s){return s.mul(new _t(i,a)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new _t(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new _t(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},r.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new _t(e,t))},r.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},r.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var n=e instanceof ba?e.box.floor():new hs(e);return this.shiftBy(n.x,n.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=i.useDlibAlignment,s=i.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(s)},r.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],i=e[2],a=function(m){return i.sub(m).magnitude()},s=(a(t)+a(n))/2,u=Math.floor(s/FW),c=V_(e),h=Math.floor(Math.max(0,c.x-PW*u)),d=Math.floor(Math.max(0,c.y-LW*u));return new U_(h,d,Math.min(u,this.imageWidth+h),Math.min(u,this.imageHeight+d))},r.prototype.alignMinBbox=function(e){var t=OW(this.positions);return t.pad(t.width*e,t.height*e)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}(),BW=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],V_([t[3],t[4]])]},e}(ym),VW=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(V_)},e}(ym),dS=function(){function r(e,t){this._label=e,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+DW(this.distance)+")":"")},r}(),pS=function(r){Ye(e,r);function e(t,n){var i=r.call(this,t)||this;return i._label=n,i}return e.assertIsValidLabeledBox=function(t,n){if(hs.assertIsValidBox(t,n),!su(t.label))throw new Error(n+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(hs),cp=function(){function r(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},r.fromJSON=function(e){var t=e.descriptors.map(function(n){return new Float32Array(n)});return new r(e.label,t)},r}();(function(r){Ye(e,r);function e(t,n,i,a){var s=r.call(this,t,n)||this;return s._score=i,s._classScore=a,s}return e.assertIsValidPredictedBox=function(t,n){if(pS.assertIsValidLabeledBox(t,n),!fS(t.score)||!fS(t.classScore))throw new Error(n+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(pS);function UW(r){return r.detection instanceof ba}function z_(r,e){var t={detection:e};return Object.assign({},r,t)}function mD(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:e}}function vD(r){var e="";if(!r)try{r=require("fs")}catch(n){e=n.toString()}var t=r?function(n){return new Promise(function(i,a){r.readFile(n,function(s,u){return s?a(s):i(u)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function gD(){var r=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=vD();return nr({Canvas:r||function(){function s(){}return s}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function s(){}return s}(),Image:e||function(){function s(){}return s}(),ImageData:global.ImageData||function(){function s(){}return s}(),Video:global.HTMLVideoElement||function(){function s(){}return s}(),createCanvasElement:t,createImageElement:n,fetch:i},a)}function yD(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function bD(){return typeof global=="object"&&typeof require=="function"&&typeof ZD<"u"&&typeof process<"u"&&!!process.version}var yn;function zW(){if(!yn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return yn}function J0(r){yn=r}function j_(){yD()&&J0(mD()),bD()&&J0(gD())}function jW(r){if(yn||j_(),!yn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=r.Canvas,t=e===void 0?yn.Canvas:e,n=r.Image,i=n===void 0?yn.Image:n;yn.Canvas=t,yn.Image=i,yn.createCanvasElement=r.createCanvasElement||function(){return new t},yn.createImageElement=r.createImageElement||function(){return new i},yn.ImageData=r.ImageData||yn.ImageData,yn.Video=r.Video||yn.Video,yn.fetch=r.fetch||yn.fetch,yn.readFile=r.readFile||yn.readFile}var sr={getEnv:zW,setEnv:J0,initialize:j_,createBrowserEnv:mD,createFileSystem:vD,createNodejsEnv:gD,monkeyPatch:jW,isBrowser:yD,isNodejs:bD};j_();function _D(r){return!sr.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function vu(r){var e=sr.getEnv(),t=e.Canvas,n=e.CanvasRenderingContext2D;if(r instanceof n)return r;var i=_D(r);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=i.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var mS;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(mS||(mS={}));function wD(r){var e=sr.getEnv(),t=e.Image,n=e.Video;return r instanceof t&&r.complete||r instanceof n&&r.readyState>=3}function HW(r){return new Promise(function(e,t){if(r instanceof sr.getEnv().Canvas||wD(r))return e();function n(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",i),e(a))}function i(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",i),t(a))}r.addEventListener("load",n),r.addEventListener("error",i)})}function xD(r){var e=sr.getEnv(),t=e.Image,n=e.Video;return r instanceof t?new Vl(r.naturalWidth,r.naturalHeight):r instanceof n?new Vl(r.videoWidth,r.videoHeight):new Vl(r.width,r.height)}function sv(r){var e=r.width,t=r.height,n=sr.getEnv().createCanvasElement,i=n();return i.width=e,i.height=t,i}function H_(r,e){var t=sr.getEnv().ImageData;if(!(r instanceof t)&&!wD(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=xD(r),i=n.width,a=n.height,s=sv({width:i,height:a});return r instanceof t?vu(s).putImageData(r,0,0):vu(s).drawImage(r,0,0,i,a),s}function WW(r,e){return Pe(this,void 0,void 0,function(){var t,n,i,a,s,u;return Le(this,function(c){switch(c.label){case 0:return t=sr.getEnv().createCanvasElement(),n=r.shape.slice(ns(r)?1:0),i=n[0],a=n[1],s=n[2],u=Re(function(){return r.as3D(i,a,s).toInt()}),[4,B_.toPixels(u,t)];case 1:return c.sent(),u.dispose(),[2,t]}})})}function vS(r){var e=sr.getEnv(),t=e.Image,n=e.Canvas,i=e.Video;return r instanceof t||r instanceof n||r instanceof i}function qW(r,e,t){t===void 0&&(t=!1);var n=sr.getEnv(),i=n.Image,a=n.Canvas;if(!(r instanceof i||r instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=xD(r),u=e/Math.max(s.height,s.width),c=u*s.width,h=u*s.height,d=sv({width:e,height:e}),m=r instanceof a?r:H_(r),v=Math.abs(c-h)/2,y=t&&c<h?v:0,_=t&&h<c?v:0;return vu(d).drawImage(m,y,_,c,h),d}var bm=function(){function r(e,t){var n=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,a){if(av(i)){n._imageTensors[a]=i,n._inputDimensions[a]=i.shape;return}if(ns(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");n._imageTensors[a]=i,n._inputDimensions[a]=i.shape.slice(1);return}var u=i instanceof sr.getEnv().Canvas?i:H_(i);n._canvases[a]=u,n._inputDimensions[a]=[u.height,u.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var e=this;return nf(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},r.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},r.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},r.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},r.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),n=this.getInputHeight(e);return NW({width:t,height:n},this.inputSize)},r.prototype.toBatchTensor=function(e,t){var n=this;return t===void 0&&(t=!0),this._inputSize=e,Re(function(){var i=nf(n.batchSize,0,1).map(function(s){var u=n.getInput(s);if(u instanceof Gt){var c=ns(u)?u:u.expandDims();return c=MW(c,t),(c.shape[1]!==e||c.shape[2]!==e)&&(c=k_.resizeBilinear(c,[e,e])),c.as3D(e,e,3)}if(u instanceof sr.getEnv().Canvas)return B_.fromPixels(qW(u,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+u)}),a=qr(i.map(function(s){return s.toFloat()})).as4D(n.batchSize,e,e,3);return a})},r}();function Ln(r){return Pe(this,void 0,void 0,function(){var e,t,n;return Le(this,function(i){switch(i.label){case 0:if(r instanceof bm)return[2,r];if(e=Array.isArray(r)?r:[r],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(a){return Array.isArray(r)?" at input index "+a+":":""},n=e.map(_D),n.forEach(function(a,s){if(!vS(a)&&!av(a)&&!ns(a))throw typeof e[s]=="string"?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ns(a)){var u=a.shape[0];if(u!==1)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+u+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(a){return vS(a)&&HW(a)}))];case 1:return i.sent(),[2,new bm(n,Array.isArray(r))]}})})}function W_(r,e){return Pe(this,void 0,void 0,function(){var t,n,i,a,s,u,c;return Le(this,function(h){switch(h.label){case 0:return t=sr.getEnv().Canvas,n=r,r instanceof t?[3,5]:[4,Ln(r)];case 1:if(i=h.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=i.getInput(0),a instanceof t?(s=a,[3,4]):[3,2];case 2:return[4,WW(a)];case 3:s=h.sent(),h.label=4;case 4:n=s,h.label=5;case 5:return u=vu(n),c=e.map(function(d){return d instanceof ba?d.forSize(n.width,n.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(n.width,n.height)}),[2,c.map(function(d){var m=d.x,v=d.y,y=d.width,_=d.height,E=sv({width:y,height:_});return vu(E).putImageData(u.getImageData(m,v,y,_),0,0),E})]}})})}function q_(r,e){return Pe(this,void 0,void 0,function(){return Le(this,function(t){if(!av(r)&&!ns(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ns(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Re(function(){var n=r.shape.slice(ns(r)?1:0),i=n[0],a=n[1],s=n[2],u=e.map(function(h){return h instanceof ba?h.forSize(a,i).box:h}).map(function(h){return h.clipAtImageBorders(a,i)}),c=u.map(function(h){var d=h.x,m=h.y,v=h.width,y=h.height;return $I(r.as3D(i,a,s),[m,d,0],[y,v,s])});return c})]})})}function GW(r,e){return Pe(this,void 0,void 0,function(){var t,n;return Le(this,function(i){switch(i.label){case 0:return t=sr.getEnv().fetch,[4,t(r,e)];case 1:if(n=i.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function KW(r){return Pe(this,void 0,void 0,function(){return Le(this,function(e){switch(e.label){case 0:return[4,GW(r)];case 1:return[2,e.sent().json()]}})})}function ED(r,e){var t=e+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var i=r.split("/").filter(function(u){return u}),a=r.endsWith(".json")?i[i.length-1]:t,s=n+(r.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=r.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+a:s+"/"+a}}function XW(r,e){return Pe(this,void 0,void 0,function(){var t,n,i,a;return Le(this,function(s){switch(s.label){case 0:return t=ED(r,e),n=t.manifestUri,i=t.modelBaseUri,[4,KW(n)];case 1:return a=s.sent(),[2,fD.loadWeights(a,i)]}})})}var lo=function(){function r(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),n=t.obj,i=t.objProp;return n[i]},r.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),i=n.obj,a=n.objProp;i[a].dispose(),i[a]=t},r.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Yl})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Yl)})},r.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,i=t.tensor;e.reassignParamFromPath(n,i.variable())})},r.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,i=t.tensor,a=Gn(i.dataSync());i.dispose(),e.reassignParamFromPath(n,a)})},r.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},r.prototype.load=function(e){return Pe(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(e){return Pe(this,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,XW(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(e){return Pe(this,void 0,void 0,function(){var t,n,i,a,s,u,c,h,d,m;return Le(this,function(v){switch(v.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=sr.getEnv().readFile,n=ED(e,this.getDefaultModelName()),i=n.manifestUri,a=n.modelBaseUri,s=function(y){return Promise.all(y.map(function(_){return t(_).then(function(E){return E.buffer})}))},u=fD.weightsLoaderFactory(s),d=(h=JSON).parse,[4,t(i)];case 1:return c=d.apply(h,[v.sent().toString()]),[4,u(c,a)];case 2:return m=v.sent(),this.loadFromWeightMap(m),[2]}})})},r.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(a,s){if(!a.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),n=t.obj,i=t.objProp;if(!n||!i||!(n[i]instanceof Gt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:i}},r}();function Hr(r,e,t){return Re(function(){var n=A_(r,e.depthwise_filter,e.pointwise_filter,t,"same");return n=at(n,e.bias),n})}function t0(r,e,t){return t===void 0&&(t=!1),Re(function(){var n=Kt(t?at(hi(r,e.conv0.filters,[2,2],"same"),e.conv0.bias):Hr(r,e.conv0,[2,2])),i=Hr(n,e.conv1,[1,1]),a=Kt(at(n,i)),s=Hr(a,e.conv2,[1,1]);return Kt(at(n,at(i,s)))})}function hp(r,e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!0),Re(function(){var i=Kt(t?at(hi(r,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):Hr(r,e.conv0,n?[2,2]:[1,1])),a=Hr(i,e.conv1,[1,1]),s=Kt(at(i,a)),u=Hr(s,e.conv2,[1,1]),c=Kt(at(i,at(a,u))),h=Hr(c,e.conv3,[1,1]);return Kt(at(i,at(a,at(u,h))))})}function Si(r,e,t,n){return t===void 0&&(t="same"),n===void 0&&(n=!1),Re(function(){var i=at(hi(r,e.filters,[1,1],t),e.bias);return n?Kt(i):i})}function co(r,e){Object.keys(r).forEach(function(t){e.some(function(n){return n.originalPath===t})||r[t].dispose()})}function uv(r,e){return function(t,n,i,a){var s=br(r(t*n*i*i),[i,i,t,n]),u=hn(r(n));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:s,bias:u}}}function G_(r,e){return function(t,n,i){var a=es(r(t*n),[t,n]),s=hn(r(n));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:s}}}var TD=function(){function r(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}return r}();function K_(r,e){return function(t,n,i){var a=br(r(9*t),[3,3,t,1]),s=br(r(t*n),[1,1,t,n]),u=hn(r(n));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new TD(a,s,u)}}function X_(r){return function(e){var t=r(e+"/depthwise_filter",4),n=r(e+"/pointwise_filter",4),i=r(e+"/bias",1);return new TD(t,n,i)}}function bs(r,e){return function(t,n,i){var a=r[t];if(!iv(a,n))throw new Error("expected weightMap["+t+"] to be a Tensor"+n+"D, instead have "+a);return e.push({originalPath:t,paramPath:i||t}),a}}function ho(r){var e=r;function t(i){var a=e.slice(0,i);return e=e.slice(i),a}function n(){return e}return{extractWeights:t,getRemainingWeights:n}}function SD(r,e){var t=uv(r,e),n=K_(r,e);function i(s,u,c,h){h===void 0&&(h=!1);var d=h?t(s,u,3,c+"/conv0"):n(s,u,c+"/conv0"),m=n(u,u,c+"/conv1"),v=n(u,u,c+"/conv2");return{conv0:d,conv1:m,conv2:v}}function a(s,u,c,h){h===void 0&&(h=!1);var d=i(s,u,c,h),m=d.conv0,v=d.conv1,y=d.conv2,_=n(u,u,c+"/conv3");return{conv0:m,conv1:v,conv2:y,conv3:_}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function $W(r){var e=[],t=ho(r),n=t.extractWeights,i=t.getRemainingWeights,a=SD(n,e).extractDenseBlock4Params,s=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2"),h=a(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:u,dense2:c,dense3:h}}}function CD(r){return function(e){var t=r(e+"/filters",4),n=r(e+"/bias",1);return{filters:t,bias:n}}}function AD(r,e){var t=bs(r,e),n=CD(t),i=X_(t);function a(u,c){c===void 0&&(c=!1);var h=c?n(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),m=i(u+"/conv2");return{conv0:h,conv1:d,conv2:m}}function s(u,c){c===void 0&&(c=!1);var h=c?n(u+"/conv0"):i(u+"/conv0"),d=i(u+"/conv1"),m=i(u+"/conv2"),v=i(u+"/conv3");return{conv0:h,conv1:d,conv2:m,conv3:v}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function YW(r){var e=[],t=AD(r,e).extractDenseBlock4Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return co(r,e),{params:n,paramMappings:e}}var RD=function(r){Ye(e,r);function e(){return r.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return Re(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Tf(i,a).div(Ce(255)),u=hp(s,n.dense0,!0);return u=hp(u,n.dense1),u=hp(u,n.dense2),u=hp(u,n.dense3),u=xf(u,[7,7],[2,2],"valid"),u})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return YW(t)},e.prototype.extractParams=function(t){return $W(t)},e}(lo);function na(r,e){return Re(function(){return at(tv(r,e.weights),e.bias)})}function QW(r,e,t){var n=[],i=ho(r),a=i.extractWeights,s=i.getRemainingWeights,u=G_(a,n),c=u(e,t,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:n,params:{fc:c}}}function ZW(r){var e=[],t=bs(r,e);function n(a){var s=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:s,bias:u}}var i={fc:n("fc")};return co(r,e),{params:i,paramMappings:e}}function ID(r){var e={},t={};return Object.keys(r).forEach(function(n){var i=n.startsWith("fc")?t:e;i[n]=r[n]}),{featureExtractorMap:e,classifierMap:t}}var DD=function(r){Ye(e,r);function e(t,n){var i=r.call(this,t)||this;return i._faceFeatureExtractor=n,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Re(function(){var a=t instanceof bm?n.faceFeatureExtractor.forwardInput(t):t;return na(a.as2D(a.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,a=n.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return QW(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var n=ID(t),i=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),ZW(a)},e.prototype.extractParams=function(t){var n=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),a=i*n+i,s=t.slice(0,t.length-a),u=t.slice(t.length-a);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(u)},e}(lo),gS=["neutral","happy","sad","angry","fearful","disgusted","surprised"],JW=function(){function r(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);gS.forEach(function(n,i){t[n]=e[i]})}return r.prototype.asSortedArray=function(){var e=this;return gS.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,n){return n.probability-t.probability})},r}(),eq=function(r){Ye(e,r);function e(t){return t===void 0&&(t=new RD),r.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var n=this;return Re(function(){return so(n.runNet(t))})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return Pe(this,void 0,void 0,function(){var n,i,a,s,u=this;return Le(this,function(c){switch(c.label){case 0:return[4,Ln(t)];case 1:return n=c.sent(),[4,this.forwardInput(n)];case 2:return i=c.sent(),[4,Promise.all(En(i).map(function(h){return Pe(u,void 0,void 0,function(){var d;return Le(this,function(m){switch(m.label){case 0:return[4,h.data()];case 1:return d=m.sent(),h.dispose(),[2,d]}})})}))];case 3:return a=c.sent(),i.dispose(),s=a.map(function(h){return new JW(h)}),[2,n.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(DD);function ND(r,e){var t={expressions:e};return Object.assign({},r,t)}function tq(r){return UW(r)&&r.landmarks instanceof ym&&r.unshiftedLandmarks instanceof ym&&r.alignedRect instanceof ba}function $_(r,e){var t=r.detection.box,n=e.shiftBy(t.x,t.y),i=n.align(),a=r.detection.imageDims,s=new ba(r.detection.score,i.rescale(a.reverse()),a),u={landmarks:n,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},r,u)}function nq(r,e){var t=uv(r,e),n=K_(r,e);function i(s,u,c){var h=n(s,u,c+"/separable_conv0"),d=n(u,u,c+"/separable_conv1"),m=t(s,u,1,c+"/expansion_conv");return{separable_conv0:h,separable_conv1:d,expansion_conv:m}}function a(s,u){var c=n(s,s,u+"/separable_conv0"),h=n(s,s,u+"/separable_conv1"),d=n(s,s,u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:t,extractSeparableConvParams:n,extractReductionBlockParams:i,extractMainBlockParams:a}}function rq(r,e){var t=[],n=ho(r),i=n.extractWeights,a=n.getRemainingWeights,s=nq(i,t),u=s.extractConvParams,c=s.extractSeparableConvParams,h=s.extractReductionBlockParams,d=s.extractMainBlockParams,m=u(3,32,3,"entry_flow/conv_in"),v=h(32,64,"entry_flow/reduction_block_0"),y=h(64,128,"entry_flow/reduction_block_1"),_={conv_in:m,reduction_block_0:v,reduction_block_1:y},E={};nf(e,0,1).forEach(function(A){E["main_block_"+A]=d(128,"middle_flow/main_block_"+A)});var x=h(128,256,"exit_flow/reduction_block"),T=c(256,512,"exit_flow/separable_conv"),C={reduction_block:x,separable_conv:T};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{entry_flow:_,middle_flow:E,exit_flow:C}}}function iq(r,e){var t=bs(r,e),n=CD(t),i=X_(t);function a(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=n(u+"/expansion_conv");return{separable_conv0:c,separable_conv1:h,expansion_conv:d}}function s(u){var c=i(u+"/separable_conv0"),h=i(u+"/separable_conv1"),d=i(u+"/separable_conv2");return{separable_conv0:c,separable_conv1:h,separable_conv2:d}}return{extractConvParams:n,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:s}}function aq(r,e){var t=[],n=iq(r,t),i=n.extractConvParams,a=n.extractSeparableConvParams,s=n.extractReductionBlockParams,u=n.extractMainBlockParams,c=i("entry_flow/conv_in"),h=s("entry_flow/reduction_block_0"),d=s("entry_flow/reduction_block_1"),m={conv_in:c,reduction_block_0:h,reduction_block_1:d},v={};nf(e,0,1).forEach(function(x){v["main_block_"+x]=u("middle_flow/main_block_"+x)});var y=s("exit_flow/reduction_block"),_=a("exit_flow/separable_conv"),E={reduction_block:y,separable_conv:_};return co(r,t),{params:{entry_flow:m,middle_flow:v,exit_flow:E},paramMappings:t}}function kD(r,e,t){return at(hi(r,e.filters,t,"same"),e.bias)}function n0(r,e,t){t===void 0&&(t=!0);var n=t?Kt(r):r;return n=Hr(n,e.separable_conv0,[1,1]),n=Hr(Kt(n),e.separable_conv1,[1,1]),n=On(n,[3,3],[2,2],"same"),n=at(n,kD(r,e.expansion_conv,[2,2])),n}function oq(r,e){var t=Hr(Kt(r),e.separable_conv0,[1,1]);return t=Hr(Kt(t),e.separable_conv1,[1,1]),t=Hr(Kt(t),e.separable_conv2,[1,1]),t=at(t,r),t}var sq=function(r){Ye(e,r);function e(t){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return e.prototype.forwardInput=function(t){var n=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Re(function(){var a=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],u=Tf(a,s).div(Ce(256)),c=Kt(kD(u,i.entry_flow.conv_in,[2,2]));return c=n0(c,i.entry_flow.reduction_block_0,!1),c=n0(c,i.entry_flow.reduction_block_1),nf(n._numMainBlocks,0,1).forEach(function(h){c=oq(c,i.middle_flow["main_block_"+h])}),c=n0(c,i.exit_flow.reduction_block),c=Kt(Hr(c,i.exit_flow.separable_conv,[1,1])),c})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return aq(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return rq(t,this._numMainBlocks)},e}(lo);function uq(r){var e=[],t=ho(r),n=t.extractWeights,i=t.getRemainingWeights,a=G_(n,e),s=a(512,1,"fc/age"),u=a(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:u}}}}function lq(r){var e=[],t=bs(r,e);function n(a){var s=t(a+"/weights",2),u=t(a+"/bias",1);return{weights:s,bias:u}}var i={fc:{age:n("fc/age"),gender:n("fc/gender")}};return co(r,e),{params:i,paramMappings:e}}var _m;(function(r){r.FEMALE="female",r.MALE="male"})(_m||(_m={}));var cq=function(r){Ye(e,r);function e(t){t===void 0&&(t=new sq(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Re(function(){var a=t instanceof bm?n.faceFeatureExtractor.forwardInput(t):t,s=xf(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),u=na(s,i.fc.age).as1D(),c=na(s,i.fc.gender);return{age:u,gender:c}})},e.prototype.forwardInput=function(t){var n=this;return Re(function(){var i=n.runNet(t),a=i.age,s=i.gender;return{age:a,gender:so(s)}})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Pe(this,void 0,void 0,function(){var n,i,a,s,u,c,h=this;return Le(this,function(d){switch(d.label){case 0:return[4,Ln(t)];case 1:return n=d.sent(),[4,this.forwardInput(n)];case 2:return i=d.sent(),a=En(i.age),s=En(i.gender),u=a.map(function(m,v){return{ageTensor:m,genderTensor:s[v]}}),[4,Promise.all(u.map(function(m){var v=m.ageTensor,y=m.genderTensor;return Pe(h,void 0,void 0,function(){var _,E,x,T,C;return Le(this,function(A){switch(A.label){case 0:return[4,v.data()];case 1:return _=A.sent()[0],[4,y.data()];case 2:return E=A.sent()[0],x=E>.5,T=x?_m.MALE:_m.FEMALE,C=x?E:1-E,v.dispose(),y.dispose(),[2,{age:_,gender:T,genderProbability:C}]}})})}))];case 3:return c=d.sent(),i.age.dispose(),i.gender.dispose(),[2,n.isBatchInput?c:c[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,a=n.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return uq(t)},e.prototype.extractParamsFromWeigthMap=function(t){var n=ID(t),i=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),lq(a)},e.prototype.extractParams=function(t){var n=1539,i=t.slice(0,t.length-n),a=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e}(lo),OD=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.postProcess=function(t,n,i){var a=i.map(function(u){var c=u.width,h=u.height,d=n/Math.max(h,c);return{width:c*d,height:h*d}}),s=a.length;return Re(function(){var u=function(v,y){return qr([la([68],v),la([68],y)],1).as2D(1,136).as1D()},c=function(v,y){var _=a[v],E=_.width,x=_.height;return y(E,x)?Math.abs(E-x)/2:0},h=function(v){return c(v,function(y,_){return y<_})},d=function(v){return c(v,function(y,_){return _<y})},m=t.mul(la([s,136],n)).sub(qr(Array.from(Array(s),function(v,y){return u(h(y),d(y))}))).div(qr(Array.from(Array(s),function(v,y){return u(a[y].width,a[y].height)})));return m})},e.prototype.forwardInput=function(t){var n=this;return Re(function(){var i=n.runNet(t);return n.postProcess(i,t.inputSize,t.inputDimensions.map(function(a){var s=a[0],u=a[1];return{height:s,width:u}}))})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Pe(this,void 0,void 0,function(){var n,i,a,s=this;return Le(this,function(u){switch(u.label){case 0:return[4,Ln(t)];case 1:return n=u.sent(),i=Re(function(){return En(s.forwardInput(n))}),[4,Promise.all(i.map(function(c,h){return Pe(s,void 0,void 0,function(){var d,m,v,y,_;return Le(this,function(E){switch(E.label){case 0:return v=(m=Array).from,[4,c.data()];case 1:return d=v.apply(m,[E.sent()]),y=d.filter(function(x,T){return cS(T)}),_=d.filter(function(x,T){return!cS(T)}),[2,new VW(Array(68).fill(0).map(function(x,T){return new _t(y[T],_[T])}),{height:n.getInputHeight(h),width:n.getInputWidth(h)})]}})})}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(DD),MD=function(r){Ye(e,r);function e(t){return t===void 0&&(t=new RD),r.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(OD);function hq(r){var e=[],t=AD(r,e).extractDenseBlock3Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return co(r,e),{params:n,paramMappings:e}}function fq(r){var e=[],t=ho(r),n=t.extractWeights,i=t.getRemainingWeights,a=SD(n,e).extractDenseBlock3Params,s=a(3,32,"dense0",!0),u=a(32,64,"dense1"),c=a(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:u,dense2:c}}}var dq=function(r){Ye(e,r);function e(){return r.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Re(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Tf(i,a).div(Ce(255)),u=t0(s,n.dense0,!0);return u=t0(u,n.dense1),u=t0(u,n.dense2),u=xf(u,[14,14],[2,2],"valid"),u})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return hq(t)},e.prototype.extractParams=function(t){return fq(t)},e}(lo),pq=function(r){Ye(e,r);function e(t){return t===void 0&&(t=new dq),r.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(OD);(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(MD);function mq(r,e){return at(ar(r,e.weights),e.biases)}function Y_(r,e,t,n,i){i===void 0&&(i="same");var a=e.conv,s=a.filters,u=a.bias,c=hi(r,s,t,i);return c=at(c,u),c=mq(c,e.scale),n?Kt(c):c}function vq(r,e){return Y_(r,e,[1,1],!0)}function PD(r,e){return Y_(r,e,[1,1],!1)}function LD(r,e){return Y_(r,e,[2,2],!0,"valid")}function gq(r,e){function t(u,c,h){var d=r(u),m=d.length/(c*h*h);if(IW(m))throw new Error("depth has to be an integer: "+m+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+h);return Re(function(){return cs(br(d,[c,m,h,h]),[2,3,1,0])})}function n(u,c,h,d){var m=t(u,c,h),v=hn(r(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:m,bias:v}}function i(u,c){var h=hn(r(u)),d=hn(r(u));return e.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:h,biases:d}}function a(u,c,h,d){var m=n(u,c,h,d+"/conv"),v=i(c,d+"/scale");return{conv:m,scale:v}}function s(u,c,h,d,m){m===void 0&&(m=!1);var v=a((m?.5:1)*u,c,h,d+"/conv1"),y=a(u,c,h,d+"/conv2");return{conv1:v,conv2:y}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function yq(r){var e=ho(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],a=gq(t,i),s=a.extractConvLayerParams,u=a.extractResidualLayerParams,c=s(4704,32,7,"conv32_down"),h=u(9216,32,3,"conv32_1"),d=u(9216,32,3,"conv32_2"),m=u(9216,32,3,"conv32_3"),v=u(36864,64,3,"conv64_down",!0),y=u(36864,64,3,"conv64_1"),_=u(36864,64,3,"conv64_2"),E=u(36864,64,3,"conv64_3"),x=u(147456,128,3,"conv128_down",!0),T=u(147456,128,3,"conv128_1"),C=u(147456,128,3,"conv128_2"),A=u(589824,256,3,"conv256_down",!0),R=u(589824,256,3,"conv256_1"),k=u(589824,256,3,"conv256_2"),B=u(589824,256,3,"conv256_down_out"),P=Re(function(){return cs(es(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var I={conv32_down:c,conv32_1:h,conv32_2:d,conv32_3:m,conv64_down:v,conv64_1:y,conv64_2:_,conv64_3:E,conv128_down:x,conv128_1:T,conv128_2:C,conv256_down:A,conv256_1:R,conv256_2:k,conv256_down_out:B,fc:P};return{params:I,paramMappings:i}}function bq(r,e){var t=bs(r,e);function n(s){var u=t(s+"/scale/weights",1),c=t(s+"/scale/biases",1);return{weights:u,biases:c}}function i(s){var u=t(s+"/conv/filters",4),c=t(s+"/conv/bias",1),h=n(s);return{conv:{filters:u,bias:c},scale:h}}function a(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function _q(r){var e=[],t=bq(r,e),n=t.extractConvLayerParams,i=t.extractResidualLayerParams,a=n("conv32_down"),s=i("conv32_1"),u=i("conv32_2"),c=i("conv32_3"),h=i("conv64_down"),d=i("conv64_1"),m=i("conv64_2"),v=i("conv64_3"),y=i("conv128_down"),_=i("conv128_1"),E=i("conv128_2"),x=i("conv256_down"),T=i("conv256_1"),C=i("conv256_2"),A=i("conv256_down_out"),R=r.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!RW(R))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+R);var k={conv32_down:a,conv32_1:s,conv32_2:u,conv32_3:c,conv64_down:h,conv64_1:d,conv64_2:m,conv64_3:v,conv128_down:y,conv128_1:_,conv128_2:E,conv256_down:x,conv256_1:T,conv256_2:C,conv256_down_out:A,fc:R};return co(r,e),{params:k,paramMappings:e}}function $i(r,e){var t=vq(r,e.conv1);return t=PD(t,e.conv2),t=at(t,r),t=Kt(t),t}function fp(r,e){var t=LD(r,e.conv1);t=PD(t,e.conv2);var n=xf(r,2,2,"valid"),i=Bt(n.shape),a=n.shape[3]!==t.shape[3],s=n.shape[1]!==t.shape[1]||n.shape[2]!==t.shape[2];if(s){var u=Vh(t.shape);u[1]=1;var c=Bt(u);t=xn([t,c],1);var h=Vh(t.shape);h[2]=1;var d=Bt(h);t=xn([t,d],2)}return n=a?xn([n,i],3):n,t=at(n,t),t=Kt(t),t}var wq=function(r){Ye(e,r);function e(){return r.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return Re(function(){var i=t.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],s=Tf(i,a).div(Ce(256)),u=LD(s,n.conv32_down);u=On(u,3,2,"valid"),u=$i(u,n.conv32_1),u=$i(u,n.conv32_2),u=$i(u,n.conv32_3),u=fp(u,n.conv64_down),u=$i(u,n.conv64_1),u=$i(u,n.conv64_2),u=$i(u,n.conv64_3),u=fp(u,n.conv128_down),u=$i(u,n.conv128_1),u=$i(u,n.conv128_2),u=fp(u,n.conv256_down),u=$i(u,n.conv256_1),u=$i(u,n.conv256_2),u=fp(u,n.conv256_down_out);var c=u.mean([1,2]),h=tv(c,n.fc);return h})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Pe(this,void 0,void 0,function(){var n,i,a,s=this;return Le(this,function(u){switch(u.label){case 0:return[4,Ln(t)];case 1:return n=u.sent(),i=Re(function(){return En(s.forwardInput(n))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return a=u.sent(),i.forEach(function(c){return c.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return _q(t)},e.prototype.extractParams=function(t){return yq(t)},e}(lo);function FD(r,e){var t={descriptor:e};return Object.assign({},r,t)}function BD(r,e){var t={age:e};return Object.assign({},r,t)}function VD(r,e,t){var n={gender:e,genderProbability:t};return Object.assign({},r,n)}var UD=function(){function r(e){var t=e===void 0?{}:e,n=t.minFaceSize,i=t.scaleFactor,a=t.maxNumScales,s=t.scoreThresholds,u=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=i||.709,this._maxNumScales=a||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=u,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function xq(r,e){function t(c,h){var d=br(r(9*c),[3,3,c,1]),m=hn(r(c)),v=hn(r(c)),y=hn(r(c)),_=hn(r(c));return e.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:d,batch_norm_scale:m,batch_norm_offset:v,batch_norm_mean:y,batch_norm_variance:_}}function n(c,h,d,m,v){var y=br(r(c*h*d*d),[d,d,c,h]),_=hn(r(h));return e.push({paramPath:m+"/filters"},{paramPath:m+"/"+(v?"batch_norm_offset":"bias")}),{filters:y,bias:_}}function i(c,h,d,m){var v=n(c,h,d,m,!0),y=v.filters,_=v.bias;return{filters:y,batch_norm_offset:_}}function a(c,h,d){var m=t(c,d+"/depthwise_conv"),v=i(c,h,1,d+"/pointwise_conv");return{depthwise_conv:m,pointwise_conv:v}}function s(){var c=i(3,32,3,"mobilenetv1/conv_0"),h=a(32,64,"mobilenetv1/conv_1"),d=a(64,128,"mobilenetv1/conv_2"),m=a(128,128,"mobilenetv1/conv_3"),v=a(128,256,"mobilenetv1/conv_4"),y=a(256,256,"mobilenetv1/conv_5"),_=a(256,512,"mobilenetv1/conv_6"),E=a(512,512,"mobilenetv1/conv_7"),x=a(512,512,"mobilenetv1/conv_8"),T=a(512,512,"mobilenetv1/conv_9"),C=a(512,512,"mobilenetv1/conv_10"),A=a(512,512,"mobilenetv1/conv_11"),R=a(512,1024,"mobilenetv1/conv_12"),k=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:h,conv_2:d,conv_3:m,conv_4:v,conv_5:y,conv_6:_,conv_7:E,conv_8:x,conv_9:T,conv_10:C,conv_11:A,conv_12:R,conv_13:k}}function u(){var c=i(1024,256,1,"prediction_layer/conv_0"),h=i(256,512,3,"prediction_layer/conv_1"),d=i(512,128,1,"prediction_layer/conv_2"),m=i(128,256,3,"prediction_layer/conv_3"),v=i(256,128,1,"prediction_layer/conv_4"),y=i(128,256,3,"prediction_layer/conv_5"),_=i(256,64,1,"prediction_layer/conv_6"),E=i(64,128,3,"prediction_layer/conv_7"),x=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),T=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),C=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),A=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),R=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),B=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),P=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),I=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),D=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),O=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),L=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),F={box_encoding_predictor:x,class_predictor:T},V={box_encoding_predictor:C,class_predictor:A},ie={box_encoding_predictor:R,class_predictor:k},se={box_encoding_predictor:B,class_predictor:P},G={box_encoding_predictor:I,class_predictor:D},Q={box_encoding_predictor:O,class_predictor:L};return{conv_0:c,conv_1:h,conv_2:d,conv_3:m,conv_4:v,conv_5:y,conv_6:_,conv_7:E,box_predictor_0:F,box_predictor_1:V,box_predictor_2:ie,box_predictor_3:se,box_predictor_4:G,box_predictor_5:Q}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:u}}function Eq(r){var e=[],t=ho(r),n=t.extractWeights,i=t.getRemainingWeights,a=xq(n,e),s=a.extractMobilenetV1Params,u=a.extractPredictionLayerParams,c=s(),h=u(),d=f_(n(5118*4),[1,5118,4]),m={extra_dim:d};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:h,output_layer:m},paramMappings:e}}function Tq(r,e){var t=bs(r,e);function n(h,d,m){var v=t(h+"/Conv2d_"+d+"_pointwise/weights",4,m+"/filters"),y=t(h+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,m+"/batch_norm_offset");return{filters:v,batch_norm_offset:y}}function i(h){var d="mobilenetv1/conv_"+h,m="MobilenetV1/Conv2d_"+h+"_depthwise",v=d+"/depthwise_conv",y=d+"/pointwise_conv",_=t(m+"/depthwise_weights",4,v+"/filters"),E=t(m+"/BatchNorm/gamma",1,v+"/batch_norm_scale"),x=t(m+"/BatchNorm/beta",1,v+"/batch_norm_offset"),T=t(m+"/BatchNorm/moving_mean",1,v+"/batch_norm_mean"),C=t(m+"/BatchNorm/moving_variance",1,v+"/batch_norm_variance");return{depthwise_conv:{filters:_,batch_norm_scale:E,batch_norm_offset:x,batch_norm_mean:T,batch_norm_variance:C},pointwise_conv:n("MobilenetV1",h,y)}}function a(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(h,d){var m=t(h+"/weights",4,d+"/filters"),v=t(h+"/biases",1,d+"/bias");return{filters:m,bias:v}}function u(h){var d=s("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),m=s("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:d,class_predictor:m}}function c(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:u(0),box_predictor_1:u(1),box_predictor_2:u(2),box_predictor_3:u(3),box_predictor_4:u(4),box_predictor_5:u(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:c}}function Sq(r){var e=[],t=Tq(r,e),n=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,a=r["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!av(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var s={mobilenetv1:n(),prediction_layer:i(),output_layer:{extra_dim:a}};return co(r,e),{params:s,paramMappings:e}}function Yi(r,e,t){return Re(function(){var n=hi(r,e.filters,t,"same");return n=at(n,e.batch_norm_offset),E_(n,0,6)})}var Cq=.0010000000474974513;function Aq(r,e,t){return Re(function(){var n=ev(r,e.filters,t,"same");return n=MI(n,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,Cq),E_(n,0,6)})}function Rq(r){return[2,4,6,12].some(function(e){return e===r})?[2,2]:[1,1]}function Iq(r,e){return Re(function(){var t=null,n=Yi(r,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(a,s){var u=s+1,c=Rq(u);n=Aq(n,a.depthwise_conv,c),n=Yi(n,a.pointwise_conv,[1,1]),u===11&&(t=n)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:t}})}function Dq(r,e,t,n,i){var a=r.shape[0],s=Math.min(t,a),u=e.map(function(d,m){return{score:d,boxIndex:m}}).filter(function(d){return d.score>i}).sort(function(d,m){return m.score-d.score}),c=function(d){return d<=n?1:0},h=[];return u.forEach(function(d){if(!(h.length>=s)){for(var m=d.score,v=h.length-1;v>=0;--v){var y=Nq(r,d.boxIndex,h[v]);if(y!==0&&(d.score*=c(y),d.score<=i))break}m===d.score&&h.push(d.boxIndex)}}),h}function Nq(r,e,t){var n=r.arraySync(),i=Math.min(n[e][0],n[e][2]),a=Math.min(n[e][1],n[e][3]),s=Math.max(n[e][0],n[e][2]),u=Math.max(n[e][1],n[e][3]),c=Math.min(n[t][0],n[t][2]),h=Math.min(n[t][1],n[t][3]),d=Math.max(n[t][0],n[t][2]),m=Math.max(n[t][1],n[t][3]),v=(s-i)*(u-a),y=(d-c)*(m-h);if(v<=0||y<=0)return 0;var _=Math.max(i,c),E=Math.max(a,h),x=Math.min(s,d),T=Math.min(u,m),C=Math.max(x-_,0)*Math.max(T-E,0);return C/(v+y-C)}function kq(r){var e=En(cs(r,[1,0])),t=[Cn(e[2],e[0]),Cn(e[3],e[1])],n=[at(e[0],bi(t[0],Ce(2))),at(e[1],bi(t[1],Ce(2)))];return{sizes:t,centers:n}}function Oq(r,e){var t=kq(r),n=t.sizes,i=t.centers,a=En(cs(e,[1,0])),s=bi(ar(G0(bi(a[2],Ce(5))),n[0]),Ce(2)),u=at(ar(bi(a[0],Ce(10)),n[0]),i[0]),c=bi(ar(G0(bi(a[3],Ce(5))),n[1]),Ce(2)),h=at(ar(bi(a[1],Ce(10)),n[1]),i[1]);return cs(qr([Cn(u,s),Cn(h,c),at(u,s),at(h,c)]),[1,0])}function Mq(r,e,t){return Re(function(){var n=r.shape[0],i=Oq(wi(Ml(t.extra_dim,[n,1,1]),[-1,4]),wi(r,[-1,4]));i=wi(i,[n,i.shape[0]/n,4]);var a=DI(pa(e,[0,0,1],[-1,-1,-1])),s=pa(a,[0,0,0],[-1,-1,1]);s=wi(s,[n,s.shape[1]]);var u=En(i),c=En(s);return{boxes:u,scores:c}})}function _l(r,e){return Re(function(){var t=r.shape[0],n=wi(Si(r,e.box_encoding_predictor),[t,-1,1,4]),i=wi(Si(r,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:n,classPrediction:i}})}function Pq(r,e,t){return Re(function(){var n=Yi(r,t.conv_0,[1,1]),i=Yi(n,t.conv_1,[2,2]),a=Yi(i,t.conv_2,[1,1]),s=Yi(a,t.conv_3,[2,2]),u=Yi(s,t.conv_4,[1,1]),c=Yi(u,t.conv_5,[2,2]),h=Yi(c,t.conv_6,[1,1]),d=Yi(h,t.conv_7,[2,2]),m=_l(e,t.box_predictor_0),v=_l(r,t.box_predictor_1),y=_l(i,t.box_predictor_2),_=_l(s,t.box_predictor_3),E=_l(c,t.box_predictor_4),x=_l(d,t.box_predictor_5),T=xn([m.boxPredictionEncoding,v.boxPredictionEncoding,y.boxPredictionEncoding,_.boxPredictionEncoding,E.boxPredictionEncoding,x.boxPredictionEncoding],1),C=xn([m.classPrediction,v.classPrediction,y.classPrediction,_.classPrediction,E.classPrediction,x.classPrediction],1);return{boxPredictions:T,classPredictions:C}})}var lv=function(){function r(e){var t=e===void 0?{}:e,n=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}(),zD=function(r){Ye(e,r);function e(){return r.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return Re(function(){var i=t.toBatchTensor(512,!1).toFloat(),a=Cn(ar(i,Ce(.007843137718737125)),Ce(1)),s=Iq(a,n.mobilenetv1),u=Pq(s.out,s.conv11,n.prediction_layer),c=u.boxPredictions,h=u.classPredictions;return Mq(c,h,n.output_layer)})},e.prototype.forward=function(t){return Pe(this,void 0,void 0,function(){var n;return Le(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Ln(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,n){return n===void 0&&(n={}),Pe(this,void 0,void 0,function(){var i,a,s,u,c,h,d,m,v,y,_,E,x,T,C,A,R,k,B,P,I;return Le(this,function(D){switch(D.label){case 0:return i=new lv(n),a=i.maxResults,s=i.minConfidence,[4,Ln(t)];case 1:for(u=D.sent(),c=this.forwardInput(u),h=c.boxes,d=c.scores,m=h[0],v=d[0],y=1;y<h.length;y++)h[y].dispose(),d[y].dispose();return x=(E=Array).from,[4,v.data()];case 2:return _=x.apply(E,[D.sent()]),T=.5,C=Dq(m,_,a,T,s),A=u.getReshapedInputDimensions(0),R=u.inputSize,k=R/A.width,B=R/A.height,P=m.arraySync(),I=C.map(function(O){var L=[Math.max(0,P[O][0]),Math.min(1,P[O][2])].map(function(Q){return Q*B}),F=L[0],V=L[1],ie=[Math.max(0,P[O][1]),Math.min(1,P[O][3])].map(function(Q){return Q*k}),se=ie[0],G=ie[1];return new ba(_[O],new U_(se,F,G-se,V-F),{height:u.getInputHeight(0),width:u.getInputWidth(0)})}),m.dispose(),v.dispose(),[2,I]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Sq(t)},e.prototype.extractParams=function(t){return Eq(t)},e}(lo);(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(zD);var Lq=.4,Fq=[new _t(.738768,.874946),new _t(2.42204,2.65704),new _t(4.30971,7.04493),new _t(10.246,4.59428),new _t(12.6868,11.8741)],Bq=[new _t(1.603231,2.094468),new _t(6.041143,7.080126),new _t(2.882459,3.518061),new _t(4.266906,5.178857),new _t(9.041765,10.66308)],Vq=[117.001,114.697,97.404],Uq="tiny_yolov2_model",zq="tiny_yolov2_separable_conv_model",dp=function(r){return typeof r=="number"};function jq(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!dp(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(e){return e||{}}).every(function(e){return dp(e.x)&&dp(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(dp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function Q_(r){return Re(function(){var e=ar(r,Ce(.10000000149011612));return at(Kt(Cn(r,e)),e)})}function jo(r,e){return Re(function(){var t=xu(r,[[0,0],[1,1],[1,1],[0,0]]);return t=hi(t,e.conv.filters,[1,1],"valid"),t=Cn(t,e.bn.sub),t=ar(t,e.bn.truediv),t=at(t,e.conv.bias),Q_(t)})}function Ho(r,e){return Re(function(){var t=xu(r,[[0,0],[1,1],[1,1],[0,0]]);return t=A_(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=at(t,e.bias),Q_(t)})}function Hq(r,e){var t=uv(r,e);function n(s,u){var c=hn(r(s)),h=hn(r(s));return e.push({paramPath:u+"/sub"},{paramPath:u+"/truediv"}),{sub:c,truediv:h}}function i(s,u,c){var h=t(s,u,3,c+"/conv"),d=n(u,c+"/bn");return{conv:h,bn:d}}var a=K_(r,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function Wq(r,e,t,n){var i=ho(r),a=i.extractWeights,s=i.getRemainingWeights,u=[],c=Hq(a,u),h=c.extractConvParams,d=c.extractConvWithBatchNormParams,m=c.extractSeparableConvParams,v;if(e.withSeparableConvs){var y=n[0],_=n[1],E=n[2],x=n[3],T=n[4],C=n[5],A=n[6],R=n[7],k=n[8],B=e.isFirstLayerConv2d?h(y,_,3,"conv0"):m(y,_,"conv0"),P=m(_,E,"conv1"),I=m(E,x,"conv2"),D=m(x,T,"conv3"),O=m(T,C,"conv4"),L=m(C,A,"conv5"),F=R?m(A,R,"conv6"):void 0,V=k?m(R,k,"conv7"):void 0,ie=h(k||R||A,5*t,1,"conv8");v={conv0:B,conv1:P,conv2:I,conv3:D,conv4:O,conv5:L,conv6:F,conv7:V,conv8:ie}}else{var y=n[0],_=n[1],E=n[2],x=n[3],T=n[4],C=n[5],A=n[6],R=n[7],k=n[8],B=d(y,_,"conv0"),P=d(_,E,"conv1"),I=d(E,x,"conv2"),D=d(x,T,"conv3"),O=d(T,C,"conv4"),L=d(C,A,"conv5"),F=d(A,R,"conv6"),V=d(R,k,"conv7"),ie=h(k,5*t,1,"conv8");v={conv0:B,conv1:P,conv2:I,conv3:D,conv4:O,conv5:L,conv6:F,conv7:V,conv8:ie}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:v,paramMappings:u}}function qq(r,e){var t=bs(r,e);function n(u){var c=t(u+"/sub",1),h=t(u+"/truediv",1);return{sub:c,truediv:h}}function i(u){var c=t(u+"/filters",4),h=t(u+"/bias",1);return{filters:c,bias:h}}function a(u){var c=i(u+"/conv"),h=n(u+"/bn");return{conv:c,bn:h}}var s=X_(t);return{extractConvParams:i,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function Gq(r,e){var t=[],n=qq(r,t),i=n.extractConvParams,a=n.extractConvWithBatchNormParams,s=n.extractSeparableConvParams,u;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;u={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else u={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return co(r,t),{params:u,paramMappings:t}}var yS;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(yS||(yS={}));var Z_=function(){function r(e){var t=e===void 0?{}:e,n=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}(),jD=function(r){Ye(e,r);function e(t){var n=r.call(this,"TinyYolov2")||this;return jq(t),n._config=t,n}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,n){var i=jo(t,n.conv0);return i=On(i,[2,2],[2,2],"same"),i=jo(i,n.conv1),i=On(i,[2,2],[2,2],"same"),i=jo(i,n.conv2),i=On(i,[2,2],[2,2],"same"),i=jo(i,n.conv3),i=On(i,[2,2],[2,2],"same"),i=jo(i,n.conv4),i=On(i,[2,2],[2,2],"same"),i=jo(i,n.conv5),i=On(i,[2,2],[1,1],"same"),i=jo(i,n.conv6),i=jo(i,n.conv7),Si(i,n.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,n){var i=this.config.isFirstLayerConv2d?Q_(Si(t,n.conv0,"valid",!1)):Ho(t,n.conv0);return i=On(i,[2,2],[2,2],"same"),i=Ho(i,n.conv1),i=On(i,[2,2],[2,2],"same"),i=Ho(i,n.conv2),i=On(i,[2,2],[2,2],"same"),i=Ho(i,n.conv3),i=On(i,[2,2],[2,2],"same"),i=Ho(i,n.conv4),i=On(i,[2,2],[2,2],"same"),i=Ho(i,n.conv5),i=On(i,[2,2],[1,1],"same"),i=n.conv6?Ho(i,n.conv6):i,i=n.conv7?Ho(i,n.conv7):i,Si(i,n.conv8,"valid",!1)},e.prototype.forwardInput=function(t,n){var i=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return Re(function(){var s=t.toBatchTensor(n,!1).toFloat();return s=i.config.meanRgb?Tf(s,i.config.meanRgb):s,s=s.div(Ce(256)),i.config.withSeparableConvs?i.runMobilenet(s,a):i.runTinyYolov2(s,a)})},e.prototype.forward=function(t,n){return Pe(this,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,Ln(t)];case 1:return[4,i.apply(this,[a.sent(),n])];case 2:return[2,a.sent()]}})})},e.prototype.detect=function(t,n){return n===void 0&&(n={}),Pe(this,void 0,void 0,function(){var i,a,s,u,c,h,d,m,v,y,_,E,x,T,C=this;return Le(this,function(A){switch(A.label){case 0:return i=new Z_(n),a=i.inputSize,s=i.scoreThreshold,[4,Ln(t)];case 1:return u=A.sent(),[4,this.forwardInput(u,a)];case 2:return c=A.sent(),h=Re(function(){return En(c)[0].expandDims()}),d={width:u.getInputWidth(0),height:u.getInputHeight(0)},[4,this.extractBoxes(h,u.getReshapedInputDimensions(0),s)];case 3:return m=A.sent(),c.dispose(),h.dispose(),v=m.map(function(R){return R.box}),y=m.map(function(R){return R.score}),_=m.map(function(R){return R.classScore}),E=m.map(function(R){return C.config.classes[R.label]}),x=rf(v.map(function(R){return R.rescale(a)}),y,this.config.iouThreshold,!0),T=x.map(function(R){return new pD(y[R],_[R],E[R],v[R],d)}),[2,T]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Gq(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=n?n.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return Wq(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,n,i){return Pe(this,void 0,void 0,function(){var a,s,u,c,h,d,m,v,y,_,E,x,T,C,A,R,k,B,P,I,D,O,L,F,V,ie,se,G,Q,te=this;return Le(this,function(de){switch(de.label){case 0:return a=n.width,s=n.height,u=Math.max(a,s),c=u/a,h=u/s,d=t.shape[1],m=this.config.anchors.length,v=Re(function(){var H=t.reshape([d,d,m,te.boxEncodingSize]),ee=H.slice([0,0,0,0],[d,d,m,4]),pe=H.slice([0,0,0,4],[d,d,m,1]),ce=te.withClassScores?so(H.slice([0,0,0,5],[d,d,m,te.config.classes.length]),3):Ce(0);return[ee,pe,ce]}),y=v[0],_=v[1],E=v[2],x=[],[4,_.array()];case 1:return T=de.sent(),[4,y.array()];case 2:C=de.sent(),A=0,de.label=3;case 3:if(!(A<d))return[3,12];R=0,de.label=4;case 4:if(!(R<d))return[3,11];k=0,de.label=5;case 5:return k<m?(B=e0(T[A][R][k][0]),!i||B>i?(P=(R+e0(C[A][R][k][0]))/d*c,I=(A+e0(C[A][R][k][1]))/d*h,D=Math.exp(C[A][R][k][2])*this.config.anchors[k].x/d*c,O=Math.exp(C[A][R][k][3])*this.config.anchors[k].y/d*h,L=P-D/2,F=I-O/2,V={row:A,col:R,anchor:k},this.withClassScores?[4,this.extractPredictedClass(E,V)]:[3,7]):[3,9]):[3,10];case 6:return Q=de.sent(),[3,8];case 7:Q={classScore:1,label:0},de.label=8;case 8:ie=Q,se=ie.classScore,G=ie.label,x.push(nr({box:new ov(L,F,L+D,F+O),score:B,classScore:B*se,label:G},V)),de.label=9;case 9:return k++,[3,5];case 10:return R++,[3,4];case 11:return A++,[3,3];case 12:return y.dispose(),_.dispose(),E.dispose(),[2,x]}})})},e.prototype.extractPredictedClass=function(t,n){return Pe(this,void 0,void 0,function(){var i,a,s,u;return Le(this,function(c){switch(c.label){case 0:return i=n.row,a=n.col,s=n.anchor,[4,t.array()];case 1:return u=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,d){return u[i][a][s][d]}).map(function(h,d){return{classScore:h,label:d}}).reduce(function(h,d){return h.classScore>d.classScore?h:d})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(lo),Kq=function(r){Ye(e,r);function e(t){t===void 0&&(t=!0);var n=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:Lq,classes:["face"]},t?{anchors:Bq,meanRgb:Vq}:{anchors:Fq,withClassScores:!0});return n=r.call(this,i)||this,n}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return Pe(this,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return[4,this.detect(t,n)];case 1:return i=a.sent(),[2,i.map(function(s){return new ba(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?zq:Uq},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(jD),HD=function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(Z_),Sf=function(){function r(){}return r.prototype.then=function(e){return Pe(this,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return Pe(this,void 0,void 0,function(){return Le(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},r}();function cv(r,e,t,n,i){return i===void 0&&(i=function(a){var s=a.alignedRect;return s}),Pe(this,void 0,void 0,function(){var a,s,u,c,h;return Le(this,function(d){switch(d.label){case 0:return a=r.map(function(m){return tq(m)?i(m):m.detection}),u=n,u?[3,5]:e instanceof Gt?[4,q_(e,a)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,W_(e,a)];case 3:c=d.sent(),d.label=4;case 4:u=c,d.label=5;case 5:return s=u,[4,t(s)];case 6:return h=d.sent(),s.forEach(function(m){return m instanceof Gt&&m.dispose()}),[2,h]}})})}function J_(r,e,t,n,i){return Pe(this,void 0,void 0,function(){var a=this;return Le(this,function(s){return[2,cv([r],e,function(u){return Pe(a,void 0,void 0,function(){return Le(this,function(c){return[2,t(u[0])]})})},n,i)]})})}function Xq(r){return Re(function(){return qr(En(r,3).reverse(),3)})}var pp=2,wm=12;function $q(r,e){var t=uv(r,e),n=G_(r,e);function i(h,d){var m=hn(r(h));return e.push({paramPath:d}),m}function a(h,d,m){m===void 0&&(m=!1);var v=t(h[0],h[1],3,d+"/conv1"),y=i(h[1],d+"/prelu1_alpha"),_=t(h[1],h[2],3,d+"/conv2"),E=i(h[2],d+"/prelu2_alpha"),x=t(h[2],h[3],m?2:3,d+"/conv3"),T=i(h[3],d+"/prelu3_alpha");return{conv1:v,prelu1_alpha:y,conv2:_,prelu2_alpha:E,conv3:x,prelu3_alpha:T}}function s(){var h=a([3,10,16,32],"pnet"),d=t(32,2,1,"pnet/conv4_1"),m=t(32,4,1,"pnet/conv4_2");return nr(nr({},h),{conv4_1:d,conv4_2:m})}function u(){var h=a([3,28,48,64],"rnet",!0),d=n(576,128,"rnet/fc1"),m=i(128,"rnet/prelu4_alpha"),v=n(128,2,"rnet/fc2_1"),y=n(128,4,"rnet/fc2_2");return nr(nr({},h),{fc1:d,prelu4_alpha:m,fc2_1:v,fc2_2:y})}function c(){var h=a([3,32,64,64],"onet"),d=t(64,128,2,"onet/conv4"),m=i(128,"onet/prelu4_alpha"),v=n(1152,256,"onet/fc1"),y=i(256,"onet/prelu5_alpha"),_=n(256,2,"onet/fc2_1"),E=n(256,4,"onet/fc2_2"),x=n(256,10,"onet/fc2_3");return nr(nr({},h),{conv4:d,prelu4_alpha:m,fc1:v,prelu5_alpha:y,fc2_1:_,fc2_2:E,fc2_3:x})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function Yq(r){var e=ho(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],a=$q(t,i),s=a.extractPNetParams,u=a.extractRNetParams,c=a.extractONetParams,h=s(),d=u(),m=c();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:h,rnet:d,onet:m},paramMappings:i}}function Qq(r,e){var t=bs(r,e);function n(d){var m=t(d+"/weights",4,d+"/filters"),v=t(d+"/bias",1);return{filters:m,bias:v}}function i(d){var m=t(d+"/weights",2),v=t(d+"/bias",1);return{weights:m,bias:v}}function a(d){return t(d,1)}function s(d){var m=n(d+"/conv1"),v=a(d+"/prelu1_alpha"),y=n(d+"/conv2"),_=a(d+"/prelu2_alpha"),E=n(d+"/conv3"),x=a(d+"/prelu3_alpha");return{conv1:m,prelu1_alpha:v,conv2:y,prelu2_alpha:_,conv3:E,prelu3_alpha:x}}function u(){var d=s("pnet"),m=n("pnet/conv4_1"),v=n("pnet/conv4_2");return nr(nr({},d),{conv4_1:m,conv4_2:v})}function c(){var d=s("rnet"),m=i("rnet/fc1"),v=a("rnet/prelu4_alpha"),y=i("rnet/fc2_1"),_=i("rnet/fc2_2");return nr(nr({},d),{fc1:m,prelu4_alpha:v,fc2_1:y,fc2_2:_})}function h(){var d=s("onet"),m=n("onet/conv4"),v=a("onet/prelu4_alpha"),y=i("onet/fc1"),_=a("onet/prelu5_alpha"),E=i("onet/fc2_1"),x=i("onet/fc2_2"),T=i("onet/fc2_3");return nr(nr({},d),{conv4:m,prelu4_alpha:v,fc1:y,prelu5_alpha:_,fc2_1:E,fc2_2:x,fc2_3:T})}return{extractPNetParams:u,extractRNetParams:c,extractONetParams:h}}function Zq(r){var e=[],t=Qq(r,e),n=t.extractPNetParams,i=t.extractRNetParams,a=t.extractONetParams,s=n(),u=i(),c=a();return co(r,e),{params:{pnet:s,rnet:u,onet:c},paramMappings:e}}function eb(r,e){var t=e[0],n=e[1];return{height:Math.floor(t*r),width:Math.floor(n*r)}}function Jq(r,e,t){for(var n=t[0],i=t[1],a=wm/r,s=[],u=Math.min(n,i)*a,c=0;u>=12;)s.push(a*Math.pow(e,c)),u=u*e,c+=1;return s}var ew=function(r){Ye(e,r);function e(t,n,i,a){return r.call(this,{left:t,top:n,right:i,bottom:a},!0)||this}return e}(hs);function WD(r){return Re(function(){return ar(Cn(r,Ce(127.5)),Ce(.0078125))})}function Ul(r,e){return Re(function(){return at(Kt(r),ar(e,pm(Kt(pm(r)))))})}function tw(r,e,t){return t===void 0&&(t=!1),Re(function(){var n=Si(r,e.conv1,"valid");return n=Ul(n,e.prelu1_alpha),n=On(n,t?[2,2]:[3,3],[2,2],"same"),n=Si(n,e.conv2,"valid"),n=Ul(n,e.prelu2_alpha),n=t?n:On(n,[3,3],[2,2],"valid"),n=Si(n,e.conv3,"valid"),n=Ul(n,e.prelu3_alpha),n})}function e8(r,e){return Re(function(){var t=tw(r,e,!0),n=Si(t,e.conv4_1,"valid"),i=oi(nv(n,3),3),a=so(Cn(n,i),3),s=Si(t,e.conv4_2,"valid");return{prob:a,regions:s}})}function t8(r,e){return Re(function(){var t=eb(e,r.shape.slice(1)),n=t.height,i=t.width,a=k_.resizeBilinear(r,[n,i]),s=WD(a);return cs(s,[0,2,1,3])})}function n8(r,e,t,n){for(var i=[],a=r.arraySync(),s=0;s<r.shape[0];s++)for(var u=0;u<r.shape[1];u++)a[s][u]>=n&&i.push(new _t(u,s));var c=i.map(function(h){var d=new ov(Math.round((h.y*pp+1)/t),Math.round((h.x*pp+1)/t),Math.round((h.y*pp+wm)/t),Math.round((h.x*pp+wm)/t)),m=a[h.y][h.x],v=e.arraySync(),y=new ew(v[h.y][h.x][0],v[h.y][h.x][1],v[h.y][h.x][2],v[h.y][h.x][3]);return{cell:d,score:m,region:y}});return c}function r8(r,e,t,n,i){i.stage1=[];var a=e.map(function(v){return Re(function(){var y={scale:v},_=t8(r,v),E=Date.now(),x=e8(_,n),T=x.prob,C=x.regions;y.pnet=Date.now()-E;var A=En(En(T,3)[1])[0],R=En(C)[0];return{scoresTensor:A,regionsTensor:R,scale:v,statsForScale:y}})}),s=a.map(function(v){var y=v.scoresTensor,_=v.regionsTensor,E=v.scale,x=v.statsForScale,T=n8(y,_,E,t);if(y.dispose(),_.dispose(),!T.length)return i.stage1.push(x),[];var C=Date.now(),A=rf(T.map(function(R){return R.cell}),T.map(function(R){return R.score}),.5);return x.nms=Date.now()-C,x.numBoxes=A.length,i.stage1.push(x),A.map(function(R){return T[R]})}),u=s.reduce(function(v,y){return v.concat(y)},[]),c=[],h=[];if(u.length>0){var d=Date.now(),m=rf(u.map(function(v){return v.cell}),u.map(function(v){return v.score}),.7);i.stage1_nms=Date.now()-d,h=m.map(function(v){return u[v].score}),c=m.map(function(v){return u[v]}).map(function(v){var y=v.cell,_=v.region;return new ov(y.left+_.left*y.width,y.top+_.top*y.height,y.right+_.right*y.width,y.bottom+_.bottom*y.height).toSquare().round()})}return{boxes:c,scores:h}}function qD(r,e,t){var n=t.width,i=t.height;return Pe(this,void 0,void 0,function(){var a,s,u,c=this;return Le(this,function(h){switch(h.label){case 0:return a=vu(r),[4,Promise.all(e.map(function(d){return Pe(c,void 0,void 0,function(){var m,v,y,_,E,x,T,C;return Le(this,function(A){return m=d.padAtBorders(r.height,r.width),v=m.y,y=m.ey,_=m.x,E=m.ex,x=_-1,T=v-1,C=a.getImageData(x,T,E-x,y-T),[2,sr.isNodejs()?H_(C):createImageBitmap(C)]})})}))];case 1:return s=h.sent(),u=[],s.forEach(function(d){var m=sv({width:n,height:i}),v=vu(m);v.drawImage(d,0,0,n,i);for(var y=v.getImageData(0,0,n,i).data,_=[],E=0;E<y.length;E+=4)_.push(y[E+2]),_.push(y[E+1]),_.push(y[E]);u.push(_)}),[2,u.map(function(d){var m=Re(function(){var v=cs(br(d,[1,n,i,3]),[0,2,1,3]).toFloat();return WD(v)});return m})]}})})}function i8(r,e){return Re(function(){var t=tw(r,e),n=wi(t,[t.shape[0],e.fc1.weights.shape[0]]),i=na(n,e.fc1),a=Ul(i,e.prelu4_alpha),s=na(a,e.fc2_1),u=oi(nv(s,1),1),c=so(Cn(s,u),1),h=na(a,e.fc2_2),d=En(c,1)[1];return{scores:d,regions:h}})}function a8(r,e,t,n,i){return Pe(this,void 0,void 0,function(){var a,s,u,c,h,d,m,v,y,_,E,x,T,C;return Le(this,function(A){switch(A.label){case 0:return a=Date.now(),[4,qD(r,e,{width:24,height:24})];case 1:return s=A.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),u=s.map(function(R){var k=i8(R,n);return R.dispose(),k}),i.stage2_rnet=Date.now()-a,c=u.length>1?xn(u.map(function(R){return R.scores})):u[0].scores,m=(d=Array).from,[4,c.data()];case 2:return h=m.apply(d,[A.sent()]),c.dispose(),v=h.map(function(R,k){return{score:R,idx:k}}).filter(function(R){return R.score>t}).map(function(R){var k=R.idx;return k}),y=v.map(function(R){return e[R]}),_=v.map(function(R){return h[R]}),E=[],x=[],y.length>0&&(a=Date.now(),T=rf(y,_,.7),i.stage2_nms=Date.now()-a,C=T.map(function(R){var k=u[v[R]].regions.arraySync();return new ew(k[0][0],k[0][1],k[0][2],k[0][3])}),x=T.map(function(R){return _[R]}),E=T.map(function(R,k){return y[R].calibrate(C[k])})),u.forEach(function(R){R.regions.dispose(),R.scores.dispose()}),[2,{boxes:E,scores:x}]}})})}function o8(r,e){return Re(function(){var t=tw(r,e);t=On(t,[2,2],[2,2],"same"),t=Si(t,e.conv4,"valid"),t=Ul(t,e.prelu4_alpha);var n=wi(t,[t.shape[0],e.fc1.weights.shape[0]]),i=na(n,e.fc1),a=Ul(i,e.prelu5_alpha),s=na(a,e.fc2_1),u=oi(nv(s,1),1),c=so(Cn(s,u),1),h=na(a,e.fc2_2),d=na(a,e.fc2_3),m=En(c,1)[1];return{scores:m,regions:h,points:d}})}function s8(r,e,t,n,i){return Pe(this,void 0,void 0,function(){var a,s,u,c,h,d,m,v,y,_,E,x,T,C,A;return Le(this,function(R){switch(R.label){case 0:return a=Date.now(),[4,qD(r,e,{width:48,height:48})];case 1:return s=R.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),u=s.map(function(k){var B=o8(k,n);return k.dispose(),B}),i.stage3_onet=Date.now()-a,c=u.length>1?xn(u.map(function(k){return k.scores})):u[0].scores,m=(d=Array).from,[4,c.data()];case 2:return h=m.apply(d,[R.sent()]),c.dispose(),v=h.map(function(k,B){return{score:k,idx:B}}).filter(function(k){return k.score>t}).map(function(k){var B=k.idx;return B}),y=v.map(function(k){var B=u[k].regions.arraySync();return new ew(B[0][0],B[0][1],B[0][2],B[0][3])}),_=v.map(function(k,B){return e[k].calibrate(y[B])}),E=v.map(function(k){return h[k]}),x=[],T=[],C=[],_.length>0&&(a=Date.now(),A=rf(_,E,.7,!1),i.stage3_nms=Date.now()-a,x=A.map(function(k){return _[k]}),T=A.map(function(k){return E[k]}),C=A.map(function(k,B){return Array(5).fill(0).map(function(P,I){var D=u[k].points.arraySync();return new _t(D[0][I]*(x[B].width+1)+x[B].left,D[0][I+5]*(x[B].height+1)+x[B].top)})})),u.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:x,scores:T,points:C}]}})})}var u8=function(r){Ye(e,r);function e(){return r.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return Pe(this,void 0,void 0,function(){return Le(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return Pe(this,void 0,void 0,function(){return Le(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,n){return n===void 0&&(n={}),Pe(this,void 0,void 0,function(){var i,a,s,u,c,h,d,m,v,y,_,E,x,T,C,A,R,k,B,P,I;return Le(this,function(D){switch(D.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(a=t.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},u=Date.now(),c=Re(function(){return Xq(oi(B_.fromPixels(a)).toFloat())}),h=function(O){return c.dispose(),s.total=Date.now()-u,O},d=c.shape.slice(1),m=d[0],v=d[1],y=new UD(n),_=y.minFaceSize,E=y.scaleFactor,x=y.maxNumScales,T=y.scoreThresholds,C=y.scaleSteps,A=(C||Jq(_,E,[m,v])).filter(function(O){var L=eb(O,[m,v]);return Math.min(L.width,L.height)>wm}).slice(0,x),s.scales=A,s.pyramid=A.map(function(O){return eb(O,[m,v])}),R=Date.now(),[4,r8(c,A,T[0],i.pnet,s)];case 1:return k=D.sent(),s.total_stage1=Date.now()-R,k.boxes.length?(s.stage2_numInputBoxes=k.boxes.length,R=Date.now(),[4,a8(a,k.boxes,T[1],i.rnet,s)]):[2,h({results:[],stats:s})];case 2:return B=D.sent(),s.total_stage2=Date.now()-R,B.boxes.length?(s.stage3_numInputBoxes=B.boxes.length,R=Date.now(),[4,s8(a,B.boxes,T[2],i.onet,s)]):[2,h({results:[],stats:s})];case 3:return P=D.sent(),s.total_stage3=Date.now()-R,I=P.boxes.map(function(O,L){return $_(z_({},new ba(P.scores[L],new U_(O.left/v,O.top/m,O.width/v,O.height/m),{height:m,width:v})),new BW(P.points[L].map(function(F){return F.sub(new _t(O.left,O.top)).div(new _t(O.width,O.height))}),{width:O.width,height:O.height}))}),[2,h({results:I,stats:s})]}})})},e.prototype.forward=function(t,n){return n===void 0&&(n={}),Pe(this,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,Ln(t)];case 1:return[4,i.apply(this,[a.sent(),n])];case 2:return[2,a.sent().results]}})})},e.prototype.forwardWithStats=function(t,n){return n===void 0&&(n={}),Pe(this,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,Ln(t)];case 1:return[2,i.apply(this,[a.sent(),n])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Zq(t)},e.prototype.extractParams=function(t){return Yq(t)},e}(lo),l8=.4,c8=[new _t(1.603231,2.094468),new _t(6.041143,7.080126),new _t(2.882459,3.518061),new _t(4.266906,5.178857),new _t(9.041765,10.66308)],h8=[117.001,114.697,97.404],f8=function(r){Ye(e,r);function e(){var t=this,n={withSeparableConvs:!0,iouThreshold:l8,classes:["face"],anchors:c8,meanRgb:h8,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,n)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return Pe(this,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return[4,this.detect(t,n)];case 1:return i=a.sent(),[2,i.map(function(s){return new ba(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(jD),xr={ssdMobilenetv1:new zD,tinyFaceDetector:new f8,tinyYolov2:new Kq,mtcnn:new u8,faceLandmark68Net:new MD,faceLandmark68TinyNet:new pq,faceRecognitionNet:new wq,faceExpressionNet:new eq,ageGenderNet:new cq},GD=function(r){Ye(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=i,a}return e}(Sf),nw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i=this;return Le(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,cv(t,this.input,function(s){return Pe(i,void 0,void 0,function(){return Le(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return xr.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,t.map(function(s,u){return ND(s,n[u])})]}})})},e.prototype.withAgeAndGender=function(){return new ow(this,this.input)},e}(GD),rw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n;return Le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,J_(t,this.input,function(a){return xr.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return n=i.sent(),[2,ND(t,n)]}})})},e.prototype.withAgeAndGender=function(){return new sw(this,this.input)},e}(GD),iw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new uw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cw(this,this.input)},e}(nw),aw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new lw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hw(this,this.input)},e}(rw),KD=function(r){Ye(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=i,a}return e}(Sf),ow=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i=this;return Le(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,cv(t,this.input,function(s){return Pe(i,void 0,void 0,function(){return Le(this,function(u){switch(u.label){case 0:return[4,Promise.all(s.map(function(c){return xr.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,u.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,t.map(function(s,u){var c=n[u],h=c.age,d=c.gender,m=c.genderProbability;return BD(VD(s,d,m),h)})]}})})},e.prototype.withFaceExpressions=function(){return new nw(this,this.input)},e}(KD),sw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i,a,s;return Le(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?[4,J_(t,this.input,function(c){return xr.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return n=u.sent(),i=n.age,a=n.gender,s=n.genderProbability,[2,BD(VD(t,a,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new rw(this,this.input)},e}(KD),uw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new iw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cw(this,this.input)},e}(ow),lw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new aw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hw(this,this.input)},e}(sw),XD=function(r){Ye(e,r);function e(t,n){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i}return e}(Sf),cw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n;return Le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,cv(t,this.input,function(a){return Promise.all(a.map(function(s){return xr.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=i.sent(),[2,n.map(function(a,s){return FD(t[s],a)})]}})})},e.prototype.withFaceExpressions=function(){return new iw(this,this.input)},e.prototype.withAgeAndGender=function(){return new uw(this,this.input)},e}(XD),hw=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n;return Le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,J_(t,this.input,function(a){return xr.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=i.sent(),[2,FD(t,n)]}})})},e.prototype.withFaceExpressions=function(){return new aw(this,this.input)},e.prototype.withAgeAndGender=function(){return new lw(this,this.input)},e}(XD),$D=function(r){Ye(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=i,a}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?xr.faceLandmark68TinyNet:xr.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Sf),d8=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i,a,s,u=this;return Le(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),n=t.map(function(h){return h.detection}),this.input instanceof Gt?[4,q_(this.input,n)]:[3,3];case 2:return a=c.sent(),[3,5];case 3:return[4,W_(this.input,n)];case 4:a=c.sent(),c.label=5;case 5:return i=a,[4,Promise.all(i.map(function(h){return u.landmarkNet.detectLandmarks(h)}))];case 6:return s=c.sent(),i.forEach(function(h){return h instanceof Gt&&h.dispose()}),[2,t.map(function(h,d){return $_(h,s[d])})]}})})},e.prototype.withFaceExpressions=function(){return new iw(this,this.input)},e.prototype.withAgeAndGender=function(){return new uw(this,this.input)},e.prototype.withFaceDescriptors=function(){return new cw(this,this.input)},e}($D),p8=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i,a,s;return Le(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),t?(n=t.detection,this.input instanceof Gt?[4,q_(this.input,[n])]:[3,3]):[2];case 2:return a=u.sent(),[3,5];case 3:return[4,W_(this.input,[n])];case 4:a=u.sent(),u.label=5;case 5:return i=a,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=u.sent(),i.forEach(function(c){return c instanceof Gt&&c.dispose()}),[2,$_(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new aw(this,this.input)},e.prototype.withAgeAndGender=function(){return new lw(this,this.input)},e.prototype.withFaceDescriptor=function(){return new hw(this,this.input)},e}($D),YD=function(r){Ye(e,r);function e(t,n){n===void 0&&(n=new lv);var i=r.call(this)||this;return i.input=t,i.options=n,i}return e}(Sf),m8=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n,i,a;return Le(this,function(s){switch(s.label){case 0:return t=this,n=t.input,i=t.options,i instanceof UD?[4,xr.mtcnn.forward(n,i)]:[3,2];case 1:return[2,s.sent().map(function(u){return u.detection})];case 2:if(a=i instanceof HD?function(u){return xr.tinyFaceDetector.locateFaces(u,i)}:i instanceof lv?function(u){return xr.ssdMobilenetv1.locateFaces(u,i)}:i instanceof Z_?function(u){return xr.tinyYolov2.locateFaces(u,i)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(n)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(n){return Pe(t,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,n(i.map(function(s){return z_({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new d8(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new nw(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new ow(this.runAndExtendWithFaceDetections(),this.input)},e}(YD),v8=function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Pe(this,void 0,void 0,function(){var t,n;return Le(this,function(i){switch(i.label){case 0:return[4,new m8(this.input,this.options)];case 1:return t=i.sent(),n=t[0],t.forEach(function(a){a.score>n.score&&(n=a)}),[2,n]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(n){return Pe(t,void 0,void 0,function(){var i;return Le(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,n(i?z_({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new p8(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new rw(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new sw(this.runAndExtendWithFaceDetection(),this.input)},e}(YD);function g8(r,e){return e===void 0&&(e=new lv),new v8(r,e)}function y8(r,e){if(r.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),n=Array.from(e);return Math.sqrt(t.map(function(i,a){return i-n[a]}).reduce(function(i,a){return i+Math.pow(a,2)},0))}(function(){function r(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,a=function(){return"person "+i++};this._labeledDescriptors=n.map(function(s){if(s instanceof cp)return s;if(s instanceof Float32Array)return new cp(a(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new cp(a(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(e,t){return t.map(function(n){return y8(n,e)}).reduce(function(n,i){return n+i},0)/(t.length||1)},r.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var i=n.descriptors,a=n.label;return new dS(a,t.computeMeanDistance(e,i))}).reduce(function(n,i){return n.distance<i.distance?n:i})},r.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new dS("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},r.fromJSON=function(e){var t=e.labeledDescriptors.map(function(n){return cp.fromJSON(n)});return new r(t,e.distanceThreshold)},r})();const QD=Y.createContext(),b8=({children:r})=>{const[e,t]=Y.useState(null),[n,i]=Y.useState(!0);return Y.useEffect(()=>{const a=fL(pu,s=>{t(s),i(!1)});return()=>a()},[]),Z.jsx(QD.Provider,{value:{usuario:e},children:!n&&r})},Cf=()=>Y.useContext(QD),bS={happy:"Feliz😊",sad:"Triste😢",angry:"Molesto😡",surprised:"Sorprendido😲",fearful:"Miedoso😨",disgusted:"Disgustado🤢",neutral:"Neutral😐"},_8={happy:"bg-yellow-100 border-yellow-500",sad:"bg-blue-100 border-blue-500",angry:"bg-red-100 border-red-500",surprised:"bg-purple-100 border-purple-500",fearful:"bg-indigo-100 border-indigo-500",disgusted:"bg-green-100 border-green-500",neutral:"bg-gray-100 border-gray-400"},w8={red:"Rojo 🔴",blue:"Azul 🔵",black:"Negro ⚫️",yellow:"Amarillo 🟡",green:"Verde 🟢",purple:"Morado 🟣",white:"Blanco ⚪️"},x8={red:"border-red-500",blue:"border-blue-500",black:"border-gray-800",yellow:"border-yellow-400",green:"border-green-500",purple:"border-purple-500",white:"border-gray-300"},E8={red:"bg-red-100",blue:"bg-blue-100",black:"bg-gray-300",yellow:"bg-yellow-100",green:"bg-green-100",purple:"bg-purple-100",white:"bg-white"},T8=()=>{const{usuario:r}=Cf(),[e,t]=Y.useState(""),[n,i]=Y.useState(""),[a,s]=Y.useState(null),[u,c]=Y.useState(!1),h=Y.useRef(null),d=ma(),m=Y.useRef(null);Y.useEffect(()=>{(async()=>{await xr.tinyFaceDetector.loadFromUri("/models"),await xr.faceExpressionNet.loadFromUri("/models")})()},[]);const v=async()=>{try{const E=await navigator.mediaDevices.getUserMedia({video:!0});h.current.srcObject=E}catch{alert("No se pudo acceder a la cámara.")}},y=async()=>{if(s(null),h.current){const E=await g8(h.current,new HD).withFaceExpressions();if(E){const x=Object.entries(E.expressions).reduce((T,C)=>T[1]>C[1]?T:C)[0];s(x),t(x),c(!0),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{c(!1),m.current=null},8e3)}else alert("No se detectó ninguna cara, intenta de nuevo.")}},_=async E=>{if(E.preventDefault(),!a){alert("Primero debes detectar tu emoción.");return}if(!e||!n){alert("Por favor completa todas las selecciones.");return}try{const x=oa(Ti,"usuarios",r.email);await FU(x,{estadoAnimo:e,colorPreferido:n,emocionDetectada:a}),console.log("Datos guardados en Firestore"),d("/")}catch(x){console.error("Error al guardar en Firestore:",x),alert("Hubo un problema al guardar los datos.")}};return Z.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 px-6 py-10",children:[Z.jsxs("div",{className:"mb-5 flex flex-col items-center w-full max-w-md -mt-3",children:[Z.jsx("video",{ref:h,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full max-w-xs h-auto rounded-lg bg-black mb-5"}),Z.jsxs("div",{className:"flex flex-wrap gap-4 justify-center w-full sm:flex-row flex-col items-center",children:[Z.jsxs("button",{onClick:v,className:"w-full sm:w-auto bg-red-500 text-white px-5 py-3 rounded-lg hover:bg-red-600 transition flex items-center justify-center gap-2",children:["Activar Cámara"," ",Z.jsx("span",{className:"inline-flex items-center leading-none relative text-xl sm:text-3xl",style:{top:"-4px"},children:"📷"})]}),Z.jsxs("button",{onClick:y,className:"w-full sm:w-auto text-white px-5 py-3 rounded-lg transition flex items-center justify-center gap-2 bg-gray-500 hover:bg-gradient-to-r hover:from-pink-400 hover:via-purple-400 hover:to-indigo-500",children:["Detectar Emoción"," ",Z.jsx("span",{className:"inline-flex items-center leading-none relative text-xl sm:text-3xl",style:{top:"-1px"},children:"😝"})]})]}),u&&a&&Z.jsx("div",{className:"mt-6 bg-white border border-gray-300 px-5 py-3 rounded-lg text-center max-w-xs mx-auto shadow-sm animate-fade-in-out",children:Z.jsxs("p",{className:"text-lg font-semibold text-gray-700",children:["Según mi análisis, tu emoción es:"," ",Z.jsx("span",{className:"text-blue-600",children:bS[a]})]})})]}),Z.jsxs("form",{onSubmit:_,className:"bg-white p-8 rounded-2xl shadow-md w-full max-w-md",children:[Z.jsx("h2",{className:"text-3xl font-extrabold mb-8 text-center text-gray-800",children:"¿Cómo te sientes hoy?"}),Z.jsx("div",{className:"bg-gray-100 rounded-xl p-5 mb-8",children:Z.jsxs("fieldset",{children:[Z.jsx("legend",{className:"text-xl font-semibold mb-5 text-gray-700",children:"Estado de ánimo"}),Z.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Object.entries(bS).map(([E,x])=>Z.jsxs("label",{className:`
      cursor-pointer flex items-center gap-3 text-gray-700 hover:text-blue-600 
      transition select-none rounded-lg p-2 border
      ${e===E?_8[E]:"border-transparent"}
    `,children:[Z.jsx("input",{type:"radio",name:"estado",value:E,checked:e===E,onChange:T=>t(T.target.value),className:"form-radio h-5 w-5 text-blue-600"}),Z.jsx("span",{className:"text-base",children:x})]},E))})]})}),Z.jsx("div",{className:"bg-gray-100 rounded-xl p-5 mb-6",children:Z.jsxs("fieldset",{children:[Z.jsx("legend",{className:"text-xl font-semibold mb-5 text-gray-700",children:"Color que prefieres hoy"}),Z.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Object.entries(w8).map(([E,x])=>{const T=n===E;return Z.jsxs("label",{className:`
                      cursor-pointer flex items-center gap-3 text-gray-700 hover:text-blue-600 transition-colors duration-300 select-none
                      rounded-lg p-3 border-2
                      ${T?`${E8[E]} ${x8[E]}`:"border-transparent"}
                    `,children:[Z.jsx("input",{type:"radio",name:"color",value:E,checked:T,onChange:C=>i(C.target.value),className:"form-radio h-5 w-5 text-blue-600"}),Z.jsx("span",{className:"text-base",children:x})]},E)})})]})}),Z.jsx("button",{type:"submit",className:"w-full bg-red-500 text-white py-3 rounded-xl font-semibold hover:bg-red-700 transition",children:"Continuar"})]})]})},S8=()=>{const r=ao(),e=ma(),{usuario:t}=Cf(),{recomendaciones:n=[],emotion:i="neutral"}=r.state||{},[a,s]=Y.useState(0),[u,c]=Y.useState([]),[h,d]=Y.useState(""),[m,v]=Y.useState(null),[y,_]=Y.useState(!1),[E,x]=Y.useState(!1),T=Y.useRef(null),C=Y.useRef(null),A=["https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExeWp3ZTV1eDF1bm40aGVpN3pzajJndDFneXQ3NW05bTQ5djNpZGN0eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/s0kLsuucleKE7CDb6W/giphy.gif","https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExZWV2d2QwMzBndXZsbXlmaHM5c3pmY3RrajlhM2N5dThsMTFscTNhaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/NKPUJzeCNsUiiOopAk/giphy.gif","https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMWc3MGZjeWh5eHZvZnFxczYxb2FtOWxsam9pN3h0MHNtY3R5Ym9tdSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l41Ypc6k7m6p3vXuU/giphy.gif","https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExdGNydTJuMWxrbHY1cHl1MjRoZGs4dTBtbm92MWJneHlrbGxva3JidSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/eNCT1AS48GvM98DCXk/giphy.gif","https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExdTlpOTBoNmltNHlwcmdlZTM1NW5jZGI4M2pzY3VvYno4a2E3MzhjbyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/YZOsKxJfmvzG0/giphy.gif","https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExdXYxNHZuZDRmOTN4aTZqd20xMTBpZ2QwdDBmZnJ1anc0Ym9teGVtcSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/CPlkqEvq8gRDW/giphy.gif"],R=A[Math.floor(Math.random()*A.length)];Y.useEffect(()=>{if(a+1<n.length){const L=new Image;L.src=n[a+1].link}},[a,n]),Y.useEffect(()=>{(async()=>{if(t!=null&&t.email)try{const F=oa(Ti,"usuarios",t.email),V=await Xl(F);V.exists()&&V.data().formularioLlenado&&_(!0)}catch(F){console.error("Error al verificar si ya llenó el formulario:",F)}})()},[t]);const k=async()=>{try{if(!(t!=null&&t.email)){alert("Debes estar autenticado para registrar el formulario");return}const L=oa(Ti,"usuarios",t.email);await Yh(L,{formularioLlenado:!0},{merge:!0}),_(!0)}catch(L){console.error("Error al marcar el formulario como llenado:",L)}},B=L=>{if(E)return;x(!0);const F=L?"swipe-right":"swipe-left",V=L?"❤️":"❌";d(F),v(V),setTimeout(()=>{L&&c(ie=>[...ie,n[a]]),s(ie=>ie+1),d(""),v(null),x(!1)},850)},P=L=>{C.current=L.clientX},I=L=>{const V=L.clientX-C.current;Math.abs(V)>80&&(V>0?B(!0):B(!1))},D=async()=>{try{if(!(t!=null&&t.email)){alert("Usuario no autenticado");return}const L=Jb(Ti,"usuarios",t.email,"preferencias");for(const ie of u){const se=oa(L,ie.id);(await Xl(se)).exists()?console.log(`Prenda ${ie.productDisplayName} ya existe.`):(await Yh(se,ie),console.log(`Prenda ${ie.productDisplayName} guardada.`))}const F=await fetch("https://smartwear-ai-backend-2.onrender.com/api/tinder-feedback-batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emotion:i,likes:u})}),V=await F.json();F.ok?e("/"):console.error("❌ Error al enviar likes:",V)}catch(L){console.error("Error al guardar preferencias:",L),alert("Error al guardar preferencias")}};if(!n.length)return Z.jsx("p",{children:"No hay recomendaciones para mostrar."});if(a>=n.length){const L=n.length,F=u.length,V=F/L;let ie="😐";return V>=.8?ie="😍":V>=.6?ie="😊":V>=.4?ie="🙂":V>=.2?ie="😕":ie="😢",Z.jsxs("div",{className:"shinder-end",children:[Z.jsx("h2",{children:"¡Has visto todas las recomendaciones!"}),Z.jsxs("p",{className:"resultado-final",children:[ie," Te gustaron ",F," de ",L," prendas."]}),!y&&Z.jsxs("div",{className:"formulario-feedback",children:[Z.jsx("img",{src:R,alt:"gif gracioso",className:"gif-feedback"}),Z.jsx("p",{children:"¿Qué te pareció nuestra app? Por favor, llena este formulario. ¡Solo te tomará un minuto!"}),Z.jsx("a",{href:"https://forms.gle/2aMwt6zWPTAZa4YSA",target:"_blank",rel:"noopener noreferrer",className:"boton-formulario",children:"Ir al formulario ✍️"}),Z.jsx("button",{onClick:k,className:"boton-ya-llene",children:"Ya llené el formulario ✅"}),Z.jsx("p",{children:"No olvides enviar las prendas que te gustaron!"})]}),Z.jsx("button",{onClick:D,className:"boton-enviar",children:"Enviar prendas que me gustaron"})]})}const O=n[a];return Z.jsxs("div",{className:"shinder-container",children:[Z.jsx("h2",{children:"¿Te gusta esta prenda?"}),Z.jsxs("div",{ref:T,className:`shinder-card ${h}`,onMouseDown:P,onMouseUp:I,children:[m&&Z.jsx("div",{className:`indicador ${m==="❤️"?"like":"dislike"}`,children:m}),Z.jsx("img",{src:O.link,alt:O.productDisplayName}),Z.jsx("h3",{children:O.productDisplayName}),Z.jsxs("p",{children:["Color: ",O.baseColour," | Categoría: ",O.category]})]}),Z.jsxs("div",{className:"shinder-buttons",children:[Z.jsx("button",{className:"btn-dislike",onClick:()=>B(!1),disabled:E,children:Z.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:Z.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),Z.jsx("button",{className:"btn-like",onClick:()=>B(!0),disabled:E,children:Z.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"#fff",children:Z.jsx("path",{d:`M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 \r
              2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 \r
              4.5 2.09C13.09 3.81 14.76 3 16.5 3 \r
              19.58 3 22 5.42 22 8.5c0 3.78-3.4 \r
              6.86-8.55 11.54L12 21.35z`})})})]})]})},mp=({children:r})=>{const{usuario:e}=Cf();return e?r:Z.jsx(SO,{to:"/login"})},C8=r=>{const e=[...r];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e},A8=()=>{const{categoria:r}=hO(),[e,t]=Y.useState([]),[n,i]=Y.useState([]),[a,s]=Y.useState(""),[u,c]=Y.useState(""),{usuario:h}=Cf(),d=ma(),m=Y.useRef(null),v=Y.useRef(null),[y,_]=Y.useState({}),E=C=>C==="falda-vestido"?"falda/vestido":C;Y.useEffect(()=>{(async()=>{try{if(!(h!=null&&h.email))return;const A=oa(Ti,"usuarios",h.email),R=await Xl(A);if(R.exists()){const B=R.data().emocionDetectada||"neutral";c(B.toLowerCase())}else console.warn("No se encontró el documento del usuario.")}catch(A){console.error("Error al obtener emoción de Firestore:",A)}})()},[h]),Y.useEffect(()=>{if(!a||!u)return;const C=`https://smartwear-ai-backend-2.onrender.com/api/recommendations/${u}?categoria=${E(r)}&gender=${a}`;fetch(C).then(A=>A.json()).then(A=>{const R=C8(A);t(R)}).catch(A=>{console.error("Error al cargar recomendaciones:",A)})},[r,a,u]),Y.useEffect(()=>{const C=()=>{const A=a==="men"?m.current:v.current;A&&_({width:A.offsetWidth+"px",left:A.offsetLeft+"px"})};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[a]);const x=C=>{const A=n.find(R=>R.id===C.id);i(A?n.filter(R=>R.id!==C.id):[...n,C])},T=async()=>{try{const C=Jb(Ti,"usuarios",h.email,"preferencias");for(const k of n){const B=oa(C,k.id);(await Xl(B)).exists()?console.log(`⏭️ Prenda ya existente: ${k.productDisplayName}`):(await Yh(B,k),console.log(`✅ Guardada prenda: ${k.productDisplayName}`))}const A=await fetch("https://smartwear-ai-backend-2.onrender.com/api/tinder-recommendation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emotion:u,gender:a,category:r})}),R=await A.json();A.ok&&R.recommendations?d("/shinder",{state:{recomendaciones:R.recommendations,emotion:u}}):console.error("Error del backend:",R)}catch(C){console.error("Error al guardar:",C),alert("Error al guardar preferencias")}};return Z.jsxs("div",{className:"pt-0 min-h-screen p-6",children:[Z.jsx("h1",{className:"text-3xl font-bold mb-4 text-center text-red-500",children:"Selecciona las prendas que más te gusten"}),Z.jsxs("div",{className:"mb-6 text-center",children:[Z.jsx("p",{className:"mb-4 font-semibold text-xl text-gray-800",children:"Elige una colección para explorar"}),Z.jsxs("div",{className:"relative flex justify-center gap-0 mb-6 rounded-md",style:{width:"fit-content",margin:"0 auto"},children:[Z.jsx("div",{className:`absolute top-0.5 bottom-0.5 rounded-md transition-all duration-300 ease-in-out ${a==="men"?"bg-blue-500":a==="women"?"bg-pink-500":"bg-gray-300"}`,style:{left:a?y.left?`calc(${y.left} + 4px)`:0:m.current&&v.current?`${m.current.offsetLeft}px`:0,width:a?y.width?`calc(${y.width} - 8px)`:"0px":m.current&&v.current?`${v.current.offsetLeft+v.current.offsetWidth-m.current.offsetLeft}px`:"0px",zIndex:0}}),Z.jsx("button",{ref:m,style:{width:"130px"},className:`relative z-10 px-6 py-2 rounded-md font-medium transition-colors duration-300 ${a==="men"?"text-white":"text-gray-700"}`,onClick:()=>s("men"),children:"Masculino"}),Z.jsx("button",{ref:v,style:{width:"130px"},className:`relative z-10 px-6 py-2 rounded-md font-medium transition-colors duration-300 ${a==="women"?"text-white":"text-gray-700"}`,onClick:()=>s("women"),children:"Femenino"})]})]}),Z.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4",children:e.map(C=>Z.jsxs("div",{className:`p-1 rounded-lg border-2 bg-white cursor-pointer transition-transform duration-300 hover:scale-105 ${n.find(A=>A.id===C.id)?"border-red-500 shadow-md":"border-gray-200"}`,onClick:()=>x(C),children:[Z.jsx("img",{src:C.link,alt:C.productDisplayName,className:"w-full aspect-square object-cover rounded-md"}),Z.jsx("p",{className:"text-sm mt-1 text-center font-medium",children:C.productDisplayName})]},C.id))}),n.length>0&&Z.jsx("button",{onClick:T,className:"mt-6 bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-3 rounded-lg block mx-auto",children:"Guardar Preferencias"})]})};function R8({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{d:"M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z"}),Y.createElement("path",{d:"m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z"}))}const I8=Y.forwardRef(R8);function D8({title:r,titleId:e,...t},n){return Y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},t),r?Y.createElement("title",{id:e},r):null,Y.createElement("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z",clipRule:"evenodd"}))}const N8=Y.forwardRef(D8),k8=()=>{var s;const r=ma(),[e,t]=Y.useState(!1),n=Y.useRef(null),i=(s=pu.currentUser)==null?void 0:s.email,a=()=>{dL(pu).then(()=>r("/login"))};return Y.useEffect(()=>{const u=c=>{n.current&&!n.current.contains(c.target)&&t(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),Z.jsxs("nav",{className:`group px-4 py-3 flex justify-between items-center
        bg-red-500 text-white shadow-md
        md:bg-transparent md:shadow-none md:text-gray-600
        md:hover:bg-red-500 md:hover:text-white
        md:transition-colors md:duration-300
        backdrop-blur-md`,children:[Z.jsxs("div",{className:"relative flex items-center",children:[Z.jsx(I8,{onClick:()=>r("/"),className:"h-8 w-8 cursor-pointer transition-all duration-300 transform md:group-hover:-translate-y-1 md:group-hover:scale-105 md:group-hover:opacity-90 md:group-hover:text-white"}),Z.jsx("span",{className:"hidden md:inline-block absolute left-10 opacity-0 group-hover:opacity-100 transform -translate-x-2 group-hover:translate-x-0 transition-all duration-300 text-lg font-medium",children:"Inicio"})]}),Z.jsxs("div",{className:"flex items-center gap-5 relative",children:[Z.jsx("button",{onClick:()=>r("/estado-animo"),className:"text-lg transition-all duration-300 transform md:hover:-translate-y-1 md:hover:scale-105 md:hover:opacity-90 group-hover:text-white",children:"Repetir Test"}),Z.jsxs("div",{className:"relative",ref:n,children:[Z.jsx(N8,{onClick:()=>t(u=>!u),className:"h-9 w-9 cursor-pointer transition-transform duration-300 transform md:hover:scale-105 group-hover:text-white"}),e&&Z.jsxs("div",{className:"absolute right-0 mt-3 w-56 bg-white text-gray-800 rounded-lg shadow-lg z-50 p-4",children:[Z.jsx("p",{className:"text-sm mb-3 font-medium truncate",children:i}),Z.jsxs("button",{onClick:a,className:"w-full flex items-center gap-2 px-3 py-2 rounded-md hover:bg-red-100 text-red-600 transition-all duration-200",children:[Z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#dc2626",viewBox:"0 0 256 256",children:Z.jsx("path",{d:"M120,216a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V40a8,8,0,0,1,8-8h64a8,8,0,0,1,0,16H56V208h56A8,8,0,0,1,120,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L204.69,120H112a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,229.66,122.34Z"})}),Z.jsx("span",{className:"flex-1 text-left",children:"Cerrar sesión"})]})]})]})]})]})},vp=({children:r})=>Z.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Z.jsx(k8,{}),Z.jsx("main",{className:"p-4",children:r})]}),O8=({children:r})=>{const{usuario:e}=Cf(),[t,n]=Y.useState(!0),[i,a]=Y.useState(!1),s=ma();return Y.useEffect(()=>{e&&(async()=>{const c=oa(Ti,"usuarios",e.email),h=await Xl(c);if(h.exists()){const d=h.data();!d.estadoAnimo||!d.emocionDetectada||!d.colorPreferido?s("/estado-animo"):a(!0)}n(!1)})()},[e]),t?Z.jsx("div",{children:"Cargando..."}):i?r:null};function M8(){return Z.jsx(QO,{children:Z.jsxs(AO,{children:[Z.jsx(Qs,{path:"/login",element:Z.jsx(GU,{})}),Z.jsx(Qs,{path:"/register",element:Z.jsx(KU,{})}),Z.jsx(Qs,{path:"/",element:Z.jsx(mp,{children:Z.jsx(O8,{children:Z.jsx(vp,{children:Z.jsx($U,{})})})})}),Z.jsx(Qs,{path:"/estado-animo",element:Z.jsx(mp,{children:Z.jsx(vp,{children:Z.jsx(T8,{})})})}),Z.jsx(Qs,{path:"/seleccion-prendas/:categoria",element:Z.jsx(mp,{children:Z.jsx(vp,{children:Z.jsx(A8,{})})})}),Z.jsx(Qs,{path:"/shinder",element:Z.jsx(mp,{children:Z.jsx(vp,{children:Z.jsx(S8,{})})})})]})})}Pk.createRoot(document.getElementById("root")).render(Z.jsx(Ak.StrictMode,{children:Z.jsx(b8,{children:Z.jsx(M8,{})})}))});export default P8();
